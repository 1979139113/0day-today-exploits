  ;;,   `&#039;;, ;;     ;;;`;;;;,  `;;;
  `[[     [[[[&#039;     [[[  [[[[[. &#039;[[
   $$,    $$$$      $$$  $$$ "Y$c$$
   888_,o8P&#039;88    .d888  888    Y88
   MMMMP"`   "YmmMMMM""  MMM     YM
    
  [ Discovered by dun \ posdub[at]gmail.com ]
  [ 2012-06-22                              ]
#################################################################
#  [ UCCASS <= v1.8.1 ]  Blind SQL Injection Vulnerability      #
#################################################################
#
# Script: "The Unit Command Climate Assessment and Survey System (UCCASS) (pronounced yoo-kas)
#          is a PHP based survey script that allows you to create online surveys..."
#
# Vendor:   http://sourceforge.net/projects/uccass/
# Download: http://sourceforge.net/projects/uccass/files/latest/download
#
################################################################
#
# [SQL]
#
#
# Vuln: http://localhost/uccass/filter.php?sid=-1 or 1=1-- (true)
#       http://localhost/uccass/filter.php?sid=-1 or 1=2-- (false)
#
 
  File: ./uccass/filter.php
  ...cut...
  <?php
 
  include(&#039;classes/main.class.php&#039;);
  include(&#039;classes/results.class.php&#039;);                 // 1 definition of filter function
 
  $survey = new UCCASS_Results;
 
  echo $survey->com_header("Filter Survey Results");
 
  echo $survey->filter($_REQUEST[&#039;sid&#039;]);               // 2 unfiltered $_REQUEST[&#039;sid&#039;] var
 
  echo $survey->com_footer();
 
  ?>
  ...cut...
 
  File: ./uccass/classes/results.class.php ( lines: 441-479 )
  ...cut...
  function filter($sid)
  {
       $x = 0;
       $qid_list = &#039;&#039;;
 
       foreach($_REQUEST[&#039;select_qid&#039;] as $qid)
       { $qid_list .= (int)$qid . &#039;,&#039;; }
       $qid_list = substr($qid_list,0,-1);
 
       $query = "SELECT at.aid, q.qid, q.question, s.survey_text_mode
                 WHERE q.aid = at.aid AND q.sid = $sid AND q.qid IN ($qid_list) AND at.type IN (&#039;MM&#039;,&#039;MS&#039;)   // 3 [SQL]
                 AND q.sid = s.sid
                 ORDER BY q.page, q.oid";
       $rs = $this->db->Execute($query);
 
       $old_aid = &#039;&#039;;
       if($rs === FALSE) { $this->error("Error selecting filter questions: " . $this->db->ErrorMsg()); }
       if($r = $rs->FetchRow())
       {
           do
           {
               $question[&#039;question&#039;][] = nl2br($this->SfStr->getSafeString($r[&#039;question&#039;],$r[&#039;survey_text_mode&#039;]));
               $question[&#039;encquestion&#039;][] = $this->SfStr->getSafeString($r[&#039;question&#039;],SAFE_STRING_TEXT);
               $question[&#039;aid&#039;][] = $r[&#039;aid&#039;];
               $question[&#039;qid&#039;][] = $r[&#039;qid&#039;];
               $temp = $this->get_answer_values($r[&#039;aid&#039;],BY_AID,$r[&#039;survey_text_mode&#039;]);
               $question[&#039;value&#039;][] = $temp[&#039;value&#039;];
               $question[&#039;avid&#039;][] = $temp[&#039;avid&#039;];
               $x++;
           }while($r = $rs->FetchRow());
           $this->smarty->assign("question",$question);
       }
       $rs = $this->db->Execute("SELECT MIN(entered) AS mindate,
                                 MAX(entered) AS maxdate FROM
       if($rs === FALSE) { $this->error("Error selecting min/max survey dates: " . $this->db->ErrorMsg()); }
       $r = $rs->FetchRow();
  ...cut...
 
### [ dun / 2012 ] #####################################################



