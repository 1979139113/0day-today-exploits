# Date: 21-05-2015
# Software Link: http://www.pluck-cms.org/
# Exploit Author: Kacper Szurek
# Contact: http://twitter.com/KacperSzurek
# Website: http://security.szurek.pl/
# Category: webapps

1. Description


File: data/modules/albums/albums_getimage.php

$image = $_GET[&#039;image&#039;];

//Then, check for hacking attempts (Remote Code Execution), and block them.
if (strpos($image, &#039;thumb&#039;) === false) {
		if ($image != $matches[0]) {
			unset($image);
			die(&#039;A hacking attempt has been detected.&#039;);
		}
	}
}

elseif (strpos($image, &#039;thumb&#039;) !== false) {
		if ($image != $matches[0]) {
			unset($image);
			die(&#039;A hacking attempt has been detected.&#039;);
		}
	}
}

//...if no hacking attempts found:
//Check if file exists.
if (file_exists(&#039;../../settings/modules/albums/&#039;.$image)) {
	//Generate the image, make sure it doesn&#039;t end up in the visitors buffer.
	header(&#039;Expires: Thu, 19 Nov 1981 08:52:00 GMT&#039;);
	header(&#039;Pragma: no-cache&#039;);
	header(&#039;Content-Type: image/jpeg&#039;);
	echo readfile(&#039;../../settings/modules/albums/&#039;.$image);
}

//If image doesn&#039;t exist, send 404 header.
else
	header(&#039;HTTP/1.0 404 Not Found&#039;);

http://security.szurek.pl/pluck-cms-472-path-traversal.html

2. Proof of Concept

  
3. Solution:
  
Update to version 4.7.3
https://github.com/pluck-cms/pluck/archive/4.7.3.zip

