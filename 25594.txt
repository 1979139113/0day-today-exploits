Conditional Privilege Escalation.
# CVE-ID: NA
# Date: 13/04/2016
# Exploit Author: Vincent Yiu
# Contact: vysec.private@gmail.com
# Vendor Homepage: http://www.leagueoflegends.com
# Software Link: screensaver.euw.leagueoflegends.com/en_US
# Version: MD5 Hash: 0C1B02079CA8BF850D59DD870BC09963
# Tested on: Windows 7 Professional x64 fully updated.
 
1. Description:
 
The League of Legends installer would install the League of Legends
screensaver along with a service. The service would be called
&#039;lolscreensaver&#039;. This particular service was misconfigured such that
the service binary path was unquoted. When the screensaver is
installed to &#039;C:\Riot Games&#039;, the issue is not exploitable. However,
during the installation process, users are able to specify a directory
to install to. When a user chooses to install this to say an external
drive, this becomes exploitable.
 
This was reported to Riot Games and has been rectified in the latest version.
 
2. Proof
http://i.imgur.com/S2fuUKa.png
 
 
3. Exploit:
 
Simply run &#039;sc qc lolscreensaver&#039; and check for unquoted service path.
If the path is unquoted, then check the permissions of each directory
using space as a token.
 
Eg. D:\My Games\Hidden Files\Super Secure\Riot Games\service\service.exe
 
Do icacls on D:\, &#039;D:\My Games\&#039;, &#039;D:\My Games\Hidden Files\&#039;, &#039;D:\My
Games\Hidden Files\Super Secure\&#039;. If you are able to write files to
any of these directories, it is exploitable.
 
If &#039;D:\My Games\&#039; is writable, to exploit this issue, place a binary
to run as SYSTEM into the folder and named as &#039;Hidden.exe".

