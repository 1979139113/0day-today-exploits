Drupal Sections Module XSS Vulnerability
========================================

The text of this announcment is also available at
http://www.madirish.net/?article=440
 
Description of Vulnerability:
- - - -----------------------------
Drupal (http://drupal.org) is a robust content management system (CMS)
written in PHP and MySQL that provides extensibility through various
third party modules.  The Sections module
(http://drupal.org/project/sections) "allows you to create sections
within your site. Each section has an installed template, theme or style
attached to it."
 
The Sections module contains a cross site scripting vulnerability
because it does not properly sanitize output of section names before
display.
 
Systems affected:
- - - -----------------
Drupal 6.14 with Sections 6.x-1.2 was tested and shown to be vulnerable.
 
Impact:
- - - -------
XSS vulnerabilities may expose site administrative accounts to
compromise which could lead to web server process compromise.
 
Mitigating factors:
- - - -------------------
The Sections module must be installed.  To carry out a Sections based
XSS proof of concept exploit below the attacker must have &#039;administer
sections&#039; permissions.
 
Proof of Concept:
- - ---------------------
1.  Install Drupal 6.14
2.  Install Sections 6.x-1.2
3.  Enable the Sections module from Administer -> Site building -> Modules
4.  Click Administer -> Site building -> Sections
5.  Click the &#039;Add section&#039; button
5.  Enter "<script>alert(&#039;xss&#039;);</script>" in the &#039;Name&#039; text area
6.  Click the &#039;Add section&#039; button to save the section and observe the
rendered JavaScript
7.  Click on the &#039;Sections&#039; link in the navigation to observe the
rendered JavaScript
 
Technical details:
- - ------------------------
The Sections module fails to sanitize the output of the section name
before display.  Applying the following patch fixes this vulnerability.
 
Patch
- - -------
Applying the following patch mitigates these threats.
 
- --- sections/sections.admin.inc 2008-06-01 08:51:51.000000000 -0400
+++ sections.fixed/sections.admin.inc   2009-11-06 15:43:53.997416137 -0500
@@ -234,6 +234,7 @@ function theme_sections_admin_display_fo
   foreach (element_children($form[&#039;sections&#039;]) as $key => $id) {
     // Don&#039;t take form control structures.
     if (is_array($form[&#039;sections&#039;][$id][&#039;name&#039;])) {
+      $form[&#039;sections&#039;][$id][&#039;name&#039;][&#039;#value&#039;] =
filter_xss($form[&#039;sections&#039;][$id][&#039;name&#039;][&#039;#value&#039;]);
       $form[&#039;sections&#039;][$id][&#039;weight&#039;][&#039;#attributes&#039;][&#039;class&#039;] =
&#039;sections-order-weight&#039;;
       $rows[] = array(
         &#039;data&#039; => array(
 
 
Vendor Response
- ---------------
Upgrade to the latest version.
SA-CONTRIB-2009-112 http://drupal.org/node/661404



