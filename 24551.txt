
Vendor:
====================================
codefuture.co.uk/projects/imagehost


Product:
===================================
CF Image Host 1.65 - 1.6.6

Archive download listed as: version 1.65
unzips as imagehost 1.6.6


Vulnerability Type:
=====================
PHP Command Injection


Vulnerability Details:
=====================

CF Imagehost allows users who have access to the management area the
ability to write directly to the &#039;set.php&#039; page under
the /inc directory that stores setting values for the &#039;Site Title&#039;, &#039;Site
Slogan&#039; etc, this allows a local attacker ability to
inject specially crafted PHP command payloads to execute arbitrary
operating system commands on the victim host. Possibly leading
to privilege escalation, RFI, backdoors etc.. and most likely full
compromise of the affected system or shared environment
if applicable.



PHP Command Injection Exploit code(s):
=====================================

Under the setting tab we can inject following below PHP code and it will
remain persistent as it is written disk in &#039;set.php&#039;,
afterwards when the victim visits the application and click a tab the
persistent OS command will be executed.


1) navigate to CF image host settings tab
http://localhost/imagehost1.6.6/admin.php?act=set
2) click on admin menu on left and enter your passwords DO NOT click &#039;Save
changes&#039; yet! or you get error message to enter creds
3) now go back to settings tab and click &#039;General&#039; then inject below PHP
code into the &#039;Site Title&#039; input field
4) now click &#039;Save Changes&#039;, this code will get stored under  /inc
directory within the &#039;set.php&#039; PHP file.

our PHP injection payload needs the single quotes, double back slashes,
semicolons as described below to correctly escape the syntax
so we do not break the PHP page and cause errors, our extra \\ quoutes and
; gets removed after injection takes place.

some examples...


&#039;;echo exec("c:\\Windows\\system32\\calc.exe");&#039;&#039;;&#039;;

&#039;set.php&#039; on line 11 then becomes:
$settings[&#039;SET_TITLE&#039;] = &#039;&#039;;echo
exec("c:\Windows\system32\calc.exe");&#039;&#039;;&#039;;&#039;;

OR inject CMD to launch chrome.exe etc...

&#039;;echo exec("c:\\Program Files
(x86)\\Google\\Chrome\\Application\\chrome.exe");&#039;&#039;;&#039;;


After, click on some tabs above like &#039;Database&#039; or &#039;Ban User&#039; and Tada!
this will execute our stored PHP command...
either running calc.exe or launching Google Chrome.


Description:
================================================================

Request Method(s):            [+] POST
Vulnerable Product:           [+] CF Image Host 1.65 - 1.6.6
Vulnerable Parameter(s):      [+] &#039;Site Title&#039;, &#039;Site Slogan&#039; etc..
Affected Area(s):             [+]  OS

