SunShop <= 4.1.4 (id) Remote SQL Injection Vulnerability
========================================================


##########################################################
# GulfTech Security Research              August 18, 2008
##########################################################
# Vendor : Turnkey Web Tools, Inc
# URL : http://www.turnkeywebtools.com
# Version : SunShop <= 4.1.4
# Risk : SQL Injection
##########################################################


Description:
SunShop shopping cart is a full featured ecommerce solution written
in php that allows for web masters to run their own online ecommerce
operation. Unfortunately there are a number of SQL Injection issues
in SunShop that allow for an attacker to have arbitrary access to the
SunShop database where they can access information such as customer
and administrator details. An updated version of SunShop has been
released to address these issues, and users should upgrade soon.



SQL Injection:
There are quite a few SQL Injection issues within SunShop that for an
attacker to have arbitrary access to the SunShop database. The first
example we will have a look at is in class.ajax.php @ lines 348-362

function edit_registry ($id="") {
    WHERE id=&#039;".$_POST[id]."&#039; AND userid=&#039;".$sess->gvar(&#039;userid&#039;)."&#039;");
    $data = filter_data($data);
    $out  = &#039;document.getElementById(\&#039;wishform\&#039;).style.display = \&#039;none\&#039;;&#039;;
    $out .= &#039;document.getElementById(\&#039;wisheditform\&#039;).style.display = \&#039;block\&#039;;&#039;;
    $out .= &#039;form = document.forms[\&#039;edit_registry\&#039;];&#039;;
    $out .= &#039;form.elements[\&#039;event[id]\&#039;].value = \&#039;&#039;.js_clean($data[id]).&#039;\&#039;;&#039;;
    $out .= &#039;form.elements[\&#039;event[name]\&#039;].value = \&#039;&#039;.js_clean($data[name]).&#039;\&#039;;&#039;;
    $out .= &#039;form.elements[\&#039;event[desc]\&#039;].value = \&#039;&#039;.js_clean($data[description]).&#039;\&#039;;&#039;;
    $out .= &#039;form.elements[\&#039;event[month]\&#039;].selectedIndex = &#039;.(date(&#039;m&#039;,
    strtotime($data[&#039;date&#039;]))-1).&#039;;&#039;;
    $out .= &#039;form.elements[\&#039;event[day]\&#039;].selectedIndex = &#039;.(date(&#039;d&#039;,
    strtotime($data[&#039;date&#039;]))-1).&#039;;&#039;;
    $out .= &#039;form.elements[\&#039;event[year]\&#039;].selectedIndex = &#039;.((date(&#039;Y&#039;,
    strtotime($data[&#039;date&#039;])))-date(&#039;Y&#039;)).&#039;;&#039;;
    return $out;
}

and is a result of a $_POST variable being used in the middle of the
query. An attacker could exploit this SQL Injection issue by making a
post request to "/index.php?l=edit_registry&p=1" with the following
post data.

id=-99&#039; UNION SELECT 1,2,3,concat(username,char(58),password),5,6 FROM ss_users/*

targeted credentials. In addition to this SQL Injection are several more
SQL Injection issues within class.ajax.php and can be found at lines 77,
113, 138 (via the check_email() function), 349, 374, and 400. With the
exception of the issue @ line 138 these issues are very easily identified as they use GPC variables directly within SQL queries.


Credits:
James Bercegay of the GulfTech Security Research Team




