# Author [ Discovered By ] : KingSkrupellos
# Team : Cyberizm Digital Security Army
# Software Version : 1.3.0
# WordPress Version : 2.6 or higher - 2.8.3 
# Tested On : Windows and Linux
# Category : WebApps
# Exploit Risk : Medium
# Google Dorks : 
StatTraq 1.1 Maintained by Murph.
StatTraq 1.0a Created by Randy Peterman.
# Vulnerability Type : CWE-89 [ Improper Neutralization of 
Special Elements used in an SQL Command (&#039;SQL Injection&#039;) ]
# PacketStormSecurity : packetstormsecurity.com/files/authors/13968
# CXSecurity : cxsecurity.com/author/KingSkrupellos/1/
# Exploit4Arab : exploit4arab.org/author/351/KingSkrupellos

###################################################################

# Information About Software :
*****************************
This plugin will allow you to keep track of every hit on your public WordPress site (note that it does not track admin activity).

The following views are available:

Summary View – an overview of blog activity
Hit Counter – a drill-down report of hits for various periods of time
User Counter – Track the number of individual computers who came to the site
Page Views – track the number of total views your WordPress installation served
Browser – Find out what browsers visited your site
Referrer – What other sites brought traffic to your own site
Search Terms – What search terms did search engined link to your site
SE Saturation – what percent of pages on your site have been crawled by the GoogleBot or the BingBot
IP addresses – What individual IP addresses requested data from your site

###################################################################

# Impact :
***********
WordPress Randy Peterman Murph StatTraq 1.1 is prone to an SQL-injection vulnerability 
because it fails to sufficiently sanitize user-supplied data before using it in an SQL query. 
Exploiting this issue could allow an attacker to compromise the application, access or 
modify data, or exploit latent vulnerabilities in the underlying database. 
A remote attacker can send a specially crafted request to the vulnerable application and 
execute arbitrary SQL commands in application`s database. Further exploitation of this 
vulnerability may result in unauthorized data manipulation. 
An attacker can exploit this issue using a browser or with any SQL Injector Tool.

###################################################################

# SQL Vulnerable File :
**********************
/wp-stattraq/index.php

<?php
/************************************************************
Version   Change
  1.1     Changed the footer information from Randy Peterman
          to me as the author.
          Fixed the code so that you can view it without logging in.
  1.1.1   Patch fix for disable login feature.
    information from Murph to me as the author.

************************************************************/
// Import own css file
add_action(&#039;admin_head&#039;, &#039;stattraq_admin_css&#039;);
timer_start();
$options = st_loadOptions();

$year = (int)st_getVar(&#039;year&#039;,date("Y"));
$month = (int)st_getVar(&#039;month&#039;,date("m"));
$day = (int)st_getVar(&#039;day&#039;,date("d"));
$hour = (int)st_getVar(&#039;hour&#039;,date("H"));
$minute = (int)st_getVar(&#039;day&#039;,date("i"));
$view = st_getVar(&#039;view&#039;, $options[&#039;default_view&#039;]);
$time_frame = st_getVar(&#039;time_frame&#039;, $options[&#039;default_time_frame&#039;]); // day
$orderBy = st_getVar(&#039;orderBy&#039;, "dd");
$session_id = st_getVar(&#039;session_id&#039;, &#039;google&#039;);
$limitPage = st_getVar(&#039;limitPage&#039;,0); // the page number for the SQL query limit
$limitNumber = st_getVar(&#039;limitNumber&#039;, $options[&#039;default_limit_number&#039;]); // the number of results to be returned in the query
$showReferrerType = st_getVar(&#039;showReferrerType&#039;, 0);

$wpst_url = get_bloginfo(&#039;wpurl&#039;) . "/wp-admin/admin.php?page=wp-stattraq/index.php&";
$wpst_ip_url = get_bloginfo(&#039;wpurl&#039;) . "/wp-content/plugins/wp-stattraq/access_detail.php?";
$wpst_chart_url = get_bloginfo(&#039;wpurl&#039;) . "/wp-content/plugins/wp-stattraq/reporter/chart_maker.php?";

// TODO: Check to see if file exists
$views = array(&#039;hit_counter&#039;, &#039;ip_address&#039;, &#039;page_views&#039;, &#039;query_strings&#039;, &#039;search_engine_stats&#039;, &#039;referrer&#039;, &#039;session&#039;, &#039;sessions&#039;, &#039;summary&#039;, &#039;user_agent&#039;, &#039;user_counter&#039;, &#039;options&#039;);
if(in_array($view, $views))
{
  require_once(dirname(__FILE__)."/reporter/{$view}.php");
}
else
{
  echo "You hacker you.";
  exit();
}
?>
<div style="clear:right;">
<?php 
require_once(&#039;navigation.php&#039;);
?>
<div id="stcontent">
<?php
getPageContent();
?>
</div>
<div id="stfooter">
Fresh as of: <?php echo date("Y-m-d H:i:s")?><br />
Generated in: <?php timer_stop(1);?> seconds
<br />
StatTraq <?php echo $stattraq_version;?> Maintained by <a href="http://www.randypeterman.com">Randy Peterman</a>.
</div>
</div>

# SQL Vulnerable Parameter :
***************************
?view=page_views&time_frame=[ID-NUMBER]&year=[YEAR-NUMBER]&month=[MONTH-NUMBER]&day=[DAY-NUMBER]&hour=[HOUR-NUMBER]&minute=[MINUTE-NUMBER]&limitNumber=[SQL Injection]

# SQL Injection Exploit :
**********************
/wp-stattraq/index.php?view=page_views&time_frame=[ID-NUMBER]&year=[YEAR-NUMBER]&month=[MONTH-NUMBER]&day=[DAY-NUMBER]&hour=[HOUR-NUMBER]&minute=[MINUTE-NUMBER]&limitNumber=[SQL Injection]

###################################################################

# Example SQL Database Error :
****************************
Erreur de la base de données de WordPress : [You have an error in your SQL syntax; check the 
manual that corresponds to your MySQL server version for the right syntax to use near &#039;\&#039;&#039; at line 1]
SELECT article_id, COUNT( line_id ) AS cnt, DATE_FORMAT(access_time,&#039;%Y&#039;) AS year, 
DATE_FORMAT(access_time,&#039;%m&#039;) AS month, DATE_FORMAT(access_time,&#039;%d&#039;) AS day, 
DATE_FORMAT(access_time,&#039;%H&#039;) AS hour, DATE_FORMAT(access_time,&#039;%i&#039;) AS minute, 
DATE_FORMAT(access_time,&#039;%Y-%m-%d %H:00&#039;) AS dd FROM wp_stattraq WHERE
 access_time BETWEEN &#039;20050621000000&#039; AND &#039;20050621235959&#039; AND user_agent_type=0 
GROUP BY article_id ORDER BY cnt DESC LIMIT 0, 1\&#039;


