# Exploit Author: Daniel Monzón (stark0de)
# Vendor Homepage: https://www.sourcecodester.com
# Software Link: https://www.sourcecodester.com/php/14217/online-healthcare-patient-record-management-system-using-phpmysql.html
# Version: N/A
# Tested on: Kali Linux 2020.2 x64
# CVE : N/A


The Online Healthcare Patient Record Management System suffers from multiple authentication bypass vulnerabilities: 

The login.php file allows a user to just supply ‘ or 1=1 – as a username and whatever password and bypass the authentication

<?php
        session_start();
        if(ISSET($_POST[&#039;login&#039;])){
                $username = $_POST[&#039;username&#039;];
                $password = $_POST[&#039;password&#039;];
                $conn = new mysqli("localhost", "root", "", "hcpms") or die(mysqli_error());
                $query = $conn->query("SELECT * FROM `user` WHERE `username` = &#039;$username&#039; && `password` = &#039;$password&#039;") or die(mysqli_error());

The same happens with login.php for the admin area:

<?php
        session_start();
        $username = $_POST[&#039;username&#039;];
        $password = $_POST[&#039;password&#039;];
        if(ISSET($_POST[&#039;login&#039;])){
                $conn = new mysqli("localhost", "root", "", "hcpms") or die(mysqli_error());
                $query = $conn->query("SELECT *FROM `admin` WHERE `username` = &#039;$username&#039; && `password` = &#039;$password&#039;") or die(mysqli_error());
                $fetch = $query->fetch_array();
                $valid = $query->num_rows;
                        if($valid > 0){
                                $_SESSION[&#039;admin_id&#039;] = $fetch[&#039;admin_id&#039;];
                                header("location:home.php");



There is also an authentication bypass issue located in add_user.php:

<?php
        if(ISSET($_POST[&#039;save_user&#039;])){
                $username = $_POST[&#039;username&#039;]; 
                $password = $_POST[&#039;password&#039;]; 
                $firstname = $_POST[&#039;firstname&#039;]; 
                $middlename = $_POST[&#039;middlename&#039;]; 
                $lastname = $_POST[&#039;lastname&#039;]; 
                $section = $_POST[&#039;section&#039;]; 
                $conn = new mysqli("localhost", "root", "", "hcpms");
                $q1 = $conn->query("SELECT * FROM `user` WHERE `username` = &#039;$username&#039;") or die(mysqli_error());
                $f1 = $q1->fetch_array();
                $c1 = $q1->num_rows;
                        if($c1 > 0){
                                echo "<script>alert(&#039;Username already taken&#039;)</script>";
                        }else{
                                $conn->query("INSERT INTO `user` VALUES(&#039;&#039;, &#039;$username&#039;, &#039;$password&#039;, &#039;$firstname&#039;, &#039;$middlename&#039;, &#039;$lastname&#039;, &#039;$section&#039;)");
                                header("location: user.php");
                        }
        }
If a request is made with the required parameters, any user can create an admin account (no authentication is required to do this).

Finally, there are many SQL injection vulnerabilities (GET parameters directly passed to SQL queries), but those are authenticated

