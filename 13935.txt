Cpanel PHP Restriction Bypass Vulnerability 0day
================================================

1) Advisory information
 
  Title               :  Cpanel  PHP Restriction Bypass Vulnerability
  Version             : <= 11.25
  Discovery           : http://www.abysssec.com
  Vendor              :  http://www.cpanel.net
  Impact              :  Ciritical
   Contact            :  shahin [at] abysssec.com , info  [at] abysssec.com
  Twitter             : @abysssec
 
2) Vulnerability Information
 
Class
        1- Restriction Bypass Vulnerability
Impact
Attackers can use this issue to gain access to restricted files, potentially obtaining sensitive information that may aid in further attacks.It can help attacker to bypass restriction such as mod_security , Safemod and disable functions.
Remotely Exploitable
No
Locally Exploitable
Yes
 
3) Vulnerability details
 
1- Restriction Bypass Vulnerabilities:
 
Load All file with this structures :
[Domain | Filename ]
from :
/home/[user directory name/.fantasticodata/[Script name folder] and include all file.
 
Example [folder] :
/home/test/.fantasticodata/Joomla_1.5/
then include this file  :
test.com|file1
 
After you created your malicious file in that style you can browse this page:
http://test.com:2082/frontend/x3/fantastico/autoinstallhome.php?app=Joomla_1.5
 
 
Now your PHP code will execute without /safe_mode/Disable_function/ Mod_security due to cpanel php.ini must be run with execute permission.
 
Vulnerable code located in in  /usr/local/cpanel/3rdparty/fantastico/autoinstallhome.php :
Line 529 :
  function Show_Notice ( $Script , $Version_Numbers )
    {
        $Home_Directory = $GLOBALS[&#039;enc_cpanel_homedir&#039;] ;
        if ( substr ( $Home_Directory , -1 ) != &#039;/&#039; )
        {
            $Home_Directory = $Home_Directory . &#039;/&#039; ;
        }
        $Files = Array ( ) ;
[This Place]   --->     $Directory = $Home_Directory . &#039;.fantasticodata/&#039; . $Script . &#039;/&#039; ;
        $Files = Get_Files ( $Directory ) ;
        if ( !empty ( $Files ) AND is_array ( $Files ) )
        {
            $Temporary = natcasesort ( $Files ) ;
        }
        foreach ( $Files As $File )
        {
            $Name    = &#039;&#039; ;
            $Path    = &#039;&#039; ;
            if ( strstr ( $File , "|" ) )
            {
                $Name = explode ( "|" , $File ) ;
                $Name = $Name[1] ;
            }
            else
            {
                $Name = $File ;
            }
            /* Debugging */ // echo $Directory . $File . &#039;<br/>&#039; ;
            if ( is_file ( $Directory . $File ) )
            {
                include $Directory . $File ;
                if ( !empty ( $thisscriptpath ) )
                {
                    $Path = $thisscriptpath ;
                }
                else
                {
                    $Path = $Home_Directory . &#039;public_html/&#039; . $Name . &#039;/&#039; ;
                }
                if ( substr ( $Path , -1 ) != &#039;/&#039; )
                {
                    $Path = $Path . &#039;/&#039; ;
                }
                /* Debugging */ // echo $Path . &#039;fantversion.php<br/><br/>&#039; ;
                if ( is_file ( $Path . &#039;fantversion.php&#039; ) )
                {
                    include $Path . &#039;fantversion.php&#039; ;
                    if ( !empty ( $version ) )
                    {
                        if ( in_array ( $version , $Version_Numbers ) )
                        {
                            return &#039;Yes&#039; ;
                        }
                    }
                }
            }
        }
        return &#039;No&#039; ;
    }



