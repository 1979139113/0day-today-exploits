# Date: 2020-04-24
# Author: Besim ALTINOK
# Vendor Homepage: https://www.php-fusion.co.uk/home.php
# Software Link: https://sourceforge.net/projects/php-fusion/files/PHP-Fusion%20Archives/9.x/PHP-Fusion%209.03.50.zip/download
# Version: v9.03.50
# Tested on: Xampp
# Credit: Ä°smail BOZKURT and AkkuS

-------------------------------------------------------------------------------------------------
Description
---
- This system does not check the file extension when user upload photo for
avatar :). So you can upload PHP file like:

Content of the file
--
Sample PHP code: <? phpinfo(); ?>

Name of the file:
---
Sample PHP File name: tester.php

- When you want to try to upload the image to the avatar, just, try to
change the file name and content.

----------------------------------------------------------------------------------------
Vulnerable code section in the UserFieldsInput.inc
----------------------------------------------------------
    private function _setUserAvatar() {
        if (isset($_POST[&#039;delAvatar&#039;])) {
            if ($this->userData[&#039;user_avatar&#039;] != "" &&
file_exists(IMAGES."avatars/".$this->userData[&#039;user_avatar&#039;]) &&
is_file(IMAGES."avatars/".$this->userData[&#039;user_avatar&#039;])) {
                unlink(IMAGES."avatars/".$this->userData[&#039;user_avatar&#039;]);
            }
            $this->data[&#039;user_avatar&#039;] = &#039;&#039;;
        }
        if (isset($_FILES[&#039;user_avatar&#039;]) &&
$_FILES[&#039;user_avatar&#039;][&#039;name&#039;]) { // uploaded avatar
            if (!empty($_FILES[&#039;user_avatar&#039;]) &&
is_uploaded_file($_FILES[&#039;user_avatar&#039;][&#039;tmp_name&#039;])) {
                $upload = form_sanitizer($_FILES[&#039;user_avatar&#039;], &#039;&#039;,
&#039;user_avatar&#039;);
                if (isset($upload[&#039;error&#039;]) && !$upload[&#039;error&#039;]) {
                    // ^ maybe use empty($upload[&#039;error&#039;]) also can but
maybe low end php version has problem on empty.
                    $this->data[&#039;user_avatar&#039;] = $upload[&#039;image_name&#039;];
                }
            }
        }
    }

