Osclass <= 3.4.2 (ajax.php) Local File Inclusion Vulnerability
--------------------------------------------------------------


[-] Software Link:

http://osclass.org/  


[-] Affected Versions:

Version 3.4.2 and probably prior versions.


[-] Vulnerability Description:

The vulnerable code is located in the /oc-includes/osclass/controller/ajax.php script:

225.       case &#039;custom&#039;: // Execute via AJAX custom file
226.           if(Params::existParam(&#039;route&#039;)) {
227.               $routes = Rewrite::newInstance()->getRoutes();
228.               $rid = Params::getParam(&#039;route&#039;);
229.               $file = &#039;../&#039;;
230.               if(isset($routes[$rid]) && isset($routes[$rid][&#039;file&#039;])) {
231.                   $file = $routes[$rid][&#039;file&#039;];
232.               }
233.           } else {
235.               // This will be REMOVED in 3.4
236.               $file = Params::getParam(&#039;ajaxfile&#039;);
237.           }
238.  
239.           if($file == &#039;&#039;) {
240.               echo json_encode(array(&#039;error&#039; => &#039;no action defined&#039;));
241.               break;
242.           }
243.  
244.           // valid file?
245.           if( stripos($file, &#039;../&#039;) !== false  || stripos($file, &#039;/admin/&#039;) !== false ) ...
246.               echo json_encode(array(&#039;error&#039; => &#039;no valid ajaxFile&#039;));
247.               break;
248.           }
249.  
250.           if( !file_exists(osc_plugins_path() . $file) ) {
251.               echo json_encode(array(&#039;error&#039; => "ajaxFile doesn&#039;t exist"));
252.               break;
253.           }
254.  
255.           require_once osc_plugins_path() . $file;

User input passed through the "ajaxfile" request parameter when handling a "custom" action within
the AJAX interface is not properly sanitized being used in a call to the "require_once()" function
at line 255. This can be exploited to include arbitrary local files and execute arbitrary PHP code
when the application is running on Windows.


[-] Solution:

Update to version 3.4.3 or later.


[-] Disclosure Timeline:

[29/09/2014] - Vendor notified
[29/09/2014] - Vendor response
[09/10/2014] - Version 3.4.3 released: http://blog.osclass.org/2014/10/09/osclass-3-4-3
[09/10/2014] - CVE number requested
[11/10/2014] - CVE number assigned
[31/12/2014] - Public disclosure


[-] CVE Reference:

The Common Vulnerabilities and Exposures project (cve.mitre.org)
has assigned the name CVE-2014-8084 to this vulnerability.


[-] Credits:

Vulnerability discovered by Egidio Romano.

