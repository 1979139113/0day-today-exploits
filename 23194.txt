# Google Dork: inurl:webquest/soporte_horizontal_w.php?id_actividad=
# Date: [24/01/2015]
# Exploit Author: [jord4nroo7] anonjo@aol.com
# Vendor Homepage: [http://phpwebquest.org]
# Software Link: [http://phpwebquest.org/?page_id=14]
# Version: [phpwebquest-2.6]
# Tested on: [windows 8.1]
#Exploit: sql inhection found on phpwebquest script version 2.6
#
 
#example http://localhost/phpwq/webquest/soporte_horizontal_w.php?id_actividad=184&id_pagina=1%27&#039;
 
#---------------------------
if ($_GET[&#039;id_actividad&#039;]!=&#039;&#039;){
    $id_actividad=$_GET[&#039;id_actividad&#039;];--------->sqlinjection here
}else{
    $id_actividad=&#039;1500000&#039;;
}
if ($_GET[&#039;id_pagina&#039;]!=&#039;&#039;){
    $id_pagina=$_GET[&#039;id_pagina&#039;];
}else{
    $id_pagina=&#039;1&#039;;
    $texto_actual=$texto_alternativo;
    $imagen_actual=&#039;../imagenes/no_imagen.gif&#039;;
}
#----------------------------
<?
session_cache_limiter(&#039;nocache,private&#039;);
session_start();
session_set_cookie_params(0, "/", $HTTP_SERVER_VARS["HTTP_HOST"], 0);
include("../include/mysql.php");
include("../include/idioma.php");
 
$base=$mysql_db;
$c=mysql_connect($mysql_server,$mysql_login,$mysql_pass);
mysql_select_db ($base, $c);
#para solucionar un problema que se plantea cuando los usuarios crean la actividad pero no crean páginas
if ($_GET[&#039;id_actividad&#039;]!=&#039;&#039;){
    $id_actividad=$_GET[&#039;id_actividad&#039;];
}else{
    $id_actividad=&#039;1500000&#039;;
}
if ($_GET[&#039;id_pagina&#039;]!=&#039;&#039;){
    $id_pagina=$_GET[&#039;id_pagina&#039;];
}else{
    $id_pagina=&#039;1&#039;;
    $texto_actual=$texto_alternativo;
    $imagen_actual=&#039;../imagenes/no_imagen.gif&#039;;
}
 #echo "PAGINA DEL GET:".$id_pagina."<br>";
 #echo "PAGINA DEL GET:".$id_pagina."<br>";
$sentencia= "SELECT * FROM actividad WHERE id_actividad=".$id_actividad;
$resultado=mysql_query($sentencia);
while($v=mysql_fetch_array($resultado)){
   foreach ($v as $indice=>$valor){
       if(!is_int($indice)){
            # echo $indice.":".$valor."<br>";
             $campo[$indice]=$valor;
              
         }
    }
}
$sentencia="select * from pagina where id_actividad=".$id_actividad." order by num_pagina asc";
$resultado=mysql_query($sentencia);
$j=1;  
while($v=mysql_fetch_array($resultado)){
  foreach ($v as $indice=>$valor){
      if(!is_int($indice)){
            #echo $indice.":".$valor."<br>";
             $campo[$j][$indice]=$valor;
              
       }
   }
    $j++;
}
for ($cont=1; $cont<=5; $cont++){
        if ($campo[$cont][&#039;num_pagina&#039;]==$id_pagina){
            $texto_actual=$campo[$cont][&#039;texto&#039;];
            $imagen_actual=$campo[$cont][&#039;imagen&#039;];
        }  
    }
$resta=0;
$tamano_enlaces=$campo[&#039;font_size&#039;] - $resta ;
$tamano_titulo=$campo[&#039;font_size&#039;];
#echo $tamano_titulo;
?>
 
 
<html>
<head>
 
<title>PHP Webquest</title>
<!-- Webquest elaborada con PHP Webquest http://www.phpwebquest.org
Programa elaborado por Antonio Temprano bajo Licencia GPL
Puede ser utilizado gratuitamente por quien quiera hacerlo con fines
educativos y con la obligación de no quitar estas líneas de código
-->
<style>
table {
   font-family : <? echo $campo[&#039;font_face&#039;];?>;
   font-size :  <? echo $campo[&#039;font_size&#039;];?>;
   font-weight : normal;
   color: <? echo $campo[&#039;color_texto_principal&#039;];?>;
}
a  {
   font-family : <? echo $campo[&#039;font_face&#039;];?>;
   font-size : <? echo $campo[&#039;font_size&#039;];?>;
   text-decoration: none;
   color: <? echo $campo[&#039;color_enlaces&#039;];?>;
   font-weight : normal;
}
 
a:hover  {
   position: relative;
   top: 1px;
   left: 1px;
   font-family : <? echo $campo[&#039;font_face&#039;];?>;
   font-size : <? echo $campo[&#039;font_size&#039;];?>;
   text-decoration: none;
   color: <? echo $campo[&#039;color_enlaces_resaltados&#039;];?>;
   font-weight : normal; 
}
 
div.phpwebquest { font-size : 7.5pt;}
div.phpwebquest a:link { font-size : 7.5pt;}
div.phpwebquest a:hover { font-size : 7.5pt;}
div.phpwebquest a { font-size : 7.5pt;};
</style>
</head>
 
<body bgcolor="<? echo $campo[&#039;color_fondo_pagina&#039;];?>">
<div align="center">
<table width="750" border="0" cellpadding="0" cellspacing="1" bgcolor="<? echo $campo[&#039;color_cuadro_pagina&#039;];?>">
    <tr>
      <td><div align="center">
 
           
          <table width="100%" border="0" cellpadding="0" cellspacing="1" bgcolor="<? echo $campo[&#039;color_cuadro_texto&#039;];?>">
            <tr>
              <td><table width="100%" border="0" cellspacing="1" cellpadding="0">
                  <tr>
                    <td height="50"><div valign="middle" align="center"><h1><font color="<? echo $campo[&#039;color_texto_titulo&#039;];?>"><? echo $campo[&#039;titulo&#039;];?></font></h1></div></td>
                  </tr>
                  <tr>
                                  <? if ($id_pagina==1){
                                        $titular=$introduccion;
                                        }elseif($id_pagina==2){
                                        $titular=$tareas;
                                        }elseif($id_pagina==3){
                                        $titular=$proceso;                     
                                        }elseif($id_pagina==4){
                                        $titular=$evaluacion;      
                                        }else{
                                        $titular=$conclusiones;    
                                        }                        
                                ?>
                   
                    <td height="50" bgcolor="<? echo $campo[&#039;color_cuadro_pagina&#039;];?>"><font color="<? echo $campo[&#039;color_texto_tipo&#039;];?>"><div  valign="middle" align="center"><h3><? echo $titular;?></h3></div></font></td>
                  </tr>
 
                  <tr>
                    <td><table width="100%" border="0" cellspacing="1" cellpadding="0">
                        <tr>
                          <td width="81%" valign="top"><table width="100%" height="141" border="0" cellpadding="0" cellspacing="1">
                              <tr>
                                <td width="1%" height="139"> </td>
                                <td width="97%" valign="middle"><div align="left">
                                    <table width="100%" height="134" border="0" cellpadding="0" cellspacing="1">
                                      <tr>
                                        <td width="1%" valign="top"><div align="left"><img src="<? echo $imagen_actual;?>"></div></td>
                                        <td width="2%"> </td>
 
                                        <td width="97%"><? echo $texto_actual;?><br>
                        <table align=center width="80%" border=0 bgcolor="<? echo $campo[&#039;color_cuadro_menu&#039;];?>">
                         
                          <? if ($id_pagina==3){
                                echo &#039;<tr></tr>&#039;;
                                $sentencia="select url, descripcion from url where id_actividad=".$id_actividad;
                                $resultado=mysql_query($sentencia);
                                $j=1;  
                                while($v=mysql_fetch_array($resultado)){
                                  foreach ($v as $indice=>$valor){
                                     if(!is_int($indice)){
                                        if($indice==&#039;url&#039;){
                                            echo &#039;<tr><td><div class="celdamenu"><a href=&#039;.$valor.&#039; target="_blank"></div>&#039;;
                                        }else{ 
                                            echo $valor."</td></tr>";
                                        }
                                         $url[$j][$indice]=$valor;
                                        }
                                    }
                                $j++;  
                                }
                            }
                            mysql_close($c);
                        ?>
                        </table>
 
                                        </td>
                                      </tr>
                                    </table>
                                  </div></td>
                                <td width="2%"> </td>
                              </tr>
                            </table></td>
 
                          <td width="15%" valign="top">
                            <table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="<? echo $campo[&#039;color_cuadro_texto&#039;];?>" bordercolor="#FFFFFF"><tr><td> </td></tr></table>
                            <table width="100%" border="0" cellspacing="1" cellpadding="0" bgcolor="<? echo $campo[&#039;color_cuadro_menu&#039;];?>" bordercolor="#FFFFFF">
                              
                              <tr>
                                <td><div align="left"><a href="soporte_derecha_w.php?id_actividad=<? echo $campo[1][&#039;id_actividad&#039;]."&id_pagina=1"; ?>"> <? echo $enlace_introduccion; ?></a></div></td>
                              </tr>
                              <tr>
                                <td height="1" bgcolor="#FFFFFF"></td>
                              </tr>
 
                              <tr>
                                <td><div align="left"><a href="soporte_derecha_w.php?id_actividad=<? echo $campo[1][&#039;id_actividad&#039;]."&id_pagina=2"; ?>"> <? echo $enlace_tareas; ?></a></div></td>
                              </tr>
                              <tr>
                                <td height="1" bgcolor="#FFFFFF"></td>
                              </tr>
                              <tr>
                                <td><div align="left"><a href="soporte_derecha_w.php?id_actividad=<? echo $campo[1][&#039;id_actividad&#039;]."&id_pagina=3"; ?>"> <? echo $enlace_proceso; ?></a></font></div></td>
                              </tr>
 
                              <tr>
                                <td height="1" bgcolor="#FFFFFF"></td>
                              </tr>
                              <tr>
                                <td><div align="left"><a href="soporte_derecha_w.php?id_actividad=<? echo $campo[1][&#039;id_actividad&#039;]."&id_pagina=4"; ?>"> <? echo $enlace_evaluacion; ?></a></font></div></td>
 
                              </tr>
                              <tr>
                                <td height="1" bgcolor="#FFFFFF"></td>
                              </tr>
                              <tr>
                                <td><div align="left"><a href="soporte_derecha_w.php?id_actividad=<? echo $campo[1][&#039;id_actividad&#039;]."&id_pagina=5"; ?>"> <? echo $enlace_conclusiones; ?></a></font></div></td>
                              </tr>
                            </table></td>
                        </tr>
 
                      </table></td>
                  </tr>
                </table></td>
            </tr>
            <tr>
              <td height="19">
              <table width="100%" border="0" cellspacing="1" cellpadding="0">
                  <tr>
                    <td width="55%"><div class="phpwebquest" align="right"><? echo $elaborada; ?> <? echo $campo[&#039;autor&#039;];?> <? echo $con; ?></div></td>
                    <td width="45%"><div class="phpwebquest" align="left"><a href="http://www.phpwebquest.org"> PHPWebquest</a></div></td>
                  </tr>
                </table>
                </td>
            </tr>
          </table>
        </div></td>
    </tr>
  </table>
 
 </div>
</body>
</html>
 
#greetz to all my friends ,balawi,ro3ob hr ,mothana-X , sharingan jo , and anonymous jo , and all muslim hackers

