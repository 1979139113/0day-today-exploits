
CVE-2017-0298


Windows: Bad Fix for COM Session Moniker EoP

So....


However looking at the fix in HelpPane.exe you can see that the fix isn&#039;t actually sufficient. The bug is in the check.

if ( imp_token_il >= process_token_il 
  && (imp_token_il >= SECURITY_MANDATORY_HIGH_RID 
  || EqualSid(process_token_user, imp_token_user)))
{
   ShellExecuteW(NULL, L"open", path, NULL, NULL, SW_SHOW);
}


Confused? Well one case where a user will gain an elevated IL is in UAC elevation. While administrators will get High IL so will UI Access programs. Unfortunately UI access programs are easy for a normal user to hijack (in the general case). For example <a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=220" title="" class="" rel="nofollow">https://bugs.chromium.org/p/project-zero/issues/detail?id=220</a> was never fixed down level so Windows 7 and 8.X are vulnerable to a normal user being able to get trivial UI access execution (and by extension Win2008 and 2012 servers). Even on Windows 10 where this is fixed (AFAIK) there&#039;s still alternative ways of getting UI access execution through DosDevices abuse to hijack DLL loading of a valid UI access binary.



Also before you say this is a UAC bypass, just don&#039;t even start on that. I warned you about this sort of behavior with things like UI access and the IL ratchet before and you ignored it.

I&#039;ve not provided a PoC as imo the bug is self evident. I&#039;ve proven it myself manually, at least on Windows 7. If you _really_ need me to prove it with a PoC I will.

This bug is subject to a 90 day disclosure deadline. After 90 days elapse
or a patch has been made broadly available, the bug report will become
visible to the public.

