of Realtek SDK based routers
══════════════════════════════════════════════════════════════════════════

  CVE: CVE-2019-19822

  SDK vendor: Realtek

  Device vendor: TOTOLINK, Sapido, CIK Telecom, Fibergate Inc.,
  MAX-C300N, T-BROAD and possibly others..

  Product: Realtek SDK based routers backed by Boa HTTP server (and
  possibly others) and using apmib library for memory management.

  Boa Version: <= Boa/0.94.14rc21 SDK Version: < 2020/02/15

  Description: Realtek SDK based routers which use form based instead
  HTTP Basic authentication (that includes Realtek APMIB 0.11f and Boa
  HTTP server 0.94.14rc21) allows remote attackers to retrieve the
  configuration, including sensitive data (usernames and passwords).

  This affects:
  • TOTOLINK A3002RU through 2.0.0,
  • TOTOLINK 702R through 2.1.3,
  • TOTOLINK N301RT through 2.1.6,
  • TOTOLINK N302R through 3.4.0,
  • TOTOLINK N300RT through 3.4.0,
  • TOTOLINK N200RE through 4.0.0,
  • TOTOLINK N150RT through 3.4.0, and
  • TOTOLINK N100RE through 3.4.0;
  • Rutek RTK 11N AP through 2019-12-12;
  • Sapido GR297n through 2019-12-12;
  • CIK TELECOM MESH ROUTER through 2019-12-12;
  • KCTVJEJU Wireless AP through 2019-12-12;
  • Fibergate FGN-R2 through 2019-12-12;
  • Hi-Wifi MAX-C300N through 2019-12-12;
  • HCN MAX-C300N through 2019-12-12;
  • T-broad GN-866ac through 2019-12-12;
  • Coship EMTA AP through 2019-12-12; and
  • IO-Data WN-AC1167R through 2019-12-12; and
  • possibly others.

  Technical details: The apmib library at some point of initialization
  dumps the whole memory contents the file /web/config.dat. This folder
  is actually used by the boa http server as index directory.
  Additionally if the router is configured for form-based authentication
  the access control verifies credentials only for some URLs but ".dat"
  files are not restricted. This issue does not affect routers which use
  HTTP Basic authentication to secure all URLs.

  PoC:
  ┌────
  │ $ curl http://routerip/config.dat
  └────


2 Password stored in plaintext in Realtek SDK based routers
═══════════════════════════════════════════════════════════

  CVE: CVE-2019-19823

  SDK vendor: Realtek

  Device vendor: TOTOLINK, Sapido, CIK Telecom, Fibergate Inc.,
  MAX-C300N, T-BROAD and possibly others..

  Product: Realtek SDK based routers backed by Boa HTTP server (and
  possibly others) and using apmib library for memory management.

  Boa Version: <= Boa/0.94.14rc21 SDK Version: < 2020/02/15

  Description: Realtek SDK based routers (that includes Realtek APMIB
  0.11f and Boa HTTP server 0.94.14rc21) store passwords in plaintext.

  This affects:
  • TOTOLINK A3002RU through 2.0.0,
  • TOTOLINK 702R through 2.1.3,
  • TOTOLINK N301RT through 2.1.6,
  • TOTOLINK N302R through 3.4.0,
  • TOTOLINK N300RT through 3.4.0,
  • TOTOLINK N200RE through 4.0.0,
  • TOTOLINK N150RT through 3.4.0, and
  • TOTOLINK N100RE through 3.4.0;
  • Rutek RTK 11N AP through 2019-12-12;
  • Sapido GR297n through 2019-12-12;
  • CIK TELECOM MESH ROUTER through 2019-12-12;
  • KCTVJEJU Wireless AP through 2019-12-12;
  • Fibergate FGN-R2 through 2019-12-12;
  • Hi-Wifi MAX-C300N through 2019-12-12;
  • HCN MAX-C300N through 2019-12-12;
  • T-broad GN-866ac through 2019-12-12;
  • Coship EMTA AP through 2019-12-12; and
  • IO-Data WN-AC1167R through 2019-12-12; and
  • possibly others.

  Technical details: Data stored in memory in COMPCS (apmib library)
  format contains device administration and other passwords in
  plaintext. The apmib library additionally at some point of
  initialization dumps the whole memory contents the file
  /web/config.dat which might be used to easily retrieve user passwords.


3 Code execution in several TOTOLINK routers
════════════════════════════════════════════

  CVE: CVE-2019-19824

  Vendor: TOTOLINK

  Product: TOTOLINK Realtek SDK based routers

  Boa Version: <= Boa/0.94.14rc21

  Description: On several Realted SDK based TOTOLINK routers, an
  authenticated attacker may execute arbitrary OS commands via the
  sysCmd parameter to the boafrm/formSysCmd URI, even if the GUI
  (syscmd.htm) is not available. This allows for full control over the
  device&#039;s internals.

  This affects:
  • A3002RU through 2.0.0,
  • A702R through 2.1.3,
  • N301RT through 2.1.6,
  • N302R through 3.4.0,
  • N300RT through 3.4.0,
  • N200RE through 4.0.0,
  • N150RT through 3.4.0,
  • N100RE through 3.4.0, and
  • possibly others.

  PoC:
  ┌────
  │ $ curl &#039;http://routerip/boafrm/formSysCmd&#039; --user "admin:password" 
  │   --data &#039;submit-url=%2Fsyscmd.htm&sysCmdselect=5&sysCmdselects=0&
  │   save_apply=Run+Command&sysCmd=cp%20%2Fetc%2Fpasswd%20%2Fweb%2Fxxxx.dat&#039;
  └────


4 Incorrectly implemented captcha protection in TOTOLINK routers
════════════════════════════════════════════════════════════════

  CVE: CVE-2019-19825

  Vendor: TOTOLINK

  Product: TOTOLINK Realtek SDK based routers

  Boa Version: <= Boa/0.94.14rc21

  Description: Guessable captcha vulnerability (CWE-804) in several
  series of TOTOLINK routers allows a remote attacker to automatically
  login to the router without reading and providing real captcha.

  The following command returns captcha in plain text:
  ┌────
  │ $ curl &#039;http://routerip/boafrm/formLogin&#039; --data &#039;{"topicurl":"setting/getSanvas"}&#039;
  └────

  Additionally by using the HTTP Basic in a HEADER the attacker can
  execute router actions without providing captcha at all.

  This affects:
  • A3002RU through 2.0.0,
  • A702R through 2.1.3,
  • N301RT through 2.1.6,
  • N302R through 3.4.0,
  • N300RT through 3.4.0,
  • N200RE through 4.0.0,
  • N150RT through 3.4.0,
  • N100RE through 3.4.0, and
  • possibly others.


5 Exploiting all together on TOTOLINK routers
═════════════════════════════════════════════

  CVSS v3 socre: 9.6 AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H (assuming
  Administrative Access on WAN is enabled the score is 10.0)

  Exploiting all the vulnerabilities together allows a remote
  unauthenticated attacker to execute any code with root permissions and
  reveal administration password.

  The only thing that is needed is the access to router administration
  interface (either access to local network or Administrative Access on
  WAN enabled)

  Description, video and possibly an exploit:
  https://sploit.tech/2019/12/16/Realtek-TOTOLINK.html

